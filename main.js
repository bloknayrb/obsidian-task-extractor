/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => TaskExtractorPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/types.ts
var DEFAULT_FRONTMATTER_FIELDS = [
  { key: "task", defaultValue: "", type: "text", required: true },
  { key: "status", defaultValue: "inbox", type: "select", options: ["inbox", "next", "waiting", "someday", "done", "cancelled"], required: true },
  { key: "priority", defaultValue: "medium", type: "select", options: ["low", "medium", "high", "urgent"], required: true },
  { key: "due", defaultValue: "", type: "date", required: false },
  { key: "project", defaultValue: "", type: "text", required: false },
  { key: "client", defaultValue: "", type: "text", required: false },
  { key: "created", defaultValue: "{{date}}", type: "date", required: true },
  { key: "tags", defaultValue: "task", type: "text", required: false }
];
var DEFAULT_SETTINGS = {
  provider: "openai",
  apiKey: "",
  model: "gpt-4o-mini",
  // Local LLM settings
  ollamaUrl: "http://localhost:11434",
  lmstudioUrl: "http://localhost:1234",
  anthropicUrl: "https://api.anthropic.com/v1/messages",
  localModelRefreshInterval: 5,
  // Processing settings
  tasksFolder: "Tasks",
  linkBack: true,
  processedFrontmatterKey: "taskExtractor.processed",
  ownerName: "Bryan Kolb",
  processOnUpdate: false,
  triggerTypes: ["email", "meetingnote", "meeting note", "meeting notes"],
  triggerFrontmatterField: "Type",
  // default to "Type" for backward compatibility
  // Exclusion settings
  excludedPaths: [],
  excludedPatterns: [],
  // Customizable frontmatter
  frontmatterFields: DEFAULT_FRONTMATTER_FIELDS,
  customPrompt: "",
  // Advanced settings
  maxTokens: 800,
  temperature: 0,
  timeout: 30,
  retries: 3,
  // Debug settings
  debugMode: false,
  debugMaxEntries: 1e3
};
function validateSettings(settings, debugLogger) {
  const correlationId = debugLogger ? `validate-settings-${Date.now()}` : void 0;
  const validated = { ...DEFAULT_SETTINGS };
  if (settings.provider && ["openai", "anthropic", "ollama", "lmstudio"].includes(settings.provider)) {
    validated.provider = settings.provider;
  }
  if (typeof settings.apiKey === "string")
    validated.apiKey = settings.apiKey;
  if (typeof settings.model === "string")
    validated.model = settings.model;
  if (typeof settings.ollamaUrl === "string")
    validated.ollamaUrl = settings.ollamaUrl;
  if (typeof settings.lmstudioUrl === "string")
    validated.lmstudioUrl = settings.lmstudioUrl;
  if (typeof settings.anthropicUrl === "string")
    validated.anthropicUrl = settings.anthropicUrl;
  if (typeof settings.tasksFolder === "string" && settings.tasksFolder.trim()) {
    validated.tasksFolder = settings.tasksFolder.trim();
  }
  if (typeof settings.ownerName === "string" && settings.ownerName.trim()) {
    validated.ownerName = settings.ownerName.trim();
  }
  if (typeof settings.customPrompt === "string")
    validated.customPrompt = settings.customPrompt;
  if (typeof settings.processedFrontmatterKey === "string") {
    const key = settings.processedFrontmatterKey.trim();
    const parts = key.split(".");
    const yamlKeyPattern = /^[a-zA-Z_][a-zA-Z0-9_-]*$/;
    const isValid = parts.every((part) => part && yamlKeyPattern.test(part));
    if (isValid) {
      validated.processedFrontmatterKey = key;
    }
  }
  if (typeof settings.triggerFrontmatterField === "string") {
    const field = settings.triggerFrontmatterField.trim();
    const yamlKeyPattern = /^[a-zA-Z_][a-zA-Z0-9_.-]*$/;
    if (field && yamlKeyPattern.test(field) && !field.includes("..") && !field.startsWith(".") && !field.endsWith(".")) {
      validated.triggerFrontmatterField = field;
    }
  }
  if (typeof settings.linkBack === "boolean")
    validated.linkBack = settings.linkBack;
  if (typeof settings.processOnUpdate === "boolean")
    validated.processOnUpdate = settings.processOnUpdate;
  if (Array.isArray(settings.triggerTypes)) {
    const validTypes = settings.triggerTypes.filter((t) => typeof t === "string" && t.trim().length > 0).map((t) => t.trim());
    if (validTypes.length > 0) {
      validated.triggerTypes = validTypes;
    }
  }
  if (Array.isArray(settings.frontmatterFields)) {
    const validFields = settings.frontmatterFields.filter(
      (f) => f && typeof f.key === "string" && f.key.trim().length > 0 && typeof f.defaultValue === "string" && typeof f.type === "string" && ["text", "date", "select", "boolean"].includes(f.type) && typeof f.required === "boolean"
    );
    if (validFields.length > 0) {
      validated.frontmatterFields = validFields;
    }
  }
  if (Array.isArray(settings.excludedPaths)) {
    const validPaths = settings.excludedPaths.filter((p) => typeof p === "string" && p.trim().length > 0).map((p) => p.trim()).filter((p) => {
      return p.length > 0 && p.length < 500;
    });
    validated.excludedPaths = validPaths;
  }
  if (Array.isArray(settings.excludedPatterns)) {
    const validPatterns = settings.excludedPatterns.filter((p) => typeof p === "string" && p.trim().length > 0).map((p) => p.trim()).filter((p) => {
      return p.length > 0 && p.length < 500 && !/[<>:"|?]/.test(p);
    });
    validated.excludedPatterns = validPatterns;
  }
  if (typeof settings.localModelRefreshInterval === "number" && !isNaN(settings.localModelRefreshInterval)) {
    validated.localModelRefreshInterval = Math.max(1, Math.min(60, settings.localModelRefreshInterval));
  }
  if (typeof settings.maxTokens === "number" && !isNaN(settings.maxTokens)) {
    validated.maxTokens = Math.max(100, Math.min(2e3, settings.maxTokens));
  }
  if (typeof settings.temperature === "number" && !isNaN(settings.temperature)) {
    validated.temperature = Math.max(0, Math.min(1, settings.temperature));
  }
  if (typeof settings.timeout === "number" && !isNaN(settings.timeout)) {
    validated.timeout = Math.max(10, Math.min(120, settings.timeout));
  }
  if (typeof settings.retries === "number" && !isNaN(settings.retries)) {
    validated.retries = Math.max(1, Math.min(5, settings.retries));
  }
  if (typeof settings.debugMode === "boolean") {
    validated.debugMode = settings.debugMode;
    debugLogger == null ? void 0 : debugLogger.logValidationSuccess("settings", "debugMode", correlationId);
  }
  if (typeof settings.debugMaxEntries === "number" && !isNaN(settings.debugMaxEntries)) {
    const originalValue = settings.debugMaxEntries;
    validated.debugMaxEntries = Math.max(100, Math.min(1e4, settings.debugMaxEntries));
    if (originalValue !== validated.debugMaxEntries) {
      debugLogger == null ? void 0 : debugLogger.logValidation("settings", "debugMaxEntries", originalValue, "100-10000", `Value clamped from ${originalValue} to ${validated.debugMaxEntries}`, correlationId);
    } else {
      debugLogger == null ? void 0 : debugLogger.logValidationSuccess("settings", "debugMaxEntries", correlationId);
    }
  } else if (settings.debugMaxEntries !== void 0) {
    debugLogger == null ? void 0 : debugLogger.logValidation("settings", "debugMaxEntries", settings.debugMaxEntries, "number between 100-10000", "Invalid debug max entries value", correlationId);
  }
  debugLogger == null ? void 0 : debugLogger.log("info", "validation", "Settings validation completed", {
    validatedFieldCount: Object.keys(settings).length,
    correlationId
  }, correlationId);
  return validated;
}

// src/llm-providers.ts
var import_obsidian = require("obsidian");
var LLMProviderManager = class {
  constructor(settings, debugLogger) {
    this.settings = settings;
    this.debugLogger = debugLogger;
    this.serviceCache = /* @__PURE__ */ new Map();
    this.cloudModelCache = /* @__PURE__ */ new Map();
    this.apiKeyMissingNotified = /* @__PURE__ */ new Set();
  }
  // Get service with 30-minute cache TTL
  async getService(provider) {
    const cached = this.serviceCache.get(provider);
    const now = Date.now();
    const cacheValidMs = 30 * 60 * 1e3;
    if (cached && now - cached.lastChecked < cacheValidMs) {
      return cached;
    }
    return await this.detectSingleService(provider);
  }
  // Detect a single service instead of all services
  async detectSingleService(provider) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n;
    const now = Date.now();
    const correlationId = (_a = this.debugLogger) == null ? void 0 : _a.startOperation("service-detection", `Detecting service: ${provider}`, {
      provider,
      timestamp: now
    });
    if (provider === "ollama") {
      const service = {
        name: "ollama",
        url: this.settings.ollamaUrl,
        available: false,
        models: [],
        lastChecked: now
      };
      (_b = this.debugLogger) == null ? void 0 : _b.log("info", "service-detection", "Checking Ollama availability", {
        provider: "ollama",
        url: this.settings.ollamaUrl,
        endpoint: `${this.settings.ollamaUrl}/api/tags`
      }, correlationId);
      try {
        const startTime = Date.now();
        const rawResponse = await (0, import_obsidian.requestUrl)({
          url: `${this.settings.ollamaUrl}/api/tags`,
          method: "GET"
        });
        const response = this.adaptRequestUrlResponse(rawResponse);
        const connectionTime = Date.now() - startTime;
        if (response.ok) {
          const data = await response.json();
          service.available = true;
          service.models = ((_c = data.models) == null ? void 0 : _c.map((m) => m.name)) || [];
          (_d = this.debugLogger) == null ? void 0 : _d.log("info", "service-detection", "Ollama service detected successfully", {
            provider: "ollama",
            url: this.settings.ollamaUrl,
            available: true,
            modelCount: service.models.length,
            models: service.models,
            connectionTime,
            status: response.status
          }, correlationId);
        } else {
          (_e = this.debugLogger) == null ? void 0 : _e.log("warn", "service-detection", `Ollama service responded with error: ${response.status}`, {
            provider: "ollama",
            url: this.settings.ollamaUrl,
            available: false,
            status: response.status,
            connectionTime
          }, correlationId);
        }
      } catch (error) {
        console.log("Ollama not available:", error.message);
        (_f = this.debugLogger) == null ? void 0 : _f.log("warn", "service-detection", "Ollama service not available", {
          provider: "ollama",
          url: this.settings.ollamaUrl,
          available: false,
          error: error.message,
          errorType: error.name
        }, correlationId);
      }
      this.serviceCache.set("ollama", service);
      (_g = this.debugLogger) == null ? void 0 : _g.log("info", "service-detection", "Ollama service cache updated", {
        provider: "ollama",
        available: service.available,
        modelCount: service.models.length,
        lastChecked: service.lastChecked
      }, correlationId);
      return service;
    }
    if (provider === "lmstudio") {
      const service = {
        name: "lmstudio",
        url: this.settings.lmstudioUrl,
        available: false,
        models: [],
        lastChecked: now
      };
      (_h = this.debugLogger) == null ? void 0 : _h.log("info", "service-detection", "Checking LM Studio availability", {
        provider: "lmstudio",
        url: this.settings.lmstudioUrl,
        endpoint: `${this.settings.lmstudioUrl}/v1/models`
      }, correlationId);
      try {
        const startTime = Date.now();
        const rawResponse = await (0, import_obsidian.requestUrl)({
          url: `${this.settings.lmstudioUrl}/v1/models`,
          method: "GET"
        });
        const response = this.adaptRequestUrlResponse(rawResponse);
        const connectionTime = Date.now() - startTime;
        if (response.ok) {
          const data = await response.json();
          service.available = true;
          service.models = ((_i = data.data) == null ? void 0 : _i.map((m) => m.id)) || [];
          (_j = this.debugLogger) == null ? void 0 : _j.log("info", "service-detection", "LM Studio service detected successfully", {
            provider: "lmstudio",
            url: this.settings.lmstudioUrl,
            available: true,
            modelCount: service.models.length,
            models: service.models,
            connectionTime,
            status: response.status
          }, correlationId);
        } else {
          (_k = this.debugLogger) == null ? void 0 : _k.log("warn", "service-detection", `LM Studio service responded with error: ${response.status}`, {
            provider: "lmstudio",
            url: this.settings.lmstudioUrl,
            available: false,
            status: response.status,
            connectionTime
          }, correlationId);
        }
      } catch (error) {
        console.log("LM Studio not available:", error.message);
        (_l = this.debugLogger) == null ? void 0 : _l.log("warn", "service-detection", "LM Studio service not available", {
          provider: "lmstudio",
          url: this.settings.lmstudioUrl,
          available: false,
          error: error.message,
          errorType: error.name
        }, correlationId);
      }
      this.serviceCache.set("lmstudio", service);
      (_m = this.debugLogger) == null ? void 0 : _m.log("info", "service-detection", "LM Studio service cache updated", {
        provider: "lmstudio",
        available: service.available,
        modelCount: service.models.length,
        lastChecked: service.lastChecked
      }, correlationId);
      return service;
    }
    (_n = this.debugLogger) == null ? void 0 : _n.log("warn", "service-detection", `Unknown provider requested: ${provider}`, {
      provider,
      supportedProviders: ["ollama", "lmstudio"]
    }, correlationId);
    return null;
  }
  // Legacy method for backward compatibility
  async detectServices() {
    await this.getService("ollama");
    await this.getService("lmstudio");
    return this.serviceCache;
  }
  getAvailableServices() {
    return Array.from(this.serviceCache.values()).filter((s) => s.available);
  }
  // Provider-agnostic LLM call with fallback support
  async callLLM(systemPrompt, userPrompt) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    const provider = this.settings.provider;
    const correlationId = (_a = this.debugLogger) == null ? void 0 : _a.startOperation("llm-call", `Starting LLM call with provider: ${provider}`, {
      provider,
      model: this.settings.model
    });
    if (["openai", "anthropic"].includes(provider) && (!this.settings.apiKey || this.settings.apiKey.trim().length === 0)) {
      const notificationKey = `${provider}-no-api-key`;
      if (!this.apiKeyMissingNotified.has(notificationKey)) {
        console.warn(`Task Extractor: ${provider.toUpperCase()} API key not configured in plugin settings`);
        this.apiKeyMissingNotified.add(notificationKey);
        (_b = this.debugLogger) == null ? void 0 : _b.log("error", "llm-call", `API key missing for ${provider}`, {
          provider,
          notificationKey
        }, correlationId);
      }
      return null;
    }
    if (this.settings.apiKey && this.settings.apiKey.trim().length > 0) {
      this.apiKeyMissingNotified.delete(`${provider}-no-api-key`);
    }
    const configValidation = this.validateProviderConfig(provider);
    if (!configValidation.valid) {
      (_c = this.debugLogger) == null ? void 0 : _c.log("error", "llm-call", `Configuration validation failed for ${provider}`, {
        provider,
        errors: configValidation.errors
      }, correlationId);
      console.error(`Task Extractor: ${provider} configuration errors:`, configValidation.errors.join(", "));
      return null;
    }
    for (let attempt = 0; attempt < this.settings.retries; attempt++) {
      const startTime = Date.now();
      (_d = this.debugLogger) == null ? void 0 : _d.log("info", "llm-call", `Attempt ${attempt + 1}/${this.settings.retries} for ${provider}`, {
        provider,
        model: this.settings.model,
        retryAttempt: attempt + 1
      }, correlationId);
      try {
        let result = null;
        switch (provider) {
          case "openai":
            result = await this.callOpenAI(systemPrompt, userPrompt, correlationId);
            break;
          case "anthropic":
            result = await this.callAnthropic(systemPrompt, userPrompt, correlationId);
            break;
          case "ollama":
            result = await this.callOllama(systemPrompt, userPrompt, correlationId);
            break;
          case "lmstudio":
            result = await this.callLMStudio(systemPrompt, userPrompt, correlationId);
            break;
          default:
            throw new Error(`Unsupported provider: ${provider}`);
        }
        if (result) {
          const processingTime = Date.now() - startTime;
          (_e = this.debugLogger) == null ? void 0 : _e.log("info", "llm-call", `LLM call successful on attempt ${attempt + 1}`, {
            provider,
            model: this.settings.model,
            processingTime,
            retryAttempt: attempt + 1,
            responseLength: result.length
          }, correlationId);
          return result;
        }
      } catch (error) {
        const processingTime = Date.now() - startTime;
        console.warn(`Attempt ${attempt + 1} failed for ${provider}:`, error.message);
        (_f = this.debugLogger) == null ? void 0 : _f.log("warn", "llm-call", `Attempt ${attempt + 1} failed for ${provider}`, {
          provider,
          model: this.settings.model,
          error: error.message,
          processingTime,
          retryAttempt: attempt + 1
        }, correlationId);
        if (attempt === this.settings.retries - 1) {
          if (["ollama", "lmstudio"].includes(provider)) {
            (_g = this.debugLogger) == null ? void 0 : _g.log("info", "llm-call", `All attempts failed, trying local fallback`, {
              provider,
              totalAttempts: this.settings.retries
            }, correlationId);
            return await this.tryLocalFallback(systemPrompt, userPrompt, correlationId);
          }
        } else {
          const backoffDelay = 1e3 * (attempt + 1);
          (_h = this.debugLogger) == null ? void 0 : _h.log("info", "llm-call", `Waiting ${backoffDelay}ms before retry`, {
            provider,
            backoffDelay,
            nextAttempt: attempt + 2
          }, correlationId);
          await this.delay(backoffDelay);
        }
      }
    }
    return null;
  }
  async tryLocalFallback(systemPrompt, userPrompt, correlationId) {
    var _a, _b, _c, _d;
    const availableServices = this.getAvailableServices();
    (_a = this.debugLogger) == null ? void 0 : _a.log("info", "llm-call", `Trying local fallback with ${availableServices.length} available services`, {
      availableServices: availableServices.map((s) => s.name),
      primaryProvider: this.settings.provider
    }, correlationId);
    for (const service of availableServices) {
      if (service.name === this.settings.provider)
        continue;
      try {
        console.log(`Trying fallback to ${service.name}`);
        (_b = this.debugLogger) == null ? void 0 : _b.log("info", "llm-call", `Attempting fallback to ${service.name}`, {
          fallbackProvider: service.name,
          availableModels: service.models
        }, correlationId);
        if (service.name === "ollama") {
          return await this.callOllama(systemPrompt, userPrompt, correlationId);
        } else if (service.name === "lmstudio") {
          return await this.callLMStudio(systemPrompt, userPrompt, correlationId);
        }
      } catch (error) {
        console.warn(`Fallback to ${service.name} failed:`, error.message);
        (_c = this.debugLogger) == null ? void 0 : _c.log("warn", "llm-call", `Fallback to ${service.name} failed`, {
          fallbackProvider: service.name,
          error: error.message
        }, correlationId);
      }
    }
    console.warn("Task Extractor: All LLM services failed. Check your configuration.");
    (_d = this.debugLogger) == null ? void 0 : _d.log("error", "llm-call", "All LLM services failed including fallbacks", {
      primaryProvider: this.settings.provider,
      availableServices: availableServices.map((s) => s.name)
    }, correlationId);
    return null;
  }
  async callOpenAI(systemPrompt, userPrompt, correlationId) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _i;
    const endpoint = "https://api.openai.com/v1/chat/completions";
    const model = this.settings.model || "gpt-4o-mini";
    const body = {
      model,
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt }
      ],
      temperature: this.settings.temperature,
      max_tokens: this.settings.maxTokens
    };
    const maskedApiKey = this.settings.apiKey ? `...${this.settings.apiKey.slice(-4)}` : "none";
    (_a = this.debugLogger) == null ? void 0 : _a.log("info", "llm-call", "Sending OpenAI API request", {
      provider: "openai",
      model,
      endpoint,
      apiKey: maskedApiKey,
      requestPayload: {
        ...body,
        messages: body.messages.map((m) => ({ role: m.role, contentLength: m.content.length }))
      }
    }, correlationId);
    try {
      const startTime = Date.now();
      const rawResp = await (0, import_obsidian.requestUrl)({
        url: endpoint,
        method: "POST",
        headers: {
          "Authorization": `Bearer ${this.settings.apiKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
      const resp = this.adaptRequestUrlResponse(rawResp);
      const processingTime = Date.now() - startTime;
      if (!resp.ok) {
        const text = await resp.text();
        console.error("OpenAI error", resp.status, text);
        let errorMessage = `OpenAI API error: ${resp.status} ${resp.statusText}`;
        if (resp.status === 401) {
          errorMessage += ". Check that your OpenAI API key is valid and properly configured.";
        } else if (resp.status === 400) {
          errorMessage += ". Request format may be invalid - check model name and request parameters.";
        } else if (resp.status === 429) {
          errorMessage += ". Rate limit exceeded - please try again later.";
        } else if (resp.status === 403) {
          errorMessage += ". Access denied - check API key permissions.";
        }
        (_b = this.debugLogger) == null ? void 0 : _b.log("error", "llm-call", `OpenAI API error: ${resp.status}`, {
          provider: "openai",
          model,
          endpoint,
          status: resp.status,
          statusText: resp.statusText,
          error: text,
          processingTime,
          requestBody: {
            model,
            temperature: this.settings.temperature,
            max_tokens: this.settings.maxTokens
          }
        }, correlationId);
        throw new Error(errorMessage);
      }
      const json = await resp.json();
      const content = ((_e = (_d = (_c = json == null ? void 0 : json.choices) == null ? void 0 : _c[0]) == null ? void 0 : _d.message) == null ? void 0 : _e.content) || null;
      const tokenUsage = ((_f = json == null ? void 0 : json.usage) == null ? void 0 : _f.total_tokens) || 0;
      (_h = this.debugLogger) == null ? void 0 : _h.log("info", "llm-call", "OpenAI API response received", {
        provider: "openai",
        model,
        status: resp.status,
        tokenUsage,
        responseLength: (content == null ? void 0 : content.length) || 0,
        processingTime,
        responseData: {
          choices: ((_g = json == null ? void 0 : json.choices) == null ? void 0 : _g.length) || 0,
          usage: json == null ? void 0 : json.usage
        }
      }, correlationId);
      return content;
    } catch (e) {
      console.error("callOpenAI error", e);
      (_i = this.debugLogger) == null ? void 0 : _i.log("error", "llm-call", "OpenAI API call failed", {
        provider: "openai",
        model,
        error: e.message
      }, correlationId);
      throw e;
    }
  }
  async callAnthropic(systemPrompt, userPrompt, correlationId) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j;
    let endpoint = this.settings.anthropicUrl || "https://api.anthropic.com/v1/messages";
    if (endpoint.includes("anthropic.com") && !endpoint.includes("/v1/messages")) {
      endpoint = "https://api.anthropic.com/v1/messages";
      console.warn("Task Extractor: Fixed invalid Anthropic URL to use correct /v1/messages endpoint");
      (_a = this.debugLogger) == null ? void 0 : _a.log("warn", "llm-call", "Fixed invalid Anthropic URL", {
        provider: "anthropic",
        originalUrl: this.settings.anthropicUrl,
        fixedUrl: endpoint
      }, correlationId);
    }
    const model = this.settings.model || "claude-3-5-haiku-20241022";
    const requestBody = {
      model,
      max_tokens: this.settings.maxTokens,
      temperature: this.settings.temperature,
      system: systemPrompt,
      messages: [{
        role: "user",
        content: userPrompt
      }]
    };
    const maskedApiKey = this.settings.apiKey ? `...${this.settings.apiKey.slice(-4)}` : "none";
    (_b = this.debugLogger) == null ? void 0 : _b.log("info", "llm-call", "Sending Anthropic API request", {
      provider: "anthropic",
      model,
      endpoint,
      apiKey: maskedApiKey,
      requestPayload: {
        ...requestBody,
        system: `${systemPrompt.length} chars`,
        messages: requestBody.messages.map((m) => ({ role: m.role, contentLength: m.content.length }))
      }
    }, correlationId);
    try {
      const startTime = Date.now();
      const rawResp = await (0, import_obsidian.requestUrl)({
        url: endpoint,
        method: "POST",
        headers: {
          "x-api-key": this.settings.apiKey,
          "Content-Type": "application/json",
          "anthropic-version": "2023-06-01"
        },
        body: JSON.stringify(requestBody)
      });
      const resp = this.adaptRequestUrlResponse(rawResp);
      const processingTime = Date.now() - startTime;
      if (!resp.ok) {
        const text = await resp.text();
        console.error("Anthropic error", resp.status, text);
        let errorMessage = `Anthropic API error: ${resp.status} ${resp.statusText}`;
        if (resp.status === 404) {
          errorMessage += ". Check that anthropicUrl setting uses the correct endpoint: https://api.anthropic.com/v1/messages";
        } else if (resp.status === 401 || resp.status === 403) {
          errorMessage += ". Check that your Anthropic API key is valid and has proper permissions.";
        } else if (resp.status === 400) {
          errorMessage += ". Request format may be invalid - check model name and request parameters.";
        }
        (_c = this.debugLogger) == null ? void 0 : _c.log("error", "llm-call", `Anthropic API error: ${resp.status}`, {
          provider: "anthropic",
          model,
          endpoint,
          status: resp.status,
          statusText: resp.statusText,
          error: text,
          processingTime,
          requestBody: {
            model,
            max_tokens: this.settings.maxTokens,
            temperature: this.settings.temperature
          }
        }, correlationId);
        throw new Error(errorMessage);
      }
      const json = await resp.json();
      const content = ((_e = (_d = json == null ? void 0 : json.content) == null ? void 0 : _d[0]) == null ? void 0 : _e.text) || null;
      const tokenUsage = ((_f = json == null ? void 0 : json.usage) == null ? void 0 : _f.input_tokens) + ((_g = json == null ? void 0 : json.usage) == null ? void 0 : _g.output_tokens) || 0;
      (_i = this.debugLogger) == null ? void 0 : _i.log("info", "llm-call", "Anthropic API response received", {
        provider: "anthropic",
        model,
        status: resp.status,
        tokenUsage,
        responseLength: (content == null ? void 0 : content.length) || 0,
        processingTime,
        responseData: {
          contentBlocks: ((_h = json == null ? void 0 : json.content) == null ? void 0 : _h.length) || 0,
          usage: json == null ? void 0 : json.usage
        }
      }, correlationId);
      return content;
    } catch (e) {
      console.error("callAnthropic error", e);
      (_j = this.debugLogger) == null ? void 0 : _j.log("error", "llm-call", "Anthropic API call failed", {
        provider: "anthropic",
        model,
        error: e.message
      }, correlationId);
      throw e;
    }
  }
  async callOllama(systemPrompt, userPrompt, correlationId) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    const service = await this.getService("ollama");
    if (!(service == null ? void 0 : service.available) || !service.models.length) {
      (_b = this.debugLogger) == null ? void 0 : _b.log("error", "llm-call", "Ollama service not available or no models loaded", {
        provider: "ollama",
        serviceAvailable: (service == null ? void 0 : service.available) || false,
        modelCount: ((_a = service == null ? void 0 : service.models) == null ? void 0 : _a.length) || 0,
        url: this.settings.ollamaUrl
      }, correlationId);
      throw new Error("Ollama service not available or no models loaded");
    }
    const model = service.models.includes(this.settings.model) ? this.settings.model : service.models[0];
    const endpoint = `${this.settings.ollamaUrl}/api/chat`;
    const requestBody = {
      model,
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt }
      ],
      stream: false,
      options: {
        temperature: this.settings.temperature,
        num_predict: this.settings.maxTokens
      }
    };
    (_c = this.debugLogger) == null ? void 0 : _c.log("info", "llm-call", "Sending Ollama API request", {
      provider: "ollama",
      model,
      endpoint,
      url: this.settings.ollamaUrl,
      availableModels: service.models,
      requestPayload: {
        ...requestBody,
        messages: requestBody.messages.map((m) => ({ role: m.role, contentLength: m.content.length }))
      }
    }, correlationId);
    try {
      const startTime = Date.now();
      const rawResp = await (0, import_obsidian.requestUrl)({
        url: endpoint,
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });
      const resp = this.adaptRequestUrlResponse(rawResp);
      const processingTime = Date.now() - startTime;
      if (!resp.ok) {
        const text = await resp.text();
        console.error("Ollama error", resp.status, text);
        (_d = this.debugLogger) == null ? void 0 : _d.log("error", "llm-call", `Ollama API error: ${resp.status}`, {
          provider: "ollama",
          model,
          status: resp.status,
          statusText: resp.statusText,
          error: text,
          processingTime,
          url: this.settings.ollamaUrl
        }, correlationId);
        throw new Error(`Ollama API error: ${resp.status} ${resp.statusText}`);
      }
      const json = await resp.json();
      const content = ((_e = json == null ? void 0 : json.message) == null ? void 0 : _e.content) || null;
      (_g = this.debugLogger) == null ? void 0 : _g.log("info", "llm-call", "Ollama API response received", {
        provider: "ollama",
        model,
        status: resp.status,
        responseLength: (content == null ? void 0 : content.length) || 0,
        processingTime,
        responseData: {
          hasMessage: !!(json == null ? void 0 : json.message),
          messageRole: (_f = json == null ? void 0 : json.message) == null ? void 0 : _f.role
        }
      }, correlationId);
      return content;
    } catch (e) {
      console.error("callOllama error", e);
      (_h = this.debugLogger) == null ? void 0 : _h.log("error", "llm-call", "Ollama API call failed", {
        provider: "ollama",
        model,
        error: e.message,
        url: this.settings.ollamaUrl
      }, correlationId);
      throw e;
    }
  }
  async callLMStudio(systemPrompt, userPrompt, correlationId) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k;
    const service = await this.getService("lmstudio");
    if (!(service == null ? void 0 : service.available) || !service.models.length) {
      (_b = this.debugLogger) == null ? void 0 : _b.log("error", "llm-call", "LM Studio service not available or no models loaded", {
        provider: "lmstudio",
        serviceAvailable: (service == null ? void 0 : service.available) || false,
        modelCount: ((_a = service == null ? void 0 : service.models) == null ? void 0 : _a.length) || 0,
        url: this.settings.lmstudioUrl
      }, correlationId);
      throw new Error("LM Studio service not available or no models loaded");
    }
    const model = service.models.includes(this.settings.model) ? this.settings.model : service.models[0];
    const endpoint = `${this.settings.lmstudioUrl}/v1/chat/completions`;
    const requestBody = {
      model,
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt }
      ],
      temperature: this.settings.temperature,
      max_tokens: this.settings.maxTokens
    };
    (_c = this.debugLogger) == null ? void 0 : _c.log("info", "llm-call", "Sending LM Studio API request", {
      provider: "lmstudio",
      model,
      endpoint,
      url: this.settings.lmstudioUrl,
      availableModels: service.models,
      requestPayload: {
        ...requestBody,
        messages: requestBody.messages.map((m) => ({ role: m.role, contentLength: m.content.length }))
      }
    }, correlationId);
    try {
      const startTime = Date.now();
      const rawResp = await (0, import_obsidian.requestUrl)({
        url: endpoint,
        method: "POST",
        headers: {
          "Authorization": "Bearer lm-studio",
          // Placeholder auth
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });
      const resp = this.adaptRequestUrlResponse(rawResp);
      const processingTime = Date.now() - startTime;
      if (!resp.ok) {
        const text = await resp.text();
        console.error("LM Studio error", resp.status, text);
        (_d = this.debugLogger) == null ? void 0 : _d.log("error", "llm-call", `LM Studio API error: ${resp.status}`, {
          provider: "lmstudio",
          model,
          status: resp.status,
          statusText: resp.statusText,
          error: text,
          processingTime,
          url: this.settings.lmstudioUrl
        }, correlationId);
        throw new Error(`LM Studio API error: ${resp.status} ${resp.statusText}`);
      }
      const json = await resp.json();
      const content = ((_g = (_f = (_e = json == null ? void 0 : json.choices) == null ? void 0 : _e[0]) == null ? void 0 : _f.message) == null ? void 0 : _g.content) || null;
      const tokenUsage = ((_h = json == null ? void 0 : json.usage) == null ? void 0 : _h.total_tokens) || 0;
      (_j = this.debugLogger) == null ? void 0 : _j.log("info", "llm-call", "LM Studio API response received", {
        provider: "lmstudio",
        model,
        status: resp.status,
        tokenUsage,
        responseLength: (content == null ? void 0 : content.length) || 0,
        processingTime,
        responseData: {
          choices: ((_i = json == null ? void 0 : json.choices) == null ? void 0 : _i.length) || 0,
          usage: json == null ? void 0 : json.usage
        }
      }, correlationId);
      return content;
    } catch (e) {
      console.error("callLMStudio error", e);
      (_k = this.debugLogger) == null ? void 0 : _k.log("error", "llm-call", "LM Studio API call failed", {
        provider: "lmstudio",
        model,
        error: e.message,
        url: this.settings.lmstudioUrl
      }, correlationId);
      throw e;
    }
  }
  // Fetch available models for cloud providers
  async fetchCloudModels(provider) {
    var _a, _b, _c, _d, _e;
    const correlationId = (_a = this.debugLogger) == null ? void 0 : _a.startOperation("service-detection", `Fetching cloud models for provider: ${provider}`, {
      provider,
      hasApiKey: !!this.settings.apiKey
    });
    if (!this.settings.apiKey) {
      (_b = this.debugLogger) == null ? void 0 : _b.log("warn", "service-detection", `No API key available for ${provider}`, {
        provider
      }, correlationId);
      return [];
    }
    const cacheKey = `${provider}-${this.settings.apiKey.slice(-4)}`;
    if (this.cloudModelCache.has(cacheKey)) {
      const cachedModels = this.cloudModelCache.get(cacheKey) || [];
      (_c = this.debugLogger) == null ? void 0 : _c.log("info", "service-detection", `Using cached models for ${provider}`, {
        provider,
        cacheKey: cacheKey.replace(/-.*$/, "-****"),
        // Mask API key in logs
        modelCount: cachedModels.length,
        models: cachedModels
      }, correlationId);
      return cachedModels;
    }
    (_d = this.debugLogger) == null ? void 0 : _d.log("info", "service-detection", `Cache miss, fetching fresh models for ${provider}`, {
      provider,
      cacheKey: cacheKey.replace(/-.*$/, "-****")
    }, correlationId);
    try {
      if (provider === "openai") {
        return await this.fetchOpenAIModels(correlationId);
      } else if (provider === "anthropic") {
        return await this.fetchAnthropicModels(correlationId);
      }
    } catch (error) {
      console.warn(`Failed to fetch ${provider} models:`, error.message);
      const defaultModels = this.getDefaultModels(provider);
      (_e = this.debugLogger) == null ? void 0 : _e.log("error", "service-detection", `Failed to fetch ${provider} models, using defaults`, {
        provider,
        error: error.message,
        errorType: error.name,
        defaultModels,
        defaultModelCount: defaultModels.length
      }, correlationId);
      return defaultModels;
    }
    return [];
  }
  async fetchOpenAIModels(correlationId) {
    var _a, _b, _c, _d, _e, _f, _g;
    const endpoint = "https://api.openai.com/v1/models";
    const maskedApiKey = this.settings.apiKey ? `...${this.settings.apiKey.slice(-4)}` : "none";
    (_a = this.debugLogger) == null ? void 0 : _a.log("info", "service-detection", "Fetching OpenAI models", {
      provider: "openai",
      endpoint,
      apiKey: maskedApiKey
    }, correlationId);
    try {
      const startTime = Date.now();
      const rawResponse = await (0, import_obsidian.requestUrl)({
        url: endpoint,
        method: "GET",
        headers: {
          "Authorization": `Bearer ${this.settings.apiKey}`,
          "Content-Type": "application/json"
        }
      });
      const response = this.adaptRequestUrlResponse(rawResponse);
      const processingTime = Date.now() - startTime;
      if (!response.ok) {
        (_b = this.debugLogger) == null ? void 0 : _b.log("error", "service-detection", `OpenAI models API error: ${response.status}`, {
          provider: "openai",
          endpoint,
          status: response.status,
          statusText: response.statusText,
          processingTime
        }, correlationId);
        throw new Error(`OpenAI API error: ${response.status}`);
      }
      const data = await response.json();
      const allModels = data.data || [];
      const models = ((_d = (_c = allModels == null ? void 0 : allModels.filter((model) => model.id.includes("gpt") && !model.id.includes("instruct"))) == null ? void 0 : _c.map((model) => model.id)) == null ? void 0 : _d.sort()) || [];
      (_e = this.debugLogger) == null ? void 0 : _e.log("info", "service-detection", "OpenAI models fetched successfully", {
        provider: "openai",
        endpoint,
        status: response.status,
        processingTime,
        totalModelsReceived: allModels.length,
        filteredModelCount: models.length,
        models
      }, correlationId);
      const cacheKey = `openai-${this.settings.apiKey.slice(-4)}`;
      this.cloudModelCache.set(cacheKey, models);
      (_f = this.debugLogger) == null ? void 0 : _f.log("info", "service-detection", "OpenAI models cached successfully", {
        provider: "openai",
        cacheKey: cacheKey.replace(/-.*$/, "-****"),
        // Mask API key in logs
        modelCount: models.length
      }, correlationId);
      return models.length > 0 ? models : this.getDefaultModels("openai");
    } catch (e) {
      (_g = this.debugLogger) == null ? void 0 : _g.log("error", "service-detection", "OpenAI models fetch failed", {
        provider: "openai",
        endpoint,
        error: e.message,
        errorType: e.name
      }, correlationId);
      return this.getDefaultModels("openai");
    }
  }
  async fetchAnthropicModels(correlationId) {
    var _a, _b, _c;
    (_a = this.debugLogger) == null ? void 0 : _a.log("info", "service-detection", "Fetching Anthropic models (using known model list)", {
      provider: "anthropic",
      reason: "no-public-models-api"
    }, correlationId);
    const knownModels = [
      // Current generation (2025) - Recommended
      "claude-opus-4-1-20250805",
      // Latest and most capable
      "claude-opus-4-20250514",
      // Previous Opus 4
      "claude-sonnet-4-20250514",
      // High-performance Sonnet 4
      "claude-3-7-sonnet-20250219",
      // Hybrid reasoning model
      // Claude 3.5 series
      "claude-3-5-sonnet-20241022",
      // Sonnet 3.5 v2
      "claude-3-5-sonnet-20240620",
      // Original Sonnet 3.5
      "claude-3-5-haiku-20241022",
      // Fast Haiku 3.5
      // Claude 3 series (legacy)
      "claude-3-opus-20240229",
      // Legacy Opus 3
      "claude-3-sonnet-20240229",
      // Legacy Sonnet 3
      "claude-3-haiku-20240307"
      // Legacy Haiku 3
    ];
    (_b = this.debugLogger) == null ? void 0 : _b.log("info", "service-detection", "Anthropic models retrieved successfully", {
      provider: "anthropic",
      modelCount: knownModels.length,
      models: knownModels,
      source: "hardcoded-known-models"
    }, correlationId);
    const cacheKey = `anthropic-${this.settings.apiKey.slice(-4)}`;
    this.cloudModelCache.set(cacheKey, knownModels);
    (_c = this.debugLogger) == null ? void 0 : _c.log("info", "service-detection", "Anthropic models cached successfully", {
      provider: "anthropic",
      cacheKey: cacheKey.replace(/-.*$/, "-****"),
      // Mask API key in logs
      modelCount: knownModels.length
    }, correlationId);
    return knownModels;
  }
  getDefaultModels(provider) {
    const defaults = {
      openai: ["gpt-4o", "gpt-4o-mini", "gpt-4-turbo", "gpt-3.5-turbo"],
      anthropic: ["claude-opus-4-1-20250805", "claude-sonnet-4-20250514", "claude-3-7-sonnet-20250219", "claude-3-5-sonnet-20241022", "claude-3-5-haiku-20241022", "claude-3-opus-20240229"],
      ollama: ["llama3.2", "mistral", "codellama"],
      lmstudio: ["local-model"]
    };
    return defaults[provider] || [];
  }
  // Configuration validation method
  validateProviderConfig(provider) {
    const errors = [];
    switch (provider) {
      case "openai":
        if (!this.settings.apiKey || this.settings.apiKey.trim().length === 0) {
          errors.push("OpenAI API key is missing");
        } else if (!this.settings.apiKey.startsWith("sk-")) {
          errors.push('OpenAI API key should start with "sk-"');
        }
        if (!this.settings.model || this.settings.model.trim().length === 0) {
          errors.push("OpenAI model is not specified");
        }
        break;
      case "anthropic":
        if (!this.settings.apiKey || this.settings.apiKey.trim().length === 0) {
          errors.push("Anthropic API key is missing");
        }
        const anthropicUrl = this.settings.anthropicUrl || "https://api.anthropic.com/v1/messages";
        if (!anthropicUrl.includes("api.anthropic.com/v1/messages")) {
          errors.push("Anthropic URL must point to https://api.anthropic.com/v1/messages");
        }
        if (!this.settings.model || this.settings.model.trim().length === 0) {
          errors.push("Anthropic model is not specified");
        }
        break;
      case "ollama":
        if (!this.settings.ollamaUrl || this.settings.ollamaUrl.trim().length === 0) {
          errors.push("Ollama URL is missing");
        }
        break;
      case "lmstudio":
        if (!this.settings.lmstudioUrl || this.settings.lmstudioUrl.trim().length === 0) {
          errors.push("LM Studio URL is missing");
        }
        break;
      default:
        errors.push(`Unsupported provider: ${provider}`);
    }
    return { valid: errors.length === 0, errors };
  }
  // Utility methods
  delay(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  createTimeoutSignal(ms) {
    const controller = new AbortController();
    setTimeout(() => controller.abort(), ms);
    return controller.signal;
  }
  // Cleanup method
  cleanup() {
    this.cloudModelCache.clear();
    this.apiKeyMissingNotified.clear();
    this.serviceCache.clear();
  }
  // Helper to adapt requestUrl response to fetch-like interface
  adaptRequestUrlResponse(response) {
    return {
      ok: response.status >= 200 && response.status < 300,
      status: response.status,
      statusText: response.status.toString(),
      json: async () => response.json,
      text: async () => response.text
    };
  }
  // Methods for backward compatibility
  getServiceCache() {
    return this.serviceCache;
  }
  getCloudModelCache() {
    return this.cloudModelCache;
  }
  getApiKeyMissingNotified() {
    return this.apiKeyMissingNotified;
  }
};

// src/task-processor.ts
var import_obsidian2 = require("obsidian");
var TaskProcessor = class {
  constructor(app, settings, llmProvider, debugLogger) {
    this.app = app;
    this.settings = settings;
    this.llmProvider = llmProvider;
    this.debugLogger = debugLogger;
    this.processingFiles = /* @__PURE__ */ new Set();
    this.fileChangeDebouncer = /* @__PURE__ */ new Map();
    this.processingQueue = /* @__PURE__ */ new Map();
  }
  /**
   * Conditional logging helper to ensure zero overhead when debug mode is disabled
   */
  log(level, category, message, data, correlationId) {
    var _a;
    if ((_a = this.debugLogger) == null ? void 0 : _a.isEnabled()) {
      this.debugLogger.log(level, category, message, data, correlationId);
    }
  }
  /**
   * Start a new operation for correlation tracking
   */
  startOperation(category, message, data) {
    var _a;
    if ((_a = this.debugLogger) == null ? void 0 : _a.isEnabled()) {
      return this.debugLogger.startOperation(category, message, data);
    }
    return void 0;
  }
  // Debounce file changes to prevent rapid processing
  debounceFileChange(file, callback) {
    const existing = this.fileChangeDebouncer.get(file.path);
    if (existing) {
      clearTimeout(existing);
    }
    this.fileChangeDebouncer.set(file.path, setTimeout(() => {
      callback(file);
      this.fileChangeDebouncer.delete(file.path);
    }, 2e3));
  }
  // When a file is created or modified
  async onFileChanged(file) {
    var _a, _b, _c, _d, _e, _f, _g;
    if (file.extension !== "md") {
      this.log("info", "file-processing", "File skipped: not a markdown file", {
        filePath: file.path,
        extension: file.extension
      });
      return;
    }
    const correlationId = this.startOperation("file-processing", "Processing file", {
      filePath: file.path
    });
    if (this.isFileExcluded(file.path)) {
      this.log("info", "file-processing", "File skipped: excluded by user rules", {
        filePath: file.path,
        excludedPaths: this.settings.excludedPaths,
        excludedPatterns: this.settings.excludedPatterns
      }, correlationId);
      return;
    }
    const queueStatus = this.processingQueue.get(file.path);
    if ((queueStatus == null ? void 0 : queueStatus.status) === "processing" || this.processingFiles.has(file.path)) {
      this.log("info", "file-processing", "File skipped: already being processed", {
        filePath: file.path,
        queueStatus: queueStatus == null ? void 0 : queueStatus.status,
        inProcessingSet: this.processingFiles.has(file.path)
      }, correlationId);
      return;
    }
    const processingStatus = {
      status: "queued",
      startTime: Date.now()
    };
    processingStatus.timeout = setTimeout(() => {
      console.warn(`TaskExtractor: File processing timeout for ${file.path}`);
      this.cleanupFileProcessing(file.path);
    }, 3e4);
    this.processingQueue.set(file.path, processingStatus);
    this.processingFiles.add(file.path);
    processingStatus.status = "processing";
    try {
      const cache = this.app.metadataCache.getFileCache(file);
      const front = cache == null ? void 0 : cache.frontmatter;
      if (!front) {
        this.log("info", "file-processing", "File skipped: no frontmatter found", {
          filePath: file.path
        }, correlationId);
        return;
      }
      this.log("info", "file-processing", "File has frontmatter, validating", {
        filePath: file.path,
        frontmatterKeys: Object.keys(front)
      }, correlationId);
      if (!this.settings.triggerTypes || !Array.isArray(this.settings.triggerTypes) || this.settings.triggerTypes.length === 0) {
        console.warn("TaskExtractor: Invalid trigger types configuration, skipping processing");
        this.log("error", "validation", "Invalid trigger types configuration", {
          filePath: file.path,
          triggerTypes: this.settings.triggerTypes
        }, correlationId);
        this.processingFiles.delete(file.path);
        return;
      }
      const processedKey = this.settings.processedFrontmatterKey || "taskExtractor.processed";
      const processedValue = this.getFrontmatterValue(front, processedKey);
      if (processedValue === true || processedValue === "true") {
        this.log("info", "file-processing", "File skipped: already processed", {
          filePath: file.path,
          processedKey,
          processedValue
        }, correlationId);
        return;
      }
      const frontmatterField = this.validateFrontmatterField(this.settings.triggerFrontmatterField, correlationId);
      const typeRaw = this.getFrontmatterValue(front, frontmatterField) || "";
      if (typeRaw) {
        (_a = this.debugLogger) == null ? void 0 : _a.logValidationSuccess("frontmatter", `${frontmatterField}`, correlationId);
      } else {
        (_b = this.debugLogger) == null ? void 0 : _b.logValidation(
          "frontmatter",
          frontmatterField,
          typeRaw,
          "non-empty value",
          "Frontmatter field is empty or missing",
          correlationId
        );
      }
      const type = ("" + typeRaw).toLowerCase();
      const accepted = this.settings.triggerTypes.map((t) => t.toLowerCase());
      this.log("info", "file-processing", "Checking trigger type match", {
        filePath: file.path,
        frontmatterField,
        typeFound: type,
        acceptedTypes: accepted,
        matches: accepted.includes(type)
      }, correlationId);
      if (!accepted.includes(type)) {
        this.log("info", "file-processing", "File skipped: trigger type not matched", {
          filePath: file.path,
          typeFound: type,
          acceptedTypes: accepted
        }, correlationId);
        (_c = this.debugLogger) == null ? void 0 : _c.logValidation(
          "frontmatter",
          `${frontmatterField}.triggerMatch`,
          type,
          `one of: ${accepted.join(", ")}`,
          `Value '${type}' does not match any trigger types`,
          correlationId
        );
        return;
      } else {
        (_d = this.debugLogger) == null ? void 0 : _d.logValidationSuccess("frontmatter", `${frontmatterField}.triggerMatch`, correlationId);
      }
      if (!this.settings.ownerName || this.settings.ownerName.trim().length === 0) {
        console.warn("TaskExtractor: Owner name not configured, skipping processing");
        this.log("error", "validation", "Owner name not configured", {
          filePath: file.path,
          ownerName: this.settings.ownerName
        }, correlationId);
        this.processingFiles.delete(file.path);
        return;
      }
      const content = await this.app.vault.read(file);
      this.log("info", "file-processing", "File content read, proceeding to task extraction", {
        filePath: file.path,
        contentLength: content.length
      }, correlationId);
      const extraction = await this.extractTaskFromContent(content, file.path, correlationId);
      if (extraction && extraction.found) {
        this.log("info", "file-processing", "Tasks found, proceeding to task creation", {
          filePath: file.path,
          tasksFound: "tasks" in extraction ? (_e = extraction.tasks) == null ? void 0 : _e.length : 1
        }, correlationId);
        await this.handleTaskExtraction(extraction, file, correlationId);
      } else {
        this.log("info", "file-processing", "No tasks found in file", {
          filePath: file.path
        }, correlationId);
      }
      await this.markFileProcessed(file, correlationId);
      if (this.processingQueue.has(file.path)) {
        this.processingQueue.get(file.path).status = "completed";
      }
      this.log("info", "file-processing", "File processing completed successfully", {
        filePath: file.path,
        processingTime: Date.now() - (((_f = this.processingQueue.get(file.path)) == null ? void 0 : _f.startTime) || Date.now())
      }, correlationId);
    } catch (err) {
      console.error("TaskExtractor error", err);
      new import_obsidian2.Notice("Task Extractor: error processing file \u2014 see console");
      this.log("error", "error", "File processing failed with error", {
        filePath: file.path,
        error: err instanceof Error ? err.message : String(err),
        stack: err instanceof Error ? err.stack : void 0,
        processingTime: Date.now() - (((_g = this.processingQueue.get(file.path)) == null ? void 0 : _g.startTime) || Date.now())
      }, correlationId);
      if (this.processingQueue.has(file.path)) {
        this.processingQueue.get(file.path).status = "failed";
      }
    } finally {
      this.cleanupFileProcessing(file.path);
    }
  }
  // Centralized cleanup method for atomic processing
  cleanupFileProcessing(filePath) {
    const status = this.processingQueue.get(filePath);
    if (status == null ? void 0 : status.timeout) {
      clearTimeout(status.timeout);
    }
    this.processingQueue.delete(filePath);
    this.processingFiles.delete(filePath);
  }
  // scan vault once on load for unprocessed matching notes
  async scanExistingFiles() {
    const files = this.getUnprocessedFiles();
    const batches = this.chunkArray(files, 5);
    for (const batch of batches) {
      await Promise.all(batch.map((f) => this.onFileChanged(f)));
      await this.delay(100);
    }
  }
  // Get list of unprocessed files that match trigger criteria
  getUnprocessedFiles() {
    const files = this.app.vault.getMarkdownFiles();
    const unprocessedFiles = [];
    for (const f of files) {
      if (this.isFileExcluded(f.path)) {
        continue;
      }
      const cache = this.app.metadataCache.getFileCache(f);
      const front = cache == null ? void 0 : cache.frontmatter;
      if (!front)
        continue;
      const frontmatterField = this.validateFrontmatterField(this.settings.triggerFrontmatterField);
      const typeRaw = this.getFrontmatterValue(front, frontmatterField) || "";
      const type = ("" + typeRaw).toLowerCase();
      const accepted = this.settings.triggerTypes.map((t) => t.toLowerCase());
      const processedValue = this.getFrontmatterValue(front, this.settings.processedFrontmatterKey);
      if (accepted.includes(type) && !(processedValue === true || processedValue === "true")) {
        unprocessedFiles.push(f);
      }
    }
    return unprocessedFiles;
  }
  // Utility function to chunk array into smaller batches
  chunkArray(array, size) {
    const chunks = [];
    for (let i = 0; i < array.length; i += size) {
      chunks.push(array.slice(i, i + size));
    }
    return chunks;
  }
  // Utility function for delays
  delay(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }
  getFrontmatterValue(front, key) {
    if (!front)
      return void 0;
    if (key.includes(".")) {
      const parts = key.split(".");
      let cur = front;
      for (const p of parts) {
        if (!cur)
          return void 0;
        cur = cur[p];
      }
      return cur;
    }
    return front[key];
  }
  async markFileProcessed(file, correlationId) {
    if (!this.settings.processedFrontmatterKey) {
      this.log("info", "file-processing", "Skipping processed marker: no processed frontmatter key configured", {
        filePath: file.path
      }, correlationId);
      return;
    }
    try {
      await this.app.fileManager.processFrontMatter(file, (frontmatter) => {
        const keys = this.settings.processedFrontmatterKey.split(".");
        let current = frontmatter;
        for (let i = 0; i < keys.length - 1; i++) {
          const key = keys[i];
          if (!current[key] || typeof current[key] !== "object") {
            current[key] = {};
          }
          current = current[key];
        }
        current[keys[keys.length - 1]] = true;
      });
      this.log("info", "file-processing", "File marked as processed successfully", {
        filePath: file.path,
        processedKey: this.settings.processedFrontmatterKey
      }, correlationId);
    } catch (e) {
      console.warn("Failed to mark file processed with official API:", e);
      this.log("warn", "file-processing", "Failed to mark file processed with official API, trying fallback", {
        filePath: file.path,
        error: e instanceof Error ? e.message : String(e)
      }, correlationId);
      await this.markFileProcessedFallback(file, correlationId);
    }
  }
  // Fallback method using the previous implementation
  async markFileProcessedFallback(file, correlationId) {
    try {
      const content = await this.app.vault.read(file);
      const fmMatch = content.match(/^---\n([\s\S]*?)\n---/);
      let newContent = content;
      if (fmMatch) {
        const fm = fmMatch[1];
        const processedKey = this.settings.processedFrontmatterKey;
        if (!new RegExp("^" + processedKey.replace(".", "\\.") + ":", "m").test(fm)) {
          const lines = fm.split("\n");
          lines.push(`${processedKey}: true`);
          const updatedFm = lines.join("\n");
          newContent = content.replace(fmMatch[0], `---
${updatedFm}
---`);
          await this.app.vault.modify(file, newContent);
        }
      } else {
        const processedKey = this.settings.processedFrontmatterKey;
        newContent = `---
${processedKey}: true
---

` + content;
        await this.app.vault.modify(file, newContent);
      }
      this.log("info", "file-processing", "File marked as processed using fallback method", {
        filePath: file.path,
        processedKey: this.settings.processedFrontmatterKey
      }, correlationId);
    } catch (e) {
      console.warn("Failed to mark file processed with fallback method:", e);
      this.log("error", "file-processing", "Failed to mark file processed with fallback method", {
        filePath: file.path,
        error: e instanceof Error ? e.message : String(e)
      }, correlationId);
    }
  }
  // Shared method for constructing prompts
  buildExtractionPrompt(sourcePath, content) {
    const basePrompt = this.settings.customPrompt || `You are a task extraction specialist. Extract actionable tasks from emails and meeting notes following these strict rules:

EXTRACTION RULES:
- Extract ONLY concrete, actionable tasks explicitly stated or clearly implied
- Use null for uncertain/missing information - DO NOT GUESS
- Extract tasks only for the specified person: ${this.settings.ownerName} (exact name)
- If no clear tasks exist, return {"found": false, "tasks": []}

PRIORITY GUIDELINES:
- high: explicit urgency/deadline mentioned
- medium: standard requests without time pressure  
- low: optional/background items

VALIDATION CONSTRAINTS:
- task_title: 6-100 characters, actionable phrasing
- task_details: max 300 characters, concrete description
- due_date: YYYY-MM-DD format only if explicitly mentioned
- source_excerpt: exact quote (max 150 chars) justifying extraction

Return valid JSON only. Be conservative - accuracy over completeness.`;
    const fieldDescriptions = this.settings.frontmatterFields.filter((f) => f.required || f.key === "task_title" || f.key === "task_details").map((f) => {
      var _a;
      if (f.key === "task" || f.key === "task_title")
        return "- task_title: short (6-100 words) actionable title";
      if (f.key === "task_details")
        return "- task_details: 1-3 sentences describing what to do and any context";
      if (f.key === "due")
        return "- due_date: ISO date YYYY-MM-DD if explicitly present in the text, otherwise null";
      if (f.key === "priority")
        return `- priority: ${((_a = f.options) == null ? void 0 : _a.join("|")) || "high|medium|low"} (choose best match)`;
      if (f.key === "project")
        return "- project: project name if mentioned, otherwise null";
      if (f.key === "client")
        return "- client: client name if mentioned, otherwise null";
      return `- ${f.key}: ${f.defaultValue || "appropriate value based on context"}`;
    });
    const system = `${basePrompt}

When tasks are found, return JSON in this format:
{
  "found": true,
  "tasks": [
    {
      ${fieldDescriptions.join(",\n      ")},
      "source_excerpt": "exact quote from source (max 150 chars)",
      "confidence": "high|medium|low"
    }
  ],
  "confidence": "high|medium|low"
}

When no tasks found, return: {"found": false, "tasks": []}`;
    const user = `SOURCE_PATH: ${sourcePath}
---BEGIN NOTE---
${content}
---END NOTE---`;
    return { system, user };
  }
  // New method for multi-task extraction
  async extractMultipleTasksFromContent(content, sourcePath, correlationId) {
    var _a;
    const { system, user } = this.buildExtractionPrompt(sourcePath, content);
    this.log("info", "llm-call", "LLM prompt constructed for multi-task extraction", {
      filePath: sourcePath,
      systemPromptLength: system.length,
      userPromptLength: user.length,
      contentLength: content.length
    }, correlationId);
    try {
      const raw = await this.llmProvider.callLLM(system, user);
      this.log("info", "llm-call", "LLM response received for multi-task extraction", {
        filePath: sourcePath,
        responseLength: (raw == null ? void 0 : raw.length) || 0,
        responsePreview: (raw == null ? void 0 : raw.substring(0, 200)) || "null"
      }, correlationId);
      const parsed = this.safeParseJSON(raw);
      if (!parsed) {
        this.log("warn", "llm-call", "Failed to parse LLM response as JSON for multi-task extraction", {
          filePath: sourcePath,
          rawResponse: raw
        }, correlationId);
        return { found: false, tasks: [] };
      }
      this.log("info", "llm-call", "LLM response parsed successfully for multi-task extraction", {
        filePath: sourcePath,
        parsedStructure: Object.keys(parsed),
        found: parsed.found || false,
        tasksCount: ((_a = parsed.tasks) == null ? void 0 : _a.length) || 0
      }, correlationId);
      if ("tasks" in parsed && Array.isArray(parsed.tasks)) {
        return parsed;
      }
      if ("found" in parsed && parsed.found) {
        return {
          found: true,
          tasks: [{
            task_title: parsed.task_title || "Unspecified task",
            task_details: parsed.task_details || "",
            due_date: parsed.due_date || null,
            priority: parsed.priority || "medium",
            project: parsed.project || null,
            client: parsed.client || null,
            source_excerpt: parsed.source_excerpt || "",
            confidence: parsed.confidence || "medium"
          }]
        };
      }
      return { found: false, tasks: [] };
    } catch (e) {
      console.error("extractMultipleTasksFromContent error", e);
      this.log("error", "llm-call", "Multi-task extraction failed with error", {
        filePath: sourcePath,
        error: e instanceof Error ? e.message : String(e),
        stack: e instanceof Error ? e.stack : void 0
      }, correlationId);
      return { found: false, tasks: [] };
    }
  }
  // Handle task extraction results (both single and multi-task)
  async handleTaskExtraction(extraction, sourceFile, correlationId) {
    try {
      if ("tasks" in extraction && Array.isArray(extraction.tasks)) {
        this.log("info", "task-creation", "Processing multi-task extraction result", {
          filePath: sourceFile.path,
          tasksCount: extraction.tasks.length
        }, correlationId);
        let createdCount = 0;
        for (const task of extraction.tasks) {
          try {
            await this.createTaskNote(task, sourceFile, correlationId);
            createdCount++;
          } catch (error) {
            console.error(`Failed to create task note for: ${task.task_title}`, error);
            this.log("error", "task-creation", "Failed to create individual task note", {
              filePath: sourceFile.path,
              taskTitle: task.task_title,
              error: error instanceof Error ? error.message : String(error)
            }, correlationId);
          }
        }
        this.log("info", "task-creation", "Multi-task creation completed", {
          filePath: sourceFile.path,
          totalTasks: extraction.tasks.length,
          createdCount,
          failedCount: extraction.tasks.length - createdCount
        }, correlationId);
        if (createdCount > 0) {
          new import_obsidian2.Notice(`Task Extractor: created ${createdCount} task note${createdCount !== 1 ? "s" : ""}`);
        }
      } else {
        this.log("info", "task-creation", "Processing single-task extraction result", {
          filePath: sourceFile.path,
          taskTitle: extraction.task_title
        }, correlationId);
        await this.createTaskNote(extraction, sourceFile, correlationId);
        new import_obsidian2.Notice(`Task Extractor: created task "${extraction.task_title}"`);
      }
    } catch (error) {
      console.error("Error handling task extraction:", error);
      this.log("error", "task-creation", "Task extraction handling failed", {
        filePath: sourceFile.path,
        error: error instanceof Error ? error.message : String(error),
        stack: error instanceof Error ? error.stack : void 0
      }, correlationId);
      new import_obsidian2.Notice("Task Extractor: error creating task notes \u2014 see console");
    }
  }
  // Compose prompt, call LLM, and parse response (legacy method for backward compatibility)
  async extractTaskFromContent(content, sourcePath, correlationId) {
    var _a;
    const { system, user } = this.buildExtractionPrompt(sourcePath, content);
    this.log("info", "llm-call", "LLM prompt constructed for task extraction", {
      filePath: sourcePath,
      systemPromptLength: system.length,
      userPromptLength: user.length,
      contentLength: content.length
    }, correlationId);
    try {
      const raw = await this.llmProvider.callLLM(system, user);
      this.log("info", "llm-call", "LLM response received for task extraction", {
        filePath: sourcePath,
        responseLength: (raw == null ? void 0 : raw.length) || 0,
        responsePreview: (raw == null ? void 0 : raw.substring(0, 200)) || "null"
      }, correlationId);
      const parsed = this.safeParseJSON(raw);
      if (!parsed) {
        this.log("warn", "llm-call", "Failed to parse LLM response as JSON", {
          filePath: sourcePath,
          rawResponse: raw
        }, correlationId);
        return { found: false };
      }
      this.log("info", "llm-call", "LLM response parsed successfully", {
        filePath: sourcePath,
        parsedStructure: Object.keys(parsed),
        found: parsed.found || false,
        tasksCount: ((_a = parsed.tasks) == null ? void 0 : _a.length) || (parsed.found ? 1 : 0)
      }, correlationId);
      if (parsed.tasks && Array.isArray(parsed.tasks)) {
        if (parsed.tasks.length > 0) {
          const firstTask = parsed.tasks[0];
          return {
            found: true,
            task_title: firstTask.task_title || "Unspecified task",
            task_details: firstTask.task_details || "",
            due_date: firstTask.due_date || null,
            priority: firstTask.priority || "medium",
            source_excerpt: firstTask.source_excerpt || "",
            ...firstTask
            // Include any additional extracted fields
          };
        } else {
          return { found: false };
        }
      }
      if (!parsed.found)
        return { found: false };
      return {
        found: true,
        task_title: parsed.task_title || parsed.title || "Unspecified task",
        task_details: parsed.task_details || parsed.details || "",
        due_date: parsed.due_date || null,
        priority: parsed.priority || "medium",
        source_excerpt: parsed.source_excerpt || "",
        ...parsed
        // Include any additional extracted fields
      };
    } catch (e) {
      console.error("extractTaskFromContent error", e);
      this.log("error", "llm-call", "Task extraction failed with error", {
        filePath: sourcePath,
        error: e instanceof Error ? e.message : String(e),
        stack: e instanceof Error ? e.stack : void 0
      }, correlationId);
      return { found: false };
    }
  }
  safeParseJSON(text) {
    if (!text)
      return null;
    let parsed = null;
    try {
      parsed = JSON.parse(text);
    } catch (e) {
      const m = text.match(/\{[\s\S]*\}/);
      if (m) {
        try {
          parsed = JSON.parse(m[0]);
        } catch (e2) {
          const fixed = m[0].replace(/'/g, '"');
          try {
            parsed = JSON.parse(fixed);
          } catch (e3) {
            return null;
          }
        }
      } else {
        return null;
      }
    }
    if (!parsed || typeof parsed !== "object")
      return null;
    return this.validateAndNormalizeParsedResult(parsed);
  }
  validateAndNormalizeParsedResult(data) {
    if (typeof data !== "object" || data === null) {
      this.log("warn", "validation", "Parsed data is not an object", {
        dataType: typeof data,
        data
      });
      return null;
    }
    if (data.hasOwnProperty("tasks") && Array.isArray(data.tasks)) {
      const validTasks = [];
      for (const task of data.tasks) {
        if (this.isValidTask(task)) {
          validTasks.push({
            task_title: task.task_title || "Unspecified task",
            task_details: task.task_details || "",
            due_date: task.due_date || null,
            priority: task.priority || "medium",
            project: task.project || null,
            client: task.client || null,
            source_excerpt: task.source_excerpt || "",
            confidence: task.confidence || "medium",
            ...task
          });
        } else {
          this.log("warn", "validation", "Invalid task found in multi-task result", {
            task,
            taskTitle: task == null ? void 0 : task.task_title
          });
        }
      }
      this.log("info", "validation", "Multi-task validation completed", {
        totalTasks: data.tasks.length,
        validTasks: validTasks.length,
        invalidTasks: data.tasks.length - validTasks.length
      });
      return {
        found: data.found === true && validTasks.length > 0,
        tasks: validTasks,
        confidence: data.confidence || "medium"
      };
    }
    if (data.hasOwnProperty("found")) {
      this.log("info", "validation", "Processing legacy single-task format", {
        found: data.found,
        taskTitle: data.task_title || data.title
      });
      return {
        found: data.found === true,
        task_title: data.task_title || data.title || "",
        task_details: data.task_details || data.details || "",
        due_date: data.due_date || null,
        priority: data.priority || "medium",
        source_excerpt: data.source_excerpt || "",
        ...data
      };
    }
    this.log("warn", "validation", "Parsed data does not match expected format", {
      dataKeys: Object.keys(data),
      hasFound: data.hasOwnProperty("found"),
      hasTasks: data.hasOwnProperty("tasks")
    });
    return null;
  }
  isValidTask(task) {
    if (typeof task !== "object" || !task)
      return false;
    if (!task.task_title || typeof task.task_title !== "string" || task.task_title.trim().length === 0) {
      return false;
    }
    if (task.confidence && !["high", "medium", "low"].includes(task.confidence)) {
      return false;
    }
    if (task.priority && !["high", "medium", "low"].includes(task.priority)) {
      return false;
    }
    if (task.due_date && typeof task.due_date === "string") {
      const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
      if (!dateRegex.test(task.due_date)) {
        return false;
      }
    }
    return true;
  }
  // Create TaskNotescompatible note in tasksFolder
  async createTaskNote(extraction, sourceFile, correlationId) {
    var _a;
    const safeTitle = this.makeFilenameSafe(extraction.task_title || "task");
    let filename = `${safeTitle}.md`;
    let folder = ((_a = this.settings.tasksFolder) == null ? void 0 : _a.trim()) || "Tasks";
    if (!folder || folder.length === 0) {
      folder = "Tasks";
    }
    folder = folder.replace(/[\\/:*?"<>|]/g, "");
    let path = `${folder}/${filename}`;
    let counter = 1;
    while (this.app.vault.getAbstractFileByPath(path)) {
      path = `${folder}/${safeTitle}-${counter}.md`;
      counter++;
    }
    this.log("info", "task-creation", "Creating task note", {
      sourceFile: sourceFile.path,
      taskTitle: extraction.task_title,
      taskPath: path,
      folder,
      filename: path.split("/").pop()
    }, correlationId);
    const lines = [];
    lines.push("---");
    for (const field of this.settings.frontmatterFields) {
      let value = extraction[field.key] || extraction[field.key.replace("_", "")] || field.defaultValue;
      if (value === "{{date}}") {
        value = new Date().toISOString().split("T")[0];
      }
      if (field.key === "task" && !value && extraction.task_title) {
        value = extraction.task_title;
      }
      if (value) {
        if (field.type === "text" && typeof value === "string" && value.includes(" ")) {
          lines.push(`${field.key}: "${value}"`);
        } else {
          lines.push(`${field.key}: ${value}`);
        }
      }
    }
    lines.push("---");
    lines.push("");
    lines.push(extraction.task_details || "");
    lines.push("");
    if (this.settings.linkBack) {
      const link = `[[${sourceFile.path}]]`;
      lines.push(`Source: ${link}`);
    }
    if (extraction.source_excerpt) {
      lines.push("");
      lines.push("> Justification excerpt:");
      lines.push("> " + extraction.source_excerpt.replace(/\n/g, " "));
    }
    const final = lines.join("\n");
    try {
      await this.app.vault.create(path, final);
      this.log("info", "task-creation", "Task note created successfully", {
        sourceFile: sourceFile.path,
        taskTitle: extraction.task_title,
        taskPath: path,
        contentLength: final.length
      }, correlationId);
      new import_obsidian2.Notice(`Task Extractor: created task "${extraction.task_title}"`);
    } catch (e) {
      console.error("Failed to create task note", e);
      this.log("error", "task-creation", "Failed to create task note", {
        sourceFile: sourceFile.path,
        taskTitle: extraction.task_title,
        taskPath: path,
        error: e instanceof Error ? e.message : String(e),
        stack: e instanceof Error ? e.stack : void 0
      }, correlationId);
      new import_obsidian2.Notice("Task Extractor: failed to create task note \u2014 see console");
    }
  }
  makeFilenameSafe(title) {
    return title.replace(/[\\/:*?"<>|#%{}\\^~\[\]`;'@&=+]/g, "").replace(/\s+/g, "-").slice(0, 120);
  }
  /**
   * Checks if a file path is excluded based on exact path matches
   */
  isPathExcluded(filePath) {
    if (!this.settings.excludedPaths || this.settings.excludedPaths.length === 0) {
      return false;
    }
    const normalizedPath = filePath.replace(/\\/g, "/");
    return this.settings.excludedPaths.some((excludedPath) => {
      const normalizedExcluded = excludedPath.replace(/\\/g, "/");
      if (normalizedExcluded.endsWith("/")) {
        return normalizedPath.startsWith(normalizedExcluded) || normalizedPath.startsWith(normalizedExcluded.slice(0, -1) + "/");
      }
      return normalizedPath === normalizedExcluded;
    });
  }
  /**
   * Checks if a file path matches any exclusion patterns (glob-style)
   */
  matchesExclusionPattern(filePath) {
    if (!this.settings.excludedPatterns || this.settings.excludedPatterns.length === 0) {
      return false;
    }
    const normalizedPath = filePath.replace(/\\/g, "/");
    return this.settings.excludedPatterns.some((pattern) => {
      const normalizedPattern = pattern.replace(/\\/g, "/");
      const regexPattern = this.globToRegex(normalizedPattern);
      try {
        return new RegExp(regexPattern, "i").test(normalizedPath);
      } catch (error) {
        console.warn(`TaskExtractor: Invalid exclusion pattern: ${pattern}`);
        return false;
      }
    });
  }
  /**
   * Converts a glob pattern to a regex pattern
   */
  globToRegex(pattern) {
    let regexPattern = pattern.replace(/[.+^${}()|[\]\\]/g, "\\$&");
    regexPattern = regexPattern.replace(/\*\*/g, "\xA7DOUBLESTAR\xA7").replace(/\*/g, "[^/]*").replace(/DOUBLESTAR/g, ".*").replace(/\?/g, "[^/]");
    if (!regexPattern.startsWith("^")) {
      regexPattern = "^" + regexPattern;
    }
    if (!regexPattern.endsWith("$")) {
      regexPattern = regexPattern + "$";
    }
    return regexPattern;
  }
  /**
   * Main exclusion check combining both path and pattern matching
   */
  isFileExcluded(filePath) {
    return this.isPathExcluded(filePath) || this.matchesExclusionPattern(filePath);
  }
  /**
   * Validates frontmatter field name with graceful fallback to "Type"
   * Ensures the field name is valid for YAML and safe to use
   */
  validateFrontmatterField(fieldName, correlationId) {
    var _a, _b, _c, _d;
    if (!fieldName || typeof fieldName !== "string" || fieldName.trim().length === 0) {
      console.warn('TaskExtractor: Empty frontmatter field name, falling back to "Type"');
      (_a = this.debugLogger) == null ? void 0 : _a.logValidation(
        "frontmatter",
        "fieldName",
        fieldName,
        "non-empty string",
        'Empty frontmatter field name, using fallback "Type"',
        correlationId
      );
      return "Type";
    }
    const trimmed = fieldName.trim();
    const yamlKeyPattern = /^[a-zA-Z_][a-zA-Z0-9_.-]*$/;
    if (!yamlKeyPattern.test(trimmed)) {
      console.warn(`TaskExtractor: Invalid frontmatter field name "${trimmed}", falling back to "Type"`);
      (_b = this.debugLogger) == null ? void 0 : _b.logValidation(
        "frontmatter",
        "fieldName",
        trimmed,
        "valid YAML key pattern (^[a-zA-Z_][a-zA-Z0-9_.-]*$)",
        'Invalid YAML key format, using fallback "Type"',
        correlationId
      );
      return "Type";
    }
    if (trimmed.includes("..") || trimmed.startsWith(".") || trimmed.endsWith(".")) {
      console.warn(`TaskExtractor: Problematic frontmatter field name "${trimmed}", falling back to "Type"`);
      (_c = this.debugLogger) == null ? void 0 : _c.logValidation(
        "frontmatter",
        "fieldName",
        trimmed,
        "valid YAML key without problematic dot patterns",
        'Problematic dot pattern in field name, using fallback "Type"',
        correlationId
      );
      return "Type";
    }
    (_d = this.debugLogger) == null ? void 0 : _d.logValidationSuccess("frontmatter", "fieldName", correlationId);
    return trimmed;
  }
  // Enhanced cleanup method with processing queue management
  cleanup() {
    this.fileChangeDebouncer.forEach((timeout) => clearTimeout(timeout));
    this.fileChangeDebouncer.clear();
    this.processingQueue.forEach((status) => {
      if (status.timeout) {
        clearTimeout(status.timeout);
      }
    });
    this.processingQueue.clear();
    this.processingFiles.clear();
  }
  // Methods for backward compatibility
  getProcessingFiles() {
    return this.processingFiles;
  }
};

// src/settings.ts
var import_obsidian3 = require("obsidian");
var ExtractorSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin, settings, llmProvider) {
    super(app, plugin);
    this.plugin = plugin;
    this.settings = settings;
    this.llmProvider = llmProvider;
    this.saveTimeout = null;
  }
  // Debounced save to reduce save frequency
  debouncedSave() {
    if (this.saveTimeout) {
      clearTimeout(this.saveTimeout);
    }
    this.saveTimeout = setTimeout(async () => {
      await this.plugin.saveSettings();
      this.saveTimeout = null;
    }, 500);
  }
  // Clean up timeout on hide
  hide() {
    if (this.saveTimeout) {
      clearTimeout(this.saveTimeout);
      this.saveTimeout = null;
    }
    super.hide();
  }
  /**
   * Validates frontmatter field name according to YAML key format
   * Returns a valid field name or defaults to "Type"
   */
  validateFrontmatterField(fieldName) {
    if (!fieldName || fieldName.length === 0) {
      return "Type";
    }
    const yamlKeyPattern = /^[a-zA-Z_][a-zA-Z0-9_.-]*$/;
    if (!yamlKeyPattern.test(fieldName)) {
      return "Type";
    }
    if (fieldName.includes("..") || fieldName.startsWith(".") || fieldName.endsWith(".")) {
      return "Type";
    }
    return fieldName;
  }
  /**
   * Shows validation feedback to the user
   */
  showValidationFeedback(inputEl, message) {
    inputEl.style.borderColor = "#ff6b6b";
    inputEl.style.backgroundColor = "rgba(255, 107, 107, 0.1)";
    inputEl.title = message;
    setTimeout(() => {
      inputEl.style.borderColor = "";
      inputEl.style.backgroundColor = "";
      inputEl.title = "";
    }, 3e3);
  }
  /**
   * Validates and clamps numeric values with enhanced error handling
   */
  validateNumericInput(value, min, max, defaultValue) {
    if (isNaN(value)) {
      return {
        value: defaultValue,
        isValid: false,
        message: `Invalid number. Using default value ${defaultValue}.`
      };
    }
    if (value < min) {
      return {
        value: min,
        isValid: false,
        message: `Value too low. Minimum is ${min}.`
      };
    }
    if (value > max) {
      return {
        value: max,
        isValid: false,
        message: `Value too high. Maximum is ${max}.`
      };
    }
    return { value, isValid: true };
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Task Extractor Settings" });
    this.addProviderSection(containerEl);
    this.addLocalLLMSection(containerEl);
    this.addProcessingSection(containerEl);
    this.addExclusionSection(containerEl);
    this.addFrontmatterSection(containerEl);
    this.addDebugSection(containerEl);
    this.addAdvancedSection(containerEl);
  }
  addProviderSection(containerEl) {
    containerEl.createEl("h3", { text: "LLM Provider Configuration" });
    const statusEl = containerEl.createEl("div", { cls: "task-extractor-status" });
    this.updateServiceStatus(statusEl);
    new import_obsidian3.Setting(containerEl).setName("Provider").setDesc("Choose LLM provider. Local providers (Ollama/LM Studio) require the service to be running.").addDropdown((cb) => cb.addOption("openai", "OpenAI").addOption("anthropic", "Anthropic").addOption("ollama", "Ollama (Local)").addOption("lmstudio", "LM Studio (Local)").setValue(this.settings.provider).onChange((v) => {
      this.settings.provider = v;
      this.debouncedSave();
      this.llmProvider.getApiKeyMissingNotified().clear();
      this.updateServiceStatus(statusEl);
      this.display();
    }));
    if (["openai", "anthropic"].includes(this.settings.provider)) {
      new import_obsidian3.Setting(containerEl).setName("API Key").setDesc("Your API key for the selected provider. Models will be loaded automatically once entered.").addText((text) => text.setPlaceholder("sk-... or claude-...").setValue(this.settings.apiKey).onChange((v) => {
        this.settings.apiKey = v.trim();
        this.debouncedSave();
        const oldCacheKeys = Array.from(this.llmProvider.getCloudModelCache().keys()).filter((key) => key.startsWith(this.settings.provider));
        oldCacheKeys.forEach((key) => this.llmProvider.getCloudModelCache().delete(key));
        this.llmProvider.getApiKeyMissingNotified().clear();
        this.display();
      }));
      if (this.settings.provider === "anthropic") {
        new import_obsidian3.Setting(containerEl).setName("Anthropic URL").setDesc("Optional: URL for a proxy for the Anthropic API.").addText((text) => text.setPlaceholder("https://api.anthropic.com/v1/messages").setValue(this.settings.anthropicUrl).onChange((v) => {
          this.settings.anthropicUrl = v.trim();
          this.debouncedSave();
        }));
      }
    }
    this.addModelSetting(containerEl);
  }
  async addModelSetting(containerEl) {
    const modelContainer = containerEl.createDiv();
    const provider = this.settings.provider;
    const service = this.llmProvider.getServiceCache().get(provider);
    if (["ollama", "lmstudio"].includes(provider) && (service == null ? void 0 : service.available) && service.models.length > 0) {
      new import_obsidian3.Setting(modelContainer).setName("Model").setDesc(`Select from ${service.models.length} available ${provider} models.`).addDropdown((cb) => {
        service.models.forEach((model) => cb.addOption(model, model));
        cb.setValue(this.settings.model || service.models[0]).onChange((v) => {
          this.settings.model = v;
          this.debouncedSave();
        });
      });
    } else if (["openai", "anthropic"].includes(provider) && this.settings.apiKey) {
      const loadingSetting = new import_obsidian3.Setting(modelContainer).setName("Model").setDesc("Loading available models...");
      try {
        const availableModels = await this.llmProvider.fetchCloudModels(provider);
        modelContainer.empty();
        new import_obsidian3.Setting(modelContainer).setName("Model").setDesc(`Select from ${availableModels.length} available ${provider} models.`).addDropdown((cb) => {
          availableModels.forEach((model) => cb.addOption(model, model));
          const currentModel = this.settings.model;
          const defaultModel = availableModels.includes(currentModel) ? currentModel : availableModels[0];
          cb.setValue(defaultModel).onChange((v) => {
            this.settings.model = v;
            this.debouncedSave();
          });
        });
        new import_obsidian3.Setting(modelContainer).setName("Refresh Models").setDesc("Reload the list of available models from the API.").addButton((button) => button.setButtonText("Refresh").onClick(async () => {
          this.llmProvider.getCloudModelCache().clear();
          this.display();
        }));
      } catch (error) {
        modelContainer.empty();
        this.addFallbackModelSetting(modelContainer, provider);
      }
    } else {
      this.addFallbackModelSetting(modelContainer, provider);
    }
  }
  addFallbackModelSetting(container, provider) {
    const defaultModels = {
      openai: "gpt-4o-mini",
      anthropic: "claude-3-haiku-20240307",
      ollama: "llama3.2",
      lmstudio: "local-model"
    };
    const description = ["ollama", "lmstudio"].includes(provider) ? `Enter model name. Service not detected or no models available.` : `Enter model name manually.`;
    new import_obsidian3.Setting(container).setName("Model").setDesc(description).addText((text) => text.setPlaceholder(defaultModels[provider] || "").setValue(this.settings.model).onChange((v) => {
      this.settings.model = v.trim();
      this.debouncedSave();
    }));
  }
  addLocalLLMSection(containerEl) {
    if (this.settings.provider !== "ollama" && this.settings.provider !== "lmstudio") {
      return;
    }
    containerEl.createEl("h3", { text: "Local LLM Configuration" });
    if (this.settings.provider === "ollama") {
      new import_obsidian3.Setting(containerEl).setName("Ollama URL").setDesc("URL for your Ollama instance.").addText((text) => text.setValue(this.settings.ollamaUrl).onChange((v) => {
        this.settings.ollamaUrl = v.trim();
        this.debouncedSave();
      }));
    }
    if (this.settings.provider === "lmstudio") {
      new import_obsidian3.Setting(containerEl).setName("LM Studio URL").setDesc("URL for your LM Studio instance.").addText((text) => text.setValue(this.settings.lmstudioUrl).onChange((v) => {
        this.settings.lmstudioUrl = v.trim();
        this.debouncedSave();
      }));
    }
    this.addSliderWithInput(
      containerEl,
      "Model Refresh Interval",
      "How often to check for available models (minutes).",
      this.settings.localModelRefreshInterval,
      1,
      60,
      1,
      (v) => {
        this.settings.localModelRefreshInterval = v;
        this.debouncedSave();
      }
    );
  }
  addProcessingSection(containerEl) {
    containerEl.createEl("h3", { text: "Processing Settings" });
    new import_obsidian3.Setting(containerEl).setName("Owner name").setDesc("Exact name the LLM should look for when deciding tasks.").addText((text) => text.setPlaceholder("Bryan Kolb").setValue(this.settings.ownerName).onChange((v) => {
      this.settings.ownerName = v.trim();
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Tasks folder").setDesc("Folder where generated task notes will be created.").addText((text) => text.setValue(this.settings.tasksFolder).onChange((v) => {
      this.settings.tasksFolder = v.trim();
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Trigger note types").setDesc("Comma-separated list of note types to process (from frontmatter Type field).").addText((text) => text.setValue(this.settings.triggerTypes.join(", ")).onChange((v) => {
      this.settings.triggerTypes = v.split(",").map((s) => s.trim()).filter((s) => s.length > 0);
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Frontmatter field for filtering").setDesc('The frontmatter field name to use for filtering notes (e.g., "Type", "Category", "NoteType").').addText((text) => text.setPlaceholder("Type").setValue(this.settings.triggerFrontmatterField).onChange((v) => {
      const validatedField = this.validateFrontmatterField(v.trim());
      this.settings.triggerFrontmatterField = validatedField;
      this.debouncedSave();
      if (validatedField !== v.trim()) {
        text.setValue(validatedField);
        this.showValidationFeedback(text.inputEl, 'Invalid field name. Using default "Type".');
      }
    }));
    new import_obsidian3.Setting(containerEl).setName("Process edits as well as new files").setDesc("If enabled, modifications to matching notes will be processed too.").addToggle((toggle) => toggle.setValue(this.settings.processOnUpdate).onChange((v) => {
      this.settings.processOnUpdate = v;
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Link back to source").setDesc("Insert a link back to the source note in generated task notes.").addToggle((toggle) => toggle.setValue(this.settings.linkBack).onChange((v) => {
      this.settings.linkBack = v;
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Processed marker key").setDesc("Frontmatter key to mark processed notes.").addText((text) => text.setValue(this.settings.processedFrontmatterKey).onChange((v) => {
      this.settings.processedFrontmatterKey = v.trim();
      this.debouncedSave();
    }));
  }
  addExclusionSection(containerEl) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    containerEl.createEl("h3", { text: "File/Folder Exclusion Settings" });
    containerEl.createEl("p", {
      text: "Exclude specific files or folders from being processed by the task extractor.",
      cls: "setting-item-description"
    });
    new import_obsidian3.Setting(containerEl).setName("Excluded Paths").setDesc('Comma-separated list of exact file or folder paths to exclude. Examples: "Templates/", "Archive/Old Notes/", "Private/secrets.md"').addTextArea((text) => text.setPlaceholder("Templates/, Archive/, Private/secrets.md").setValue(this.settings.excludedPaths.join(", ")).onChange((v) => {
      this.settings.excludedPaths = v.split(",").map((s) => s.trim()).filter((s) => s.length > 0);
      this.debouncedSave();
    }));
    new import_obsidian3.Setting(containerEl).setName("Exclusion Patterns").setDesc('Comma-separated list of glob patterns to exclude files. Supports wildcards: * (any characters except /), ** (any characters including /), ? (single character). Examples: "*.template.md", "**/drafts/**", "Archive/**"').addTextArea((text) => text.setPlaceholder("*.template.md, **/drafts/**, Archive/**").setValue(this.settings.excludedPatterns.join(", ")).onChange((v) => {
      this.settings.excludedPatterns = v.split(",").map((s) => s.trim()).filter((s) => s.length > 0);
      this.debouncedSave();
    }));
    const examplesEl = containerEl.createDiv({ cls: "task-extractor-examples" });
    examplesEl.createEl("h4", { text: "Examples:" });
    const examplesList = examplesEl.createEl("ul");
    examplesList.createEl("li").createEl("strong").setText("Exact Paths: ");
    (_a = examplesList.lastChild) == null ? void 0 : _a.createEl("code").setText('"Templates/"');
    (_b = examplesList.lastChild) == null ? void 0 : _b.appendText(" - excludes entire Templates folder");
    examplesList.createEl("li").createEl("strong").setText("File Extensions: ");
    (_c = examplesList.lastChild) == null ? void 0 : _c.createEl("code").setText('"*.tmp"');
    (_d = examplesList.lastChild) == null ? void 0 : _d.appendText(" - excludes all .tmp files");
    examplesList.createEl("li").createEl("strong").setText("Nested Folders: ");
    (_e = examplesList.lastChild) == null ? void 0 : _e.createEl("code").setText('"**/drafts/**"');
    (_f = examplesList.lastChild) == null ? void 0 : _f.appendText(" - excludes any drafts folder and its contents");
    examplesList.createEl("li").createEl("strong").setText("Mixed: ");
    (_g = examplesList.lastChild) == null ? void 0 : _g.createEl("code").setText('"Archive/**, *.template.md, Private/"');
    (_h = examplesList.lastChild) == null ? void 0 : _h.appendText(" - excludes Archive folder, template files, and Private folder");
    examplesEl.style.marginTop = "16px";
    examplesEl.style.padding = "12px";
    examplesEl.style.backgroundColor = "var(--background-secondary)";
    examplesEl.style.borderRadius = "8px";
    examplesEl.style.fontSize = "0.9em";
  }
  addFrontmatterSection(containerEl) {
    containerEl.createEl("h3", { text: "Task Note Frontmatter" });
    new import_obsidian3.Setting(containerEl).setName("Add Field").setDesc("Add a new frontmatter field").addButton((button) => button.setButtonText("Add Field").onClick(() => {
      this.settings.frontmatterFields.push({
        key: "new_field",
        defaultValue: "",
        type: "text",
        required: false
      });
      this.debouncedSave();
      this.display();
    }));
    this.settings.frontmatterFields.forEach((field, index) => {
      const fieldContainer = containerEl.createDiv({ cls: "task-extractor-field" });
      new import_obsidian3.Setting(fieldContainer).setName(`Field ${index + 1}: ${field.key}`).setDesc(`Type: ${field.type}, Required: ${field.required ? "Yes" : "No"}`).addButton((button) => button.setButtonText("Remove").onClick(() => {
        this.settings.frontmatterFields.splice(index, 1);
        this.debouncedSave();
        this.display();
      }));
    });
    new import_obsidian3.Setting(containerEl).setName("Custom Prompt").setDesc("Override the default task extraction prompt. Leave empty to use default.").addTextArea((text) => text.setPlaceholder("Enter custom prompt...").setValue(this.settings.customPrompt).onChange((v) => {
      this.settings.customPrompt = v;
      this.debouncedSave();
    }));
  }
  addDebugSection(containerEl) {
    containerEl.createEl("h3", { text: "Debug Settings" });
    new import_obsidian3.Setting(containerEl).setName("Debug Mode").setDesc("Enable debug logging to monitor plugin activities. Logs are stored in memory only and cleared when Obsidian restarts.").addToggle((toggle) => toggle.setValue(this.settings.debugMode).onChange((v) => {
      this.settings.debugMode = v;
      this.debouncedSave();
      this.display();
    }));
    if (this.settings.debugMode) {
      this.addSliderWithInput(
        containerEl,
        "Max Debug Entries",
        "Maximum number of debug log entries to keep in memory. Older entries are automatically removed.",
        this.settings.debugMaxEntries,
        100,
        1e4,
        100,
        (v) => {
          this.settings.debugMaxEntries = v;
          this.debouncedSave();
        }
      );
    }
  }
  addAdvancedSection(containerEl) {
    containerEl.createEl("h3", { text: "Advanced Settings" });
    this.addSliderWithInput(
      containerEl,
      "Max Tokens",
      "Maximum tokens to generate.",
      this.settings.maxTokens,
      100,
      2e3,
      50,
      (v) => {
        this.settings.maxTokens = v;
        this.debouncedSave();
      }
    );
    this.addSliderWithInput(
      containerEl,
      "Temperature",
      "Creativity level (0 = deterministic, 1 = creative).",
      this.settings.temperature,
      0,
      1,
      0.1,
      (v) => {
        this.settings.temperature = v;
        this.debouncedSave();
      }
    );
    this.addSliderWithInput(
      containerEl,
      "Timeout (seconds)",
      "Request timeout for LLM calls.",
      this.settings.timeout,
      10,
      120,
      5,
      (v) => {
        this.settings.timeout = v;
        this.debouncedSave();
      }
    );
    this.addSliderWithInput(
      containerEl,
      "Retry Attempts",
      "Number of retry attempts for failed requests.",
      this.settings.retries,
      1,
      5,
      1,
      (v) => {
        this.settings.retries = v;
        this.debouncedSave();
      }
    );
  }
  /**
   * Helper method to create an enhanced slider with input field
   * Provides bidirectional synchronization between slider and number input
   */
  addSliderWithInput(containerEl, name, desc, value, min, max, step, onChange) {
    const setting = new import_obsidian3.Setting(containerEl).setName(name).setDesc(desc);
    const controlContainer = setting.controlEl.createDiv({ cls: "task-extractor-slider-input-container" });
    const sliderEl = controlContainer.createEl("input", {
      type: "range",
      cls: "task-extractor-slider"
    });
    sliderEl.min = min.toString();
    sliderEl.max = max.toString();
    sliderEl.step = step.toString();
    sliderEl.value = value.toString();
    const inputEl = controlContainer.createEl("input", {
      type: "number",
      cls: "task-extractor-number-input"
    });
    inputEl.min = min.toString();
    inputEl.max = max.toString();
    inputEl.step = step.toString();
    inputEl.value = value.toString();
    sliderEl.addEventListener("input", () => {
      const newValue = parseFloat(sliderEl.value);
      const validation = this.validateNumericInput(newValue, min, max, value);
      inputEl.value = validation.value.toString();
      onChange(validation.value);
    });
    inputEl.addEventListener("input", () => {
      const newValue = parseFloat(inputEl.value);
      const validation = this.validateNumericInput(newValue, min, max, value);
      if (!validation.isValid) {
        inputEl.value = validation.value.toString();
        this.showValidationFeedback(inputEl, validation.message || "Invalid value");
      }
      sliderEl.value = validation.value.toString();
      onChange(validation.value);
    });
    inputEl.addEventListener("blur", () => {
      const newValue = parseFloat(inputEl.value);
      const validation = this.validateNumericInput(newValue, min, max, value);
      inputEl.value = validation.value.toString();
      sliderEl.value = validation.value.toString();
      if (!validation.isValid) {
        this.showValidationFeedback(inputEl, validation.message || "Value corrected");
      }
    });
    controlContainer.style.display = "flex";
    controlContainer.style.alignItems = "center";
    controlContainer.style.gap = "12px";
    controlContainer.style.width = "100%";
    sliderEl.style.flex = "1";
    sliderEl.style.minWidth = "120px";
    sliderEl.style.height = "20px";
    inputEl.style.width = "80px";
    inputEl.style.textAlign = "center";
    inputEl.style.padding = "4px 8px";
    inputEl.style.border = "1px solid var(--background-modifier-border)";
    inputEl.style.borderRadius = "4px";
    inputEl.style.backgroundColor = "var(--background-primary)";
    inputEl.style.color = "var(--text-normal)";
    inputEl.style.fontSize = "13px";
  }
  updateServiceStatus(statusEl) {
    statusEl.empty();
    const provider = this.settings.provider;
    const service = this.llmProvider.getServiceCache().get(provider);
    if (["ollama", "lmstudio"].includes(provider)) {
      if (service == null ? void 0 : service.available) {
        statusEl.createEl("div", {
          text: `\u2705 ${provider} connected (${service.models.length} models)`,
          cls: "task-extractor-status-success"
        });
      } else {
        statusEl.createEl("div", {
          text: `\u274C ${provider} not available`,
          cls: "task-extractor-status-error"
        });
      }
    } else {
      if (this.settings.apiKey) {
        statusEl.createEl("div", {
          text: `\u2705 ${provider} API key configured`,
          cls: "task-extractor-status-success"
        });
      } else {
        statusEl.createEl("div", {
          text: `\u274C ${provider} API key required`,
          cls: "task-extractor-status-error"
        });
      }
    }
  }
};

// src/debug-logger.ts
var DebugLogger = class {
  constructor(config) {
    this.logs = [];
    this.correlationCounter = 0;
    this.logFailureCount = 0;
    this.maxLogFailures = 5;
    // Performance optimization fields
    this.entryPool = [];
    this.maxPoolSize = 100;
    this.lastCleanupTime = 0;
    this.cleanupInterval = 3e4;
    // 30 seconds
    this.logCount = 0;
    this.totalLogTime = 0;
    this.config = config;
  }
  /**
   * Log a debug entry with specified level, category, and optional data
   * Optimized with object pooling and memory management
   */
  log(level, category, message, data, correlationId) {
    if (!this.config.enabled) {
      return;
    }
    this.safeLog(() => {
      const startTime = performance.now();
      const entry = this.getPooledEntry();
      entry.timestamp = Date.now();
      entry.level = level;
      entry.category = category;
      entry.message = message;
      entry.correlationId = correlationId;
      entry.data = data ? this.cloneData(data) : void 0;
      entry.errorContext = void 0;
      this.logs.push(entry);
      this.logCount++;
      this.totalLogTime += performance.now() - startTime;
      this.performMemoryManagement();
    });
  }
  /**
   * Start a new operation and return a correlation ID for tracking related log entries
   */
  startOperation(category, message, data) {
    const correlationId = `op-${++this.correlationCounter}-${Date.now()}`;
    this.log("info", category, message, data, correlationId);
    return correlationId;
  }
  /**
   * Get all current log entries
   */
  getLogs() {
    return [...this.logs];
  }
  /**
   * Clear all log entries and return them to pool
   */
  clearLogs() {
    this.returnEntriesToPool(this.logs);
    this.logs = [];
    this.correlationCounter = 0;
  }
  /**
   * Export logs as formatted text string with optimized serialization
   */
  exportLogs() {
    if (this.logs.length === 0) {
      return "No debug logs available.";
    }
    const parts = [];
    parts.push("=== Obsidian Task Extractor Debug Logs ===\n");
    parts.push(`Generated: ${new Date().toISOString()}
`);
    parts.push(`Total Entries: ${this.logs.length}
`);
    parts.push("");
    const lines = new Array(this.logs.length * 3);
    let lineIndex = 0;
    for (const entry of this.logs) {
      const timestamp = new Date(entry.timestamp).toISOString();
      const correlationPart = entry.correlationId ? ` [${entry.correlationId}]` : "";
      lines[lineIndex++] = `[${timestamp}] ${entry.level.toUpperCase()} ${entry.category}${correlationPart}: ${entry.message}`;
      if (entry.data && Object.keys(entry.data).length > 0) {
        try {
          const serializedData = this.optimizedStringify(entry.data);
          lines[lineIndex++] = `  Data: ${serializedData.split("\n").join("\n  ")}`;
        } catch (error) {
          lines[lineIndex++] = "  Data: [Serialization Error]";
        }
      }
      lines[lineIndex++] = "";
    }
    lines.length = lineIndex;
    parts.push(lines.join("\n"));
    return parts.join("\n");
  }
  /**
   * Remove old entries to maintain memory limits with automatic rotation
   * Keeps the most recent entries up to maxEntries limit
   */
  cleanup() {
    if (this.logs.length > this.config.maxEntries) {
      const entriesToRemove = this.logs.length - this.config.maxEntries;
      const removedEntries = this.logs.splice(0, entriesToRemove);
      this.returnEntriesToPool(removedEntries);
    }
  }
  /**
   * Update the logger configuration with performance optimizations
   */
  updateConfig(config) {
    this.config = { ...this.config, ...config };
    if (!this.config.enabled) {
      this.clearLogs();
      this.entryPool = [];
    }
    if (this.logs.length > this.config.maxEntries) {
      this.cleanup();
    }
  }
  /**
   * Get current configuration
   */
  getConfig() {
    return { ...this.config };
  }
  /**
   * Check if debug logging is currently enabled
   */
  isEnabled() {
    return this.config.enabled;
  }
  /**
   * Log an error with detailed context including stack trace
   * Optimized with object pooling
   */
  logError(message, error, category = "error", additionalData, correlationId) {
    if (!this.config.enabled) {
      return;
    }
    this.safeLog(() => {
      const startTime = performance.now();
      const errorContext = this.extractErrorContext(error, additionalData);
      const entry = this.getPooledEntry();
      entry.timestamp = Date.now();
      entry.level = "error";
      entry.category = category;
      entry.message = message;
      entry.data = additionalData ? this.cloneData(additionalData) : void 0;
      entry.correlationId = correlationId;
      entry.errorContext = errorContext;
      this.logs.push(entry);
      this.logCount++;
      this.totalLogTime += performance.now() - startTime;
      this.performMemoryManagement();
    });
  }
  /**
   * Log validation errors with detailed field and value context
   * Optimized with object pooling
   */
  logValidation(validationType, fieldName, providedValue, expectedFormat, errorReason, correlationId) {
    if (!this.config.enabled) {
      return;
    }
    this.safeLog(() => {
      const startTime = performance.now();
      const validationContext = {
        validationType,
        fieldName,
        providedValue: this.sanitizeValue(providedValue),
        expectedFormat,
        errorReason
      };
      const entry = this.getPooledEntry();
      entry.timestamp = Date.now();
      entry.level = "warn";
      entry.category = "validation";
      entry.message = `Validation failed for ${validationType}.${fieldName}: ${errorReason}`;
      entry.data = validationContext;
      entry.correlationId = correlationId;
      entry.errorContext = void 0;
      this.logs.push(entry);
      this.logCount++;
      this.totalLogTime += performance.now() - startTime;
      this.performMemoryManagement();
    });
  }
  /**
   * Log successful validation for debugging purposes
   */
  logValidationSuccess(validationType, fieldName, correlationId) {
    if (!this.config.enabled) {
      return;
    }
    this.safeLog(() => {
      this.log(
        "info",
        "validation",
        `Validation passed for ${validationType}.${fieldName}`,
        { validationType, fieldName },
        correlationId
      );
    });
  }
  /**
   * Safely execute logging with graceful degradation
   */
  safeLog(logOperation) {
    try {
      logOperation();
      this.logFailureCount = 0;
    } catch (error) {
      this.handleLoggingFailure(error);
    }
  }
  /**
   * Handle logging failures with graceful degradation
   */
  handleLoggingFailure(error) {
    this.logFailureCount++;
    if (this.logFailureCount >= this.maxLogFailures) {
      this.config.enabled = false;
      console.warn("DebugLogger: Disabled after repeated failures. Last error:", error);
      return;
    }
    console.warn("DebugLogger: Logging operation failed:", error);
  }
  /**
   * Extract comprehensive error context from error objects
   */
  extractErrorContext(error, additionalData) {
    const context = {
      additionalData
    };
    if (error instanceof Error) {
      context.errorName = error.name;
      context.errorMessage = error.message;
      context.errorStack = error.stack;
    } else if (error && typeof error === "object") {
      try {
        context.originalError = JSON.stringify(error);
      } catch (e) {
        context.originalError = String(error);
      }
    } else {
      context.originalError = String(error);
    }
    return context;
  }
  /**
   * Sanitize values to prevent logging sensitive information
   */
  sanitizeValue(value) {
    if (typeof value === "string") {
      if (value.length > 10 && /^[a-zA-Z0-9_-]+$/.test(value)) {
        return `${value.substring(0, 4)}...${value.substring(value.length - 4)}`;
      }
    }
    if (value && typeof value === "object") {
      const sanitized = { ...value };
      const sensitiveFields = ["apiKey", "token", "password", "secret", "key"];
      for (const field of sensitiveFields) {
        if (field in sanitized) {
          sanitized[field] = "[REDACTED]";
        }
      }
      return sanitized;
    }
    return value;
  }
  /**
   * Get a pooled entry or create a new one to reduce GC pressure
   */
  getPooledEntry() {
    if (this.entryPool.length > 0) {
      return this.entryPool.pop();
    }
    return {
      timestamp: 0,
      level: "info",
      category: "file-processing",
      message: "",
      correlationId: void 0,
      data: void 0,
      errorContext: void 0
    };
  }
  /**
   * Return entries to the pool for reuse
   */
  returnEntriesToPool(entries) {
    for (const entry of entries) {
      entry.data = void 0;
      entry.errorContext = void 0;
      entry.correlationId = void 0;
      entry.message = "";
      if (this.entryPool.length < this.maxPoolSize) {
        this.entryPool.push(entry);
      }
    }
  }
  /**
   * Optimized memory management with automatic rotation
   */
  performMemoryManagement() {
    const now = Date.now();
    if (this.logs.length > this.config.maxEntries) {
      this.cleanup();
    }
    if (now - this.lastCleanupTime > this.cleanupInterval) {
      this.periodicCleanup();
      this.lastCleanupTime = now;
    }
  }
  /**
   * Periodic cleanup to manage memory and pool size
   */
  periodicCleanup() {
    if (this.entryPool.length > this.maxPoolSize) {
      this.entryPool.length = this.maxPoolSize;
    }
    const memoryThreshold = this.config.maxEntries * 0.8;
    if (this.logs.length > memoryThreshold) {
      const entriesToRemove = Math.floor(this.config.maxEntries * 0.2);
      const removedEntries = this.logs.splice(0, entriesToRemove);
      this.returnEntriesToPool(removedEntries);
    }
  }
  /**
   * Optimized deep clone for data to prevent reference leaks
   */
  cloneData(data) {
    if (data === null || typeof data !== "object") {
      return data;
    }
    if (data instanceof Date) {
      return new Date(data.getTime());
    }
    if (Array.isArray(data)) {
      return data.map((item) => this.cloneData(item));
    }
    const cloned = {};
    for (const key in data) {
      if (data.hasOwnProperty(key)) {
        cloned[key] = this.cloneData(data[key]);
      }
    }
    return cloned;
  }
  /**
   * Get performance metrics for the debug logger
   */
  getPerformanceMetrics() {
    return {
      totalLogs: this.logCount,
      averageLogTime: this.logCount > 0 ? this.totalLogTime / this.logCount : 0,
      poolSize: this.entryPool.length,
      maxPoolSize: this.maxPoolSize,
      memoryUsage: {
        currentLogs: this.logs.length,
        maxLogs: this.config.maxEntries,
        utilizationPercent: this.logs.length / this.config.maxEntries * 100
      }
    };
  }
  /**
   * Force a memory cleanup and optimization
   */
  optimizeMemory() {
    this.periodicCleanup();
    if (this.logs.length < this.config.maxEntries * 0.5) {
      this.logs = [...this.logs];
    }
    const optimalPoolSize = Math.min(this.maxPoolSize, Math.ceil(this.config.maxEntries * 0.1));
    if (this.entryPool.length > optimalPoolSize) {
      this.entryPool.length = optimalPoolSize;
    }
  }
  /**
   * Optimized JSON stringification with size limits to prevent memory issues
   */
  optimizedStringify(obj, maxDepth = 5, currentDepth = 0) {
    if (currentDepth >= maxDepth) {
      return "[Max Depth Reached]";
    }
    if (obj === null || obj === void 0) {
      return String(obj);
    }
    if (typeof obj !== "object") {
      return typeof obj === "string" ? `"${obj}"` : String(obj);
    }
    const seen = /* @__PURE__ */ new WeakSet();
    try {
      return JSON.stringify(obj, (key, value) => {
        if (typeof value === "object" && value !== null) {
          if (seen.has(value)) {
            return "[Circular Reference]";
          }
          seen.add(value);
        }
        if (typeof value === "string" && value.length > 1e3) {
          return value.substring(0, 1e3) + "... [Truncated]";
        }
        return value;
      }, 2);
    } catch (error) {
      return "[Serialization Failed]";
    }
  }
};

// main.ts
var TaskExtractorPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.processingFiles = /* @__PURE__ */ new Set();
    this.serviceCache = /* @__PURE__ */ new Map();
    this.serviceCheckInterval = null;
    this.cloudModelCache = /* @__PURE__ */ new Map();
    this.apiKeyMissingNotified = /* @__PURE__ */ new Set();
    this.fileChangeDebouncer = /* @__PURE__ */ new Map();
    this.debugLogger = null;
  }
  /**
   * Get debug logger instance with lazy initialization.
   * Only creates the logger when debug mode is enabled to avoid overhead.
   */
  getDebugLogger() {
    if (this.settings.debugMode) {
      if (!this.debugLogger) {
        this.debugLogger = new DebugLogger({
          enabled: true,
          maxEntries: this.settings.debugMaxEntries || 1e3
        });
      }
      return this.debugLogger;
    }
    return null;
  }
  async onload() {
    console.log("Loading Task Extractor plugin...");
    await this.loadSettings();
    this.llmProvider = new LLMProviderManager(this.settings, this.getDebugLogger());
    this.taskProcessor = new TaskProcessor(this.app, this.settings, this.llmProvider, this.getDebugLogger());
    this.serviceCache = this.llmProvider.getServiceCache();
    this.cloudModelCache = this.llmProvider.getCloudModelCache();
    this.apiKeyMissingNotified = this.llmProvider.getApiKeyMissingNotified();
    this.processingFiles = this.taskProcessor.getProcessingFiles();
    this.addSettingTab(new ExtractorSettingTab(this.app, this, this.settings, this.llmProvider));
    this.registerEvent(
      this.app.vault.on("create", (file) => {
        if (file instanceof import_obsidian4.TFile) {
          this.debounceFileChange(file);
        }
      })
    );
    if (this.settings.processOnUpdate) {
      this.registerEvent(
        this.app.vault.on("modify", (file) => {
          if (file instanceof import_obsidian4.TFile) {
            this.debounceFileChange(file);
          }
        })
      );
    }
    await this.initializeServices();
    this.scanExistingFiles();
  }
  onunload() {
    console.log("Unloading Task Extractor plugin...");
    if (this.serviceCheckInterval) {
      clearInterval(this.serviceCheckInterval);
      this.serviceCheckInterval = null;
    }
    this.fileChangeDebouncer.forEach((timeout) => clearTimeout(timeout));
    this.fileChangeDebouncer.clear();
    this.cloudModelCache.clear();
    this.apiKeyMissingNotified.clear();
    if (this.debugLogger) {
      this.debugLogger.cleanup();
      this.debugLogger = null;
    }
  }
  async loadSettings() {
    const rawSettings = await this.loadData();
    this.settings = validateSettings(Object.assign({}, DEFAULT_SETTINGS, rawSettings));
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  // Debounce file changes to prevent rapid processing
  debounceFileChange(file) {
    const existing = this.fileChangeDebouncer.get(file.path);
    if (existing) {
      clearTimeout(existing);
    }
    this.fileChangeDebouncer.set(file.path, setTimeout(() => {
      this.onFileChanged(file);
      this.fileChangeDebouncer.delete(file.path);
    }, 2e3));
  }
  // Delegate to task processor
  async onFileChanged(file) {
    return this.taskProcessor.onFileChanged(file);
  }
  async scanExistingFiles() {
    return this.taskProcessor.scanExistingFiles();
  }
  // Service Detection and Management - delegate to LLM provider
  async initializeServices() {
  }
  async detectServices() {
    return this.llmProvider.detectServices();
  }
  getAvailableServices() {
    return this.llmProvider.getAvailableServices();
  }
  // LLM calls - delegate to provider
  async callLLM(systemPrompt, userPrompt) {
    return this.llmProvider.callLLM(systemPrompt, userPrompt);
  }
  async fetchCloudModels(provider) {
    return this.llmProvider.fetchCloudModels(provider);
  }
  getDefaultModels(provider) {
    return this.llmProvider.getDefaultModels(provider);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvdHlwZXMudHMiLCAic3JjL2xsbS1wcm92aWRlcnMudHMiLCAic3JjL3Rhc2stcHJvY2Vzc29yLnRzIiwgInNyYy9zZXR0aW5ncy50cyIsICJzcmMvZGVidWctbG9nZ2VyLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKlxyXG5PYnNpZGlhbiBQbHVnaW46IFRhc2sgRXh0cmFjdG9yIGZvciBFbWFpbHMgJiBNZWV0aW5nIE5vdGVzXHJcbkVuaGFuY2VkIHZlcnNpb24gd2l0aCBsb2NhbCBMTE0gc3VwcG9ydCBhbmQgY3VzdG9taXphYmxlIGZyb250bWF0dGVyXHJcblxyXG5GZWF0dXJlczpcclxuLSBNdWx0aS1wcm92aWRlciBMTE0gc3VwcG9ydDogT3BlbkFJLCBBbnRocm9waWMsIE9sbGFtYSwgTE0gU3R1ZGlvXHJcbi0gQXV0by1kZXRlY3Rpb24gb2YgbG9jYWwgTExNIHNlcnZpY2VzXHJcbi0gQ3VzdG9taXphYmxlIGZyb250bWF0dGVyIHRlbXBsYXRlcyBmb3IgdGFzayBjcmVhdGlvblxyXG4tIEFkdmFuY2VkIHNldHRpbmdzIHdpdGggcmVhbC10aW1lIHNlcnZpY2UgbW9uaXRvcmluZ1xyXG4tIFJvYnVzdCBlcnJvciBoYW5kbGluZyBhbmQgZmFsbGJhY2sgc3RyYXRlZ2llc1xyXG4qL1xyXG5cclxuaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBFeHRyYWN0b3JTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUywgTExNU2VydmljZSwgdmFsaWRhdGVTZXR0aW5ncyB9IGZyb20gJy4vc3JjL3R5cGVzJztcclxuaW1wb3J0IHsgTExNUHJvdmlkZXJNYW5hZ2VyIH0gZnJvbSAnLi9zcmMvbGxtLXByb3ZpZGVycyc7XHJcbmltcG9ydCB7IFRhc2tQcm9jZXNzb3IgfSBmcm9tICcuL3NyYy90YXNrLXByb2Nlc3Nvcic7XHJcbmltcG9ydCB7IEV4dHJhY3RvclNldHRpbmdUYWIgfSBmcm9tICcuL3NyYy9zZXR0aW5ncyc7XHJcbmltcG9ydCB7IERlYnVnTG9nZ2VyIH0gZnJvbSAnLi9zcmMvZGVidWctbG9nZ2VyJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRhc2tFeHRyYWN0b3JQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIHNldHRpbmdzOiBFeHRyYWN0b3JTZXR0aW5ncztcclxuICBwcm9jZXNzaW5nRmlsZXM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xyXG4gIHNlcnZpY2VDYWNoZTogTWFwPHN0cmluZywgTExNU2VydmljZT4gPSBuZXcgTWFwKCk7XHJcbiAgc2VydmljZUNoZWNrSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XHJcbiAgY2xvdWRNb2RlbENhY2hlOiBNYXA8c3RyaW5nLCBzdHJpbmdbXT4gPSBuZXcgTWFwKCk7XHJcbiAgYXBpS2V5TWlzc2luZ05vdGlmaWVkOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcclxuICBmaWxlQ2hhbmdlRGVib3VuY2VyOiBNYXA8c3RyaW5nLCBOb2RlSlMuVGltZW91dD4gPSBuZXcgTWFwKCk7XHJcblxyXG4gIHByaXZhdGUgbGxtUHJvdmlkZXI6IExMTVByb3ZpZGVyTWFuYWdlcjtcclxuICBwcml2YXRlIHRhc2tQcm9jZXNzb3I6IFRhc2tQcm9jZXNzb3I7XHJcbiAgcHJpdmF0ZSBkZWJ1Z0xvZ2dlcjogRGVidWdMb2dnZXIgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGRlYnVnIGxvZ2dlciBpbnN0YW5jZSB3aXRoIGxhenkgaW5pdGlhbGl6YXRpb24uXHJcbiAgICogT25seSBjcmVhdGVzIHRoZSBsb2dnZXIgd2hlbiBkZWJ1ZyBtb2RlIGlzIGVuYWJsZWQgdG8gYXZvaWQgb3ZlcmhlYWQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXREZWJ1Z0xvZ2dlcigpOiBEZWJ1Z0xvZ2dlciB8IG51bGwge1xyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWdNb2RlKSB7XHJcbiAgICAgIGlmICghdGhpcy5kZWJ1Z0xvZ2dlcikge1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXIgPSBuZXcgRGVidWdMb2dnZXIoe1xyXG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIG1heEVudHJpZXM6IHRoaXMuc2V0dGluZ3MuZGVidWdNYXhFbnRyaWVzIHx8IDEwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGhpcy5kZWJ1Z0xvZ2dlcjtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgY29uc29sZS5sb2coJ0xvYWRpbmcgVGFzayBFeHRyYWN0b3IgcGx1Z2luLi4uJyk7XHJcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgbW9kdWxhciBjb21wb25lbnRzXHJcbiAgICB0aGlzLmxsbVByb3ZpZGVyID0gbmV3IExMTVByb3ZpZGVyTWFuYWdlcih0aGlzLnNldHRpbmdzLCB0aGlzLmdldERlYnVnTG9nZ2VyKCkpO1xyXG4gICAgdGhpcy50YXNrUHJvY2Vzc29yID0gbmV3IFRhc2tQcm9jZXNzb3IodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3MsIHRoaXMubGxtUHJvdmlkZXIsIHRoaXMuZ2V0RGVidWdMb2dnZXIoKSk7XHJcblxyXG4gICAgLy8gU3luYyB0aGUgcmVmZXJlbmNlcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxyXG4gICAgdGhpcy5zZXJ2aWNlQ2FjaGUgPSB0aGlzLmxsbVByb3ZpZGVyLmdldFNlcnZpY2VDYWNoZSgpO1xyXG4gICAgdGhpcy5jbG91ZE1vZGVsQ2FjaGUgPSB0aGlzLmxsbVByb3ZpZGVyLmdldENsb3VkTW9kZWxDYWNoZSgpO1xyXG4gICAgdGhpcy5hcGlLZXlNaXNzaW5nTm90aWZpZWQgPSB0aGlzLmxsbVByb3ZpZGVyLmdldEFwaUtleU1pc3NpbmdOb3RpZmllZCgpO1xyXG4gICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMgPSB0aGlzLnRhc2tQcm9jZXNzb3IuZ2V0UHJvY2Vzc2luZ0ZpbGVzKCk7XHJcblxyXG4gICAgLy8gUmVnaXN0ZXIgc2V0dGluZ3MgdGFiXHJcbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEV4dHJhY3RvclNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMsIHRoaXMuc2V0dGluZ3MsIHRoaXMubGxtUHJvdmlkZXIpKTtcclxuXHJcbiAgICAvLyBIb29rIGludG8gbWV0YWRhdGEgY2hhbmdlcyAoZmlsZSBjcmVhdGVkL3VwZGF0ZWQpXHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXHJcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdjcmVhdGUnLCAoZmlsZSkgPT4ge1xyXG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgIHRoaXMuZGVib3VuY2VGaWxlQ2hhbmdlKGZpbGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MucHJvY2Vzc09uVXBkYXRlKSB7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcclxuICAgICAgICB0aGlzLmFwcC52YXVsdC5vbignbW9kaWZ5JywgKGZpbGUpID0+IHtcclxuICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWJvdW5jZUZpbGVDaGFuZ2UoZmlsZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIHNlcnZpY2UgZGV0ZWN0aW9uXHJcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVTZXJ2aWNlcygpO1xyXG4gICAgXHJcbiAgICAvLyBBbHNvIHNjYW4gZXhpc3RpbmcgdW5wcm9jZXNzZWQgZmlsZXMgb25jZSBvbiBsb2FkIChub24tYmxvY2tpbmcpXHJcbiAgICB0aGlzLnNjYW5FeGlzdGluZ0ZpbGVzKCk7XHJcbiAgfVxyXG5cclxuICBvbnVubG9hZCgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdVbmxvYWRpbmcgVGFzayBFeHRyYWN0b3IgcGx1Z2luLi4uJyk7XHJcbiAgICBpZiAodGhpcy5zZXJ2aWNlQ2hlY2tJbnRlcnZhbCkge1xyXG4gICAgICBjbGVhckludGVydmFsKHRoaXMuc2VydmljZUNoZWNrSW50ZXJ2YWwpO1xyXG4gICAgICB0aGlzLnNlcnZpY2VDaGVja0ludGVydmFsID0gbnVsbDtcclxuICAgIH1cclxuICAgIC8vIENsZWFyIHBlbmRpbmcgZmlsZSBjaGFuZ2UgdGltZW91dHNcclxuICAgIHRoaXMuZmlsZUNoYW5nZURlYm91bmNlci5mb3JFYWNoKHRpbWVvdXQgPT4gY2xlYXJUaW1lb3V0KHRpbWVvdXQpKTtcclxuICAgIHRoaXMuZmlsZUNoYW5nZURlYm91bmNlci5jbGVhcigpO1xyXG4gICAgLy8gQ2xlYXIgY2FjaGVzXHJcbiAgICB0aGlzLmNsb3VkTW9kZWxDYWNoZS5jbGVhcigpO1xyXG4gICAgdGhpcy5hcGlLZXlNaXNzaW5nTm90aWZpZWQuY2xlYXIoKTtcclxuICAgIC8vIENsZWFuIHVwIGRlYnVnIGxvZ2dlclxyXG4gICAgaWYgKHRoaXMuZGVidWdMb2dnZXIpIHtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlci5jbGVhbnVwKCk7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xyXG4gICAgY29uc3QgcmF3U2V0dGluZ3MgPSBhd2FpdCB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICAvLyBWYWxpZGF0ZSBhbmQgc2FuaXRpemUgbG9hZGVkIHNldHRpbmdzIHRvIGVuc3VyZSBhbGwgdmFsdWVzIGFyZSB3aXRoaW4gYWNjZXB0YWJsZSByYW5nZXNcclxuICAgIHRoaXMuc2V0dGluZ3MgPSB2YWxpZGF0ZVNldHRpbmdzKE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIHJhd1NldHRpbmdzKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XHJcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVib3VuY2UgZmlsZSBjaGFuZ2VzIHRvIHByZXZlbnQgcmFwaWQgcHJvY2Vzc2luZ1xyXG4gIHByaXZhdGUgZGVib3VuY2VGaWxlQ2hhbmdlKGZpbGU6IFRGaWxlKSB7XHJcbiAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuZmlsZUNoYW5nZURlYm91bmNlci5nZXQoZmlsZS5wYXRoKTtcclxuICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICBjbGVhclRpbWVvdXQoZXhpc3RpbmcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB0aGlzLmZpbGVDaGFuZ2VEZWJvdW5jZXIuc2V0KGZpbGUucGF0aCwgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMub25GaWxlQ2hhbmdlZChmaWxlKTtcclxuICAgICAgdGhpcy5maWxlQ2hhbmdlRGVib3VuY2VyLmRlbGV0ZShmaWxlLnBhdGgpO1xyXG4gICAgfSwgMjAwMCkpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVsZWdhdGUgdG8gdGFzayBwcm9jZXNzb3JcclxuICBhc3luYyBvbkZpbGVDaGFuZ2VkKGZpbGU6IFRGaWxlKSB7XHJcbiAgICByZXR1cm4gdGhpcy50YXNrUHJvY2Vzc29yLm9uRmlsZUNoYW5nZWQoZmlsZSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBzY2FuRXhpc3RpbmdGaWxlcygpIHtcclxuICAgIHJldHVybiB0aGlzLnRhc2tQcm9jZXNzb3Iuc2NhbkV4aXN0aW5nRmlsZXMoKTtcclxuICB9XHJcblxyXG4gIC8vIFNlcnZpY2UgRGV0ZWN0aW9uIGFuZCBNYW5hZ2VtZW50IC0gZGVsZWdhdGUgdG8gTExNIHByb3ZpZGVyXHJcbiAgYXN5bmMgaW5pdGlhbGl6ZVNlcnZpY2VzKCkge1xyXG4gICAgLy8gTm8gbG9uZ2VyIGRvIHVwZnJvbnQgZGV0ZWN0aW9uIC0gdXNlIGxhenkgbG9hZGluZ1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGV0ZWN0U2VydmljZXMoKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBMTE1TZXJ2aWNlPj4ge1xyXG4gICAgcmV0dXJuIHRoaXMubGxtUHJvdmlkZXIuZGV0ZWN0U2VydmljZXMoKTtcclxuICB9XHJcblxyXG4gIGdldEF2YWlsYWJsZVNlcnZpY2VzKCk6IExMTVNlcnZpY2VbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5sbG1Qcm92aWRlci5nZXRBdmFpbGFibGVTZXJ2aWNlcygpO1xyXG4gIH1cclxuXHJcbiAgLy8gTExNIGNhbGxzIC0gZGVsZWdhdGUgdG8gcHJvdmlkZXJcclxuICBhc3luYyBjYWxsTExNKHN5c3RlbVByb21wdDogc3RyaW5nLCB1c2VyUHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICAgIHJldHVybiB0aGlzLmxsbVByb3ZpZGVyLmNhbGxMTE0oc3lzdGVtUHJvbXB0LCB1c2VyUHJvbXB0KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGZldGNoQ2xvdWRNb2RlbHMocHJvdmlkZXI6ICdvcGVuYWknIHwgJ2FudGhyb3BpYycpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5sbG1Qcm92aWRlci5mZXRjaENsb3VkTW9kZWxzKHByb3ZpZGVyKTtcclxuICB9XHJcblxyXG4gIGdldERlZmF1bHRNb2RlbHMocHJvdmlkZXI6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIHJldHVybiB0aGlzLmxsbVByb3ZpZGVyLmdldERlZmF1bHRNb2RlbHMocHJvdmlkZXIpO1xyXG4gIH1cclxufVxyXG5cclxuIiwgIi8qXHJcbiAqIFR5cGUgZGVmaW5pdGlvbnMgZm9yIFRhc2sgRXh0cmFjdG9yIFBsdWdpblxyXG4gKi9cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRnJvbnRtYXR0ZXJGaWVsZCB7XHJcbiAga2V5OiBzdHJpbmc7XHJcbiAgZGVmYXVsdFZhbHVlOiBzdHJpbmc7XHJcbiAgdHlwZTogJ3RleHQnIHwgJ2RhdGUnIHwgJ3NlbGVjdCcgfCAnYm9vbGVhbic7XHJcbiAgb3B0aW9ucz86IHN0cmluZ1tdOyAvLyBmb3Igc2VsZWN0IHR5cGVcclxuICByZXF1aXJlZDogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBMTE1TZXJ2aWNlIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgdXJsOiBzdHJpbmc7XHJcbiAgYXZhaWxhYmxlOiBib29sZWFuO1xyXG4gIG1vZGVsczogc3RyaW5nW107XHJcbiAgbGFzdENoZWNrZWQ6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBFeHRyYWN0b3JTZXR0aW5ncyB7XHJcbiAgcHJvdmlkZXI6ICdvcGVuYWknIHwgJ2FudGhyb3BpYycgfCAnb2xsYW1hJyB8ICdsbXN0dWRpbyc7XHJcbiAgYXBpS2V5OiBzdHJpbmc7XHJcbiAgbW9kZWw6IHN0cmluZztcclxuICBcclxuICAvLyBMb2NhbCBMTE0gc2V0dGluZ3NcclxuICBvbGxhbWFVcmw6IHN0cmluZztcclxuICBsbXN0dWRpb1VybDogc3RyaW5nO1xyXG4gIGFudGhyb3BpY1VybDogc3RyaW5nO1xyXG4gIGxvY2FsTW9kZWxSZWZyZXNoSW50ZXJ2YWw6IG51bWJlcjsgLy8gbWludXRlc1xyXG4gIFxyXG4gIC8vIFByb2Nlc3Npbmcgc2V0dGluZ3NcclxuICB0YXNrc0ZvbGRlcjogc3RyaW5nO1xyXG4gIGxpbmtCYWNrOiBib29sZWFuO1xyXG4gIHByb2Nlc3NlZEZyb250bWF0dGVyS2V5OiBzdHJpbmc7XHJcbiAgb3duZXJOYW1lOiBzdHJpbmc7XHJcbiAgcHJvY2Vzc09uVXBkYXRlOiBib29sZWFuO1xyXG4gIHRyaWdnZXJUeXBlczogc3RyaW5nW107IC8vIGN1c3RvbWl6YWJsZSBub3RlIHR5cGVzIHRvIHByb2Nlc3NcclxuICB0cmlnZ2VyRnJvbnRtYXR0ZXJGaWVsZDogc3RyaW5nOyAvLyBjb25maWd1cmFibGUgZnJvbnRtYXR0ZXIgZmllbGQgZm9yIGZpbHRlcmluZ1xyXG4gIFxyXG4gIC8vIEV4Y2x1c2lvbiBzZXR0aW5nc1xyXG4gIGV4Y2x1ZGVkUGF0aHM6IHN0cmluZ1tdOyAvLyBleGFjdCBwYXRocyB0byBleGNsdWRlIChmaWxlcyBvciBmb2xkZXJzKVxyXG4gIGV4Y2x1ZGVkUGF0dGVybnM6IHN0cmluZ1tdOyAvLyBnbG9iLXN0eWxlIHBhdHRlcm5zIHRvIGV4Y2x1ZGVcclxuICBcclxuICAvLyBDdXN0b21pemFibGUgZnJvbnRtYXR0ZXJcclxuICBmcm9udG1hdHRlckZpZWxkczogRnJvbnRtYXR0ZXJGaWVsZFtdO1xyXG4gIGN1c3RvbVByb21wdDogc3RyaW5nO1xyXG4gIFxyXG4gIC8vIEFkdmFuY2VkIHNldHRpbmdzXHJcbiAgbWF4VG9rZW5zOiBudW1iZXI7XHJcbiAgdGVtcGVyYXR1cmU6IG51bWJlcjtcclxuICB0aW1lb3V0OiBudW1iZXI7IC8vIHNlY29uZHNcclxuICByZXRyaWVzOiBudW1iZXI7XHJcbiAgXHJcbiAgLy8gRGVidWcgc2V0dGluZ3NcclxuICBkZWJ1Z01vZGU6IGJvb2xlYW47XHJcbiAgZGVidWdNYXhFbnRyaWVzOiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRXh0cmFjdGVkVGFzayB7XHJcbiAgdGFza190aXRsZTogc3RyaW5nO1xyXG4gIHRhc2tfZGV0YWlsczogc3RyaW5nO1xyXG4gIGR1ZV9kYXRlPzogc3RyaW5nIHwgbnVsbDtcclxuICBwcmlvcml0eT86ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdyc7XHJcbiAgcHJvamVjdD86IHN0cmluZyB8IG51bGw7XHJcbiAgY2xpZW50Pzogc3RyaW5nIHwgbnVsbDtcclxuICBzb3VyY2VfZXhjZXJwdD86IHN0cmluZztcclxuICBjb25maWRlbmNlPzogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcclxuICBba2V5OiBzdHJpbmddOiBhbnk7IC8vIEFsbG93IGFkZGl0aW9uYWwgZXh0cmFjdGVkIGZpZWxkc1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRhc2tFeHRyYWN0aW9uUmVzdWx0IHtcclxuICBmb3VuZDogYm9vbGVhbjtcclxuICB0YXNrczogRXh0cmFjdGVkVGFza1tdO1xyXG4gIGNvbmZpZGVuY2U/OiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnO1xyXG59XHJcblxyXG4vLyBCYWNrd2FyZCBjb21wYXRpYmlsaXR5IHR5cGUgYWxpYXNcclxuZXhwb3J0IGludGVyZmFjZSBUYXNrRXh0cmFjdGlvbiB7XHJcbiAgZm91bmQ6IGJvb2xlYW47XHJcbiAgdGFza190aXRsZT86IHN0cmluZztcclxuICB0YXNrX2RldGFpbHM/OiBzdHJpbmc7XHJcbiAgZHVlX2RhdGU/OiBzdHJpbmcgfCBudWxsO1xyXG4gIHByaW9yaXR5Pzogc3RyaW5nO1xyXG4gIHNvdXJjZV9leGNlcnB0Pzogc3RyaW5nO1xyXG4gIFtrZXk6IHN0cmluZ106IGFueTsgLy8gQWxsb3cgYWRkaXRpb25hbCBleHRyYWN0ZWQgZmllbGRzXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX0ZST05UTUFUVEVSX0ZJRUxEUzogRnJvbnRtYXR0ZXJGaWVsZFtdID0gW1xyXG4gIHsga2V5OiAndGFzaycsIGRlZmF1bHRWYWx1ZTogJycsIHR5cGU6ICd0ZXh0JywgcmVxdWlyZWQ6IHRydWUgfSxcclxuICB7IGtleTogJ3N0YXR1cycsIGRlZmF1bHRWYWx1ZTogJ2luYm94JywgdHlwZTogJ3NlbGVjdCcsIG9wdGlvbnM6IFsnaW5ib3gnLCAnbmV4dCcsICd3YWl0aW5nJywgJ3NvbWVkYXknLCAnZG9uZScsICdjYW5jZWxsZWQnXSwgcmVxdWlyZWQ6IHRydWUgfSxcclxuICB7IGtleTogJ3ByaW9yaXR5JywgZGVmYXVsdFZhbHVlOiAnbWVkaXVtJywgdHlwZTogJ3NlbGVjdCcsIG9wdGlvbnM6IFsnbG93JywgJ21lZGl1bScsICdoaWdoJywgJ3VyZ2VudCddLCByZXF1aXJlZDogdHJ1ZSB9LFxyXG4gIHsga2V5OiAnZHVlJywgZGVmYXVsdFZhbHVlOiAnJywgdHlwZTogJ2RhdGUnLCByZXF1aXJlZDogZmFsc2UgfSxcclxuICB7IGtleTogJ3Byb2plY3QnLCBkZWZhdWx0VmFsdWU6ICcnLCB0eXBlOiAndGV4dCcsIHJlcXVpcmVkOiBmYWxzZSB9LFxyXG4gIHsga2V5OiAnY2xpZW50JywgZGVmYXVsdFZhbHVlOiAnJywgdHlwZTogJ3RleHQnLCByZXF1aXJlZDogZmFsc2UgfSxcclxuICB7IGtleTogJ2NyZWF0ZWQnLCBkZWZhdWx0VmFsdWU6ICd7e2RhdGV9fScsIHR5cGU6ICdkYXRlJywgcmVxdWlyZWQ6IHRydWUgfSxcclxuICB7IGtleTogJ3RhZ3MnLCBkZWZhdWx0VmFsdWU6ICd0YXNrJywgdHlwZTogJ3RleHQnLCByZXF1aXJlZDogZmFsc2UgfVxyXG5dO1xyXG5cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEV4dHJhY3RvclNldHRpbmdzID0ge1xyXG4gIHByb3ZpZGVyOiAnb3BlbmFpJyxcclxuICBhcGlLZXk6ICcnLFxyXG4gIG1vZGVsOiAnZ3B0LTRvLW1pbmknLFxyXG4gIFxyXG4gIC8vIExvY2FsIExMTSBzZXR0aW5nc1xyXG4gIG9sbGFtYVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxyXG4gIGxtc3R1ZGlvVXJsOiAnaHR0cDovL2xvY2FsaG9zdDoxMjM0JyxcclxuICBhbnRocm9waWNVcmw6ICdodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzJyxcclxuICBsb2NhbE1vZGVsUmVmcmVzaEludGVydmFsOiA1LFxyXG4gIFxyXG4gIC8vIFByb2Nlc3Npbmcgc2V0dGluZ3NcclxuICB0YXNrc0ZvbGRlcjogJ1Rhc2tzJyxcclxuICBsaW5rQmFjazogdHJ1ZSxcclxuICBwcm9jZXNzZWRGcm9udG1hdHRlcktleTogJ3Rhc2tFeHRyYWN0b3IucHJvY2Vzc2VkJyxcclxuICBvd25lck5hbWU6ICdCcnlhbiBLb2xiJyxcclxuICBwcm9jZXNzT25VcGRhdGU6IGZhbHNlLFxyXG4gIHRyaWdnZXJUeXBlczogWydlbWFpbCcsICdtZWV0aW5nbm90ZScsICdtZWV0aW5nIG5vdGUnLCAnbWVldGluZyBub3RlcyddLFxyXG4gIHRyaWdnZXJGcm9udG1hdHRlckZpZWxkOiAnVHlwZScsIC8vIGRlZmF1bHQgdG8gXCJUeXBlXCIgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxuICBcclxuICAvLyBFeGNsdXNpb24gc2V0dGluZ3NcclxuICBleGNsdWRlZFBhdGhzOiBbXSxcclxuICBleGNsdWRlZFBhdHRlcm5zOiBbXSxcclxuICBcclxuICAvLyBDdXN0b21pemFibGUgZnJvbnRtYXR0ZXJcclxuICBmcm9udG1hdHRlckZpZWxkczogREVGQVVMVF9GUk9OVE1BVFRFUl9GSUVMRFMsXHJcbiAgY3VzdG9tUHJvbXB0OiAnJyxcclxuICBcclxuICAvLyBBZHZhbmNlZCBzZXR0aW5nc1xyXG4gIG1heFRva2VuczogODAwLFxyXG4gIHRlbXBlcmF0dXJlOiAwLFxyXG4gIHRpbWVvdXQ6IDMwLFxyXG4gIHJldHJpZXM6IDMsXHJcbiAgXHJcbiAgLy8gRGVidWcgc2V0dGluZ3NcclxuICBkZWJ1Z01vZGU6IGZhbHNlLFxyXG4gIGRlYnVnTWF4RW50cmllczogMTAwMCxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZXMgYW5kIHNhbml0aXplcyBzZXR0aW5ncyBvYmplY3QsIGVuc3VyaW5nIGFsbCB2YWx1ZXMgYXJlIHdpdGhpbiBhY2NlcHRhYmxlIHJhbmdlc1xyXG4gKiBSZXR1cm5zIGEgbmV3IHNldHRpbmdzIG9iamVjdCB3aXRoIHZhbGlkYXRlZCB2YWx1ZXNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVNldHRpbmdzKHNldHRpbmdzOiBQYXJ0aWFsPEV4dHJhY3RvclNldHRpbmdzPiwgZGVidWdMb2dnZXI/OiBpbXBvcnQoJy4vZGVidWctbG9nZ2VyJykuRGVidWdMb2dnZXIpOiBFeHRyYWN0b3JTZXR0aW5ncyB7XHJcbiAgY29uc3QgY29ycmVsYXRpb25JZCA9IGRlYnVnTG9nZ2VyID8gYHZhbGlkYXRlLXNldHRpbmdzLSR7RGF0ZS5ub3coKX1gIDogdW5kZWZpbmVkO1xyXG4gIGNvbnN0IHZhbGlkYXRlZDogRXh0cmFjdG9yU2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfU0VUVElOR1MgfTtcclxuXHJcbiAgLy8gVmFsaWRhdGUgcHJvdmlkZXJcclxuICBpZiAoc2V0dGluZ3MucHJvdmlkZXIgJiYgWydvcGVuYWknLCAnYW50aHJvcGljJywgJ29sbGFtYScsICdsbXN0dWRpbyddLmluY2x1ZGVzKHNldHRpbmdzLnByb3ZpZGVyKSkge1xyXG4gICAgdmFsaWRhdGVkLnByb3ZpZGVyID0gc2V0dGluZ3MucHJvdmlkZXI7XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSBzdHJpbmcgZmllbGRzXHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5hcGlLZXkgPT09ICdzdHJpbmcnKSB2YWxpZGF0ZWQuYXBpS2V5ID0gc2V0dGluZ3MuYXBpS2V5O1xyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MubW9kZWwgPT09ICdzdHJpbmcnKSB2YWxpZGF0ZWQubW9kZWwgPSBzZXR0aW5ncy5tb2RlbDtcclxuICBpZiAodHlwZW9mIHNldHRpbmdzLm9sbGFtYVVybCA9PT0gJ3N0cmluZycpIHZhbGlkYXRlZC5vbGxhbWFVcmwgPSBzZXR0aW5ncy5vbGxhbWFVcmw7XHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5sbXN0dWRpb1VybCA9PT0gJ3N0cmluZycpIHZhbGlkYXRlZC5sbXN0dWRpb1VybCA9IHNldHRpbmdzLmxtc3R1ZGlvVXJsO1xyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MuYW50aHJvcGljVXJsID09PSAnc3RyaW5nJykgdmFsaWRhdGVkLmFudGhyb3BpY1VybCA9IHNldHRpbmdzLmFudGhyb3BpY1VybDtcclxuICBpZiAodHlwZW9mIHNldHRpbmdzLnRhc2tzRm9sZGVyID09PSAnc3RyaW5nJyAmJiBzZXR0aW5ncy50YXNrc0ZvbGRlci50cmltKCkpIHtcclxuICAgIHZhbGlkYXRlZC50YXNrc0ZvbGRlciA9IHNldHRpbmdzLnRhc2tzRm9sZGVyLnRyaW0oKTtcclxuICB9XHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5vd25lck5hbWUgPT09ICdzdHJpbmcnICYmIHNldHRpbmdzLm93bmVyTmFtZS50cmltKCkpIHtcclxuICAgIHZhbGlkYXRlZC5vd25lck5hbWUgPSBzZXR0aW5ncy5vd25lck5hbWUudHJpbSgpO1xyXG4gIH1cclxuICBpZiAodHlwZW9mIHNldHRpbmdzLmN1c3RvbVByb21wdCA9PT0gJ3N0cmluZycpIHZhbGlkYXRlZC5jdXN0b21Qcm9tcHQgPSBzZXR0aW5ncy5jdXN0b21Qcm9tcHQ7XHJcblxyXG4gIC8vIFZhbGlkYXRlIHByb2Nlc3NlZCBmcm9udG1hdHRlciBrZXkgKGNhbiBiZSBuZXN0ZWQgbGlrZSBcInRhc2tFeHRyYWN0b3IucHJvY2Vzc2VkXCIpXHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5wcm9jZXNzZWRGcm9udG1hdHRlcktleSA9PT0gJ3N0cmluZycpIHtcclxuICAgIGNvbnN0IGtleSA9IHNldHRpbmdzLnByb2Nlc3NlZEZyb250bWF0dGVyS2V5LnRyaW0oKTtcclxuICAgIC8vIEFsbG93IG5lc3RlZCBrZXlzIHdpdGggZG90cywgYnV0IHZhbGlkYXRlIGVhY2ggcGFydFxyXG4gICAgY29uc3QgcGFydHMgPSBrZXkuc3BsaXQoJy4nKTtcclxuICAgIGNvbnN0IHlhbWxLZXlQYXR0ZXJuID0gL15bYS16QS1aX11bYS16QS1aMC05Xy1dKiQvO1xyXG4gICAgY29uc3QgaXNWYWxpZCA9IHBhcnRzLmV2ZXJ5KHBhcnQgPT4gcGFydCAmJiB5YW1sS2V5UGF0dGVybi50ZXN0KHBhcnQpKTtcclxuICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgIHZhbGlkYXRlZC5wcm9jZXNzZWRGcm9udG1hdHRlcktleSA9IGtleTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFZhbGlkYXRlIGZyb250bWF0dGVyIGZpZWxkIHdpdGggWUFNTCBrZXkgdmFsaWRhdGlvblxyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MudHJpZ2dlckZyb250bWF0dGVyRmllbGQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICBjb25zdCBmaWVsZCA9IHNldHRpbmdzLnRyaWdnZXJGcm9udG1hdHRlckZpZWxkLnRyaW0oKTtcclxuICAgIGNvbnN0IHlhbWxLZXlQYXR0ZXJuID0gL15bYS16QS1aX11bYS16QS1aMC05Xy4tXSokLztcclxuICAgIGlmIChmaWVsZCAmJiB5YW1sS2V5UGF0dGVybi50ZXN0KGZpZWxkKSAmJiAhZmllbGQuaW5jbHVkZXMoJy4uJykgJiYgIWZpZWxkLnN0YXJ0c1dpdGgoJy4nKSAmJiAhZmllbGQuZW5kc1dpdGgoJy4nKSkge1xyXG4gICAgICB2YWxpZGF0ZWQudHJpZ2dlckZyb250bWF0dGVyRmllbGQgPSBmaWVsZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFZhbGlkYXRlIGJvb2xlYW4gZmllbGRzXHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5saW5rQmFjayA9PT0gJ2Jvb2xlYW4nKSB2YWxpZGF0ZWQubGlua0JhY2sgPSBzZXR0aW5ncy5saW5rQmFjaztcclxuICBpZiAodHlwZW9mIHNldHRpbmdzLnByb2Nlc3NPblVwZGF0ZSA9PT0gJ2Jvb2xlYW4nKSB2YWxpZGF0ZWQucHJvY2Vzc09uVXBkYXRlID0gc2V0dGluZ3MucHJvY2Vzc09uVXBkYXRlO1xyXG5cclxuICAvLyBWYWxpZGF0ZSBhcnJheXNcclxuICBpZiAoQXJyYXkuaXNBcnJheShzZXR0aW5ncy50cmlnZ2VyVHlwZXMpKSB7XHJcbiAgICBjb25zdCB2YWxpZFR5cGVzID0gc2V0dGluZ3MudHJpZ2dlclR5cGVzXHJcbiAgICAgIC5maWx0ZXIodCA9PiB0eXBlb2YgdCA9PT0gJ3N0cmluZycgJiYgdC50cmltKCkubGVuZ3RoID4gMClcclxuICAgICAgLm1hcCh0ID0+IHQudHJpbSgpKTtcclxuICAgIGlmICh2YWxpZFR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdmFsaWRhdGVkLnRyaWdnZXJUeXBlcyA9IHZhbGlkVHlwZXM7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmIChBcnJheS5pc0FycmF5KHNldHRpbmdzLmZyb250bWF0dGVyRmllbGRzKSkge1xyXG4gICAgY29uc3QgdmFsaWRGaWVsZHMgPSBzZXR0aW5ncy5mcm9udG1hdHRlckZpZWxkcy5maWx0ZXIoZiA9PiBcclxuICAgICAgZiAmJiB0eXBlb2YgZi5rZXkgPT09ICdzdHJpbmcnICYmIGYua2V5LnRyaW0oKS5sZW5ndGggPiAwICYmXHJcbiAgICAgIHR5cGVvZiBmLmRlZmF1bHRWYWx1ZSA9PT0gJ3N0cmluZycgJiZcclxuICAgICAgdHlwZW9mIGYudHlwZSA9PT0gJ3N0cmluZycgJiYgWyd0ZXh0JywgJ2RhdGUnLCAnc2VsZWN0JywgJ2Jvb2xlYW4nXS5pbmNsdWRlcyhmLnR5cGUpICYmXHJcbiAgICAgIHR5cGVvZiBmLnJlcXVpcmVkID09PSAnYm9vbGVhbidcclxuICAgICk7XHJcbiAgICBpZiAodmFsaWRGaWVsZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB2YWxpZGF0ZWQuZnJvbnRtYXR0ZXJGaWVsZHMgPSB2YWxpZEZpZWxkcztcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLy8gVmFsaWRhdGUgZXhjbHVzaW9uIGFycmF5c1xyXG4gIGlmIChBcnJheS5pc0FycmF5KHNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMpKSB7XHJcbiAgICBjb25zdCB2YWxpZFBhdGhzID0gc2V0dGluZ3MuZXhjbHVkZWRQYXRoc1xyXG4gICAgICAuZmlsdGVyKHAgPT4gdHlwZW9mIHAgPT09ICdzdHJpbmcnICYmIHAudHJpbSgpLmxlbmd0aCA+IDApXHJcbiAgICAgIC5tYXAocCA9PiBwLnRyaW0oKSlcclxuICAgICAgLmZpbHRlcihwID0+IHtcclxuICAgICAgICAvLyBCYXNpYyBwYXRoIHZhbGlkYXRpb24gLSBubyBlbXB0eSBzdHJpbmdzLCBhbmQgcmVhc29uYWJsZSBsZW5ndGhcclxuICAgICAgICByZXR1cm4gcC5sZW5ndGggPiAwICYmIHAubGVuZ3RoIDwgNTAwO1xyXG4gICAgICB9KTtcclxuICAgIHZhbGlkYXRlZC5leGNsdWRlZFBhdGhzID0gdmFsaWRQYXRocztcclxuICB9XHJcbiAgaWYgKEFycmF5LmlzQXJyYXkoc2V0dGluZ3MuZXhjbHVkZWRQYXR0ZXJucykpIHtcclxuICAgIGNvbnN0IHZhbGlkUGF0dGVybnMgPSBzZXR0aW5ncy5leGNsdWRlZFBhdHRlcm5zXHJcbiAgICAgIC5maWx0ZXIocCA9PiB0eXBlb2YgcCA9PT0gJ3N0cmluZycgJiYgcC50cmltKCkubGVuZ3RoID4gMClcclxuICAgICAgLm1hcChwID0+IHAudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKHAgPT4ge1xyXG4gICAgICAgIC8vIEJhc2ljIHBhdHRlcm4gdmFsaWRhdGlvbiAtIG5vIGVtcHR5IHN0cmluZ3MsIHJlYXNvbmFibGUgbGVuZ3RoLCBhbmQgYmFzaWMgZ2xvYiBwYXR0ZXJuIGNoZWNrXHJcbiAgICAgICAgcmV0dXJuIHAubGVuZ3RoID4gMCAmJiBwLmxlbmd0aCA8IDUwMCAmJiAhL1s8PjpcInw/XS8udGVzdChwKTtcclxuICAgICAgfSk7XHJcbiAgICB2YWxpZGF0ZWQuZXhjbHVkZWRQYXR0ZXJucyA9IHZhbGlkUGF0dGVybnM7XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSBudW1lcmljIGZpZWxkcyB3aXRoIGJvdW5kc1xyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MubG9jYWxNb2RlbFJlZnJlc2hJbnRlcnZhbCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHNldHRpbmdzLmxvY2FsTW9kZWxSZWZyZXNoSW50ZXJ2YWwpKSB7XHJcbiAgICB2YWxpZGF0ZWQubG9jYWxNb2RlbFJlZnJlc2hJbnRlcnZhbCA9IE1hdGgubWF4KDEsIE1hdGgubWluKDYwLCBzZXR0aW5ncy5sb2NhbE1vZGVsUmVmcmVzaEludGVydmFsKSk7XHJcbiAgfVxyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MubWF4VG9rZW5zID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oc2V0dGluZ3MubWF4VG9rZW5zKSkge1xyXG4gICAgdmFsaWRhdGVkLm1heFRva2VucyA9IE1hdGgubWF4KDEwMCwgTWF0aC5taW4oMjAwMCwgc2V0dGluZ3MubWF4VG9rZW5zKSk7XHJcbiAgfVxyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MudGVtcGVyYXR1cmUgPT09ICdudW1iZXInICYmICFpc05hTihzZXR0aW5ncy50ZW1wZXJhdHVyZSkpIHtcclxuICAgIHZhbGlkYXRlZC50ZW1wZXJhdHVyZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHNldHRpbmdzLnRlbXBlcmF0dXJlKSk7XHJcbiAgfVxyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3MudGltZW91dCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHNldHRpbmdzLnRpbWVvdXQpKSB7XHJcbiAgICB2YWxpZGF0ZWQudGltZW91dCA9IE1hdGgubWF4KDEwLCBNYXRoLm1pbigxMjAsIHNldHRpbmdzLnRpbWVvdXQpKTtcclxuICB9XHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5yZXRyaWVzID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oc2V0dGluZ3MucmV0cmllcykpIHtcclxuICAgIHZhbGlkYXRlZC5yZXRyaWVzID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oNSwgc2V0dGluZ3MucmV0cmllcykpO1xyXG4gIH1cclxuXHJcbiAgLy8gVmFsaWRhdGUgZGVidWcgc2V0dGluZ3NcclxuICBpZiAodHlwZW9mIHNldHRpbmdzLmRlYnVnTW9kZSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICB2YWxpZGF0ZWQuZGVidWdNb2RlID0gc2V0dGluZ3MuZGVidWdNb2RlO1xyXG4gICAgZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb25TdWNjZXNzKCdzZXR0aW5ncycsICdkZWJ1Z01vZGUnLCBjb3JyZWxhdGlvbklkKTtcclxuICB9XHJcbiAgaWYgKHR5cGVvZiBzZXR0aW5ncy5kZWJ1Z01heEVudHJpZXMgPT09ICdudW1iZXInICYmICFpc05hTihzZXR0aW5ncy5kZWJ1Z01heEVudHJpZXMpKSB7XHJcbiAgICBjb25zdCBvcmlnaW5hbFZhbHVlID0gc2V0dGluZ3MuZGVidWdNYXhFbnRyaWVzO1xyXG4gICAgdmFsaWRhdGVkLmRlYnVnTWF4RW50cmllcyA9IE1hdGgubWF4KDEwMCwgTWF0aC5taW4oMTAwMDAsIHNldHRpbmdzLmRlYnVnTWF4RW50cmllcykpO1xyXG4gICAgaWYgKG9yaWdpbmFsVmFsdWUgIT09IHZhbGlkYXRlZC5kZWJ1Z01heEVudHJpZXMpIHtcclxuICAgICAgZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb24oJ3NldHRpbmdzJywgJ2RlYnVnTWF4RW50cmllcycsIG9yaWdpbmFsVmFsdWUsICcxMDAtMTAwMDAnLCBgVmFsdWUgY2xhbXBlZCBmcm9tICR7b3JpZ2luYWxWYWx1ZX0gdG8gJHt2YWxpZGF0ZWQuZGVidWdNYXhFbnRyaWVzfWAsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb25TdWNjZXNzKCdzZXR0aW5ncycsICdkZWJ1Z01heEVudHJpZXMnLCBjb3JyZWxhdGlvbklkKTtcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKHNldHRpbmdzLmRlYnVnTWF4RW50cmllcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICBkZWJ1Z0xvZ2dlcj8ubG9nVmFsaWRhdGlvbignc2V0dGluZ3MnLCAnZGVidWdNYXhFbnRyaWVzJywgc2V0dGluZ3MuZGVidWdNYXhFbnRyaWVzLCAnbnVtYmVyIGJldHdlZW4gMTAwLTEwMDAwJywgJ0ludmFsaWQgZGVidWcgbWF4IGVudHJpZXMgdmFsdWUnLCBjb3JyZWxhdGlvbklkKTtcclxuICB9XHJcblxyXG4gIC8vIExvZyBvdmVyYWxsIHZhbGlkYXRpb24gc3VtbWFyeVxyXG4gIGRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAndmFsaWRhdGlvbicsICdTZXR0aW5ncyB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHtcclxuICAgIHZhbGlkYXRlZEZpZWxkQ291bnQ6IE9iamVjdC5rZXlzKHNldHRpbmdzKS5sZW5ndGgsXHJcbiAgICBjb3JyZWxhdGlvbklkXHJcbiAgfSwgY29ycmVsYXRpb25JZCk7XHJcblxyXG4gIHJldHVybiB2YWxpZGF0ZWQ7XHJcbn0iLCAiLypcclxuICogTExNIFByb3ZpZGVyIGltcGxlbWVudGF0aW9ucyBhbmQgc2VydmljZSBkZXRlY3Rpb25cclxuICovXHJcblxyXG5pbXBvcnQgeyByZXF1ZXN0VXJsIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBFeHRyYWN0b3JTZXR0aW5ncywgTExNU2VydmljZSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBEZWJ1Z0xvZ2dlciB9IGZyb20gJy4vZGVidWctbG9nZ2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBMTE1Qcm92aWRlck1hbmFnZXIge1xyXG4gIHByaXZhdGUgc2VydmljZUNhY2hlOiBNYXA8c3RyaW5nLCBMTE1TZXJ2aWNlPiA9IG5ldyBNYXAoKTtcclxuICBwcml2YXRlIGNsb3VkTW9kZWxDYWNoZTogTWFwPHN0cmluZywgc3RyaW5nW10+ID0gbmV3IE1hcCgpO1xyXG4gIHByaXZhdGUgYXBpS2V5TWlzc2luZ05vdGlmaWVkOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXR0aW5nczogRXh0cmFjdG9yU2V0dGluZ3MsIHByaXZhdGUgZGVidWdMb2dnZXI/OiBEZWJ1Z0xvZ2dlcikge31cclxuXHJcbiAgLy8gR2V0IHNlcnZpY2Ugd2l0aCAzMC1taW51dGUgY2FjaGUgVFRMXHJcbiAgYXN5bmMgZ2V0U2VydmljZShwcm92aWRlcjogc3RyaW5nKTogUHJvbWlzZTxMTE1TZXJ2aWNlIHwgbnVsbD4ge1xyXG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5zZXJ2aWNlQ2FjaGUuZ2V0KHByb3ZpZGVyKTtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBjb25zdCBjYWNoZVZhbGlkTXMgPSAzMCAqIDYwICogMTAwMDsgLy8gMzAgbWludXRlc1xyXG4gICAgXHJcbiAgICBpZiAoY2FjaGVkICYmIChub3cgLSBjYWNoZWQubGFzdENoZWNrZWQpIDwgY2FjaGVWYWxpZE1zKSB7XHJcbiAgICAgIHJldHVybiBjYWNoZWQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmRldGVjdFNpbmdsZVNlcnZpY2UocHJvdmlkZXIpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0IGEgc2luZ2xlIHNlcnZpY2UgaW5zdGVhZCBvZiBhbGwgc2VydmljZXNcclxuICBwcml2YXRlIGFzeW5jIGRldGVjdFNpbmdsZVNlcnZpY2UocHJvdmlkZXI6IHN0cmluZyk6IFByb21pc2U8TExNU2VydmljZSB8IG51bGw+IHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gdGhpcy5kZWJ1Z0xvZ2dlcj8uc3RhcnRPcGVyYXRpb24oJ3NlcnZpY2UtZGV0ZWN0aW9uJywgYERldGVjdGluZyBzZXJ2aWNlOiAke3Byb3ZpZGVyfWAsIHtcclxuICAgICAgcHJvdmlkZXIsXHJcbiAgICAgIHRpbWVzdGFtcDogbm93XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaWYgKHByb3ZpZGVyID09PSAnb2xsYW1hJykge1xyXG4gICAgICBjb25zdCBzZXJ2aWNlOiBMTE1TZXJ2aWNlID0ge1xyXG4gICAgICAgIG5hbWU6ICdvbGxhbWEnLFxyXG4gICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwsXHJcbiAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgICBtb2RlbHM6IFtdLFxyXG4gICAgICAgIGxhc3RDaGVja2VkOiBub3dcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsICdDaGVja2luZyBPbGxhbWEgYXZhaWxhYmlsaXR5Jywge1xyXG4gICAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsLFxyXG4gICAgICAgIGVuZHBvaW50OiBgJHt0aGlzLnNldHRpbmdzLm9sbGFtYVVybH0vYXBpL3RhZ3NgXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIGNvbnN0IHJhd1Jlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7XHJcbiAgICAgICAgICB1cmw6IGAke3RoaXMuc2V0dGluZ3Mub2xsYW1hVXJsfS9hcGkvdGFnc2AsXHJcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB0aGlzLmFkYXB0UmVxdWVzdFVybFJlc3BvbnNlKHJhd1Jlc3BvbnNlKTtcclxuICAgICAgICBjb25zdCBjb25uZWN0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgc2VydmljZS5hdmFpbGFibGUgPSB0cnVlO1xyXG4gICAgICAgICAgc2VydmljZS5tb2RlbHMgPSBkYXRhLm1vZGVscz8ubWFwKChtOiBhbnkpID0+IG0ubmFtZSkgfHwgW107XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsICdPbGxhbWEgc2VydmljZSBkZXRlY3RlZCBzdWNjZXNzZnVsbHknLCB7XHJcbiAgICAgICAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgICAgICAgdXJsOiB0aGlzLnNldHRpbmdzLm9sbGFtYVVybCxcclxuICAgICAgICAgICAgYXZhaWxhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBtb2RlbENvdW50OiBzZXJ2aWNlLm1vZGVscy5sZW5ndGgsXHJcbiAgICAgICAgICAgIG1vZGVsczogc2VydmljZS5tb2RlbHMsXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb25UaW1lLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1c1xyXG4gICAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnd2FybicsICdzZXJ2aWNlLWRldGVjdGlvbicsIGBPbGxhbWEgc2VydmljZSByZXNwb25kZWQgd2l0aCBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCwge1xyXG4gICAgICAgICAgICBwcm92aWRlcjogJ29sbGFtYScsXHJcbiAgICAgICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwsXHJcbiAgICAgICAgICAgIGF2YWlsYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgICAgICBjb25uZWN0aW9uVGltZVxyXG4gICAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdPbGxhbWEgbm90IGF2YWlsYWJsZTonLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ3dhcm4nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnT2xsYW1hIHNlcnZpY2Ugbm90IGF2YWlsYWJsZScsIHtcclxuICAgICAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwsXHJcbiAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgICBlcnJvclR5cGU6IGVycm9yLm5hbWVcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhpcy5zZXJ2aWNlQ2FjaGUuc2V0KCdvbGxhbWEnLCBzZXJ2aWNlKTtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ3NlcnZpY2UtZGV0ZWN0aW9uJywgJ09sbGFtYSBzZXJ2aWNlIGNhY2hlIHVwZGF0ZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdvbGxhbWEnLFxyXG4gICAgICAgIGF2YWlsYWJsZTogc2VydmljZS5hdmFpbGFibGUsXHJcbiAgICAgICAgbW9kZWxDb3VudDogc2VydmljZS5tb2RlbHMubGVuZ3RoLFxyXG4gICAgICAgIGxhc3RDaGVja2VkOiBzZXJ2aWNlLmxhc3RDaGVja2VkXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKHByb3ZpZGVyID09PSAnbG1zdHVkaW8nKSB7XHJcbiAgICAgIGNvbnN0IHNlcnZpY2U6IExMTVNlcnZpY2UgPSB7XHJcbiAgICAgICAgbmFtZTogJ2xtc3R1ZGlvJyxcclxuICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwsXHJcbiAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgICBtb2RlbHM6IFtdLFxyXG4gICAgICAgIGxhc3RDaGVja2VkOiBub3dcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsICdDaGVja2luZyBMTSBTdHVkaW8gYXZhaWxhYmlsaXR5Jywge1xyXG4gICAgICAgIHByb3ZpZGVyOiAnbG1zdHVkaW8nLFxyXG4gICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5sbXN0dWRpb1VybCxcclxuICAgICAgICBlbmRwb2ludDogYCR7dGhpcy5zZXR0aW5ncy5sbXN0dWRpb1VybH0vdjEvbW9kZWxzYFxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBjb25zdCByYXdSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3RVcmwoe1xyXG4gICAgICAgICAgdXJsOiBgJHt0aGlzLnNldHRpbmdzLmxtc3R1ZGlvVXJsfS92MS9tb2RlbHNgLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdGhpcy5hZGFwdFJlcXVlc3RVcmxSZXNwb25zZShyYXdSZXNwb25zZSk7XHJcbiAgICAgICAgY29uc3QgY29ubmVjdGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgIHNlcnZpY2UuYXZhaWxhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgIHNlcnZpY2UubW9kZWxzID0gZGF0YS5kYXRhPy5tYXAoKG06IGFueSkgPT4gbS5pZCkgfHwgW107XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsICdMTSBTdHVkaW8gc2VydmljZSBkZXRlY3RlZCBzdWNjZXNzZnVsbHknLCB7XHJcbiAgICAgICAgICAgIHByb3ZpZGVyOiAnbG1zdHVkaW8nLFxyXG4gICAgICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwsXHJcbiAgICAgICAgICAgIGF2YWlsYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgbW9kZWxDb3VudDogc2VydmljZS5tb2RlbHMubGVuZ3RoLFxyXG4gICAgICAgICAgICBtb2RlbHM6IHNlcnZpY2UubW9kZWxzLFxyXG4gICAgICAgICAgICBjb25uZWN0aW9uVGltZSxcclxuICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXNcclxuICAgICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ3dhcm4nLCAnc2VydmljZS1kZXRlY3Rpb24nLCBgTE0gU3R1ZGlvIHNlcnZpY2UgcmVzcG9uZGVkIHdpdGggZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWAsIHtcclxuICAgICAgICAgICAgcHJvdmlkZXI6ICdsbXN0dWRpbycsXHJcbiAgICAgICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5sbXN0dWRpb1VybCxcclxuICAgICAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb25UaW1lXHJcbiAgICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0xNIFN0dWRpbyBub3QgYXZhaWxhYmxlOicsIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnd2FybicsICdzZXJ2aWNlLWRldGVjdGlvbicsICdMTSBTdHVkaW8gc2VydmljZSBub3QgYXZhaWxhYmxlJywge1xyXG4gICAgICAgICAgcHJvdmlkZXI6ICdsbXN0dWRpbycsXHJcbiAgICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwsXHJcbiAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgICBlcnJvclR5cGU6IGVycm9yLm5hbWVcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhpcy5zZXJ2aWNlQ2FjaGUuc2V0KCdsbXN0dWRpbycsIHNlcnZpY2UpO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnTE0gU3R1ZGlvIHNlcnZpY2UgY2FjaGUgdXBkYXRlZCcsIHtcclxuICAgICAgICBwcm92aWRlcjogJ2xtc3R1ZGlvJyxcclxuICAgICAgICBhdmFpbGFibGU6IHNlcnZpY2UuYXZhaWxhYmxlLFxyXG4gICAgICAgIG1vZGVsQ291bnQ6IHNlcnZpY2UubW9kZWxzLmxlbmd0aCxcclxuICAgICAgICBsYXN0Q2hlY2tlZDogc2VydmljZS5sYXN0Q2hlY2tlZFxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnd2FybicsICdzZXJ2aWNlLWRldGVjdGlvbicsIGBVbmtub3duIHByb3ZpZGVyIHJlcXVlc3RlZDogJHtwcm92aWRlcn1gLCB7XHJcbiAgICAgIHByb3ZpZGVyLFxyXG4gICAgICBzdXBwb3J0ZWRQcm92aWRlcnM6IFsnb2xsYW1hJywgJ2xtc3R1ZGlvJ11cclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBMZWdhY3kgbWV0aG9kIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XHJcbiAgYXN5bmMgZGV0ZWN0U2VydmljZXMoKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBMTE1TZXJ2aWNlPj4ge1xyXG4gICAgYXdhaXQgdGhpcy5nZXRTZXJ2aWNlKCdvbGxhbWEnKTtcclxuICAgIGF3YWl0IHRoaXMuZ2V0U2VydmljZSgnbG1zdHVkaW8nKTtcclxuICAgIHJldHVybiB0aGlzLnNlcnZpY2VDYWNoZTtcclxuICB9XHJcblxyXG4gIGdldEF2YWlsYWJsZVNlcnZpY2VzKCk6IExMTVNlcnZpY2VbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnNlcnZpY2VDYWNoZS52YWx1ZXMoKSkuZmlsdGVyKHMgPT4gcy5hdmFpbGFibGUpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHJvdmlkZXItYWdub3N0aWMgTExNIGNhbGwgd2l0aCBmYWxsYmFjayBzdXBwb3J0XHJcbiAgYXN5bmMgY2FsbExMTShzeXN0ZW1Qcm9tcHQ6IHN0cmluZywgdXNlclByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuc2V0dGluZ3MucHJvdmlkZXI7XHJcbiAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gdGhpcy5kZWJ1Z0xvZ2dlcj8uc3RhcnRPcGVyYXRpb24oJ2xsbS1jYWxsJywgYFN0YXJ0aW5nIExMTSBjYWxsIHdpdGggcHJvdmlkZXI6ICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICBwcm92aWRlcixcclxuICAgICAgbW9kZWw6IHRoaXMuc2V0dGluZ3MubW9kZWxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBDaGVjayBpZiBBUEkga2V5IGlzIHJlcXVpcmVkIGZvciBjbG91ZCBwcm92aWRlcnMgKG9ubHkgbm90aWZ5IG9uY2UgcGVyIHByb3ZpZGVyKVxyXG4gICAgaWYgKFsnb3BlbmFpJywgJ2FudGhyb3BpYyddLmluY2x1ZGVzKHByb3ZpZGVyKSAmJiAoIXRoaXMuc2V0dGluZ3MuYXBpS2V5IHx8IHRoaXMuc2V0dGluZ3MuYXBpS2V5LnRyaW0oKS5sZW5ndGggPT09IDApKSB7XHJcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbktleSA9IGAke3Byb3ZpZGVyfS1uby1hcGkta2V5YDtcclxuICAgICAgaWYgKCF0aGlzLmFwaUtleU1pc3NpbmdOb3RpZmllZC5oYXMobm90aWZpY2F0aW9uS2V5KSkge1xyXG4gICAgICAgIC8vIE5vdGU6IE5vdGljZSB3b3VsZCBuZWVkIHRvIGJlIHBhc3NlZCBpbiBvciBoYW5kbGVkIGJ5IGNhbGxlclxyXG4gICAgICAgIGNvbnNvbGUud2FybihgVGFzayBFeHRyYWN0b3I6ICR7cHJvdmlkZXIudG9VcHBlckNhc2UoKX0gQVBJIGtleSBub3QgY29uZmlndXJlZCBpbiBwbHVnaW4gc2V0dGluZ3NgKTtcclxuICAgICAgICB0aGlzLmFwaUtleU1pc3NpbmdOb3RpZmllZC5hZGQobm90aWZpY2F0aW9uS2V5KTtcclxuICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgYEFQSSBrZXkgbWlzc2luZyBmb3IgJHtwcm92aWRlcn1gLCB7XHJcbiAgICAgICAgICBwcm92aWRlcixcclxuICAgICAgICAgIG5vdGlmaWNhdGlvbktleVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDbGVhciBub3RpZmljYXRpb24gZmxhZyBpZiBBUEkga2V5IGlzIHByZXNlbnRcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLmFwaUtleSAmJiB0aGlzLnNldHRpbmdzLmFwaUtleS50cmltKCkubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmFwaUtleU1pc3NpbmdOb3RpZmllZC5kZWxldGUoYCR7cHJvdmlkZXJ9LW5vLWFwaS1rZXlgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgY29uZmlndXJhdGlvbiBiZWZvcmUgbWFraW5nIHJlcXVlc3RzXHJcbiAgICBjb25zdCBjb25maWdWYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZVByb3ZpZGVyQ29uZmlnKHByb3ZpZGVyKTtcclxuICAgIGlmICghY29uZmlnVmFsaWRhdGlvbi52YWxpZCkge1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgYENvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiBmYWlsZWQgZm9yICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICAgIHByb3ZpZGVyLFxyXG4gICAgICAgIGVycm9yczogY29uZmlnVmFsaWRhdGlvbi5lcnJvcnNcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFRhc2sgRXh0cmFjdG9yOiAke3Byb3ZpZGVyfSBjb25maWd1cmF0aW9uIGVycm9yczpgLCBjb25maWdWYWxpZGF0aW9uLmVycm9ycy5qb2luKCcsICcpKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFRyeSBwcmltYXJ5IHByb3ZpZGVyIHdpdGggcmV0cmllc1xyXG4gICAgZm9yIChsZXQgYXR0ZW1wdCA9IDA7IGF0dGVtcHQgPCB0aGlzLnNldHRpbmdzLnJldHJpZXM7IGF0dGVtcHQrKykge1xyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCBgQXR0ZW1wdCAke2F0dGVtcHQgKyAxfS8ke3RoaXMuc2V0dGluZ3MucmV0cmllc30gZm9yICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICAgIHByb3ZpZGVyLFxyXG4gICAgICAgIG1vZGVsOiB0aGlzLnNldHRpbmdzLm1vZGVsLFxyXG4gICAgICAgIHJldHJ5QXR0ZW1wdDogYXR0ZW1wdCArIDFcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGxldCByZXN1bHQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHN3aXRjaCAocHJvdmlkZXIpIHtcclxuICAgICAgICAgIGNhc2UgJ29wZW5haSc6XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE9wZW5BSShzeXN0ZW1Qcm9tcHQsIHVzZXJQcm9tcHQsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ2FudGhyb3BpYyc6XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbEFudGhyb3BpYyhzeXN0ZW1Qcm9tcHQsIHVzZXJQcm9tcHQsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ29sbGFtYSc6XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE9sbGFtYShzeXN0ZW1Qcm9tcHQsIHVzZXJQcm9tcHQsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ2xtc3R1ZGlvJzpcclxuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5jYWxsTE1TdHVkaW8oc3lzdGVtUHJvbXB0LCB1c2VyUHJvbXB0LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHByb3ZpZGVyOiAke3Byb3ZpZGVyfWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCBgTExNIGNhbGwgc3VjY2Vzc2Z1bCBvbiBhdHRlbXB0ICR7YXR0ZW1wdCArIDF9YCwge1xyXG4gICAgICAgICAgICBwcm92aWRlcixcclxuICAgICAgICAgICAgbW9kZWw6IHRoaXMuc2V0dGluZ3MubW9kZWwsXHJcbiAgICAgICAgICAgIHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICAgICAgICByZXRyeUF0dGVtcHQ6IGF0dGVtcHQgKyAxLFxyXG4gICAgICAgICAgICByZXNwb25zZUxlbmd0aDogcmVzdWx0Lmxlbmd0aFxyXG4gICAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBBdHRlbXB0ICR7YXR0ZW1wdCArIDF9IGZhaWxlZCBmb3IgJHtwcm92aWRlcn06YCwgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCd3YXJuJywgJ2xsbS1jYWxsJywgYEF0dGVtcHQgJHthdHRlbXB0ICsgMX0gZmFpbGVkIGZvciAke3Byb3ZpZGVyfWAsIHtcclxuICAgICAgICAgIHByb3ZpZGVyLFxyXG4gICAgICAgICAgbW9kZWw6IHRoaXMuc2V0dGluZ3MubW9kZWwsXHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICAgICAgcmV0cnlBdHRlbXB0OiBhdHRlbXB0ICsgMVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChhdHRlbXB0ID09PSB0aGlzLnNldHRpbmdzLnJldHJpZXMgLSAxKSB7XHJcbiAgICAgICAgICAvLyBMYXN0IGF0dGVtcHQgZmFpbGVkLCB0cnkgZmFsbGJhY2sgZm9yIGxvY2FsIHByb3ZpZGVyc1xyXG4gICAgICAgICAgaWYgKFsnb2xsYW1hJywgJ2xtc3R1ZGlvJ10uaW5jbHVkZXMocHJvdmlkZXIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdsbG0tY2FsbCcsIGBBbGwgYXR0ZW1wdHMgZmFpbGVkLCB0cnlpbmcgbG9jYWwgZmFsbGJhY2tgLCB7XHJcbiAgICAgICAgICAgICAgcHJvdmlkZXIsXHJcbiAgICAgICAgICAgICAgdG90YWxBdHRlbXB0czogdGhpcy5zZXR0aW5ncy5yZXRyaWVzXHJcbiAgICAgICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy50cnlMb2NhbEZhbGxiYWNrKHN5c3RlbVByb21wdCwgdXNlclByb21wdCwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFdhaXQgYmVmb3JlIHJldHJ5IHdpdGggbGluZWFyIGJhY2tvZmZcclxuICAgICAgICAgIGNvbnN0IGJhY2tvZmZEZWxheSA9IDEwMDAgKiAoYXR0ZW1wdCArIDEpO1xyXG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgYFdhaXRpbmcgJHtiYWNrb2ZmRGVsYXl9bXMgYmVmb3JlIHJldHJ5YCwge1xyXG4gICAgICAgICAgICBwcm92aWRlcixcclxuICAgICAgICAgICAgYmFja29mZkRlbGF5LFxyXG4gICAgICAgICAgICBuZXh0QXR0ZW1wdDogYXR0ZW1wdCArIDJcclxuICAgICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5kZWxheShiYWNrb2ZmRGVsYXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgdHJ5TG9jYWxGYWxsYmFjayhzeXN0ZW1Qcm9tcHQ6IHN0cmluZywgdXNlclByb21wdDogc3RyaW5nLCBjb3JyZWxhdGlvbklkPzogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICBjb25zdCBhdmFpbGFibGVTZXJ2aWNlcyA9IHRoaXMuZ2V0QXZhaWxhYmxlU2VydmljZXMoKTtcclxuICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdsbG0tY2FsbCcsIGBUcnlpbmcgbG9jYWwgZmFsbGJhY2sgd2l0aCAke2F2YWlsYWJsZVNlcnZpY2VzLmxlbmd0aH0gYXZhaWxhYmxlIHNlcnZpY2VzYCwge1xyXG4gICAgICBhdmFpbGFibGVTZXJ2aWNlczogYXZhaWxhYmxlU2VydmljZXMubWFwKHMgPT4gcy5uYW1lKSxcclxuICAgICAgcHJpbWFyeVByb3ZpZGVyOiB0aGlzLnNldHRpbmdzLnByb3ZpZGVyXHJcbiAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBzZXJ2aWNlIG9mIGF2YWlsYWJsZVNlcnZpY2VzKSB7XHJcbiAgICAgIGlmIChzZXJ2aWNlLm5hbWUgPT09IHRoaXMuc2V0dGluZ3MucHJvdmlkZXIpIGNvbnRpbnVlOyAvLyBTa2lwIHByaW1hcnkgdGhhdCBhbHJlYWR5IGZhaWxlZFxyXG4gICAgICBcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgVHJ5aW5nIGZhbGxiYWNrIHRvICR7c2VydmljZS5uYW1lfWApO1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdsbG0tY2FsbCcsIGBBdHRlbXB0aW5nIGZhbGxiYWNrIHRvICR7c2VydmljZS5uYW1lfWAsIHtcclxuICAgICAgICAgIGZhbGxiYWNrUHJvdmlkZXI6IHNlcnZpY2UubmFtZSxcclxuICAgICAgICAgIGF2YWlsYWJsZU1vZGVsczogc2VydmljZS5tb2RlbHNcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoc2VydmljZS5uYW1lID09PSAnb2xsYW1hJykge1xyXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FsbE9sbGFtYShzeXN0ZW1Qcm9tcHQsIHVzZXJQcm9tcHQsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc2VydmljZS5uYW1lID09PSAnbG1zdHVkaW8nKSB7XHJcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jYWxsTE1TdHVkaW8oc3lzdGVtUHJvbXB0LCB1c2VyUHJvbXB0LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWxsYmFjayB0byAke3NlcnZpY2UubmFtZX0gZmFpbGVkOmAsIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnd2FybicsICdsbG0tY2FsbCcsIGBGYWxsYmFjayB0byAke3NlcnZpY2UubmFtZX0gZmFpbGVkYCwge1xyXG4gICAgICAgICAgZmFsbGJhY2tQcm92aWRlcjogc2VydmljZS5uYW1lLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLndhcm4oJ1Rhc2sgRXh0cmFjdG9yOiBBbGwgTExNIHNlcnZpY2VzIGZhaWxlZC4gQ2hlY2sgeW91ciBjb25maWd1cmF0aW9uLicpO1xyXG4gICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdlcnJvcicsICdsbG0tY2FsbCcsICdBbGwgTExNIHNlcnZpY2VzIGZhaWxlZCBpbmNsdWRpbmcgZmFsbGJhY2tzJywge1xyXG4gICAgICBwcmltYXJ5UHJvdmlkZXI6IHRoaXMuc2V0dGluZ3MucHJvdmlkZXIsXHJcbiAgICAgIGF2YWlsYWJsZVNlcnZpY2VzOiBhdmFpbGFibGVTZXJ2aWNlcy5tYXAocyA9PiBzLm5hbWUpXHJcbiAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBjYWxsT3BlbkFJKHN5c3RlbVByb21wdDogc3RyaW5nLCB1c2VyUHJvbXB0OiBzdHJpbmcsIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICAgIGNvbnN0IGVuZHBvaW50ID0gJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucyc7XHJcbiAgICBjb25zdCBtb2RlbCA9IHRoaXMuc2V0dGluZ3MubW9kZWwgfHwgJ2dwdC00by1taW5pJztcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIG1vZGVsLFxyXG4gICAgICBtZXNzYWdlczogW1xyXG4gICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxyXG4gICAgICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyUHJvbXB0IH1cclxuICAgICAgXSxcclxuICAgICAgdGVtcGVyYXR1cmU6IHRoaXMuc2V0dGluZ3MudGVtcGVyYXR1cmUsXHJcbiAgICAgIG1heF90b2tlbnM6IHRoaXMuc2V0dGluZ3MubWF4VG9rZW5zXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvZyByZXF1ZXN0IHdpdGggbWFza2VkIEFQSSBrZXlcclxuICAgIGNvbnN0IG1hc2tlZEFwaUtleSA9IHRoaXMuc2V0dGluZ3MuYXBpS2V5ID8gYC4uLiR7dGhpcy5zZXR0aW5ncy5hcGlLZXkuc2xpY2UoLTQpfWAgOiAnbm9uZSc7XHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCAnU2VuZGluZyBPcGVuQUkgQVBJIHJlcXVlc3QnLCB7XHJcbiAgICAgIHByb3ZpZGVyOiAnb3BlbmFpJyxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGVuZHBvaW50LFxyXG4gICAgICBhcGlLZXk6IG1hc2tlZEFwaUtleSxcclxuICAgICAgcmVxdWVzdFBheWxvYWQ6IHtcclxuICAgICAgICAuLi5ib2R5LFxyXG4gICAgICAgIG1lc3NhZ2VzOiBib2R5Lm1lc3NhZ2VzLm1hcChtID0+ICh7IHJvbGU6IG0ucm9sZSwgY29udGVudExlbmd0aDogbS5jb250ZW50Lmxlbmd0aCB9KSlcclxuICAgICAgfVxyXG4gICAgfSwgY29ycmVsYXRpb25JZCk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgY29uc3QgcmF3UmVzcCA9IGF3YWl0IHJlcXVlc3RVcmwoe1xyXG4gICAgICAgIHVybDogZW5kcG9pbnQsXHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5zZXR0aW5ncy5hcGlLZXl9YCxcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCByZXNwID0gdGhpcy5hZGFwdFJlcXVlc3RVcmxSZXNwb25zZShyYXdSZXNwKTtcclxuICAgICAgY29uc3QgcHJvY2Vzc2luZ1RpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFyZXNwLm9rKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3AudGV4dCgpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ09wZW5BSSBlcnJvcicsIHJlc3Auc3RhdHVzLCB0ZXh0KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBQcm92aWRlIHNwZWNpZmljIGVycm9yIG1lc3NhZ2VzIGJhc2VkIG9uIHN0YXR1cyBjb2RlcyAgXHJcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IGBPcGVuQUkgQVBJIGVycm9yOiAke3Jlc3Auc3RhdHVzfSAke3Jlc3Auc3RhdHVzVGV4dH1gO1xyXG4gICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gJy4gQ2hlY2sgdGhhdCB5b3VyIE9wZW5BSSBBUEkga2V5IGlzIHZhbGlkIGFuZCBwcm9wZXJseSBjb25maWd1cmVkLic7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwLnN0YXR1cyA9PT0gNDAwKSB7XHJcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gJy4gUmVxdWVzdCBmb3JtYXQgbWF5IGJlIGludmFsaWQgLSBjaGVjayBtb2RlbCBuYW1lIGFuZCByZXF1ZXN0IHBhcmFtZXRlcnMuJztcclxuICAgICAgICB9IGVsc2UgaWYgKHJlc3Auc3RhdHVzID09PSA0MjkpIHtcclxuICAgICAgICAgIGVycm9yTWVzc2FnZSArPSAnLiBSYXRlIGxpbWl0IGV4Y2VlZGVkIC0gcGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVzcC5zdGF0dXMgPT09IDQwMykge1xyXG4gICAgICAgICAgZXJyb3JNZXNzYWdlICs9ICcuIEFjY2VzcyBkZW5pZWQgLSBjaGVjayBBUEkga2V5IHBlcm1pc3Npb25zLic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCBgT3BlbkFJIEFQSSBlcnJvcjogJHtyZXNwLnN0YXR1c31gLCB7XHJcbiAgICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXHJcbiAgICAgICAgICBtb2RlbCxcclxuICAgICAgICAgIGVuZHBvaW50LFxyXG4gICAgICAgICAgc3RhdHVzOiByZXNwLnN0YXR1cyxcclxuICAgICAgICAgIHN0YXR1c1RleHQ6IHJlc3Auc3RhdHVzVGV4dCxcclxuICAgICAgICAgIGVycm9yOiB0ZXh0LFxyXG4gICAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgICByZXF1ZXN0Qm9keToge1xyXG4gICAgICAgICAgICBtb2RlbCxcclxuICAgICAgICAgICAgdGVtcGVyYXR1cmU6IHRoaXMuc2V0dGluZ3MudGVtcGVyYXR1cmUsXHJcbiAgICAgICAgICAgIG1heF90b2tlbnM6IHRoaXMuc2V0dGluZ3MubWF4VG9rZW5zXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwLmpzb24oKTtcclxuICAgICAgY29uc3QgY29udGVudCA9IGpzb24/LmNob2ljZXM/LlswXT8ubWVzc2FnZT8uY29udGVudCB8fCBudWxsO1xyXG4gICAgICBjb25zdCB0b2tlblVzYWdlID0ganNvbj8udXNhZ2U/LnRvdGFsX3Rva2VucyB8fCAwO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ09wZW5BSSBBUEkgcmVzcG9uc2UgcmVjZWl2ZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdvcGVuYWknLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsXHJcbiAgICAgICAgdG9rZW5Vc2FnZSxcclxuICAgICAgICByZXNwb25zZUxlbmd0aDogY29udGVudD8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgcmVzcG9uc2VEYXRhOiB7XHJcbiAgICAgICAgICBjaG9pY2VzOiBqc29uPy5jaG9pY2VzPy5sZW5ndGggfHwgMCxcclxuICAgICAgICAgIHVzYWdlOiBqc29uPy51c2FnZVxyXG4gICAgICAgIH1cclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gY29udGVudDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignY2FsbE9wZW5BSSBlcnJvcicsIGUpO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgJ09wZW5BSSBBUEkgY2FsbCBmYWlsZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdvcGVuYWknLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIGVycm9yOiBlLm1lc3NhZ2VcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNhbGxBbnRocm9waWMoc3lzdGVtUHJvbXB0OiBzdHJpbmcsIHVzZXJQcm9tcHQ6IHN0cmluZywgY29ycmVsYXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gICAgLy8gVmFsaWRhdGUgYW5kIHNhbml0aXplIEFudGhyb3BpYyBVUkwgLSBlbnN1cmUgaXQncyB0aGUgY29ycmVjdCBlbmRwb2ludFxyXG4gICAgbGV0IGVuZHBvaW50ID0gdGhpcy5zZXR0aW5ncy5hbnRocm9waWNVcmwgfHwgJ2h0dHBzOi8vYXBpLmFudGhyb3BpYy5jb20vdjEvbWVzc2FnZXMnO1xyXG4gICAgXHJcbiAgICAvLyBGaXggY29tbW9uIGVuZHBvaW50IG1pc3Rha2VzXHJcbiAgICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoJ2FudGhyb3BpYy5jb20nKSAmJiAhZW5kcG9pbnQuaW5jbHVkZXMoJy92MS9tZXNzYWdlcycpKSB7XHJcbiAgICAgIGVuZHBvaW50ID0gJ2h0dHBzOi8vYXBpLmFudGhyb3BpYy5jb20vdjEvbWVzc2FnZXMnO1xyXG4gICAgICBjb25zb2xlLndhcm4oJ1Rhc2sgRXh0cmFjdG9yOiBGaXhlZCBpbnZhbGlkIEFudGhyb3BpYyBVUkwgdG8gdXNlIGNvcnJlY3QgL3YxL21lc3NhZ2VzIGVuZHBvaW50Jyk7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnd2FybicsICdsbG0tY2FsbCcsICdGaXhlZCBpbnZhbGlkIEFudGhyb3BpYyBVUkwnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdhbnRocm9waWMnLFxyXG4gICAgICAgIG9yaWdpbmFsVXJsOiB0aGlzLnNldHRpbmdzLmFudGhyb3BpY1VybCxcclxuICAgICAgICBmaXhlZFVybDogZW5kcG9pbnRcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IG1vZGVsID0gdGhpcy5zZXR0aW5ncy5tb2RlbCB8fCAnY2xhdWRlLTMtNS1oYWlrdS0yMDI0MTAyMic7XHJcbiAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIG1heF90b2tlbnM6IHRoaXMuc2V0dGluZ3MubWF4VG9rZW5zLFxyXG4gICAgICB0ZW1wZXJhdHVyZTogdGhpcy5zZXR0aW5ncy50ZW1wZXJhdHVyZSxcclxuICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQsXHJcbiAgICAgIG1lc3NhZ2VzOiBbe1xyXG4gICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICBjb250ZW50OiB1c2VyUHJvbXB0XHJcbiAgICAgIH1dXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExvZyByZXF1ZXN0IHdpdGggbWFza2VkIEFQSSBrZXlcclxuICAgIGNvbnN0IG1hc2tlZEFwaUtleSA9IHRoaXMuc2V0dGluZ3MuYXBpS2V5ID8gYC4uLiR7dGhpcy5zZXR0aW5ncy5hcGlLZXkuc2xpY2UoLTQpfWAgOiAnbm9uZSc7XHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCAnU2VuZGluZyBBbnRocm9waWMgQVBJIHJlcXVlc3QnLCB7XHJcbiAgICAgIHByb3ZpZGVyOiAnYW50aHJvcGljJyxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGVuZHBvaW50LFxyXG4gICAgICBhcGlLZXk6IG1hc2tlZEFwaUtleSxcclxuICAgICAgcmVxdWVzdFBheWxvYWQ6IHtcclxuICAgICAgICAuLi5yZXF1ZXN0Qm9keSxcclxuICAgICAgICBzeXN0ZW06IGAke3N5c3RlbVByb21wdC5sZW5ndGh9IGNoYXJzYCxcclxuICAgICAgICBtZXNzYWdlczogcmVxdWVzdEJvZHkubWVzc2FnZXMubWFwKG0gPT4gKHsgcm9sZTogbS5yb2xlLCBjb250ZW50TGVuZ3RoOiBtLmNvbnRlbnQubGVuZ3RoIH0pKVxyXG4gICAgICB9XHJcbiAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgY29uc3QgcmF3UmVzcCA9IGF3YWl0IHJlcXVlc3RVcmwoe1xyXG4gICAgICAgIHVybDogZW5kcG9pbnQsXHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ3gtYXBpLWtleSc6IHRoaXMuc2V0dGluZ3MuYXBpS2V5LFxyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICdhbnRocm9waWMtdmVyc2lvbic6ICcyMDIzLTA2LTAxJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCByZXNwID0gdGhpcy5hZGFwdFJlcXVlc3RVcmxSZXNwb25zZShyYXdSZXNwKTtcclxuICAgICAgY29uc3QgcHJvY2Vzc2luZ1RpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFyZXNwLm9rKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3AudGV4dCgpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FudGhyb3BpYyBlcnJvcicsIHJlc3Auc3RhdHVzLCB0ZXh0KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBQcm92aWRlIHNwZWNpZmljIGVycm9yIG1lc3NhZ2VzIGJhc2VkIG9uIHN0YXR1cyBjb2Rlc1xyXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBgQW50aHJvcGljIEFQSSBlcnJvcjogJHtyZXNwLnN0YXR1c30gJHtyZXNwLnN0YXR1c1RleHR9YDtcclxuICAgICAgICBpZiAocmVzcC5zdGF0dXMgPT09IDQwNCkge1xyXG4gICAgICAgICAgZXJyb3JNZXNzYWdlICs9ICcuIENoZWNrIHRoYXQgYW50aHJvcGljVXJsIHNldHRpbmcgdXNlcyB0aGUgY29ycmVjdCBlbmRwb2ludDogaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcyc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwLnN0YXR1cyA9PT0gNDAxIHx8IHJlc3Auc3RhdHVzID09PSA0MDMpIHtcclxuICAgICAgICAgIGVycm9yTWVzc2FnZSArPSAnLiBDaGVjayB0aGF0IHlvdXIgQW50aHJvcGljIEFQSSBrZXkgaXMgdmFsaWQgYW5kIGhhcyBwcm9wZXIgcGVybWlzc2lvbnMuJztcclxuICAgICAgICB9IGVsc2UgaWYgKHJlc3Auc3RhdHVzID09PSA0MDApIHtcclxuICAgICAgICAgIGVycm9yTWVzc2FnZSArPSAnLiBSZXF1ZXN0IGZvcm1hdCBtYXkgYmUgaW52YWxpZCAtIGNoZWNrIG1vZGVsIG5hbWUgYW5kIHJlcXVlc3QgcGFyYW1ldGVycy4nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgYEFudGhyb3BpYyBBUEkgZXJyb3I6ICR7cmVzcC5zdGF0dXN9YCwge1xyXG4gICAgICAgICAgcHJvdmlkZXI6ICdhbnRocm9waWMnLFxyXG4gICAgICAgICAgbW9kZWwsXHJcbiAgICAgICAgICBlbmRwb2ludCxcclxuICAgICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsXHJcbiAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwLnN0YXR1c1RleHQsXHJcbiAgICAgICAgICBlcnJvcjogdGV4dCxcclxuICAgICAgICAgIHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICAgICAgcmVxdWVzdEJvZHk6IHtcclxuICAgICAgICAgICAgbW9kZWwsXHJcbiAgICAgICAgICAgIG1heF90b2tlbnM6IHRoaXMuc2V0dGluZ3MubWF4VG9rZW5zLFxyXG4gICAgICAgICAgICB0ZW1wZXJhdHVyZTogdGhpcy5zZXR0aW5ncy50ZW1wZXJhdHVyZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcC5qc29uKCk7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBqc29uPy5jb250ZW50Py5bMF0/LnRleHQgfHwgbnVsbDtcclxuICAgICAgY29uc3QgdG9rZW5Vc2FnZSA9IGpzb24/LnVzYWdlPy5pbnB1dF90b2tlbnMgKyBqc29uPy51c2FnZT8ub3V0cHV0X3Rva2VucyB8fCAwO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ0FudGhyb3BpYyBBUEkgcmVzcG9uc2UgcmVjZWl2ZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdhbnRocm9waWMnLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsXHJcbiAgICAgICAgdG9rZW5Vc2FnZSxcclxuICAgICAgICByZXNwb25zZUxlbmd0aDogY29udGVudD8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgcmVzcG9uc2VEYXRhOiB7XHJcbiAgICAgICAgICBjb250ZW50QmxvY2tzOiBqc29uPy5jb250ZW50Py5sZW5ndGggfHwgMCxcclxuICAgICAgICAgIHVzYWdlOiBqc29uPy51c2FnZVxyXG4gICAgICAgIH1cclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gY29udGVudDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignY2FsbEFudGhyb3BpYyBlcnJvcicsIGUpO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgJ0FudGhyb3BpYyBBUEkgY2FsbCBmYWlsZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdhbnRocm9waWMnLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIGVycm9yOiBlLm1lc3NhZ2VcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNhbGxPbGxhbWEoc3lzdGVtUHJvbXB0OiBzdHJpbmcsIHVzZXJQcm9tcHQ6IHN0cmluZywgY29ycmVsYXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IHRoaXMuZ2V0U2VydmljZSgnb2xsYW1hJyk7XHJcbiAgICBpZiAoIXNlcnZpY2U/LmF2YWlsYWJsZSB8fCAhc2VydmljZS5tb2RlbHMubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCAnT2xsYW1hIHNlcnZpY2Ugbm90IGF2YWlsYWJsZSBvciBubyBtb2RlbHMgbG9hZGVkJywge1xyXG4gICAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgICBzZXJ2aWNlQXZhaWxhYmxlOiBzZXJ2aWNlPy5hdmFpbGFibGUgfHwgZmFsc2UsXHJcbiAgICAgICAgbW9kZWxDb3VudDogc2VydmljZT8ubW9kZWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09sbGFtYSBzZXJ2aWNlIG5vdCBhdmFpbGFibGUgb3Igbm8gbW9kZWxzIGxvYWRlZCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBVc2UgY29uZmlndXJlZCBtb2RlbCBvciBmaXJzdCBhdmFpbGFibGUgbW9kZWxcclxuICAgIGNvbnN0IG1vZGVsID0gc2VydmljZS5tb2RlbHMuaW5jbHVkZXModGhpcy5zZXR0aW5ncy5tb2RlbCkgXHJcbiAgICAgID8gdGhpcy5zZXR0aW5ncy5tb2RlbCBcclxuICAgICAgOiBzZXJ2aWNlLm1vZGVsc1swXTtcclxuICAgIFxyXG4gICAgY29uc3QgZW5kcG9pbnQgPSBgJHt0aGlzLnNldHRpbmdzLm9sbGFtYVVybH0vYXBpL2NoYXRgO1xyXG4gICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XHJcbiAgICAgIG1vZGVsOiBtb2RlbCxcclxuICAgICAgbWVzc2FnZXM6IFtcclxuICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSxcclxuICAgICAgICB7IHJvbGU6ICd1c2VyJywgY29udGVudDogdXNlclByb21wdCB9XHJcbiAgICAgIF0sXHJcbiAgICAgIHN0cmVhbTogZmFsc2UsXHJcbiAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICB0ZW1wZXJhdHVyZTogdGhpcy5zZXR0aW5ncy50ZW1wZXJhdHVyZSxcclxuICAgICAgICBudW1fcHJlZGljdDogdGhpcy5zZXR0aW5ncy5tYXhUb2tlbnNcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCAnU2VuZGluZyBPbGxhbWEgQVBJIHJlcXVlc3QnLCB7XHJcbiAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGVuZHBvaW50LFxyXG4gICAgICB1cmw6IHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsLFxyXG4gICAgICBhdmFpbGFibGVNb2RlbHM6IHNlcnZpY2UubW9kZWxzLFxyXG4gICAgICByZXF1ZXN0UGF5bG9hZDoge1xyXG4gICAgICAgIC4uLnJlcXVlc3RCb2R5LFxyXG4gICAgICAgIG1lc3NhZ2VzOiByZXF1ZXN0Qm9keS5tZXNzYWdlcy5tYXAobSA9PiAoeyByb2xlOiBtLnJvbGUsIGNvbnRlbnRMZW5ndGg6IG0uY29udGVudC5sZW5ndGggfSkpXHJcbiAgICAgIH1cclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICBjb25zdCByYXdSZXNwID0gYXdhaXQgcmVxdWVzdFVybCh7XHJcbiAgICAgICAgdXJsOiBlbmRwb2ludCxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHJlc3AgPSB0aGlzLmFkYXB0UmVxdWVzdFVybFJlc3BvbnNlKHJhd1Jlc3ApO1xyXG4gICAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXJlc3Aub2spIHtcclxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignT2xsYW1hIGVycm9yJywgcmVzcC5zdGF0dXMsIHRleHQpO1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCBgT2xsYW1hIEFQSSBlcnJvcjogJHtyZXNwLnN0YXR1c31gLCB7XHJcbiAgICAgICAgICBwcm92aWRlcjogJ29sbGFtYScsXHJcbiAgICAgICAgICBtb2RlbCxcclxuICAgICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsXHJcbiAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwLnN0YXR1c1RleHQsXHJcbiAgICAgICAgICBlcnJvcjogdGV4dCxcclxuICAgICAgICAgIHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICAgICAgdXJsOiB0aGlzLnNldHRpbmdzLm9sbGFtYVVybFxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgT2xsYW1hIEFQSSBlcnJvcjogJHtyZXNwLnN0YXR1c30gJHtyZXNwLnN0YXR1c1RleHR9YCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwLmpzb24oKTtcclxuICAgICAgY29uc3QgY29udGVudCA9IGpzb24/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgbnVsbDtcclxuICAgICAgXHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdsbG0tY2FsbCcsICdPbGxhbWEgQVBJIHJlc3BvbnNlIHJlY2VpdmVkJywge1xyXG4gICAgICAgIHByb3ZpZGVyOiAnb2xsYW1hJyxcclxuICAgICAgICBtb2RlbCxcclxuICAgICAgICBzdGF0dXM6IHJlc3Auc3RhdHVzLFxyXG4gICAgICAgIHJlc3BvbnNlTGVuZ3RoOiBjb250ZW50Py5sZW5ndGggfHwgMCxcclxuICAgICAgICBwcm9jZXNzaW5nVGltZSxcclxuICAgICAgICByZXNwb25zZURhdGE6IHtcclxuICAgICAgICAgIGhhc01lc3NhZ2U6ICEhanNvbj8ubWVzc2FnZSxcclxuICAgICAgICAgIG1lc3NhZ2VSb2xlOiBqc29uPy5tZXNzYWdlPy5yb2xlXHJcbiAgICAgICAgfVxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBjb250ZW50O1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdjYWxsT2xsYW1hIGVycm9yJywgZSk7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCAnT2xsYW1hIEFQSSBjYWxsIGZhaWxlZCcsIHtcclxuICAgICAgICBwcm92aWRlcjogJ29sbGFtYScsXHJcbiAgICAgICAgbW9kZWwsXHJcbiAgICAgICAgZXJyb3I6IGUubWVzc2FnZSxcclxuICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBjYWxsTE1TdHVkaW8oc3lzdGVtUHJvbXB0OiBzdHJpbmcsIHVzZXJQcm9tcHQ6IHN0cmluZywgY29ycmVsYXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IHRoaXMuZ2V0U2VydmljZSgnbG1zdHVkaW8nKTtcclxuICAgIGlmICghc2VydmljZT8uYXZhaWxhYmxlIHx8ICFzZXJ2aWNlLm1vZGVscy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdlcnJvcicsICdsbG0tY2FsbCcsICdMTSBTdHVkaW8gc2VydmljZSBub3QgYXZhaWxhYmxlIG9yIG5vIG1vZGVscyBsb2FkZWQnLCB7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdsbXN0dWRpbycsXHJcbiAgICAgICAgc2VydmljZUF2YWlsYWJsZTogc2VydmljZT8uYXZhaWxhYmxlIHx8IGZhbHNlLFxyXG4gICAgICAgIG1vZGVsQ291bnQ6IHNlcnZpY2U/Lm1vZGVscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgdXJsOiB0aGlzLnNldHRpbmdzLmxtc3R1ZGlvVXJsXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xNIFN0dWRpbyBzZXJ2aWNlIG5vdCBhdmFpbGFibGUgb3Igbm8gbW9kZWxzIGxvYWRlZCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBVc2UgY29uZmlndXJlZCBtb2RlbCBvciBmaXJzdCBhdmFpbGFibGUgbW9kZWxcclxuICAgIGNvbnN0IG1vZGVsID0gc2VydmljZS5tb2RlbHMuaW5jbHVkZXModGhpcy5zZXR0aW5ncy5tb2RlbCkgXHJcbiAgICAgID8gdGhpcy5zZXR0aW5ncy5tb2RlbCBcclxuICAgICAgOiBzZXJ2aWNlLm1vZGVsc1swXTtcclxuICAgIFxyXG4gICAgY29uc3QgZW5kcG9pbnQgPSBgJHt0aGlzLnNldHRpbmdzLmxtc3R1ZGlvVXJsfS92MS9jaGF0L2NvbXBsZXRpb25zYDtcclxuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xyXG4gICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgIG1lc3NhZ2VzOiBbXHJcbiAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXHJcbiAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXJQcm9tcHQgfVxyXG4gICAgICBdLFxyXG4gICAgICB0ZW1wZXJhdHVyZTogdGhpcy5zZXR0aW5ncy50ZW1wZXJhdHVyZSxcclxuICAgICAgbWF4X3Rva2VuczogdGhpcy5zZXR0aW5ncy5tYXhUb2tlbnNcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ1NlbmRpbmcgTE0gU3R1ZGlvIEFQSSByZXF1ZXN0Jywge1xyXG4gICAgICBwcm92aWRlcjogJ2xtc3R1ZGlvJyxcclxuICAgICAgbW9kZWwsXHJcbiAgICAgIGVuZHBvaW50LFxyXG4gICAgICB1cmw6IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwsXHJcbiAgICAgIGF2YWlsYWJsZU1vZGVsczogc2VydmljZS5tb2RlbHMsXHJcbiAgICAgIHJlcXVlc3RQYXlsb2FkOiB7XHJcbiAgICAgICAgLi4ucmVxdWVzdEJvZHksXHJcbiAgICAgICAgbWVzc2FnZXM6IHJlcXVlc3RCb2R5Lm1lc3NhZ2VzLm1hcChtID0+ICh7IHJvbGU6IG0ucm9sZSwgY29udGVudExlbmd0aDogbS5jb250ZW50Lmxlbmd0aCB9KSlcclxuICAgICAgfVxyXG4gICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICAgIGNvbnN0IHJhd1Jlc3AgPSBhd2FpdCByZXF1ZXN0VXJsKHtcclxuICAgICAgICB1cmw6IGVuZHBvaW50LFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciBsbS1zdHVkaW8nLCAvLyBQbGFjZWhvbGRlciBhdXRoXHJcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHJlc3AgPSB0aGlzLmFkYXB0UmVxdWVzdFVybFJlc3BvbnNlKHJhd1Jlc3ApO1xyXG4gICAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXJlc3Aub2spIHtcclxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignTE0gU3R1ZGlvIGVycm9yJywgcmVzcC5zdGF0dXMsIHRleHQpO1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCBgTE0gU3R1ZGlvIEFQSSBlcnJvcjogJHtyZXNwLnN0YXR1c31gLCB7XHJcbiAgICAgICAgICBwcm92aWRlcjogJ2xtc3R1ZGlvJyxcclxuICAgICAgICAgIG1vZGVsLFxyXG4gICAgICAgICAgc3RhdHVzOiByZXNwLnN0YXR1cyxcclxuICAgICAgICAgIHN0YXR1c1RleHQ6IHJlc3Auc3RhdHVzVGV4dCxcclxuICAgICAgICAgIGVycm9yOiB0ZXh0LFxyXG4gICAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgICB1cmw6IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmxcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExNIFN0dWRpbyBBUEkgZXJyb3I6ICR7cmVzcC5zdGF0dXN9ICR7cmVzcC5zdGF0dXNUZXh0fWApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcC5qc29uKCk7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBqc29uPy5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgbnVsbDtcclxuICAgICAgY29uc3QgdG9rZW5Vc2FnZSA9IGpzb24/LnVzYWdlPy50b3RhbF90b2tlbnMgfHwgMDtcclxuICAgICAgXHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdsbG0tY2FsbCcsICdMTSBTdHVkaW8gQVBJIHJlc3BvbnNlIHJlY2VpdmVkJywge1xyXG4gICAgICAgIHByb3ZpZGVyOiAnbG1zdHVkaW8nLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsXHJcbiAgICAgICAgdG9rZW5Vc2FnZSxcclxuICAgICAgICByZXNwb25zZUxlbmd0aDogY29udGVudD8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgcmVzcG9uc2VEYXRhOiB7XHJcbiAgICAgICAgICBjaG9pY2VzOiBqc29uPy5jaG9pY2VzPy5sZW5ndGggfHwgMCxcclxuICAgICAgICAgIHVzYWdlOiBqc29uPy51c2FnZVxyXG4gICAgICAgIH1cclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gY29udGVudDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignY2FsbExNU3R1ZGlvIGVycm9yJywgZSk7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCAnTE0gU3R1ZGlvIEFQSSBjYWxsIGZhaWxlZCcsIHtcclxuICAgICAgICBwcm92aWRlcjogJ2xtc3R1ZGlvJyxcclxuICAgICAgICBtb2RlbCxcclxuICAgICAgICBlcnJvcjogZS5tZXNzYWdlLFxyXG4gICAgICAgIHVybDogdGhpcy5zZXR0aW5ncy5sbXN0dWRpb1VybFxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgdGhyb3cgZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEZldGNoIGF2YWlsYWJsZSBtb2RlbHMgZm9yIGNsb3VkIHByb3ZpZGVyc1xyXG4gIGFzeW5jIGZldGNoQ2xvdWRNb2RlbHMocHJvdmlkZXI6ICdvcGVuYWknIHwgJ2FudGhyb3BpYycpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gdGhpcy5kZWJ1Z0xvZ2dlcj8uc3RhcnRPcGVyYXRpb24oJ3NlcnZpY2UtZGV0ZWN0aW9uJywgYEZldGNoaW5nIGNsb3VkIG1vZGVscyBmb3IgcHJvdmlkZXI6ICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICBwcm92aWRlcixcclxuICAgICAgaGFzQXBpS2V5OiAhIXRoaXMuc2V0dGluZ3MuYXBpS2V5XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLmFwaUtleSkge1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ3dhcm4nLCAnc2VydmljZS1kZXRlY3Rpb24nLCBgTm8gQVBJIGtleSBhdmFpbGFibGUgZm9yICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICAgIHByb3ZpZGVyXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XHJcbiAgICBjb25zdCBjYWNoZUtleSA9IGAke3Byb3ZpZGVyfS0ke3RoaXMuc2V0dGluZ3MuYXBpS2V5LnNsaWNlKC00KX1gOyAvLyBVc2UgbGFzdCA0IGNoYXJzIGZvciBjYWNoZSBrZXlcclxuICAgIGlmICh0aGlzLmNsb3VkTW9kZWxDYWNoZS5oYXMoY2FjaGVLZXkpKSB7XHJcbiAgICAgIGNvbnN0IGNhY2hlZE1vZGVscyA9IHRoaXMuY2xvdWRNb2RlbENhY2hlLmdldChjYWNoZUtleSkgfHwgW107XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsIGBVc2luZyBjYWNoZWQgbW9kZWxzIGZvciAke3Byb3ZpZGVyfWAsIHtcclxuICAgICAgICBwcm92aWRlcixcclxuICAgICAgICBjYWNoZUtleTogY2FjaGVLZXkucmVwbGFjZSgvLS4qJC8sICctKioqKicpLCAvLyBNYXNrIEFQSSBrZXkgaW4gbG9nc1xyXG4gICAgICAgIG1vZGVsQ291bnQ6IGNhY2hlZE1vZGVscy5sZW5ndGgsXHJcbiAgICAgICAgbW9kZWxzOiBjYWNoZWRNb2RlbHNcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHJldHVybiBjYWNoZWRNb2RlbHM7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZygnaW5mbycsICdzZXJ2aWNlLWRldGVjdGlvbicsIGBDYWNoZSBtaXNzLCBmZXRjaGluZyBmcmVzaCBtb2RlbHMgZm9yICR7cHJvdmlkZXJ9YCwge1xyXG4gICAgICBwcm92aWRlcixcclxuICAgICAgY2FjaGVLZXk6IGNhY2hlS2V5LnJlcGxhY2UoLy0uKiQvLCAnLSoqKionKVxyXG4gICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChwcm92aWRlciA9PT0gJ29wZW5haScpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5mZXRjaE9wZW5BSU1vZGVscyhjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfSBlbHNlIGlmIChwcm92aWRlciA9PT0gJ2FudGhyb3BpYycpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5mZXRjaEFudGhyb3BpY01vZGVscyhjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gZmV0Y2ggJHtwcm92aWRlcn0gbW9kZWxzOmAsIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICBjb25zdCBkZWZhdWx0TW9kZWxzID0gdGhpcy5nZXREZWZhdWx0TW9kZWxzKHByb3ZpZGVyKTtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdlcnJvcicsICdzZXJ2aWNlLWRldGVjdGlvbicsIGBGYWlsZWQgdG8gZmV0Y2ggJHtwcm92aWRlcn0gbW9kZWxzLCB1c2luZyBkZWZhdWx0c2AsIHtcclxuICAgICAgICBwcm92aWRlcixcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICBlcnJvclR5cGU6IGVycm9yLm5hbWUsXHJcbiAgICAgICAgZGVmYXVsdE1vZGVscyxcclxuICAgICAgICBkZWZhdWx0TW9kZWxDb3VudDogZGVmYXVsdE1vZGVscy5sZW5ndGhcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWxzO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGZldGNoT3BlbkFJTW9kZWxzKGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICBjb25zdCBlbmRwb2ludCA9ICdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL21vZGVscyc7XHJcbiAgICBjb25zdCBtYXNrZWRBcGlLZXkgPSB0aGlzLnNldHRpbmdzLmFwaUtleSA/IGAuLi4ke3RoaXMuc2V0dGluZ3MuYXBpS2V5LnNsaWNlKC00KX1gIDogJ25vbmUnO1xyXG4gICAgXHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnRmV0Y2hpbmcgT3BlbkFJIG1vZGVscycsIHtcclxuICAgICAgcHJvdmlkZXI6ICdvcGVuYWknLFxyXG4gICAgICBlbmRwb2ludCxcclxuICAgICAgYXBpS2V5OiBtYXNrZWRBcGlLZXlcclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICBjb25zdCByYXdSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3RVcmwoe1xyXG4gICAgICAgIHVybDogZW5kcG9pbnQsXHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLnNldHRpbmdzLmFwaUtleX1gLFxyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gdGhpcy5hZGFwdFJlcXVlc3RVcmxSZXNwb25zZShyYXdSZXNwb25zZSk7XHJcbiAgICAgIGNvbnN0IHByb2Nlc3NpbmdUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuICAgICAgXHJcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2Vycm9yJywgJ3NlcnZpY2UtZGV0ZWN0aW9uJywgYE9wZW5BSSBtb2RlbHMgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gLCB7XHJcbiAgICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXHJcbiAgICAgICAgICBlbmRwb2ludCxcclxuICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcclxuICAgICAgICAgIHByb2Nlc3NpbmdUaW1lXHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgY29uc3QgYWxsTW9kZWxzID0gZGF0YS5kYXRhIHx8IFtdO1xyXG4gICAgICBjb25zdCBtb2RlbHMgPSBhbGxNb2RlbHNcclxuICAgICAgICA/LmZpbHRlcigobW9kZWw6IGFueSkgPT4gbW9kZWwuaWQuaW5jbHVkZXMoJ2dwdCcpICYmICFtb2RlbC5pZC5pbmNsdWRlcygnaW5zdHJ1Y3QnKSlcclxuICAgICAgICA/Lm1hcCgobW9kZWw6IGFueSkgPT4gbW9kZWwuaWQpXHJcbiAgICAgICAgPy5zb3J0KCkgfHwgW107XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnT3BlbkFJIG1vZGVscyBmZXRjaGVkIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXHJcbiAgICAgICAgZW5kcG9pbnQsXHJcbiAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgICAgdG90YWxNb2RlbHNSZWNlaXZlZDogYWxsTW9kZWxzLmxlbmd0aCxcclxuICAgICAgICBmaWx0ZXJlZE1vZGVsQ291bnQ6IG1vZGVscy5sZW5ndGgsXHJcbiAgICAgICAgbW9kZWxzOiBtb2RlbHNcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0c1xyXG4gICAgICBjb25zdCBjYWNoZUtleSA9IGBvcGVuYWktJHt0aGlzLnNldHRpbmdzLmFwaUtleS5zbGljZSgtNCl9YDtcclxuICAgICAgdGhpcy5jbG91ZE1vZGVsQ2FjaGUuc2V0KGNhY2hlS2V5LCBtb2RlbHMpO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ3NlcnZpY2UtZGV0ZWN0aW9uJywgJ09wZW5BSSBtb2RlbHMgY2FjaGVkIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXHJcbiAgICAgICAgY2FjaGVLZXk6IGNhY2hlS2V5LnJlcGxhY2UoLy0uKiQvLCAnLSoqKionKSwgLy8gTWFzayBBUEkga2V5IGluIGxvZ3NcclxuICAgICAgICBtb2RlbENvdW50OiBtb2RlbHMubGVuZ3RoXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIG1vZGVscy5sZW5ndGggPiAwID8gbW9kZWxzIDogdGhpcy5nZXREZWZhdWx0TW9kZWxzKCdvcGVuYWknKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdlcnJvcicsICdzZXJ2aWNlLWRldGVjdGlvbicsICdPcGVuQUkgbW9kZWxzIGZldGNoIGZhaWxlZCcsIHtcclxuICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXHJcbiAgICAgICAgZW5kcG9pbnQsXHJcbiAgICAgICAgZXJyb3I6IGUubWVzc2FnZSxcclxuICAgICAgICBlcnJvclR5cGU6IGUubmFtZVxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RGVmYXVsdE1vZGVscygnb3BlbmFpJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGZldGNoQW50aHJvcGljTW9kZWxzKGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICAvLyBBbnRocm9waWMgZG9lc24ndCBoYXZlIGEgbW9kZWxzIGVuZHBvaW50LCBzbyByZXR1cm4ga25vd24gbW9kZWxzXHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnRmV0Y2hpbmcgQW50aHJvcGljIG1vZGVscyAodXNpbmcga25vd24gbW9kZWwgbGlzdCknLCB7XHJcbiAgICAgIHByb3ZpZGVyOiAnYW50aHJvcGljJyxcclxuICAgICAgcmVhc29uOiAnbm8tcHVibGljLW1vZGVscy1hcGknXHJcbiAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgIFxyXG4gICAgY29uc3Qga25vd25Nb2RlbHMgPSBbXHJcbiAgICAgIC8vIEN1cnJlbnQgZ2VuZXJhdGlvbiAoMjAyNSkgLSBSZWNvbW1lbmRlZFxyXG4gICAgICAnY2xhdWRlLW9wdXMtNC0xLTIwMjUwODA1JywgICAgIC8vIExhdGVzdCBhbmQgbW9zdCBjYXBhYmxlXHJcbiAgICAgICdjbGF1ZGUtb3B1cy00LTIwMjUwNTE0JywgICAgICAgLy8gUHJldmlvdXMgT3B1cyA0XHJcbiAgICAgICdjbGF1ZGUtc29ubmV0LTQtMjAyNTA1MTQnLCAgICAgLy8gSGlnaC1wZXJmb3JtYW5jZSBTb25uZXQgNFxyXG4gICAgICAnY2xhdWRlLTMtNy1zb25uZXQtMjAyNTAyMTknLCAgIC8vIEh5YnJpZCByZWFzb25pbmcgbW9kZWxcclxuICAgICAgXHJcbiAgICAgIC8vIENsYXVkZSAzLjUgc2VyaWVzXHJcbiAgICAgICdjbGF1ZGUtMy01LXNvbm5ldC0yMDI0MTAyMicsICAgLy8gU29ubmV0IDMuNSB2MlxyXG4gICAgICAnY2xhdWRlLTMtNS1zb25uZXQtMjAyNDA2MjAnLCAgIC8vIE9yaWdpbmFsIFNvbm5ldCAzLjVcclxuICAgICAgJ2NsYXVkZS0zLTUtaGFpa3UtMjAyNDEwMjInLCAgICAvLyBGYXN0IEhhaWt1IDMuNVxyXG4gICAgICBcclxuICAgICAgLy8gQ2xhdWRlIDMgc2VyaWVzIChsZWdhY3kpXHJcbiAgICAgICdjbGF1ZGUtMy1vcHVzLTIwMjQwMjI5JywgICAgICAgLy8gTGVnYWN5IE9wdXMgM1xyXG4gICAgICAnY2xhdWRlLTMtc29ubmV0LTIwMjQwMjI5JywgICAgIC8vIExlZ2FjeSBTb25uZXQgM1xyXG4gICAgICAnY2xhdWRlLTMtaGFpa3UtMjAyNDAzMDcnICAgICAgIC8vIExlZ2FjeSBIYWlrdSAzXHJcbiAgICBdO1xyXG4gICAgXHJcbiAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2coJ2luZm8nLCAnc2VydmljZS1kZXRlY3Rpb24nLCAnQW50aHJvcGljIG1vZGVscyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5Jywge1xyXG4gICAgICBwcm92aWRlcjogJ2FudGhyb3BpYycsXHJcbiAgICAgIG1vZGVsQ291bnQ6IGtub3duTW9kZWxzLmxlbmd0aCxcclxuICAgICAgbW9kZWxzOiBrbm93bk1vZGVscyxcclxuICAgICAgc291cmNlOiAnaGFyZGNvZGVkLWtub3duLW1vZGVscydcclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgXHJcbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0c1xyXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgYW50aHJvcGljLSR7dGhpcy5zZXR0aW5ncy5hcGlLZXkuc2xpY2UoLTQpfWA7XHJcbiAgICB0aGlzLmNsb3VkTW9kZWxDYWNoZS5zZXQoY2FjaGVLZXksIGtub3duTW9kZWxzKTtcclxuICAgIFxyXG4gICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nKCdpbmZvJywgJ3NlcnZpY2UtZGV0ZWN0aW9uJywgJ0FudGhyb3BpYyBtb2RlbHMgY2FjaGVkIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgICAgcHJvdmlkZXI6ICdhbnRocm9waWMnLFxyXG4gICAgICBjYWNoZUtleTogY2FjaGVLZXkucmVwbGFjZSgvLS4qJC8sICctKioqKicpLCAvLyBNYXNrIEFQSSBrZXkgaW4gbG9nc1xyXG4gICAgICBtb2RlbENvdW50OiBrbm93bk1vZGVscy5sZW5ndGhcclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgXHJcbiAgICByZXR1cm4ga25vd25Nb2RlbHM7XHJcbiAgfVxyXG5cclxuICBnZXREZWZhdWx0TW9kZWxzKHByb3ZpZGVyOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBkZWZhdWx0cyA9IHtcclxuICAgICAgb3BlbmFpOiBbJ2dwdC00bycsICdncHQtNG8tbWluaScsICdncHQtNC10dXJibycsICdncHQtMy41LXR1cmJvJ10sXHJcbiAgICAgIGFudGhyb3BpYzogWydjbGF1ZGUtb3B1cy00LTEtMjAyNTA4MDUnLCAnY2xhdWRlLXNvbm5ldC00LTIwMjUwNTE0JywgJ2NsYXVkZS0zLTctc29ubmV0LTIwMjUwMjE5JywgJ2NsYXVkZS0zLTUtc29ubmV0LTIwMjQxMDIyJywgJ2NsYXVkZS0zLTUtaGFpa3UtMjAyNDEwMjInLCAnY2xhdWRlLTMtb3B1cy0yMDI0MDIyOSddLFxyXG4gICAgICBvbGxhbWE6IFsnbGxhbWEzLjInLCAnbWlzdHJhbCcsICdjb2RlbGxhbWEnXSxcclxuICAgICAgbG1zdHVkaW86IFsnbG9jYWwtbW9kZWwnXVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRlZmF1bHRzW3Byb3ZpZGVyIGFzIGtleW9mIHR5cGVvZiBkZWZhdWx0c10gfHwgW107XHJcbiAgfVxyXG5cclxuICAvLyBDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gbWV0aG9kXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZVByb3ZpZGVyQ29uZmlnKHByb3ZpZGVyOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcnM6IHN0cmluZ1tdIH0ge1xyXG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgXHJcbiAgICBzd2l0Y2ggKHByb3ZpZGVyKSB7XHJcbiAgICAgIGNhc2UgJ29wZW5haSc6XHJcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLmFwaUtleSB8fCB0aGlzLnNldHRpbmdzLmFwaUtleS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnT3BlbkFJIEFQSSBrZXkgaXMgbWlzc2luZycpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuc2V0dGluZ3MuYXBpS2V5LnN0YXJ0c1dpdGgoJ3NrLScpKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnT3BlbkFJIEFQSSBrZXkgc2hvdWxkIHN0YXJ0IHdpdGggXCJzay1cIicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MubW9kZWwgfHwgdGhpcy5zZXR0aW5ncy5tb2RlbC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnT3BlbkFJIG1vZGVsIGlzIG5vdCBzcGVjaWZpZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICAgIGNhc2UgJ2FudGhyb3BpYyc6XHJcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLmFwaUtleSB8fCB0aGlzLnNldHRpbmdzLmFwaUtleS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnQW50aHJvcGljIEFQSSBrZXkgaXMgbWlzc2luZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBhbnRocm9waWNVcmwgPSB0aGlzLnNldHRpbmdzLmFudGhyb3BpY1VybCB8fCAnaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcyc7XHJcbiAgICAgICAgaWYgKCFhbnRocm9waWNVcmwuaW5jbHVkZXMoJ2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzJykpIHtcclxuICAgICAgICAgIGVycm9ycy5wdXNoKCdBbnRocm9waWMgVVJMIG11c3QgcG9pbnQgdG8gaHR0cHM6Ly9hcGkuYW50aHJvcGljLmNvbS92MS9tZXNzYWdlcycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MubW9kZWwgfHwgdGhpcy5zZXR0aW5ncy5tb2RlbC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnQW50aHJvcGljIG1vZGVsIGlzIG5vdCBzcGVjaWZpZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICAgIGNhc2UgJ29sbGFtYSc6XHJcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLm9sbGFtYVVybCB8fCB0aGlzLnNldHRpbmdzLm9sbGFtYVVybC50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCgnT2xsYW1hIFVSTCBpcyBtaXNzaW5nJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIFxyXG4gICAgICBjYXNlICdsbXN0dWRpbyc6XHJcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLmxtc3R1ZGlvVXJsIHx8IHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgZXJyb3JzLnB1c2goJ0xNIFN0dWRpbyBVUkwgaXMgbWlzc2luZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgICBcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBlcnJvcnMucHVzaChgVW5zdXBwb3J0ZWQgcHJvdmlkZXI6ICR7cHJvdmlkZXJ9YCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7IHZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLCBlcnJvcnMgfTtcclxuICB9XHJcblxyXG4gIC8vIFV0aWxpdHkgbWV0aG9kc1xyXG4gIHByaXZhdGUgZGVsYXkobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGNyZWF0ZVRpbWVvdXRTaWduYWwobXM6IG51bWJlcik6IEFib3J0U2lnbmFsIHtcclxuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgbXMpO1xyXG4gICAgcmV0dXJuIGNvbnRyb2xsZXIuc2lnbmFsO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2xlYW51cCBtZXRob2RcclxuICBjbGVhbnVwKCkge1xyXG4gICAgdGhpcy5jbG91ZE1vZGVsQ2FjaGUuY2xlYXIoKTtcclxuICAgIHRoaXMuYXBpS2V5TWlzc2luZ05vdGlmaWVkLmNsZWFyKCk7XHJcbiAgICB0aGlzLnNlcnZpY2VDYWNoZS5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgLy8gSGVscGVyIHRvIGFkYXB0IHJlcXVlc3RVcmwgcmVzcG9uc2UgdG8gZmV0Y2gtbGlrZSBpbnRlcmZhY2VcclxuICBwcml2YXRlIGFkYXB0UmVxdWVzdFVybFJlc3BvbnNlKHJlc3BvbnNlOiBhbnkpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG9rOiByZXNwb25zZS5zdGF0dXMgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1cyA8IDMwMCxcclxuICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1cy50b1N0cmluZygpLFxyXG4gICAgICBqc29uOiBhc3luYyAoKSA9PiByZXNwb25zZS5qc29uLFxyXG4gICAgICB0ZXh0OiBhc3luYyAoKSA9PiByZXNwb25zZS50ZXh0XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gTWV0aG9kcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxyXG4gIGdldFNlcnZpY2VDYWNoZSgpIHsgcmV0dXJuIHRoaXMuc2VydmljZUNhY2hlOyB9XHJcbiAgZ2V0Q2xvdWRNb2RlbENhY2hlKCkgeyByZXR1cm4gdGhpcy5jbG91ZE1vZGVsQ2FjaGU7IH1cclxuICBnZXRBcGlLZXlNaXNzaW5nTm90aWZpZWQoKSB7IHJldHVybiB0aGlzLmFwaUtleU1pc3NpbmdOb3RpZmllZDsgfVxyXG59XHJcbicnIiwgIi8qXHJcbiAqIFRhc2sgcHJvY2Vzc2luZyBhbmQgZXh0cmFjdGlvbiBsb2dpY1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IEFwcCwgVEZpbGUsIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgRXh0cmFjdG9yU2V0dGluZ3MsIFRhc2tFeHRyYWN0aW9uLCBUYXNrRXh0cmFjdGlvblJlc3VsdCwgRXh0cmFjdGVkVGFzayB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBMTE1Qcm92aWRlck1hbmFnZXIgfSBmcm9tICcuL2xsbS1wcm92aWRlcnMnO1xyXG5pbXBvcnQgeyBEZWJ1Z0xvZ2dlciB9IGZyb20gJy4vZGVidWctbG9nZ2VyJztcclxuXHJcbmludGVyZmFjZSBQcm9jZXNzaW5nU3RhdHVzIHtcclxuICBzdGF0dXM6ICdxdWV1ZWQnIHwgJ3Byb2Nlc3NpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnZmFpbGVkJztcclxuICBzdGFydFRpbWU6IG51bWJlcjtcclxuICB0aW1lb3V0PzogTm9kZUpTLlRpbWVvdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUYXNrUHJvY2Vzc29yIHtcclxuICBwcml2YXRlIHByb2Nlc3NpbmdGaWxlczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XHJcbiAgcHJpdmF0ZSBmaWxlQ2hhbmdlRGVib3VuY2VyOiBNYXA8c3RyaW5nLCBOb2RlSlMuVGltZW91dD4gPSBuZXcgTWFwKCk7XHJcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nUXVldWU6IE1hcDxzdHJpbmcsIFByb2Nlc3NpbmdTdGF0dXM+ID0gbmV3IE1hcCgpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgYXBwOiBBcHAsXHJcbiAgICBwcml2YXRlIHNldHRpbmdzOiBFeHRyYWN0b3JTZXR0aW5ncyxcclxuICAgIHByaXZhdGUgbGxtUHJvdmlkZXI6IExMTVByb3ZpZGVyTWFuYWdlcixcclxuICAgIHByaXZhdGUgZGVidWdMb2dnZXI/OiBEZWJ1Z0xvZ2dlclxyXG4gICkge31cclxuXHJcbiAgLyoqXHJcbiAgICogQ29uZGl0aW9uYWwgbG9nZ2luZyBoZWxwZXIgdG8gZW5zdXJlIHplcm8gb3ZlcmhlYWQgd2hlbiBkZWJ1ZyBtb2RlIGlzIGRpc2FibGVkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBsb2coXHJcbiAgICBsZXZlbDogJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJyxcclxuICAgIGNhdGVnb3J5OiAnZmlsZS1wcm9jZXNzaW5nJyB8ICdsbG0tY2FsbCcgfCAndGFzay1jcmVhdGlvbicgfCAnc2VydmljZS1kZXRlY3Rpb24nIHwgJ3ZhbGlkYXRpb24nIHwgJ2Vycm9yJyxcclxuICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgIGRhdGE/OiBhbnksXHJcbiAgICBjb3JyZWxhdGlvbklkPzogc3RyaW5nXHJcbiAgKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5kZWJ1Z0xvZ2dlcj8uaXNFbmFibGVkKCkpIHtcclxuICAgICAgdGhpcy5kZWJ1Z0xvZ2dlci5sb2cobGV2ZWwsIGNhdGVnb3J5LCBtZXNzYWdlLCBkYXRhLCBjb3JyZWxhdGlvbklkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IGEgbmV3IG9wZXJhdGlvbiBmb3IgY29ycmVsYXRpb24gdHJhY2tpbmdcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXJ0T3BlcmF0aW9uKFxyXG4gICAgY2F0ZWdvcnk6ICdmaWxlLXByb2Nlc3NpbmcnIHwgJ2xsbS1jYWxsJyB8ICd0YXNrLWNyZWF0aW9uJyB8ICdzZXJ2aWNlLWRldGVjdGlvbicgfCAndmFsaWRhdGlvbicgfCAnZXJyb3InLFxyXG4gICAgbWVzc2FnZTogc3RyaW5nLFxyXG4gICAgZGF0YT86IGFueVxyXG4gICk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAodGhpcy5kZWJ1Z0xvZ2dlcj8uaXNFbmFibGVkKCkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGVidWdMb2dnZXIuc3RhcnRPcGVyYXRpb24oY2F0ZWdvcnksIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8vIERlYm91bmNlIGZpbGUgY2hhbmdlcyB0byBwcmV2ZW50IHJhcGlkIHByb2Nlc3NpbmdcclxuICBkZWJvdW5jZUZpbGVDaGFuZ2UoZmlsZTogVEZpbGUsIGNhbGxiYWNrOiAoZmlsZTogVEZpbGUpID0+IHZvaWQpIHtcclxuICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5maWxlQ2hhbmdlRGVib3VuY2VyLmdldChmaWxlLnBhdGgpO1xyXG4gICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgIGNsZWFyVGltZW91dChleGlzdGluZyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMuZmlsZUNoYW5nZURlYm91bmNlci5zZXQoZmlsZS5wYXRoLCBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgY2FsbGJhY2soZmlsZSk7XHJcbiAgICAgIHRoaXMuZmlsZUNoYW5nZURlYm91bmNlci5kZWxldGUoZmlsZS5wYXRoKTtcclxuICAgIH0sIDIwMDApKTtcclxuICB9XHJcblxyXG4gIC8vIFdoZW4gYSBmaWxlIGlzIGNyZWF0ZWQgb3IgbW9kaWZpZWRcclxuICBhc3luYyBvbkZpbGVDaGFuZ2VkKGZpbGU6IFRGaWxlKSB7XHJcbiAgICAvLyBBdG9taWMgZmlsZSBwcm9jZXNzaW5nIHdpdGggZ3VhcmFudGVlZCBjbGVhbnVwIGFuZCBxdWV1ZSBtYW5hZ2VtZW50XHJcbiAgICBpZiAoZmlsZS5leHRlbnNpb24gIT09ICdtZCcpIHtcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ0ZpbGUgc2tpcHBlZDogbm90IGEgbWFya2Rvd24gZmlsZScsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IGZpbGUucGF0aCwgXHJcbiAgICAgICAgZXh0ZW5zaW9uOiBmaWxlLmV4dGVuc2lvbiBcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCBvcGVyYXRpb24gdHJhY2tpbmcgZm9yIGNvcnJlbGF0aW9uXHJcbiAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gdGhpcy5zdGFydE9wZXJhdGlvbignZmlsZS1wcm9jZXNzaW5nJywgJ1Byb2Nlc3NpbmcgZmlsZScsIHsgXHJcbiAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGggXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBDaGVjayBleGNsdXNpb24gcnVsZXMgZWFybHkgdG8gYXZvaWQgdW5uZWNlc3NhcnkgcHJvY2Vzc2luZ1xyXG4gICAgaWYgKHRoaXMuaXNGaWxlRXhjbHVkZWQoZmlsZS5wYXRoKSkge1xyXG4gICAgICB0aGlzLmxvZygnaW5mbycsICdmaWxlLXByb2Nlc3NpbmcnLCAnRmlsZSBza2lwcGVkOiBleGNsdWRlZCBieSB1c2VyIHJ1bGVzJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgIGV4Y2x1ZGVkUGF0aHM6IHRoaXMuc2V0dGluZ3MuZXhjbHVkZWRQYXRocyxcclxuICAgICAgICBleGNsdWRlZFBhdHRlcm5zOiB0aGlzLnNldHRpbmdzLmV4Y2x1ZGVkUGF0dGVybnNcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSBpbiBwcm9jZXNzaW5nIHF1ZXVlIG9yIHNldFxyXG4gICAgY29uc3QgcXVldWVTdGF0dXMgPSB0aGlzLnByb2Nlc3NpbmdRdWV1ZS5nZXQoZmlsZS5wYXRoKTtcclxuICAgIGlmIChxdWV1ZVN0YXR1cz8uc3RhdHVzID09PSAncHJvY2Vzc2luZycgfHwgdGhpcy5wcm9jZXNzaW5nRmlsZXMuaGFzKGZpbGUucGF0aCkpIHtcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ0ZpbGUgc2tpcHBlZDogYWxyZWFkeSBiZWluZyBwcm9jZXNzZWQnLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgcXVldWVTdGF0dXM6IHF1ZXVlU3RhdHVzPy5zdGF0dXMsXHJcbiAgICAgICAgaW5Qcm9jZXNzaW5nU2V0OiB0aGlzLnByb2Nlc3NpbmdGaWxlcy5oYXMoZmlsZS5wYXRoKVxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBBZGQgdG8gcXVldWUgd2l0aCBzdGF0dXMgdHJhY2tpbmdcclxuICAgIGNvbnN0IHByb2Nlc3NpbmdTdGF0dXM6IFByb2Nlc3NpbmdTdGF0dXMgPSB7XHJcbiAgICAgIHN0YXR1czogJ3F1ZXVlZCcsXHJcbiAgICAgIHN0YXJ0VGltZTogRGF0ZS5ub3coKVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQWRkIHByb2Nlc3NpbmcgdGltZW91dCBtZWNoYW5pc21cclxuICAgIHByb2Nlc3NpbmdTdGF0dXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBjb25zb2xlLndhcm4oYFRhc2tFeHRyYWN0b3I6IEZpbGUgcHJvY2Vzc2luZyB0aW1lb3V0IGZvciAke2ZpbGUucGF0aH1gKTtcclxuICAgICAgdGhpcy5jbGVhbnVwRmlsZVByb2Nlc3NpbmcoZmlsZS5wYXRoKTtcclxuICAgIH0sIDMwMDAwKTsgLy8gMzAgc2Vjb25kIHRpbWVvdXRcclxuICAgIFxyXG4gICAgdGhpcy5wcm9jZXNzaW5nUXVldWUuc2V0KGZpbGUucGF0aCwgcHJvY2Vzc2luZ1N0YXR1cyk7XHJcbiAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcy5hZGQoZmlsZS5wYXRoKTtcclxuICAgIFxyXG4gICAgLy8gVXBkYXRlIHN0YXR1cyB0byBwcm9jZXNzaW5nXHJcbiAgICBwcm9jZXNzaW5nU3RhdHVzLnN0YXR1cyA9ICdwcm9jZXNzaW5nJztcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgICAgY29uc3QgZnJvbnQgPSBjYWNoZT8uZnJvbnRtYXR0ZXI7XHJcbiAgICAgIGlmICghZnJvbnQpIHtcclxuICAgICAgICB0aGlzLmxvZygnaW5mbycsICdmaWxlLXByb2Nlc3NpbmcnLCAnRmlsZSBza2lwcGVkOiBubyBmcm9udG1hdHRlciBmb3VuZCcsIHsgXHJcbiAgICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoIFxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ0ZpbGUgaGFzIGZyb250bWF0dGVyLCB2YWxpZGF0aW5nJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgIGZyb250bWF0dGVyS2V5czogT2JqZWN0LmtleXMoZnJvbnQpXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG5cclxuICAgICAgLy8gVmFsaWRhdGUgc2V0dGluZ3MgYXQgcnVudGltZSB0byBoYW5kbGUgY29ycnVwdGVkIGNvbmZpZ3VyYXRpb25zXHJcbiAgICAgIGlmICghdGhpcy5zZXR0aW5ncy50cmlnZ2VyVHlwZXMgfHwgIUFycmF5LmlzQXJyYXkodGhpcy5zZXR0aW5ncy50cmlnZ2VyVHlwZXMpIHx8IHRoaXMuc2V0dGluZ3MudHJpZ2dlclR5cGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignVGFza0V4dHJhY3RvcjogSW52YWxpZCB0cmlnZ2VyIHR5cGVzIGNvbmZpZ3VyYXRpb24sIHNraXBwaW5nIHByb2Nlc3NpbmcnKTtcclxuICAgICAgICB0aGlzLmxvZygnZXJyb3InLCAndmFsaWRhdGlvbicsICdJbnZhbGlkIHRyaWdnZXIgdHlwZXMgY29uZmlndXJhdGlvbicsIHsgXHJcbiAgICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgICAgdHJpZ2dlclR5cGVzOiB0aGlzLnNldHRpbmdzLnRyaWdnZXJUeXBlc1xyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmRlbGV0ZShmaWxlLnBhdGgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gY2hlY2sgYWxyZWFkeSBwcm9jZXNzZWRcclxuICAgICAgY29uc3QgcHJvY2Vzc2VkS2V5ID0gdGhpcy5zZXR0aW5ncy5wcm9jZXNzZWRGcm9udG1hdHRlcktleSB8fCAndGFza0V4dHJhY3Rvci5wcm9jZXNzZWQnO1xyXG4gICAgICBjb25zdCBwcm9jZXNzZWRWYWx1ZSA9IHRoaXMuZ2V0RnJvbnRtYXR0ZXJWYWx1ZShmcm9udCwgcHJvY2Vzc2VkS2V5KTtcclxuICAgICAgaWYgKHByb2Nlc3NlZFZhbHVlID09PSB0cnVlIHx8IHByb2Nlc3NlZFZhbHVlID09PSAndHJ1ZScpIHtcclxuICAgICAgICAvLyBhbHJlYWR5IHByb2Nlc3NlZFxyXG4gICAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2ZpbGUtcHJvY2Vzc2luZycsICdGaWxlIHNraXBwZWQ6IGFscmVhZHkgcHJvY2Vzc2VkJywgeyBcclxuICAgICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgICBwcm9jZXNzZWRLZXksXHJcbiAgICAgICAgICBwcm9jZXNzZWRWYWx1ZVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXNlIHZhbGlkYXRlZCBmcm9udG1hdHRlciBmaWVsZCB3aXRoIGZhbGxiYWNrIHRvIFwiVHlwZVwiXHJcbiAgICAgIGNvbnN0IGZyb250bWF0dGVyRmllbGQgPSB0aGlzLnZhbGlkYXRlRnJvbnRtYXR0ZXJGaWVsZCh0aGlzLnNldHRpbmdzLnRyaWdnZXJGcm9udG1hdHRlckZpZWxkLCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgY29uc3QgdHlwZVJhdyA9IHRoaXMuZ2V0RnJvbnRtYXR0ZXJWYWx1ZShmcm9udCwgZnJvbnRtYXR0ZXJGaWVsZCkgfHwgJyc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2cgZnJvbnRtYXR0ZXIgZmllbGQgdmFsaWRhdGlvblxyXG4gICAgICBpZiAodHlwZVJhdykge1xyXG4gICAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb25TdWNjZXNzKCdmcm9udG1hdHRlcicsIGAke2Zyb250bWF0dGVyRmllbGR9YCwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nVmFsaWRhdGlvbihcclxuICAgICAgICAgICdmcm9udG1hdHRlcicsXHJcbiAgICAgICAgICBmcm9udG1hdHRlckZpZWxkLFxyXG4gICAgICAgICAgdHlwZVJhdyxcclxuICAgICAgICAgICdub24tZW1wdHkgdmFsdWUnLFxyXG4gICAgICAgICAgJ0Zyb250bWF0dGVyIGZpZWxkIGlzIGVtcHR5IG9yIG1pc3NpbmcnLFxyXG4gICAgICAgICAgY29ycmVsYXRpb25JZFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHR5cGUgPSAoJycgKyB0eXBlUmF3KS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBjb25zdCBhY2NlcHRlZCA9IHRoaXMuc2V0dGluZ3MudHJpZ2dlclR5cGVzLm1hcCh0ID0+IHQudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmxvZygnaW5mbycsICdmaWxlLXByb2Nlc3NpbmcnLCAnQ2hlY2tpbmcgdHJpZ2dlciB0eXBlIG1hdGNoJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgIGZyb250bWF0dGVyRmllbGQsXHJcbiAgICAgICAgdHlwZUZvdW5kOiB0eXBlLFxyXG4gICAgICAgIGFjY2VwdGVkVHlwZXM6IGFjY2VwdGVkLFxyXG4gICAgICAgIG1hdGNoZXM6IGFjY2VwdGVkLmluY2x1ZGVzKHR5cGUpXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFhY2NlcHRlZC5pbmNsdWRlcyh0eXBlKSkge1xyXG4gICAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2ZpbGUtcHJvY2Vzc2luZycsICdGaWxlIHNraXBwZWQ6IHRyaWdnZXIgdHlwZSBub3QgbWF0Y2hlZCcsIHsgXHJcbiAgICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgICAgdHlwZUZvdW5kOiB0eXBlLFxyXG4gICAgICAgICAgYWNjZXB0ZWRUeXBlczogYWNjZXB0ZWRcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBMb2cgZGV0YWlsZWQgdmFsaWRhdGlvbiBjb250ZXh0XHJcbiAgICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nVmFsaWRhdGlvbihcclxuICAgICAgICAgICdmcm9udG1hdHRlcicsXHJcbiAgICAgICAgICBgJHtmcm9udG1hdHRlckZpZWxkfS50cmlnZ2VyTWF0Y2hgLFxyXG4gICAgICAgICAgdHlwZSxcclxuICAgICAgICAgIGBvbmUgb2Y6ICR7YWNjZXB0ZWQuam9pbignLCAnKX1gLFxyXG4gICAgICAgICAgYFZhbHVlICcke3R5cGV9JyBkb2VzIG5vdCBtYXRjaCBhbnkgdHJpZ2dlciB0eXBlc2AsXHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgdHJpZ2dlciB0eXBlIG1hdGNoXHJcbiAgICAgICAgdGhpcy5kZWJ1Z0xvZ2dlcj8ubG9nVmFsaWRhdGlvblN1Y2Nlc3MoJ2Zyb250bWF0dGVyJywgYCR7ZnJvbnRtYXR0ZXJGaWVsZH0udHJpZ2dlck1hdGNoYCwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZhbGlkYXRlIG93bmVyIG5hbWUgaXMgY29uZmlndXJlZFxyXG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3Mub3duZXJOYW1lIHx8IHRoaXMuc2V0dGluZ3Mub3duZXJOYW1lLnRyaW0oKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ1Rhc2tFeHRyYWN0b3I6IE93bmVyIG5hbWUgbm90IGNvbmZpZ3VyZWQsIHNraXBwaW5nIHByb2Nlc3NpbmcnKTtcclxuICAgICAgICB0aGlzLmxvZygnZXJyb3InLCAndmFsaWRhdGlvbicsICdPd25lciBuYW1lIG5vdCBjb25maWd1cmVkJywgeyBcclxuICAgICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgICBvd25lck5hbWU6IHRoaXMuc2V0dGluZ3Mub3duZXJOYW1lXHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuZGVsZXRlKGZpbGUucGF0aCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyByZWFkIGZpbGUgY29udGVudFxyXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ0ZpbGUgY29udGVudCByZWFkLCBwcm9jZWVkaW5nIHRvIHRhc2sgZXh0cmFjdGlvbicsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IGZpbGUucGF0aCxcclxuICAgICAgICBjb250ZW50TGVuZ3RoOiBjb250ZW50Lmxlbmd0aFxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuXHJcbiAgICAgIC8vIGNhbGwgTExNXHJcbiAgICAgIGNvbnN0IGV4dHJhY3Rpb24gPSBhd2FpdCB0aGlzLmV4dHJhY3RUYXNrRnJvbUNvbnRlbnQoY29udGVudCwgZmlsZS5wYXRoLCBjb3JyZWxhdGlvbklkKTtcclxuXHJcbiAgICAgIGlmIChleHRyYWN0aW9uICYmIGV4dHJhY3Rpb24uZm91bmQpIHtcclxuICAgICAgICB0aGlzLmxvZygnaW5mbycsICdmaWxlLXByb2Nlc3NpbmcnLCAnVGFza3MgZm91bmQsIHByb2NlZWRpbmcgdG8gdGFzayBjcmVhdGlvbicsIHsgXHJcbiAgICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgICAgdGFza3NGb3VuZDogJ3Rhc2tzJyBpbiBleHRyYWN0aW9uID8gZXh0cmFjdGlvbi50YXNrcz8ubGVuZ3RoIDogMVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIC8vIEhhbmRsZSBib3RoIHNpbmdsZSB0YXNrIGFuZCBtdWx0aS10YXNrIHJlc3VsdHNcclxuICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVRhc2tFeHRyYWN0aW9uKGV4dHJhY3Rpb24sIGZpbGUsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2ZpbGUtcHJvY2Vzc2luZycsICdObyB0YXNrcyBmb3VuZCBpbiBmaWxlJywgeyBcclxuICAgICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGhcclxuICAgICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbWFyayBhcyBwcm9jZXNzZWQgaWYgY29uZmlndXJlZFxyXG4gICAgICBhd2FpdCB0aGlzLm1hcmtGaWxlUHJvY2Vzc2VkKGZpbGUsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gTWFyayBhcyBjb21wbGV0ZWRcclxuICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZ1F1ZXVlLmhhcyhmaWxlLnBhdGgpKSB7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nUXVldWUuZ2V0KGZpbGUucGF0aCkhLnN0YXR1cyA9ICdjb21wbGV0ZWQnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmxvZygnaW5mbycsICdmaWxlLXByb2Nlc3NpbmcnLCAnRmlsZSBwcm9jZXNzaW5nIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IERhdGUubm93KCkgLSAodGhpcy5wcm9jZXNzaW5nUXVldWUuZ2V0KGZpbGUucGF0aCk/LnN0YXJ0VGltZSB8fCBEYXRlLm5vdygpKVxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVGFza0V4dHJhY3RvciBlcnJvcicsIGVycik7XHJcbiAgICAgIG5ldyBOb3RpY2UoJ1Rhc2sgRXh0cmFjdG9yOiBlcnJvciBwcm9jZXNzaW5nIGZpbGUgXHUyMDE0IHNlZSBjb25zb2xlJyk7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmxvZygnZXJyb3InLCAnZXJyb3InLCAnRmlsZSBwcm9jZXNzaW5nIGZhaWxlZCB3aXRoIGVycm9yJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgIGVycm9yOiBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogU3RyaW5nKGVyciksXHJcbiAgICAgICAgc3RhY2s6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLnN0YWNrIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIHByb2Nlc3NpbmdUaW1lOiBEYXRlLm5vdygpIC0gKHRoaXMucHJvY2Vzc2luZ1F1ZXVlLmdldChmaWxlLnBhdGgpPy5zdGFydFRpbWUgfHwgRGF0ZS5ub3coKSlcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNYXJrIGFzIGZhaWxlZFxyXG4gICAgICBpZiAodGhpcy5wcm9jZXNzaW5nUXVldWUuaGFzKGZpbGUucGF0aCkpIHtcclxuICAgICAgICB0aGlzLnByb2Nlc3NpbmdRdWV1ZS5nZXQoZmlsZS5wYXRoKSEuc3RhdHVzID0gJ2ZhaWxlZCc7XHJcbiAgICAgIH1cclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIC8vIEd1YXJhbnRlZWQgY2xlYW51cCAtIGFsd2F5cyBleGVjdXRlcyByZWdhcmRsZXNzIG9mIGVycm9ycyBvciBlYXJseSByZXR1cm5zXHJcbiAgICAgIHRoaXMuY2xlYW51cEZpbGVQcm9jZXNzaW5nKGZpbGUucGF0aCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDZW50cmFsaXplZCBjbGVhbnVwIG1ldGhvZCBmb3IgYXRvbWljIHByb2Nlc3NpbmdcclxuICBwcml2YXRlIGNsZWFudXBGaWxlUHJvY2Vzc2luZyhmaWxlUGF0aDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnByb2Nlc3NpbmdRdWV1ZS5nZXQoZmlsZVBhdGgpO1xyXG4gICAgaWYgKHN0YXR1cz8udGltZW91dCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQoc3RhdHVzLnRpbWVvdXQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcm9jZXNzaW5nUXVldWUuZGVsZXRlKGZpbGVQYXRoKTtcclxuICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzLmRlbGV0ZShmaWxlUGF0aCk7XHJcbiAgfVxyXG5cclxuICAvLyBzY2FuIHZhdWx0IG9uY2Ugb24gbG9hZCBmb3IgdW5wcm9jZXNzZWQgbWF0Y2hpbmcgbm90ZXNcclxuICBhc3luYyBzY2FuRXhpc3RpbmdGaWxlcygpIHtcclxuICAgIGNvbnN0IGZpbGVzID0gdGhpcy5nZXRVbnByb2Nlc3NlZEZpbGVzKCk7XHJcbiAgICBjb25zdCBiYXRjaGVzID0gdGhpcy5jaHVua0FycmF5KGZpbGVzLCA1KTtcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBiYXRjaCBvZiBiYXRjaGVzKSB7XHJcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKGJhdGNoLm1hcChmID0+IHRoaXMub25GaWxlQ2hhbmdlZChmKSkpO1xyXG4gICAgICBhd2FpdCB0aGlzLmRlbGF5KDEwMCk7IC8vIFByZXZlbnQgVUkgYmxvY2tpbmdcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEdldCBsaXN0IG9mIHVucHJvY2Vzc2VkIGZpbGVzIHRoYXQgbWF0Y2ggdHJpZ2dlciBjcml0ZXJpYVxyXG4gIHByaXZhdGUgZ2V0VW5wcm9jZXNzZWRGaWxlcygpOiBURmlsZVtdIHtcclxuICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xyXG4gICAgY29uc3QgdW5wcm9jZXNzZWRGaWxlczogVEZpbGVbXSA9IFtdO1xyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IGYgb2YgZmlsZXMpIHtcclxuICAgICAgLy8gQXBwbHkgZXhjbHVzaW9uIGZpbHRlcnMgZmlyc3RcclxuICAgICAgaWYgKHRoaXMuaXNGaWxlRXhjbHVkZWQoZi5wYXRoKSkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGYpO1xyXG4gICAgICBjb25zdCBmcm9udCA9IGNhY2hlPy5mcm9udG1hdHRlcjtcclxuICAgICAgaWYgKCFmcm9udCkgY29udGludWU7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVc2UgdmFsaWRhdGVkIGZyb250bWF0dGVyIGZpZWxkIHdpdGggZmFsbGJhY2sgdG8gXCJUeXBlXCJcclxuICAgICAgY29uc3QgZnJvbnRtYXR0ZXJGaWVsZCA9IHRoaXMudmFsaWRhdGVGcm9udG1hdHRlckZpZWxkKHRoaXMuc2V0dGluZ3MudHJpZ2dlckZyb250bWF0dGVyRmllbGQpO1xyXG4gICAgICBjb25zdCB0eXBlUmF3ID0gdGhpcy5nZXRGcm9udG1hdHRlclZhbHVlKGZyb250LCBmcm9udG1hdHRlckZpZWxkKSB8fCAnJztcclxuICAgICAgY29uc3QgdHlwZSA9ICgnJyArIHR5cGVSYXcpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGNvbnN0IGFjY2VwdGVkID0gdGhpcy5zZXR0aW5ncy50cmlnZ2VyVHlwZXMubWFwKHQgPT4gdC50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgY29uc3QgcHJvY2Vzc2VkVmFsdWUgPSB0aGlzLmdldEZyb250bWF0dGVyVmFsdWUoZnJvbnQsIHRoaXMuc2V0dGluZ3MucHJvY2Vzc2VkRnJvbnRtYXR0ZXJLZXkpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGFjY2VwdGVkLmluY2x1ZGVzKHR5cGUpICYmICEocHJvY2Vzc2VkVmFsdWUgPT09IHRydWUgfHwgcHJvY2Vzc2VkVmFsdWUgPT09ICd0cnVlJykpIHtcclxuICAgICAgICB1bnByb2Nlc3NlZEZpbGVzLnB1c2goZik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHVucHJvY2Vzc2VkRmlsZXM7XHJcbiAgfVxyXG5cclxuICAvLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNodW5rIGFycmF5IGludG8gc21hbGxlciBiYXRjaGVzXHJcbiAgcHJpdmF0ZSBjaHVua0FycmF5PFQ+KGFycmF5OiBUW10sIHNpemU6IG51bWJlcik6IFRbXVtdIHtcclxuICAgIGNvbnN0IGNodW5rczogVFtdW10gPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICs9IHNpemUpIHtcclxuICAgICAgY2h1bmtzLnB1c2goYXJyYXkuc2xpY2UoaSwgaSArIHNpemUpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjaHVua3M7XHJcbiAgfVxyXG5cclxuICAvLyBVdGlsaXR5IGZ1bmN0aW9uIGZvciBkZWxheXNcclxuICBwcml2YXRlIGRlbGF5KG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RnJvbnRtYXR0ZXJWYWx1ZShmcm9udDogYW55LCBrZXk6IHN0cmluZykge1xyXG4gICAgLy8gU3VwcG9ydCBuZXN0ZWQga2V5cyBsaWtlIFwidGFza0V4dHJhY3Rvci5wcm9jZXNzZWRcIlxyXG4gICAgaWYgKCFmcm9udCkgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIGlmIChrZXkuaW5jbHVkZXMoJy4nKSkge1xyXG4gICAgICBjb25zdCBwYXJ0cyA9IGtleS5zcGxpdCgnLicpO1xyXG4gICAgICBsZXQgY3VyID0gZnJvbnQ7XHJcbiAgICAgIGZvciAoY29uc3QgcCBvZiBwYXJ0cykge1xyXG4gICAgICAgIGlmICghY3VyKSByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIGN1ciA9IGN1cltwXTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gY3VyO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZyb250W2tleV07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIG1hcmtGaWxlUHJvY2Vzc2VkKGZpbGU6IFRGaWxlLCBjb3JyZWxhdGlvbklkPzogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MucHJvY2Vzc2VkRnJvbnRtYXR0ZXJLZXkpIHtcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ1NraXBwaW5nIHByb2Nlc3NlZCBtYXJrZXI6IG5vIHByb2Nlc3NlZCBmcm9udG1hdHRlciBrZXkgY29uZmlndXJlZCcsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IGZpbGUucGF0aCBcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVXNlIE9ic2lkaWFuJ3Mgb2ZmaWNpYWwgQVBJIGZvciBhdG9taWMgZnJvbnRtYXR0ZXIgcHJvY2Vzc2luZ1xyXG4gICAgICBhd2FpdCB0aGlzLmFwcC5maWxlTWFuYWdlci5wcm9jZXNzRnJvbnRNYXR0ZXIoZmlsZSwgKGZyb250bWF0dGVyKSA9PiB7XHJcbiAgICAgICAgLy8gSGFuZGxlIG5lc3RlZCBrZXlzIChlLmcuLCBcInRhc2tFeHRyYWN0b3IucHJvY2Vzc2VkXCIpXHJcbiAgICAgICAgY29uc3Qga2V5cyA9IHRoaXMuc2V0dGluZ3MucHJvY2Vzc2VkRnJvbnRtYXR0ZXJLZXkuc3BsaXQoJy4nKTtcclxuICAgICAgICBsZXQgY3VycmVudCA9IGZyb250bWF0dGVyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIE5hdmlnYXRlIHRvIHRoZSBuZXN0ZWQgcHJvcGVydHksIGNyZWF0aW5nIG9iamVjdHMgYXMgbmVlZGVkXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcclxuICAgICAgICAgIGlmICghY3VycmVudFtrZXldIHx8IHR5cGVvZiBjdXJyZW50W2tleV0gIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRba2V5XSA9IHt9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRba2V5XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2V0IHRoZSBmaW5hbCBwcm9wZXJ0eVxyXG4gICAgICAgIGN1cnJlbnRba2V5c1trZXlzLmxlbmd0aCAtIDFdXSA9IHRydWU7XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnZmlsZS1wcm9jZXNzaW5nJywgJ0ZpbGUgbWFya2VkIGFzIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgcHJvY2Vzc2VkS2V5OiB0aGlzLnNldHRpbmdzLnByb2Nlc3NlZEZyb250bWF0dGVyS2V5XHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBtYXJrIGZpbGUgcHJvY2Vzc2VkIHdpdGggb2ZmaWNpYWwgQVBJOicsIGUpO1xyXG4gICAgICB0aGlzLmxvZygnd2FybicsICdmaWxlLXByb2Nlc3NpbmcnLCAnRmFpbGVkIHRvIG1hcmsgZmlsZSBwcm9jZXNzZWQgd2l0aCBvZmZpY2lhbCBBUEksIHRyeWluZyBmYWxsYmFjaycsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IGZpbGUucGF0aCxcclxuICAgICAgICBlcnJvcjogZSBpbnN0YW5jZW9mIEVycm9yID8gZS5tZXNzYWdlIDogU3RyaW5nKGUpXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAvLyBGYWxsYmFjayB0byBwcmV2aW91cyBtZXRob2QgaWYgdGhlIG9mZmljaWFsIEFQSSBmYWlsc1xyXG4gICAgICBhd2FpdCB0aGlzLm1hcmtGaWxlUHJvY2Vzc2VkRmFsbGJhY2soZmlsZSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBGYWxsYmFjayBtZXRob2QgdXNpbmcgdGhlIHByZXZpb3VzIGltcGxlbWVudGF0aW9uXHJcbiAgcHJpdmF0ZSBhc3luYyBtYXJrRmlsZVByb2Nlc3NlZEZhbGxiYWNrKGZpbGU6IFRGaWxlLCBjb3JyZWxhdGlvbklkPzogc3RyaW5nKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcclxuICAgICAgY29uc3QgZm1NYXRjaCA9IGNvbnRlbnQubWF0Y2goL14tLS1cXG4oW1xcc1xcU10qPylcXG4tLS0vKTtcclxuICAgICAgbGV0IG5ld0NvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgICBpZiAoZm1NYXRjaCkge1xyXG4gICAgICAgIGNvbnN0IGZtID0gZm1NYXRjaFsxXTtcclxuICAgICAgICBjb25zdCBwcm9jZXNzZWRLZXkgPSB0aGlzLnNldHRpbmdzLnByb2Nlc3NlZEZyb250bWF0dGVyS2V5O1xyXG4gICAgICAgIC8vIGlmIGFscmVhZHkgcHJlc2VudCwgc2tpcFxyXG4gICAgICAgIGlmICghbmV3IFJlZ0V4cCgnXicgKyBwcm9jZXNzZWRLZXkucmVwbGFjZSgnLicsICdcXFxcLicpICsgJzonLCAnbScpLnRlc3QoZm0pKSB7XHJcbiAgICAgICAgICBjb25zdCBsaW5lcyA9IGZtLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgIGxpbmVzLnB1c2goYCR7cHJvY2Vzc2VkS2V5fTogdHJ1ZWApO1xyXG4gICAgICAgICAgY29uc3QgdXBkYXRlZEZtID0gbGluZXMuam9pbignXFxuJyk7XHJcbiAgICAgICAgICBuZXdDb250ZW50ID0gY29udGVudC5yZXBsYWNlKGZtTWF0Y2hbMF0sIGAtLS1cXG4ke3VwZGF0ZWRGbX1cXG4tLS1gKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBuZXdDb250ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gbm8gZnJvbnRtYXR0ZXIgXHUyMDE0IGNyZWF0ZSBvbmVcclxuICAgICAgICBjb25zdCBwcm9jZXNzZWRLZXkgPSB0aGlzLnNldHRpbmdzLnByb2Nlc3NlZEZyb250bWF0dGVyS2V5O1xyXG4gICAgICAgIG5ld0NvbnRlbnQgPSBgLS0tXFxuJHtwcm9jZXNzZWRLZXl9OiB0cnVlXFxuLS0tXFxuXFxuYCArIGNvbnRlbnQ7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIG5ld0NvbnRlbnQpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2ZpbGUtcHJvY2Vzc2luZycsICdGaWxlIG1hcmtlZCBhcyBwcm9jZXNzZWQgdXNpbmcgZmFsbGJhY2sgbWV0aG9kJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogZmlsZS5wYXRoLFxyXG4gICAgICAgIHByb2Nlc3NlZEtleTogdGhpcy5zZXR0aW5ncy5wcm9jZXNzZWRGcm9udG1hdHRlcktleVxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gbWFyayBmaWxlIHByb2Nlc3NlZCB3aXRoIGZhbGxiYWNrIG1ldGhvZDonLCBlKTtcclxuICAgICAgdGhpcy5sb2coJ2Vycm9yJywgJ2ZpbGUtcHJvY2Vzc2luZycsICdGYWlsZWQgdG8gbWFyayBmaWxlIHByb2Nlc3NlZCB3aXRoIGZhbGxiYWNrIG1ldGhvZCcsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IGZpbGUucGF0aCxcclxuICAgICAgICBlcnJvcjogZSBpbnN0YW5jZW9mIEVycm9yID8gZS5tZXNzYWdlIDogU3RyaW5nKGUpXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gU2hhcmVkIG1ldGhvZCBmb3IgY29uc3RydWN0aW5nIHByb21wdHNcclxuICBwcml2YXRlIGJ1aWxkRXh0cmFjdGlvblByb21wdChzb3VyY2VQYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IHsgc3lzdGVtOiBzdHJpbmcsIHVzZXI6IHN0cmluZyB9IHtcclxuICAgIC8vIFVzZSBjdXN0b20gcHJvbXB0IGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgdXNlIGVuaGFuY2VkIGRlZmF1bHRcclxuICAgIGNvbnN0IGJhc2VQcm9tcHQgPSB0aGlzLnNldHRpbmdzLmN1c3RvbVByb21wdCB8fCBcclxuICAgICAgYFlvdSBhcmUgYSB0YXNrIGV4dHJhY3Rpb24gc3BlY2lhbGlzdC4gRXh0cmFjdCBhY3Rpb25hYmxlIHRhc2tzIGZyb20gZW1haWxzIGFuZCBtZWV0aW5nIG5vdGVzIGZvbGxvd2luZyB0aGVzZSBzdHJpY3QgcnVsZXM6XHJcblxyXG5FWFRSQUNUSU9OIFJVTEVTOlxyXG4tIEV4dHJhY3QgT05MWSBjb25jcmV0ZSwgYWN0aW9uYWJsZSB0YXNrcyBleHBsaWNpdGx5IHN0YXRlZCBvciBjbGVhcmx5IGltcGxpZWRcclxuLSBVc2UgbnVsbCBmb3IgdW5jZXJ0YWluL21pc3NpbmcgaW5mb3JtYXRpb24gLSBETyBOT1QgR1VFU1NcclxuLSBFeHRyYWN0IHRhc2tzIG9ubHkgZm9yIHRoZSBzcGVjaWZpZWQgcGVyc29uOiAke3RoaXMuc2V0dGluZ3Mub3duZXJOYW1lfSAoZXhhY3QgbmFtZSlcclxuLSBJZiBubyBjbGVhciB0YXNrcyBleGlzdCwgcmV0dXJuIHtcImZvdW5kXCI6IGZhbHNlLCBcInRhc2tzXCI6IFtdfVxyXG5cclxuUFJJT1JJVFkgR1VJREVMSU5FUzpcclxuLSBoaWdoOiBleHBsaWNpdCB1cmdlbmN5L2RlYWRsaW5lIG1lbnRpb25lZFxyXG4tIG1lZGl1bTogc3RhbmRhcmQgcmVxdWVzdHMgd2l0aG91dCB0aW1lIHByZXNzdXJlICBcclxuLSBsb3c6IG9wdGlvbmFsL2JhY2tncm91bmQgaXRlbXNcclxuXHJcblZBTElEQVRJT04gQ09OU1RSQUlOVFM6XHJcbi0gdGFza190aXRsZTogNi0xMDAgY2hhcmFjdGVycywgYWN0aW9uYWJsZSBwaHJhc2luZ1xyXG4tIHRhc2tfZGV0YWlsczogbWF4IDMwMCBjaGFyYWN0ZXJzLCBjb25jcmV0ZSBkZXNjcmlwdGlvblxyXG4tIGR1ZV9kYXRlOiBZWVlZLU1NLUREIGZvcm1hdCBvbmx5IGlmIGV4cGxpY2l0bHkgbWVudGlvbmVkXHJcbi0gc291cmNlX2V4Y2VycHQ6IGV4YWN0IHF1b3RlIChtYXggMTUwIGNoYXJzKSBqdXN0aWZ5aW5nIGV4dHJhY3Rpb25cclxuXHJcblJldHVybiB2YWxpZCBKU09OIG9ubHkuIEJlIGNvbnNlcnZhdGl2ZSAtIGFjY3VyYWN5IG92ZXIgY29tcGxldGVuZXNzLmA7XHJcbiAgICBcclxuICAgIC8vIEdlbmVyYXRlIGZpZWxkIGRlc2NyaXB0aW9ucyBmcm9tIGZyb250bWF0dGVyIHNldHRpbmdzXHJcbiAgICBjb25zdCBmaWVsZERlc2NyaXB0aW9ucyA9IHRoaXMuc2V0dGluZ3MuZnJvbnRtYXR0ZXJGaWVsZHNcclxuICAgICAgLmZpbHRlcihmID0+IGYucmVxdWlyZWQgfHwgZi5rZXkgPT09ICd0YXNrX3RpdGxlJyB8fCBmLmtleSA9PT0gJ3Rhc2tfZGV0YWlscycpXHJcbiAgICAgIC5tYXAoZiA9PiB7XHJcbiAgICAgICAgaWYgKGYua2V5ID09PSAndGFzaycgfHwgZi5rZXkgPT09ICd0YXNrX3RpdGxlJykgcmV0dXJuICctIHRhc2tfdGl0bGU6IHNob3J0ICg2LTEwMCB3b3JkcykgYWN0aW9uYWJsZSB0aXRsZSc7XHJcbiAgICAgICAgaWYgKGYua2V5ID09PSAndGFza19kZXRhaWxzJykgcmV0dXJuICctIHRhc2tfZGV0YWlsczogMS0zIHNlbnRlbmNlcyBkZXNjcmliaW5nIHdoYXQgdG8gZG8gYW5kIGFueSBjb250ZXh0JztcclxuICAgICAgICBpZiAoZi5rZXkgPT09ICdkdWUnKSByZXR1cm4gJy0gZHVlX2RhdGU6IElTTyBkYXRlIFlZWVktTU0tREQgaWYgZXhwbGljaXRseSBwcmVzZW50IGluIHRoZSB0ZXh0LCBvdGhlcndpc2UgbnVsbCc7XHJcbiAgICAgICAgaWYgKGYua2V5ID09PSAncHJpb3JpdHknKSByZXR1cm4gYC0gcHJpb3JpdHk6ICR7Zi5vcHRpb25zPy5qb2luKCd8JykgfHwgJ2hpZ2h8bWVkaXVtfGxvdyd9IChjaG9vc2UgYmVzdCBtYXRjaClgO1xyXG4gICAgICAgIGlmIChmLmtleSA9PT0gJ3Byb2plY3QnKSByZXR1cm4gJy0gcHJvamVjdDogcHJvamVjdCBuYW1lIGlmIG1lbnRpb25lZCwgb3RoZXJ3aXNlIG51bGwnO1xyXG4gICAgICAgIGlmIChmLmtleSA9PT0gJ2NsaWVudCcpIHJldHVybiAnLSBjbGllbnQ6IGNsaWVudCBuYW1lIGlmIG1lbnRpb25lZCwgb3RoZXJ3aXNlIG51bGwnO1xyXG4gICAgICAgIHJldHVybiBgLSAke2Yua2V5fTogJHtmLmRlZmF1bHRWYWx1ZSB8fCAnYXBwcm9wcmlhdGUgdmFsdWUgYmFzZWQgb24gY29udGV4dCd9YDtcclxuICAgICAgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHN5c3RlbSA9IGAke2Jhc2VQcm9tcHR9XHJcblxyXG5XaGVuIHRhc2tzIGFyZSBmb3VuZCwgcmV0dXJuIEpTT04gaW4gdGhpcyBmb3JtYXQ6XHJcbntcclxuICBcImZvdW5kXCI6IHRydWUsXHJcbiAgXCJ0YXNrc1wiOiBbXHJcbiAgICB7XHJcbiAgICAgICR7ZmllbGREZXNjcmlwdGlvbnMuam9pbignLFxcbiAgICAgICcpfSxcclxuICAgICAgXCJzb3VyY2VfZXhjZXJwdFwiOiBcImV4YWN0IHF1b3RlIGZyb20gc291cmNlIChtYXggMTUwIGNoYXJzKVwiLFxyXG4gICAgICBcImNvbmZpZGVuY2VcIjogXCJoaWdofG1lZGl1bXxsb3dcIlxyXG4gICAgfVxyXG4gIF0sXHJcbiAgXCJjb25maWRlbmNlXCI6IFwiaGlnaHxtZWRpdW18bG93XCJcclxufVxyXG5cclxuV2hlbiBubyB0YXNrcyBmb3VuZCwgcmV0dXJuOiB7XCJmb3VuZFwiOiBmYWxzZSwgXCJ0YXNrc1wiOiBbXX1gO1xyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBgU09VUkNFX1BBVEg6ICR7c291cmNlUGF0aH1cXG4tLS1CRUdJTiBOT1RFLS0tXFxuJHtjb250ZW50fVxcbi0tLUVORCBOT1RFLS0tYDtcclxuXHJcbiAgICByZXR1cm4geyBzeXN0ZW0sIHVzZXIgfTtcclxuICB9XHJcblxyXG4gIC8vIE5ldyBtZXRob2QgZm9yIG11bHRpLXRhc2sgZXh0cmFjdGlvblxyXG4gIGFzeW5jIGV4dHJhY3RNdWx0aXBsZVRhc2tzRnJvbUNvbnRlbnQoY29udGVudDogc3RyaW5nLCBzb3VyY2VQYXRoOiBzdHJpbmcsIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPFRhc2tFeHRyYWN0aW9uUmVzdWx0PiB7XHJcbiAgICBjb25zdCB7IHN5c3RlbSwgdXNlciB9ID0gdGhpcy5idWlsZEV4dHJhY3Rpb25Qcm9tcHQoc291cmNlUGF0aCwgY29udGVudCk7XHJcblxyXG4gICAgdGhpcy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCAnTExNIHByb21wdCBjb25zdHJ1Y3RlZCBmb3IgbXVsdGktdGFzayBleHRyYWN0aW9uJywgeyBcclxuICAgICAgZmlsZVBhdGg6IHNvdXJjZVBhdGgsXHJcbiAgICAgIHN5c3RlbVByb21wdExlbmd0aDogc3lzdGVtLmxlbmd0aCxcclxuICAgICAgdXNlclByb21wdExlbmd0aDogdXNlci5sZW5ndGgsXHJcbiAgICAgIGNvbnRlbnRMZW5ndGg6IGNvbnRlbnQubGVuZ3RoXHJcbiAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByYXcgPSBhd2FpdCB0aGlzLmxsbVByb3ZpZGVyLmNhbGxMTE0oc3lzdGVtLCB1c2VyKTtcclxuICAgICAgXHJcbiAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ0xMTSByZXNwb25zZSByZWNlaXZlZCBmb3IgbXVsdGktdGFzayBleHRyYWN0aW9uJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogc291cmNlUGF0aCxcclxuICAgICAgICByZXNwb25zZUxlbmd0aDogcmF3Py5sZW5ndGggfHwgMCxcclxuICAgICAgICByZXNwb25zZVByZXZpZXc6IHJhdz8uc3Vic3RyaW5nKDAsIDIwMCkgfHwgJ251bGwnXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG5cclxuICAgICAgY29uc3QgcGFyc2VkID0gdGhpcy5zYWZlUGFyc2VKU09OKHJhdyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXBhcnNlZCkge1xyXG4gICAgICAgIHRoaXMubG9nKCd3YXJuJywgJ2xsbS1jYWxsJywgJ0ZhaWxlZCB0byBwYXJzZSBMTE0gcmVzcG9uc2UgYXMgSlNPTiBmb3IgbXVsdGktdGFzayBleHRyYWN0aW9uJywgeyBcclxuICAgICAgICAgIGZpbGVQYXRoOiBzb3VyY2VQYXRoLFxyXG4gICAgICAgICAgcmF3UmVzcG9uc2U6IHJhd1xyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIHJldHVybiB7IGZvdW5kOiBmYWxzZSwgdGFza3M6IFtdIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ0xMTSByZXNwb25zZSBwYXJzZWQgc3VjY2Vzc2Z1bGx5IGZvciBtdWx0aS10YXNrIGV4dHJhY3Rpb24nLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBzb3VyY2VQYXRoLFxyXG4gICAgICAgIHBhcnNlZFN0cnVjdHVyZTogT2JqZWN0LmtleXMocGFyc2VkKSxcclxuICAgICAgICBmb3VuZDogcGFyc2VkLmZvdW5kIHx8IGZhbHNlLFxyXG4gICAgICAgIHRhc2tzQ291bnQ6IHBhcnNlZC50YXNrcz8ubGVuZ3RoIHx8IDBcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiBpdCdzIGFscmVhZHkgaW4gdGhlIG5ldyBmb3JtYXQsIHJldHVybiBpdFxyXG4gICAgICBpZiAoJ3Rhc2tzJyBpbiBwYXJzZWQgJiYgQXJyYXkuaXNBcnJheShwYXJzZWQudGFza3MpKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhcnNlZCBhcyBUYXNrRXh0cmFjdGlvblJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQ29udmVydCBsZWdhY3kgZm9ybWF0IHRvIG5ldyBmb3JtYXRcclxuICAgICAgaWYgKCdmb3VuZCcgaW4gcGFyc2VkICYmIHBhcnNlZC5mb3VuZCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBmb3VuZDogdHJ1ZSxcclxuICAgICAgICAgIHRhc2tzOiBbe1xyXG4gICAgICAgICAgICB0YXNrX3RpdGxlOiBwYXJzZWQudGFza190aXRsZSB8fCAnVW5zcGVjaWZpZWQgdGFzaycsXHJcbiAgICAgICAgICAgIHRhc2tfZGV0YWlsczogcGFyc2VkLnRhc2tfZGV0YWlscyB8fCAnJyxcclxuICAgICAgICAgICAgZHVlX2RhdGU6IHBhcnNlZC5kdWVfZGF0ZSB8fCBudWxsLFxyXG4gICAgICAgICAgICBwcmlvcml0eTogcGFyc2VkLnByaW9yaXR5IHx8ICdtZWRpdW0nLFxyXG4gICAgICAgICAgICBwcm9qZWN0OiBwYXJzZWQucHJvamVjdCB8fCBudWxsLFxyXG4gICAgICAgICAgICBjbGllbnQ6IHBhcnNlZC5jbGllbnQgfHwgbnVsbCxcclxuICAgICAgICAgICAgc291cmNlX2V4Y2VycHQ6IHBhcnNlZC5zb3VyY2VfZXhjZXJwdCB8fCAnJyxcclxuICAgICAgICAgICAgY29uZmlkZW5jZTogcGFyc2VkLmNvbmZpZGVuY2UgfHwgJ21lZGl1bSdcclxuICAgICAgICAgIH1dXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgZm91bmQ6IGZhbHNlLCB0YXNrczogW10gfTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignZXh0cmFjdE11bHRpcGxlVGFza3NGcm9tQ29udGVudCBlcnJvcicsIGUpO1xyXG4gICAgICB0aGlzLmxvZygnZXJyb3InLCAnbGxtLWNhbGwnLCAnTXVsdGktdGFzayBleHRyYWN0aW9uIGZhaWxlZCB3aXRoIGVycm9yJywgeyBcclxuICAgICAgICBmaWxlUGF0aDogc291cmNlUGF0aCxcclxuICAgICAgICBlcnJvcjogZSBpbnN0YW5jZW9mIEVycm9yID8gZS5tZXNzYWdlIDogU3RyaW5nKGUpLFxyXG4gICAgICAgIHN0YWNrOiBlIGluc3RhbmNlb2YgRXJyb3IgPyBlLnN0YWNrIDogdW5kZWZpbmVkXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICByZXR1cm4geyBmb3VuZDogZmFsc2UsIHRhc2tzOiBbXSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gSGFuZGxlIHRhc2sgZXh0cmFjdGlvbiByZXN1bHRzIChib3RoIHNpbmdsZSBhbmQgbXVsdGktdGFzaylcclxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVRhc2tFeHRyYWN0aW9uKGV4dHJhY3Rpb246IFRhc2tFeHRyYWN0aW9uIHwgVGFza0V4dHJhY3Rpb25SZXN1bHQsIHNvdXJjZUZpbGU6IFRGaWxlLCBjb3JyZWxhdGlvbklkPzogc3RyaW5nKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDaGVjayBpZiBpdCdzIHRoZSBuZXcgbXVsdGktdGFzayBmb3JtYXRcclxuICAgICAgaWYgKCd0YXNrcycgaW4gZXh0cmFjdGlvbiAmJiBBcnJheS5pc0FycmF5KGV4dHJhY3Rpb24udGFza3MpKSB7XHJcbiAgICAgICAgdGhpcy5sb2coJ2luZm8nLCAndGFzay1jcmVhdGlvbicsICdQcm9jZXNzaW5nIG11bHRpLXRhc2sgZXh0cmFjdGlvbiByZXN1bHQnLCB7IFxyXG4gICAgICAgICAgZmlsZVBhdGg6IHNvdXJjZUZpbGUucGF0aCxcclxuICAgICAgICAgIHRhc2tzQ291bnQ6IGV4dHJhY3Rpb24udGFza3MubGVuZ3RoXHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcblxyXG4gICAgICAgIGxldCBjcmVhdGVkQ291bnQgPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgdGFzayBvZiBleHRyYWN0aW9uLnRhc2tzKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVRhc2tOb3RlKHRhc2ssIHNvdXJjZUZpbGUsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgICAgICBjcmVhdGVkQ291bnQrKztcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgdGFzayBub3RlIGZvcjogJHt0YXNrLnRhc2tfdGl0bGV9YCwgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aGlzLmxvZygnZXJyb3InLCAndGFzay1jcmVhdGlvbicsICdGYWlsZWQgdG8gY3JlYXRlIGluZGl2aWR1YWwgdGFzayBub3RlJywgeyBcclxuICAgICAgICAgICAgICBmaWxlUGF0aDogc291cmNlRmlsZS5wYXRoLFxyXG4gICAgICAgICAgICAgIHRhc2tUaXRsZTogdGFzay50YXNrX3RpdGxlLFxyXG4gICAgICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcclxuICAgICAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMubG9nKCdpbmZvJywgJ3Rhc2stY3JlYXRpb24nLCAnTXVsdGktdGFzayBjcmVhdGlvbiBjb21wbGV0ZWQnLCB7IFxyXG4gICAgICAgICAgZmlsZVBhdGg6IHNvdXJjZUZpbGUucGF0aCxcclxuICAgICAgICAgIHRvdGFsVGFza3M6IGV4dHJhY3Rpb24udGFza3MubGVuZ3RoLFxyXG4gICAgICAgICAgY3JlYXRlZENvdW50LFxyXG4gICAgICAgICAgZmFpbGVkQ291bnQ6IGV4dHJhY3Rpb24udGFza3MubGVuZ3RoIC0gY3JlYXRlZENvdW50XHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGNyZWF0ZWRDb3VudCA+IDApIHtcclxuICAgICAgICAgIG5ldyBOb3RpY2UoYFRhc2sgRXh0cmFjdG9yOiBjcmVhdGVkICR7Y3JlYXRlZENvdW50fSB0YXNrIG5vdGUke2NyZWF0ZWRDb3VudCAhPT0gMSA/ICdzJyA6ICcnfWApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBIYW5kbGUgbGVnYWN5IHNpbmdsZS10YXNrIGZvcm1hdFxyXG4gICAgICAgIHRoaXMubG9nKCdpbmZvJywgJ3Rhc2stY3JlYXRpb24nLCAnUHJvY2Vzc2luZyBzaW5nbGUtdGFzayBleHRyYWN0aW9uIHJlc3VsdCcsIHsgXHJcbiAgICAgICAgICBmaWxlUGF0aDogc291cmNlRmlsZS5wYXRoLFxyXG4gICAgICAgICAgdGFza1RpdGxlOiAoZXh0cmFjdGlvbiBhcyBUYXNrRXh0cmFjdGlvbikudGFza190aXRsZVxyXG4gICAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG5cclxuICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVRhc2tOb3RlKGV4dHJhY3Rpb24gYXMgVGFza0V4dHJhY3Rpb24sIHNvdXJjZUZpbGUsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICAgIG5ldyBOb3RpY2UoYFRhc2sgRXh0cmFjdG9yOiBjcmVhdGVkIHRhc2sgXCIkeyhleHRyYWN0aW9uIGFzIFRhc2tFeHRyYWN0aW9uKS50YXNrX3RpdGxlfVwiYCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIHRhc2sgZXh0cmFjdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHRoaXMubG9nKCdlcnJvcicsICd0YXNrLWNyZWF0aW9uJywgJ1Rhc2sgZXh0cmFjdGlvbiBoYW5kbGluZyBmYWlsZWQnLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBzb3VyY2VGaWxlLnBhdGgsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcclxuICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBuZXcgTm90aWNlKCdUYXNrIEV4dHJhY3RvcjogZXJyb3IgY3JlYXRpbmcgdGFzayBub3RlcyBcdTIwMTQgc2VlIGNvbnNvbGUnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENvbXBvc2UgcHJvbXB0LCBjYWxsIExMTSwgYW5kIHBhcnNlIHJlc3BvbnNlIChsZWdhY3kgbWV0aG9kIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KVxyXG4gIHByaXZhdGUgYXN5bmMgZXh0cmFjdFRhc2tGcm9tQ29udGVudChjb250ZW50OiBzdHJpbmcsIHNvdXJjZVBhdGg6IHN0cmluZywgY29ycmVsYXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8VGFza0V4dHJhY3Rpb24+IHtcclxuICAgIGNvbnN0IHsgc3lzdGVtLCB1c2VyIH0gPSB0aGlzLmJ1aWxkRXh0cmFjdGlvblByb21wdChzb3VyY2VQYXRoLCBjb250ZW50KTtcclxuXHJcbiAgICB0aGlzLmxvZygnaW5mbycsICdsbG0tY2FsbCcsICdMTE0gcHJvbXB0IGNvbnN0cnVjdGVkIGZvciB0YXNrIGV4dHJhY3Rpb24nLCB7IFxyXG4gICAgICBmaWxlUGF0aDogc291cmNlUGF0aCxcclxuICAgICAgc3lzdGVtUHJvbXB0TGVuZ3RoOiBzeXN0ZW0ubGVuZ3RoLFxyXG4gICAgICB1c2VyUHJvbXB0TGVuZ3RoOiB1c2VyLmxlbmd0aCxcclxuICAgICAgY29udGVudExlbmd0aDogY29udGVudC5sZW5ndGhcclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJhdyA9IGF3YWl0IHRoaXMubGxtUHJvdmlkZXIuY2FsbExMTShzeXN0ZW0sIHVzZXIpO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAnbGxtLWNhbGwnLCAnTExNIHJlc3BvbnNlIHJlY2VpdmVkIGZvciB0YXNrIGV4dHJhY3Rpb24nLCB7IFxyXG4gICAgICAgIGZpbGVQYXRoOiBzb3VyY2VQYXRoLFxyXG4gICAgICAgIHJlc3BvbnNlTGVuZ3RoOiByYXc/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICAgIHJlc3BvbnNlUHJldmlldzogcmF3Py5zdWJzdHJpbmcoMCwgMjAwKSB8fCAnbnVsbCdcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcblxyXG4gICAgICBjb25zdCBwYXJzZWQgPSB0aGlzLnNhZmVQYXJzZUpTT04ocmF3KTtcclxuICAgICAgaWYgKCFwYXJzZWQpIHtcclxuICAgICAgICB0aGlzLmxvZygnd2FybicsICdsbG0tY2FsbCcsICdGYWlsZWQgdG8gcGFyc2UgTExNIHJlc3BvbnNlIGFzIEpTT04nLCB7IFxyXG4gICAgICAgICAgZmlsZVBhdGg6IHNvdXJjZVBhdGgsXHJcbiAgICAgICAgICByYXdSZXNwb25zZTogcmF3XHJcbiAgICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgICAgcmV0dXJuIHsgZm91bmQ6IGZhbHNlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubG9nKCdpbmZvJywgJ2xsbS1jYWxsJywgJ0xMTSByZXNwb25zZSBwYXJzZWQgc3VjY2Vzc2Z1bGx5JywgeyBcclxuICAgICAgICBmaWxlUGF0aDogc291cmNlUGF0aCxcclxuICAgICAgICBwYXJzZWRTdHJ1Y3R1cmU6IE9iamVjdC5rZXlzKHBhcnNlZCksXHJcbiAgICAgICAgZm91bmQ6IHBhcnNlZC5mb3VuZCB8fCBmYWxzZSxcclxuICAgICAgICB0YXNrc0NvdW50OiBwYXJzZWQudGFza3M/Lmxlbmd0aCB8fCAocGFyc2VkLmZvdW5kID8gMSA6IDApXHJcbiAgICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gSGFuZGxlIG5ldyBtdWx0aS10YXNrIGZvcm1hdFxyXG4gICAgICBpZiAocGFyc2VkLnRhc2tzICYmIEFycmF5LmlzQXJyYXkocGFyc2VkLnRhc2tzKSkge1xyXG4gICAgICAgIC8vIFJldHVybiBmaXJzdCB0YXNrIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XHJcbiAgICAgICAgaWYgKHBhcnNlZC50YXNrcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjb25zdCBmaXJzdFRhc2sgPSBwYXJzZWQudGFza3NbMF07XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBmb3VuZDogdHJ1ZSxcclxuICAgICAgICAgICAgdGFza190aXRsZTogZmlyc3RUYXNrLnRhc2tfdGl0bGUgfHwgJ1Vuc3BlY2lmaWVkIHRhc2snLFxyXG4gICAgICAgICAgICB0YXNrX2RldGFpbHM6IGZpcnN0VGFzay50YXNrX2RldGFpbHMgfHwgJycsXHJcbiAgICAgICAgICAgIGR1ZV9kYXRlOiBmaXJzdFRhc2suZHVlX2RhdGUgfHwgbnVsbCxcclxuICAgICAgICAgICAgcHJpb3JpdHk6IGZpcnN0VGFzay5wcmlvcml0eSB8fCAnbWVkaXVtJyxcclxuICAgICAgICAgICAgc291cmNlX2V4Y2VycHQ6IGZpcnN0VGFzay5zb3VyY2VfZXhjZXJwdCB8fCAnJyxcclxuICAgICAgICAgICAgLi4uZmlyc3RUYXNrIC8vIEluY2x1ZGUgYW55IGFkZGl0aW9uYWwgZXh0cmFjdGVkIGZpZWxkc1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHsgZm91bmQ6IGZhbHNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBIYW5kbGUgbGVnYWN5IHNpbmdsZS10YXNrIGZvcm1hdFxyXG4gICAgICBpZiAoIXBhcnNlZC5mb3VuZCkgcmV0dXJuIHsgZm91bmQ6IGZhbHNlIH07XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZm91bmQ6IHRydWUsXHJcbiAgICAgICAgdGFza190aXRsZTogcGFyc2VkLnRhc2tfdGl0bGUgfHwgcGFyc2VkLnRpdGxlIHx8ICdVbnNwZWNpZmllZCB0YXNrJyxcclxuICAgICAgICB0YXNrX2RldGFpbHM6IHBhcnNlZC50YXNrX2RldGFpbHMgfHwgcGFyc2VkLmRldGFpbHMgfHwgJycsXHJcbiAgICAgICAgZHVlX2RhdGU6IHBhcnNlZC5kdWVfZGF0ZSB8fCBudWxsLFxyXG4gICAgICAgIHByaW9yaXR5OiBwYXJzZWQucHJpb3JpdHkgfHwgJ21lZGl1bScsXHJcbiAgICAgICAgc291cmNlX2V4Y2VycHQ6IHBhcnNlZC5zb3VyY2VfZXhjZXJwdCB8fCAnJyxcclxuICAgICAgICAuLi5wYXJzZWQgLy8gSW5jbHVkZSBhbnkgYWRkaXRpb25hbCBleHRyYWN0ZWQgZmllbGRzXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2V4dHJhY3RUYXNrRnJvbUNvbnRlbnQgZXJyb3InLCBlKTtcclxuICAgICAgdGhpcy5sb2coJ2Vycm9yJywgJ2xsbS1jYWxsJywgJ1Rhc2sgZXh0cmFjdGlvbiBmYWlsZWQgd2l0aCBlcnJvcicsIHsgXHJcbiAgICAgICAgZmlsZVBhdGg6IHNvdXJjZVBhdGgsXHJcbiAgICAgICAgZXJyb3I6IGUgaW5zdGFuY2VvZiBFcnJvciA/IGUubWVzc2FnZSA6IFN0cmluZyhlKSxcclxuICAgICAgICBzdGFjazogZSBpbnN0YW5jZW9mIEVycm9yID8gZS5zdGFjayA6IHVuZGVmaW5lZFxyXG4gICAgICB9LCBjb3JyZWxhdGlvbklkKTtcclxuICAgICAgcmV0dXJuIHsgZm91bmQ6IGZhbHNlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNhZmVQYXJzZUpTT04odGV4dDogc3RyaW5nIHwgbnVsbCk6IGFueSB7XHJcbiAgICBpZiAoIXRleHQpIHJldHVybiBudWxsO1xyXG4gICAgXHJcbiAgICBsZXQgcGFyc2VkOiBhbnkgPSBudWxsO1xyXG4gICAgXHJcbiAgICAvLyB0cnkgZGlyZWN0IHBhcnNlXHJcbiAgICB0cnkge1xyXG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKHRleHQpO1xyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIC8vIGV4dHJhY3QgZmlyc3Qgey4uLn1cclxuICAgICAgY29uc3QgbSA9IHRleHQubWF0Y2goL1xce1tcXHNcXFNdKlxcfS8pO1xyXG4gICAgICBpZiAobSkge1xyXG4gICAgICAgIHRyeSB7IFxyXG4gICAgICAgICAgcGFyc2VkID0gSlNPTi5wYXJzZShtWzBdKTsgXHJcbiAgICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgICAvLyB0cnkgdG8gZml4IGNvbW1vbiBpc3N1ZXM6IHNpbmdsZSBxdW90ZXMgLT4gZG91YmxlXHJcbiAgICAgICAgICBjb25zdCBmaXhlZCA9IG1bMF0ucmVwbGFjZSgvJy9nLCAnXCInKTtcclxuICAgICAgICAgIHRyeSB7IFxyXG4gICAgICAgICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGZpeGVkKTsgXHJcbiAgICAgICAgICB9IGNhdGNoIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghcGFyc2VkIHx8IHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnKSByZXR1cm4gbnVsbDtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgYW5kIG5vcm1hbGl6ZSB0aGUgcGFyc2VkIHJlc3VsdFxyXG4gICAgcmV0dXJuIHRoaXMudmFsaWRhdGVBbmROb3JtYWxpemVQYXJzZWRSZXN1bHQocGFyc2VkKTtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZUFuZE5vcm1hbGl6ZVBhcnNlZFJlc3VsdChkYXRhOiBhbnkpOiBUYXNrRXh0cmFjdGlvblJlc3VsdCB8IFRhc2tFeHRyYWN0aW9uIHwgbnVsbCB7XHJcbiAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdvYmplY3QnIHx8IGRhdGEgPT09IG51bGwpIHtcclxuICAgICAgdGhpcy5sb2coJ3dhcm4nLCAndmFsaWRhdGlvbicsICdQYXJzZWQgZGF0YSBpcyBub3QgYW4gb2JqZWN0JywgeyBcclxuICAgICAgICBkYXRhVHlwZTogdHlwZW9mIGRhdGEsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGZvciBuZXcgbXVsdGktdGFzayBmb3JtYXRcclxuICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCd0YXNrcycpICYmIEFycmF5LmlzQXJyYXkoZGF0YS50YXNrcykpIHtcclxuICAgICAgY29uc3QgdmFsaWRUYXNrczogRXh0cmFjdGVkVGFza1tdID0gW107XHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGNvbnN0IHRhc2sgb2YgZGF0YS50YXNrcykge1xyXG4gICAgICAgIGlmICh0aGlzLmlzVmFsaWRUYXNrKHRhc2spKSB7XHJcbiAgICAgICAgICB2YWxpZFRhc2tzLnB1c2goe1xyXG4gICAgICAgICAgICB0YXNrX3RpdGxlOiB0YXNrLnRhc2tfdGl0bGUgfHwgJ1Vuc3BlY2lmaWVkIHRhc2snLFxyXG4gICAgICAgICAgICB0YXNrX2RldGFpbHM6IHRhc2sudGFza19kZXRhaWxzIHx8ICcnLFxyXG4gICAgICAgICAgICBkdWVfZGF0ZTogdGFzay5kdWVfZGF0ZSB8fCBudWxsLFxyXG4gICAgICAgICAgICBwcmlvcml0eTogdGFzay5wcmlvcml0eSB8fCAnbWVkaXVtJyxcclxuICAgICAgICAgICAgcHJvamVjdDogdGFzay5wcm9qZWN0IHx8IG51bGwsXHJcbiAgICAgICAgICAgIGNsaWVudDogdGFzay5jbGllbnQgfHwgbnVsbCxcclxuICAgICAgICAgICAgc291cmNlX2V4Y2VycHQ6IHRhc2suc291cmNlX2V4Y2VycHQgfHwgJycsXHJcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IHRhc2suY29uZmlkZW5jZSB8fCAnbWVkaXVtJyxcclxuICAgICAgICAgICAgLi4udGFza1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubG9nKCd3YXJuJywgJ3ZhbGlkYXRpb24nLCAnSW52YWxpZCB0YXNrIGZvdW5kIGluIG11bHRpLXRhc2sgcmVzdWx0JywgeyBcclxuICAgICAgICAgICAgdGFzazogdGFzayxcclxuICAgICAgICAgICAgdGFza1RpdGxlOiB0YXNrPy50YXNrX3RpdGxlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubG9nKCdpbmZvJywgJ3ZhbGlkYXRpb24nLCAnTXVsdGktdGFzayB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHsgXHJcbiAgICAgICAgdG90YWxUYXNrczogZGF0YS50YXNrcy5sZW5ndGgsXHJcbiAgICAgICAgdmFsaWRUYXNrczogdmFsaWRUYXNrcy5sZW5ndGgsXHJcbiAgICAgICAgaW52YWxpZFRhc2tzOiBkYXRhLnRhc2tzLmxlbmd0aCAtIHZhbGlkVGFza3MubGVuZ3RoXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBmb3VuZDogZGF0YS5mb3VuZCA9PT0gdHJ1ZSAmJiB2YWxpZFRhc2tzLmxlbmd0aCA+IDAsXHJcbiAgICAgICAgdGFza3M6IHZhbGlkVGFza3MsXHJcbiAgICAgICAgY29uZmlkZW5jZTogZGF0YS5jb25maWRlbmNlIHx8ICdtZWRpdW0nXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEhhbmRsZSBsZWdhY3kgc2luZ2xlLXRhc2sgZm9ybWF0XHJcbiAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZm91bmQnKSkge1xyXG4gICAgICB0aGlzLmxvZygnaW5mbycsICd2YWxpZGF0aW9uJywgJ1Byb2Nlc3NpbmcgbGVnYWN5IHNpbmdsZS10YXNrIGZvcm1hdCcsIHsgXHJcbiAgICAgICAgZm91bmQ6IGRhdGEuZm91bmQsXHJcbiAgICAgICAgdGFza1RpdGxlOiBkYXRhLnRhc2tfdGl0bGUgfHwgZGF0YS50aXRsZVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZm91bmQ6IGRhdGEuZm91bmQgPT09IHRydWUsXHJcbiAgICAgICAgdGFza190aXRsZTogZGF0YS50YXNrX3RpdGxlIHx8IGRhdGEudGl0bGUgfHwgJycsXHJcbiAgICAgICAgdGFza19kZXRhaWxzOiBkYXRhLnRhc2tfZGV0YWlscyB8fCBkYXRhLmRldGFpbHMgfHwgJycsXHJcbiAgICAgICAgZHVlX2RhdGU6IGRhdGEuZHVlX2RhdGUgfHwgbnVsbCxcclxuICAgICAgICBwcmlvcml0eTogZGF0YS5wcmlvcml0eSB8fCAnbWVkaXVtJyxcclxuICAgICAgICBzb3VyY2VfZXhjZXJwdDogZGF0YS5zb3VyY2VfZXhjZXJwdCB8fCAnJyxcclxuICAgICAgICAuLi5kYXRhXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMubG9nKCd3YXJuJywgJ3ZhbGlkYXRpb24nLCAnUGFyc2VkIGRhdGEgZG9lcyBub3QgbWF0Y2ggZXhwZWN0ZWQgZm9ybWF0JywgeyBcclxuICAgICAgZGF0YUtleXM6IE9iamVjdC5rZXlzKGRhdGEpLFxyXG4gICAgICBoYXNGb3VuZDogZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZm91bmQnKSxcclxuICAgICAgaGFzVGFza3M6IGRhdGEuaGFzT3duUHJvcGVydHkoJ3Rhc2tzJylcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSBpc1ZhbGlkVGFzayh0YXNrOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGlmICh0eXBlb2YgdGFzayAhPT0gJ29iamVjdCcgfHwgIXRhc2spIHJldHVybiBmYWxzZTtcclxuICAgIFxyXG4gICAgLy8gTXVzdCBoYXZlIGEgdGFzayB0aXRsZVxyXG4gICAgaWYgKCF0YXNrLnRhc2tfdGl0bGUgfHwgdHlwZW9mIHRhc2sudGFza190aXRsZSAhPT0gJ3N0cmluZycgfHwgdGFzay50YXNrX3RpdGxlLnRyaW0oKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBWYWxpZGF0ZSBjb25maWRlbmNlIGlmIHByZXNlbnRcclxuICAgIGlmICh0YXNrLmNvbmZpZGVuY2UgJiYgIVsnaGlnaCcsICdtZWRpdW0nLCAnbG93J10uaW5jbHVkZXModGFzay5jb25maWRlbmNlKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFZhbGlkYXRlIHByaW9yaXR5IGlmIHByZXNlbnRcclxuICAgIGlmICh0YXNrLnByaW9yaXR5ICYmICFbJ2hpZ2gnLCAnbWVkaXVtJywgJ2xvdyddLmluY2x1ZGVzKHRhc2sucHJpb3JpdHkpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgZHVlX2RhdGUgZm9ybWF0IGlmIHByZXNlbnRcclxuICAgIGlmICh0YXNrLmR1ZV9kYXRlICYmIHR5cGVvZiB0YXNrLmR1ZV9kYXRlID09PSAnc3RyaW5nJykge1xyXG4gICAgICBjb25zdCBkYXRlUmVnZXggPSAvXlxcZHs0fS1cXGR7Mn0tXFxkezJ9JC87XHJcbiAgICAgIGlmICghZGF0ZVJlZ2V4LnRlc3QodGFzay5kdWVfZGF0ZSkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvLyBDcmVhdGUgVGFza05vdGVzXHUyMDEzY29tcGF0aWJsZSBub3RlIGluIHRhc2tzRm9sZGVyXHJcbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVUYXNrTm90ZShleHRyYWN0aW9uOiBUYXNrRXh0cmFjdGlvbiB8IEV4dHJhY3RlZFRhc2ssIHNvdXJjZUZpbGU6IFRGaWxlLCBjb3JyZWxhdGlvbklkPzogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzYWZlVGl0bGUgPSB0aGlzLm1ha2VGaWxlbmFtZVNhZmUoZXh0cmFjdGlvbi50YXNrX3RpdGxlIHx8ICd0YXNrJyk7XHJcbiAgICBsZXQgZmlsZW5hbWUgPSBgJHtzYWZlVGl0bGV9Lm1kYDtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgYW5kIHNhbml0aXplIHRhc2tzIGZvbGRlclxyXG4gICAgbGV0IGZvbGRlciA9IHRoaXMuc2V0dGluZ3MudGFza3NGb2xkZXI/LnRyaW0oKSB8fCAnVGFza3MnO1xyXG4gICAgaWYgKCFmb2xkZXIgfHwgZm9sZGVyLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBmb2xkZXIgPSAnVGFza3MnO1xyXG4gICAgfVxyXG4gICAgLy8gUmVtb3ZlIGFueSBwb3RlbnRpYWxseSBwcm9ibGVtYXRpYyBjaGFyYWN0ZXJzIGZyb20gZm9sZGVyIG5hbWVcclxuICAgIGZvbGRlciA9IGZvbGRlci5yZXBsYWNlKC9bXFxcXC86Kj9cIjw+fF0vZywgJycpO1xyXG4gICAgXHJcbiAgICBsZXQgcGF0aCA9IGAke2ZvbGRlcn0vJHtmaWxlbmFtZX1gO1xyXG5cclxuICAgIC8vIElmIGZpbGUgZXhpc3RzLCBhcHBlbmQgY291bnRlclxyXG4gICAgbGV0IGNvdW50ZXIgPSAxO1xyXG4gICAgd2hpbGUgKHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwYXRoKSkge1xyXG4gICAgICBwYXRoID0gYCR7Zm9sZGVyfS8ke3NhZmVUaXRsZX0tJHtjb3VudGVyfS5tZGA7XHJcbiAgICAgIGNvdW50ZXIrKztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmxvZygnaW5mbycsICd0YXNrLWNyZWF0aW9uJywgJ0NyZWF0aW5nIHRhc2sgbm90ZScsIHsgXHJcbiAgICAgIHNvdXJjZUZpbGU6IHNvdXJjZUZpbGUucGF0aCxcclxuICAgICAgdGFza1RpdGxlOiBleHRyYWN0aW9uLnRhc2tfdGl0bGUsXHJcbiAgICAgIHRhc2tQYXRoOiBwYXRoLFxyXG4gICAgICBmb2xkZXIsXHJcbiAgICAgIGZpbGVuYW1lOiBwYXRoLnNwbGl0KCcvJykucG9wKClcclxuICAgIH0sIGNvcnJlbGF0aW9uSWQpO1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIGZyb250bWF0dGVyIHVzaW5nIGN1c3RvbWl6YWJsZSBmaWVsZHNcclxuICAgIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbGluZXMucHVzaCgnLS0tJyk7XHJcbiAgICBcclxuICAgIGZvciAoY29uc3QgZmllbGQgb2YgdGhpcy5zZXR0aW5ncy5mcm9udG1hdHRlckZpZWxkcykge1xyXG4gICAgICBsZXQgdmFsdWUgPSBleHRyYWN0aW9uW2ZpZWxkLmtleV0gfHwgZXh0cmFjdGlvbltmaWVsZC5rZXkucmVwbGFjZSgnXycsICcnKV0gfHwgZmllbGQuZGVmYXVsdFZhbHVlO1xyXG4gICAgICBcclxuICAgICAgLy8gSGFuZGxlIHNwZWNpYWwgdmFsdWUgcmVwbGFjZW1lbnRzXHJcbiAgICAgIGlmICh2YWx1ZSA9PT0gJ3t7ZGF0ZX19Jykge1xyXG4gICAgICAgIHZhbHVlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIE1hcCBjb21tb24gZXh0cmFjdGlvbiBrZXlzIHRvIGZpZWxkIGtleXNcclxuICAgICAgaWYgKGZpZWxkLmtleSA9PT0gJ3Rhc2snICYmICF2YWx1ZSAmJiBleHRyYWN0aW9uLnRhc2tfdGl0bGUpIHtcclxuICAgICAgICB2YWx1ZSA9IGV4dHJhY3Rpb24udGFza190aXRsZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgLy8gUXVvdGUgc3RyaW5nIHZhbHVlcyBhcHByb3ByaWF0ZWx5XHJcbiAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0JyAmJiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLmluY2x1ZGVzKCcgJykpIHtcclxuICAgICAgICAgIGxpbmVzLnB1c2goYCR7ZmllbGQua2V5fTogXCIke3ZhbHVlfVwiYCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxpbmVzLnB1c2goYCR7ZmllbGQua2V5fTogJHt2YWx1ZX1gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgbGluZXMucHVzaCgnLS0tJyk7XHJcbiAgICBsaW5lcy5wdXNoKCcnKTtcclxuICAgIGxpbmVzLnB1c2goZXh0cmFjdGlvbi50YXNrX2RldGFpbHMgfHwgJycpO1xyXG4gICAgbGluZXMucHVzaCgnJyk7XHJcbiAgICBcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLmxpbmtCYWNrKSB7XHJcbiAgICAgIGNvbnN0IGxpbmsgPSBgW1ske3NvdXJjZUZpbGUucGF0aH1dXWA7XHJcbiAgICAgIGxpbmVzLnB1c2goYFNvdXJjZTogJHtsaW5rfWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoZXh0cmFjdGlvbi5zb3VyY2VfZXhjZXJwdCkge1xyXG4gICAgICBsaW5lcy5wdXNoKCcnKTtcclxuICAgICAgbGluZXMucHVzaCgnPiBKdXN0aWZpY2F0aW9uIGV4Y2VycHQ6Jyk7XHJcbiAgICAgIGxpbmVzLnB1c2goJz4gJyArIGV4dHJhY3Rpb24uc291cmNlX2V4Y2VycHQucmVwbGFjZSgvXFxuL2csICcgJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbmFsID0gbGluZXMuam9pbignXFxuJyk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKHBhdGgsIGZpbmFsKTtcclxuICAgICAgdGhpcy5sb2coJ2luZm8nLCAndGFzay1jcmVhdGlvbicsICdUYXNrIG5vdGUgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCB7IFxyXG4gICAgICAgIHNvdXJjZUZpbGU6IHNvdXJjZUZpbGUucGF0aCxcclxuICAgICAgICB0YXNrVGl0bGU6IGV4dHJhY3Rpb24udGFza190aXRsZSxcclxuICAgICAgICB0YXNrUGF0aDogcGF0aCxcclxuICAgICAgICBjb250ZW50TGVuZ3RoOiBmaW5hbC5sZW5ndGhcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIG5ldyBOb3RpY2UoYFRhc2sgRXh0cmFjdG9yOiBjcmVhdGVkIHRhc2sgXCIke2V4dHJhY3Rpb24udGFza190aXRsZX1cImApO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHRhc2sgbm90ZScsIGUpO1xyXG4gICAgICB0aGlzLmxvZygnZXJyb3InLCAndGFzay1jcmVhdGlvbicsICdGYWlsZWQgdG8gY3JlYXRlIHRhc2sgbm90ZScsIHsgXHJcbiAgICAgICAgc291cmNlRmlsZTogc291cmNlRmlsZS5wYXRoLFxyXG4gICAgICAgIHRhc2tUaXRsZTogZXh0cmFjdGlvbi50YXNrX3RpdGxlLFxyXG4gICAgICAgIHRhc2tQYXRoOiBwYXRoLFxyXG4gICAgICAgIGVycm9yOiBlIGluc3RhbmNlb2YgRXJyb3IgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSksXHJcbiAgICAgICAgc3RhY2s6IGUgaW5zdGFuY2VvZiBFcnJvciA/IGUuc3RhY2sgOiB1bmRlZmluZWRcclxuICAgICAgfSwgY29ycmVsYXRpb25JZCk7XHJcbiAgICAgIG5ldyBOb3RpY2UoJ1Rhc2sgRXh0cmFjdG9yOiBmYWlsZWQgdG8gY3JlYXRlIHRhc2sgbm90ZSBcdTIwMTQgc2VlIGNvbnNvbGUnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgbWFrZUZpbGVuYW1lU2FmZSh0aXRsZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdGl0bGUucmVwbGFjZSgvW1xcXFwvOio/XCI8PnwjJXt9XFxcXF5+XFxbXFxdYDsnQCY9K10vZywgJycpLnJlcGxhY2UoL1xccysvZywgJy0nKS5zbGljZSgwLCAxMjApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2tzIGlmIGEgZmlsZSBwYXRoIGlzIGV4Y2x1ZGVkIGJhc2VkIG9uIGV4YWN0IHBhdGggbWF0Y2hlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNQYXRoRXhjbHVkZWQoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMgfHwgdGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIE5vcm1hbGl6ZSBwYXRoIHNlcGFyYXRvcnMgZm9yIGNyb3NzLXBsYXRmb3JtIGNvbXBhdGliaWxpdHlcclxuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLnNvbWUoZXhjbHVkZWRQYXRoID0+IHtcclxuICAgICAgY29uc3Qgbm9ybWFsaXplZEV4Y2x1ZGVkID0gZXhjbHVkZWRQYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEhhbmRsZSBmb2xkZXIgZXhjbHVzaW9ucyAoZW5kaW5nIHdpdGggLylcclxuICAgICAgaWYgKG5vcm1hbGl6ZWRFeGNsdWRlZC5lbmRzV2l0aCgnLycpKSB7XHJcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRQYXRoLnN0YXJ0c1dpdGgobm9ybWFsaXplZEV4Y2x1ZGVkKSB8fCBcclxuICAgICAgICAgICAgICAgbm9ybWFsaXplZFBhdGguc3RhcnRzV2l0aChub3JtYWxpemVkRXhjbHVkZWQuc2xpY2UoMCwgLTEpICsgJy8nKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRXhhY3QgcGF0aCBtYXRjaFxyXG4gICAgICByZXR1cm4gbm9ybWFsaXplZFBhdGggPT09IG5vcm1hbGl6ZWRFeGNsdWRlZDtcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiBDaGVja3MgaWYgYSBmaWxlIHBhdGggbWF0Y2hlcyBhbnkgZXhjbHVzaW9uIHBhdHRlcm5zIChnbG9iLXN0eWxlKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgbWF0Y2hlc0V4Y2x1c2lvblBhdHRlcm4oZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLnNldHRpbmdzLmV4Y2x1ZGVkUGF0dGVybnMgfHwgdGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdHRlcm5zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIE5vcm1hbGl6ZSBwYXRoIHNlcGFyYXRvcnMgZm9yIGNyb3NzLXBsYXRmb3JtIGNvbXBhdGliaWxpdHlcclxuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiB7XHJcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXFxcL2csICcvJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDb252ZXJ0IGdsb2IgcGF0dGVybiB0byByZWdleFxyXG4gICAgICBjb25zdCByZWdleFBhdHRlcm4gPSB0aGlzLmdsb2JUb1JlZ2V4KG5vcm1hbGl6ZWRQYXR0ZXJuKTtcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAocmVnZXhQYXR0ZXJuLCAnaScpLnRlc3Qobm9ybWFsaXplZFBhdGgpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIC8vIEludmFsaWQgcmVnZXggcGF0dGVybiwgc2tpcCBpdFxyXG4gICAgICAgIGNvbnNvbGUud2FybihgVGFza0V4dHJhY3RvcjogSW52YWxpZCBleGNsdXNpb24gcGF0dGVybjogJHtwYXR0ZXJufWApO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIENvbnZlcnRzIGEgZ2xvYiBwYXR0ZXJuIHRvIGEgcmVnZXggcGF0dGVyblxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2xvYlRvUmVnZXgocGF0dGVybjogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIC8vIEVzY2FwZSBzcGVjaWFsIHJlZ2V4IGNoYXJhY3RlcnMgZXhjZXB0ICogYW5kID9cclxuICAgIGxldCByZWdleFBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UoL1suK14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpO1xyXG4gICAgXHJcbiAgICAvLyBDb252ZXJ0IGdsb2Igd2lsZGNhcmRzIHRvIHJlZ2V4XHJcbiAgICByZWdleFBhdHRlcm4gPSByZWdleFBhdHRlcm5cclxuICAgICAgLnJlcGxhY2UoL1xcKlxcKi9nLCAnXHUwMEE3RE9VQkxFU1RBUlx1MDBBNycpIC8vIFRlbXBvcmFyaWx5IHJlcGxhY2UgKiogdG8gaGFuZGxlIGl0IHNwZWNpYWxseVxyXG4gICAgICAucmVwbGFjZSgvXFwqL2csICdbXi9dKicpICAgICAgICAgLy8gKiBtYXRjaGVzIGFueSBjaGFyYWN0ZXIgZXhjZXB0IC9cclxuICAgICAgLnJlcGxhY2UoL1x1MDBBN0RPVUJMRVNUQVJcdTAwQTcvZywgJy4qJykgIC8vICoqIG1hdGNoZXMgYW55IGNoYXJhY3RlcnMgaW5jbHVkaW5nIC9cclxuICAgICAgLnJlcGxhY2UoL1xcPy9nLCAnW14vXScpOyAgICAgICAgIC8vID8gbWF0Y2hlcyBhbnkgc2luZ2xlIGNoYXJhY3RlciBleGNlcHQgL1xyXG4gICAgXHJcbiAgICAvLyBBbmNob3IgdGhlIHBhdHRlcm5cclxuICAgIGlmICghcmVnZXhQYXR0ZXJuLnN0YXJ0c1dpdGgoJ14nKSkge1xyXG4gICAgICByZWdleFBhdHRlcm4gPSAnXicgKyByZWdleFBhdHRlcm47XHJcbiAgICB9XHJcbiAgICBpZiAoIXJlZ2V4UGF0dGVybi5lbmRzV2l0aCgnJCcpKSB7XHJcbiAgICAgIHJlZ2V4UGF0dGVybiA9IHJlZ2V4UGF0dGVybiArICckJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHJlZ2V4UGF0dGVybjtcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogTWFpbiBleGNsdXNpb24gY2hlY2sgY29tYmluaW5nIGJvdGggcGF0aCBhbmQgcGF0dGVybiBtYXRjaGluZ1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNGaWxlRXhjbHVkZWQoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNQYXRoRXhjbHVkZWQoZmlsZVBhdGgpIHx8IHRoaXMubWF0Y2hlc0V4Y2x1c2lvblBhdHRlcm4oZmlsZVBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGVzIGZyb250bWF0dGVyIGZpZWxkIG5hbWUgd2l0aCBncmFjZWZ1bCBmYWxsYmFjayB0byBcIlR5cGVcIlxyXG4gICAqIEVuc3VyZXMgdGhlIGZpZWxkIG5hbWUgaXMgdmFsaWQgZm9yIFlBTUwgYW5kIHNhZmUgdG8gdXNlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZUZyb250bWF0dGVyRmllbGQoZmllbGROYW1lOiBzdHJpbmcsIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgLy8gQ2hlY2sgaWYgZW1wdHkgb3IgdW5kZWZpbmVkXHJcbiAgICBpZiAoIWZpZWxkTmFtZSB8fCB0eXBlb2YgZmllbGROYW1lICE9PSAnc3RyaW5nJyB8fCBmaWVsZE5hbWUudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ1Rhc2tFeHRyYWN0b3I6IEVtcHR5IGZyb250bWF0dGVyIGZpZWxkIG5hbWUsIGZhbGxpbmcgYmFjayB0byBcIlR5cGVcIicpO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2dWYWxpZGF0aW9uKFxyXG4gICAgICAgICdmcm9udG1hdHRlcicsXHJcbiAgICAgICAgJ2ZpZWxkTmFtZScsXHJcbiAgICAgICAgZmllbGROYW1lLFxyXG4gICAgICAgICdub24tZW1wdHkgc3RyaW5nJyxcclxuICAgICAgICAnRW1wdHkgZnJvbnRtYXR0ZXIgZmllbGQgbmFtZSwgdXNpbmcgZmFsbGJhY2sgXCJUeXBlXCInLFxyXG4gICAgICAgIGNvcnJlbGF0aW9uSWRcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuICdUeXBlJztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0cmltbWVkID0gZmllbGROYW1lLnRyaW0oKTtcclxuXHJcbiAgICAvLyBZQU1MIGtleSB2YWxpZGF0aW9uOiBtdXN0IHN0YXJ0IHdpdGggbGV0dGVyIG9yIHVuZGVyc2NvcmUsIFxyXG4gICAgLy8gY2FuIGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGh5cGhlbnMsIGFuZCBkb3RzXHJcbiAgICBjb25zdCB5YW1sS2V5UGF0dGVybiA9IC9eW2EtekEtWl9dW2EtekEtWjAtOV8uLV0qJC87XHJcbiAgICBcclxuICAgIGlmICgheWFtbEtleVBhdHRlcm4udGVzdCh0cmltbWVkKSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oYFRhc2tFeHRyYWN0b3I6IEludmFsaWQgZnJvbnRtYXR0ZXIgZmllbGQgbmFtZSBcIiR7dHJpbW1lZH1cIiwgZmFsbGluZyBiYWNrIHRvIFwiVHlwZVwiYCk7XHJcbiAgICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb24oXHJcbiAgICAgICAgJ2Zyb250bWF0dGVyJyxcclxuICAgICAgICAnZmllbGROYW1lJyxcclxuICAgICAgICB0cmltbWVkLFxyXG4gICAgICAgICd2YWxpZCBZQU1MIGtleSBwYXR0ZXJuICheW2EtekEtWl9dW2EtekEtWjAtOV8uLV0qJCknLFxyXG4gICAgICAgICdJbnZhbGlkIFlBTUwga2V5IGZvcm1hdCwgdXNpbmcgZmFsbGJhY2sgXCJUeXBlXCInLFxyXG4gICAgICAgIGNvcnJlbGF0aW9uSWRcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuICdUeXBlJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZGRpdGlvbmFsIGNoZWNrcyBmb3IgcHJvYmxlbWF0aWMgcGF0dGVybnNcclxuICAgIGlmICh0cmltbWVkLmluY2x1ZGVzKCcuLicpIHx8IHRyaW1tZWQuc3RhcnRzV2l0aCgnLicpIHx8IHRyaW1tZWQuZW5kc1dpdGgoJy4nKSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oYFRhc2tFeHRyYWN0b3I6IFByb2JsZW1hdGljIGZyb250bWF0dGVyIGZpZWxkIG5hbWUgXCIke3RyaW1tZWR9XCIsIGZhbGxpbmcgYmFjayB0byBcIlR5cGVcImApO1xyXG4gICAgICB0aGlzLmRlYnVnTG9nZ2VyPy5sb2dWYWxpZGF0aW9uKFxyXG4gICAgICAgICdmcm9udG1hdHRlcicsXHJcbiAgICAgICAgJ2ZpZWxkTmFtZScsXHJcbiAgICAgICAgdHJpbW1lZCxcclxuICAgICAgICAndmFsaWQgWUFNTCBrZXkgd2l0aG91dCBwcm9ibGVtYXRpYyBkb3QgcGF0dGVybnMnLFxyXG4gICAgICAgICdQcm9ibGVtYXRpYyBkb3QgcGF0dGVybiBpbiBmaWVsZCBuYW1lLCB1c2luZyBmYWxsYmFjayBcIlR5cGVcIicsXHJcbiAgICAgICAgY29ycmVsYXRpb25JZFxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gJ1R5cGUnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIExvZyBzdWNjZXNzZnVsIHZhbGlkYXRpb25cclxuICAgIHRoaXMuZGVidWdMb2dnZXI/LmxvZ1ZhbGlkYXRpb25TdWNjZXNzKCdmcm9udG1hdHRlcicsICdmaWVsZE5hbWUnLCBjb3JyZWxhdGlvbklkKTtcclxuICAgIHJldHVybiB0cmltbWVkO1xyXG4gIH1cclxuXHJcbiAgLy8gRW5oYW5jZWQgY2xlYW51cCBtZXRob2Qgd2l0aCBwcm9jZXNzaW5nIHF1ZXVlIG1hbmFnZW1lbnRcclxuICBjbGVhbnVwKCkge1xyXG4gICAgLy8gQ2xlYXIgZGVib3VuY2UgdGltZXJzXHJcbiAgICB0aGlzLmZpbGVDaGFuZ2VEZWJvdW5jZXIuZm9yRWFjaCh0aW1lb3V0ID0+IGNsZWFyVGltZW91dCh0aW1lb3V0KSk7XHJcbiAgICB0aGlzLmZpbGVDaGFuZ2VEZWJvdW5jZXIuY2xlYXIoKTtcclxuICAgIFxyXG4gICAgLy8gQ2xlYXIgcHJvY2Vzc2luZyBxdWV1ZSB0aW1lcnNcclxuICAgIHRoaXMucHJvY2Vzc2luZ1F1ZXVlLmZvckVhY2goc3RhdHVzID0+IHtcclxuICAgICAgaWYgKHN0YXR1cy50aW1lb3V0KSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHN0YXR1cy50aW1lb3V0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnByb2Nlc3NpbmdRdWV1ZS5jbGVhcigpO1xyXG4gICAgXHJcbiAgICAvLyBDbGVhciBwcm9jZXNzaW5nIGZpbGVzIHNldFxyXG4gICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMuY2xlYXIoKTtcclxuICB9XHJcblxyXG4gIC8vIE1ldGhvZHMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxuICBnZXRQcm9jZXNzaW5nRmlsZXMoKSB7IHJldHVybiB0aGlzLnByb2Nlc3NpbmdGaWxlczsgfVxyXG59IiwgIi8qXHJcbiAqIFNldHRpbmdzIFVJIGFuZCBtYW5hZ2VtZW50XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBFeHRyYWN0b3JTZXR0aW5ncywgTExNU2VydmljZSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBMTE1Qcm92aWRlck1hbmFnZXIgfSBmcm9tICcuL2xsbS1wcm92aWRlcnMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEV4dHJhY3RvclNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBwcml2YXRlIHNhdmVUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGFwcDogQXBwLFxyXG4gICAgcHJpdmF0ZSBwbHVnaW46IGFueSwgLy8gTWFpbiBwbHVnaW4gaW5zdGFuY2VcclxuICAgIHByaXZhdGUgc2V0dGluZ3M6IEV4dHJhY3RvclNldHRpbmdzLFxyXG4gICAgcHJpdmF0ZSBsbG1Qcm92aWRlcjogTExNUHJvdmlkZXJNYW5hZ2VyXHJcbiAgKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgfVxyXG5cclxuICAvLyBEZWJvdW5jZWQgc2F2ZSB0byByZWR1Y2Ugc2F2ZSBmcmVxdWVuY3lcclxuICBwcml2YXRlIGRlYm91bmNlZFNhdmUoKSB7XHJcbiAgICBpZiAodGhpcy5zYXZlVGltZW91dCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zYXZlVGltZW91dCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMuc2F2ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgIHRoaXMuc2F2ZVRpbWVvdXQgPSBudWxsO1xyXG4gICAgfSwgNTAwKTtcclxuICB9XHJcblxyXG4gIC8vIENsZWFuIHVwIHRpbWVvdXQgb24gaGlkZVxyXG4gIGhpZGUoKSB7XHJcbiAgICBpZiAodGhpcy5zYXZlVGltZW91dCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zYXZlVGltZW91dCk7XHJcbiAgICAgIHRoaXMuc2F2ZVRpbWVvdXQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgc3VwZXIuaGlkZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGVzIGZyb250bWF0dGVyIGZpZWxkIG5hbWUgYWNjb3JkaW5nIHRvIFlBTUwga2V5IGZvcm1hdFxyXG4gICAqIFJldHVybnMgYSB2YWxpZCBmaWVsZCBuYW1lIG9yIGRlZmF1bHRzIHRvIFwiVHlwZVwiXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZUZyb250bWF0dGVyRmllbGQoZmllbGROYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgLy8gQ2hlY2sgaWYgZW1wdHlcclxuICAgIGlmICghZmllbGROYW1lIHx8IGZpZWxkTmFtZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuICdUeXBlJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBZQU1MIGtleSB2YWxpZGF0aW9uOiBtdXN0IHN0YXJ0IHdpdGggbGV0dGVyIG9yIHVuZGVyc2NvcmUsIFxyXG4gICAgLy8gY2FuIGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGh5cGhlbnMsIGFuZCBkb3RzXHJcbiAgICBjb25zdCB5YW1sS2V5UGF0dGVybiA9IC9eW2EtekEtWl9dW2EtekEtWjAtOV8uLV0qJC87XHJcbiAgICBcclxuICAgIGlmICgheWFtbEtleVBhdHRlcm4udGVzdChmaWVsZE5hbWUpKSB7XHJcbiAgICAgIHJldHVybiAnVHlwZSc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkaXRpb25hbCBjaGVja3MgZm9yIHByb2JsZW1hdGljIGNoYXJhY3RlcnNcclxuICAgIGlmIChmaWVsZE5hbWUuaW5jbHVkZXMoJy4uJykgfHwgZmllbGROYW1lLnN0YXJ0c1dpdGgoJy4nKSB8fCBmaWVsZE5hbWUuZW5kc1dpdGgoJy4nKSkge1xyXG4gICAgICByZXR1cm4gJ1R5cGUnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmaWVsZE5hbWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTaG93cyB2YWxpZGF0aW9uIGZlZWRiYWNrIHRvIHRoZSB1c2VyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG93VmFsaWRhdGlvbkZlZWRiYWNrKGlucHV0RWw6IEhUTUxJbnB1dEVsZW1lbnQsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgLy8gVmlzdWFsIGZlZWRiYWNrXHJcbiAgICBpbnB1dEVsLnN0eWxlLmJvcmRlckNvbG9yID0gJyNmZjZiNmInO1xyXG4gICAgaW5wdXRFbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmdiYSgyNTUsIDEwNywgMTA3LCAwLjEpJztcclxuICAgIFxyXG4gICAgLy8gQ3JlYXRlIHRvb2x0aXAgb3IgdXNlIHRpdGxlIGF0dHJpYnV0ZVxyXG4gICAgaW5wdXRFbC50aXRsZSA9IG1lc3NhZ2U7XHJcbiAgICBcclxuICAgIC8vIFJlc2V0IHN0eWxpbmcgYWZ0ZXIgZGVsYXlcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpbnB1dEVsLnN0eWxlLmJvcmRlckNvbG9yID0gJyc7XHJcbiAgICAgIGlucHV0RWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyc7XHJcbiAgICAgIGlucHV0RWwudGl0bGUgPSAnJztcclxuICAgIH0sIDMwMDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGVzIGFuZCBjbGFtcHMgbnVtZXJpYyB2YWx1ZXMgd2l0aCBlbmhhbmNlZCBlcnJvciBoYW5kbGluZ1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdmFsaWRhdGVOdW1lcmljSW5wdXQodmFsdWU6IG51bWJlciwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyLCBkZWZhdWx0VmFsdWU6IG51bWJlcik6IHsgdmFsdWU6IG51bWJlcjsgaXNWYWxpZDogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9IHtcclxuICAgIC8vIENoZWNrIGZvciBOYU5cclxuICAgIGlmIChpc05hTih2YWx1ZSkpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgdmFsdWU6IGRlZmF1bHRWYWx1ZSwgXHJcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsIFxyXG4gICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIG51bWJlci4gVXNpbmcgZGVmYXVsdCB2YWx1ZSAke2RlZmF1bHRWYWx1ZX0uYCBcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBib3VuZHNcclxuICAgIGlmICh2YWx1ZSA8IG1pbikge1xyXG4gICAgICByZXR1cm4geyBcclxuICAgICAgICB2YWx1ZTogbWluLCBcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSwgXHJcbiAgICAgICAgbWVzc2FnZTogYFZhbHVlIHRvbyBsb3cuIE1pbmltdW0gaXMgJHttaW59LmAgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHZhbHVlID4gbWF4KSB7XHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHZhbHVlOiBtYXgsIFxyXG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLCBcclxuICAgICAgICBtZXNzYWdlOiBgVmFsdWUgdG9vIGhpZ2guIE1heGltdW0gaXMgJHttYXh9LmAgXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgdmFsdWUsIGlzVmFsaWQ6IHRydWUgfTtcclxuICB9XHJcblxyXG4gIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdUYXNrIEV4dHJhY3RvciBTZXR0aW5ncycgfSk7XHJcblxyXG4gICAgLy8gUHJvdmlkZXIgU2VsZWN0aW9uXHJcbiAgICB0aGlzLmFkZFByb3ZpZGVyU2VjdGlvbihjb250YWluZXJFbCk7XHJcbiAgICBcclxuICAgIC8vIExvY2FsIExMTSBDb25maWd1cmF0aW9uXHJcbiAgICB0aGlzLmFkZExvY2FsTExNU2VjdGlvbihjb250YWluZXJFbCk7XHJcbiAgICBcclxuICAgIC8vIFByb2Nlc3NpbmcgU2V0dGluZ3NcclxuICAgIHRoaXMuYWRkUHJvY2Vzc2luZ1NlY3Rpb24oY29udGFpbmVyRWwpO1xyXG4gICAgXHJcbiAgICAvLyBFeGNsdXNpb24gU2V0dGluZ3NcclxuICAgIHRoaXMuYWRkRXhjbHVzaW9uU2VjdGlvbihjb250YWluZXJFbCk7XHJcbiAgICBcclxuICAgIC8vIEZyb250bWF0dGVyIEN1c3RvbWl6YXRpb25cclxuICAgIHRoaXMuYWRkRnJvbnRtYXR0ZXJTZWN0aW9uKGNvbnRhaW5lckVsKTtcclxuICAgIFxyXG4gICAgLy8gRGVidWcgU2V0dGluZ3NcclxuICAgIHRoaXMuYWRkRGVidWdTZWN0aW9uKGNvbnRhaW5lckVsKTtcclxuICAgIFxyXG4gICAgLy8gQWR2YW5jZWQgU2V0dGluZ3NcclxuICAgIHRoaXMuYWRkQWR2YW5jZWRTZWN0aW9uKGNvbnRhaW5lckVsKTtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSBhZGRQcm92aWRlclNlY3Rpb24oY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XHJcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdMTE0gUHJvdmlkZXIgQ29uZmlndXJhdGlvbicgfSk7XHJcbiAgICBcclxuICAgIC8vIFNlcnZpY2Ugc3RhdHVzIGluZGljYXRvclxyXG4gICAgY29uc3Qgc3RhdHVzRWwgPSBjb250YWluZXJFbC5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICd0YXNrLWV4dHJhY3Rvci1zdGF0dXMnIH0pO1xyXG4gICAgdGhpcy51cGRhdGVTZXJ2aWNlU3RhdHVzKHN0YXR1c0VsKTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdQcm92aWRlcicpXHJcbiAgICAgIC5zZXREZXNjKCdDaG9vc2UgTExNIHByb3ZpZGVyLiBMb2NhbCBwcm92aWRlcnMgKE9sbGFtYS9MTSBTdHVkaW8pIHJlcXVpcmUgdGhlIHNlcnZpY2UgdG8gYmUgcnVubmluZy4nKVxyXG4gICAgICAuYWRkRHJvcGRvd24oY2IgPT4gY2JcclxuICAgICAgICAuYWRkT3B0aW9uKCdvcGVuYWknLCAnT3BlbkFJJylcclxuICAgICAgICAuYWRkT3B0aW9uKCdhbnRocm9waWMnLCAnQW50aHJvcGljJylcclxuICAgICAgICAuYWRkT3B0aW9uKCdvbGxhbWEnLCAnT2xsYW1hIChMb2NhbCknKVxyXG4gICAgICAgIC5hZGRPcHRpb24oJ2xtc3R1ZGlvJywgJ0xNIFN0dWRpbyAoTG9jYWwpJylcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5wcm92aWRlcilcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLnByb3ZpZGVyID0gdiBhcyBhbnk7IFxyXG4gICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIENsZWFyIEFQSSBrZXkgbm90aWZpY2F0aW9uIHdoZW4gc3dpdGNoaW5nIHByb3ZpZGVyc1xyXG4gICAgICAgICAgdGhpcy5sbG1Qcm92aWRlci5nZXRBcGlLZXlNaXNzaW5nTm90aWZpZWQoKS5jbGVhcigpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZVNlcnZpY2VTdGF0dXMoc3RhdHVzRWwpO1xyXG4gICAgICAgICAgdGhpcy5kaXNwbGF5KCk7IC8vIFJlZnJlc2ggdG8gc2hvdy9oaWRlIHJlbGV2YW50IHNldHRpbmdzXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgIC8vIEFQSSBLZXkgKG9ubHkgZm9yIGNsb3VkIHByb3ZpZGVycylcclxuICAgIGlmIChbJ29wZW5haScsICdhbnRocm9waWMnXS5pbmNsdWRlcyh0aGlzLnNldHRpbmdzLnByb3ZpZGVyKSkge1xyXG4gICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAuc2V0TmFtZSgnQVBJIEtleScpXHJcbiAgICAgICAgLnNldERlc2MoJ1lvdXIgQVBJIGtleSBmb3IgdGhlIHNlbGVjdGVkIHByb3ZpZGVyLiBNb2RlbHMgd2lsbCBiZSBsb2FkZWQgYXV0b21hdGljYWxseSBvbmNlIGVudGVyZWQuJylcclxuICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignc2stLi4uIG9yIGNsYXVkZS0uLi4nKVxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MuYXBpS2V5KVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IFxyXG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLmFwaUtleSA9IHYudHJpbSgpOyBcclxuICAgICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDbGVhciBtb2RlbCBjYWNoZSB3aGVuIEFQSSBrZXkgY2hhbmdlc1xyXG4gICAgICAgICAgICBjb25zdCBvbGRDYWNoZUtleXMgPSBBcnJheS5mcm9tKHRoaXMubGxtUHJvdmlkZXIuZ2V0Q2xvdWRNb2RlbENhY2hlKCkua2V5cygpKVxyXG4gICAgICAgICAgICAgIC5maWx0ZXIoa2V5ID0+IGtleS5zdGFydHNXaXRoKHRoaXMuc2V0dGluZ3MucHJvdmlkZXIpKTtcclxuICAgICAgICAgICAgb2xkQ2FjaGVLZXlzLmZvckVhY2goa2V5ID0+IHRoaXMubGxtUHJvdmlkZXIuZ2V0Q2xvdWRNb2RlbENhY2hlKCkuZGVsZXRlKGtleSkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQ2xlYXIgbm90aWZpY2F0aW9uIGZsYWdcclxuICAgICAgICAgICAgdGhpcy5sbG1Qcm92aWRlci5nZXRBcGlLZXlNaXNzaW5nTm90aWZpZWQoKS5jbGVhcigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gUmVmcmVzaCBtb2RlbCBkcm9wZG93blxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcclxuICAgICAgICAgIH0pKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLnByb3ZpZGVyID09PSAnYW50aHJvcGljJykge1xyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgLnNldE5hbWUoJ0FudGhyb3BpYyBVUkwnKVxyXG4gICAgICAgICAgLnNldERlc2MoJ09wdGlvbmFsOiBVUkwgZm9yIGEgcHJveHkgZm9yIHRoZSBBbnRocm9waWMgQVBJLicpXHJcbiAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MuYW50aHJvcGljVXJsKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5hbnRocm9waWNVcmwgPSB2LnRyaW0oKTsgXHJcbiAgICAgICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE1vZGVsIHNlbGVjdGlvbiAoYXN5bmMpXHJcbiAgICB0aGlzLmFkZE1vZGVsU2V0dGluZyhjb250YWluZXJFbCk7XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYXN5bmMgYWRkTW9kZWxTZXR0aW5nKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgbW9kZWxDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoKTtcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5zZXR0aW5ncy5wcm92aWRlcjtcclxuICAgIGNvbnN0IHNlcnZpY2UgPSB0aGlzLmxsbVByb3ZpZGVyLmdldFNlcnZpY2VDYWNoZSgpLmdldChwcm92aWRlcik7XHJcbiAgICBcclxuICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIG1vZGVsIHNldHRpbmcgdGhhdCB3ZSBjYW4gdXBkYXRlXHJcbiAgICBcclxuICAgIGlmIChbJ29sbGFtYScsICdsbXN0dWRpbyddLmluY2x1ZGVzKHByb3ZpZGVyKSAmJiBzZXJ2aWNlPy5hdmFpbGFibGUgJiYgc2VydmljZS5tb2RlbHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAvLyBTaG93IGRyb3Bkb3duIGZvciBhdmFpbGFibGUgbG9jYWwgbW9kZWxzXHJcbiAgICAgIG5ldyBTZXR0aW5nKG1vZGVsQ29udGFpbmVyKVxyXG4gICAgICAgIC5zZXROYW1lKCdNb2RlbCcpXHJcbiAgICAgICAgLnNldERlc2MoYFNlbGVjdCBmcm9tICR7c2VydmljZS5tb2RlbHMubGVuZ3RofSBhdmFpbGFibGUgJHtwcm92aWRlcn0gbW9kZWxzLmApXHJcbiAgICAgICAgLmFkZERyb3Bkb3duKGNiID0+IHtcclxuICAgICAgICAgIHNlcnZpY2UubW9kZWxzLmZvckVhY2gobW9kZWwgPT4gY2IuYWRkT3B0aW9uKG1vZGVsLCBtb2RlbCkpO1xyXG4gICAgICAgICAgY2Iuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5tb2RlbCB8fCBzZXJ2aWNlLm1vZGVsc1swXSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IHRoaXMuc2V0dGluZ3MubW9kZWwgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2UgaWYgKFsnb3BlbmFpJywgJ2FudGhyb3BpYyddLmluY2x1ZGVzKHByb3ZpZGVyKSAmJiB0aGlzLnNldHRpbmdzLmFwaUtleSkge1xyXG4gICAgICAvLyBTaG93IGxvYWRpbmcgc3RhdGUgd2hpbGUgZmV0Y2hpbmcgbW9kZWxzXHJcbiAgICAgIGNvbnN0IGxvYWRpbmdTZXR0aW5nID0gbmV3IFNldHRpbmcobW9kZWxDb250YWluZXIpXHJcbiAgICAgICAgLnNldE5hbWUoJ01vZGVsJylcclxuICAgICAgICAuc2V0RGVzYygnTG9hZGluZyBhdmFpbGFibGUgbW9kZWxzLi4uJyk7XHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZU1vZGVscyA9IGF3YWl0IHRoaXMubGxtUHJvdmlkZXIuZmV0Y2hDbG91ZE1vZGVscyhwcm92aWRlciBhcyAnb3BlbmFpJyB8ICdhbnRocm9waWMnKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDbGVhciBsb2FkaW5nIHN0YXRlIGFuZCBzaG93IGFjdHVhbCBkcm9wZG93blxyXG4gICAgICAgIG1vZGVsQ29udGFpbmVyLmVtcHR5KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbmV3IFNldHRpbmcobW9kZWxDb250YWluZXIpXHJcbiAgICAgICAgICAuc2V0TmFtZSgnTW9kZWwnKVxyXG4gICAgICAgICAgLnNldERlc2MoYFNlbGVjdCBmcm9tICR7YXZhaWxhYmxlTW9kZWxzLmxlbmd0aH0gYXZhaWxhYmxlICR7cHJvdmlkZXJ9IG1vZGVscy5gKVxyXG4gICAgICAgICAgLmFkZERyb3Bkb3duKGNiID0+IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlTW9kZWxzLmZvckVhY2gobW9kZWwgPT4gY2IuYWRkT3B0aW9uKG1vZGVsLCBtb2RlbCkpO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZWwgPSB0aGlzLnNldHRpbmdzLm1vZGVsO1xyXG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0TW9kZWwgPSBhdmFpbGFibGVNb2RlbHMuaW5jbHVkZXMoY3VycmVudE1vZGVsKSA/IGN1cnJlbnRNb2RlbCA6IGF2YWlsYWJsZU1vZGVsc1swXTtcclxuICAgICAgICAgICAgY2Iuc2V0VmFsdWUoZGVmYXVsdE1vZGVsKVxyXG4gICAgICAgICAgICAgIC5vbkNoYW5nZSgodikgPT4geyB0aGlzLnNldHRpbmdzLm1vZGVsID0gdjsgdGhpcy5kZWJvdW5jZWRTYXZlKCk7IH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAvLyBBZGQgcmVmcmVzaCBidXR0b25cclxuICAgICAgICBuZXcgU2V0dGluZyhtb2RlbENvbnRhaW5lcilcclxuICAgICAgICAgIC5zZXROYW1lKCdSZWZyZXNoIE1vZGVscycpXHJcbiAgICAgICAgICAuc2V0RGVzYygnUmVsb2FkIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSB0aGUgQVBJLicpXHJcbiAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cclxuICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ1JlZnJlc2gnKVxyXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5sbG1Qcm92aWRlci5nZXRDbG91ZE1vZGVsQ2FjaGUoKS5jbGVhcigpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgbW9kZWxDb250YWluZXIuZW1wdHkoKTtcclxuICAgICAgICB0aGlzLmFkZEZhbGxiYWNrTW9kZWxTZXR0aW5nKG1vZGVsQ29udGFpbmVyLCBwcm92aWRlcik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHRleHQgaW5wdXRcclxuICAgICAgdGhpcy5hZGRGYWxsYmFja01vZGVsU2V0dGluZyhtb2RlbENvbnRhaW5lciwgcHJvdmlkZXIpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGFkZEZhbGxiYWNrTW9kZWxTZXR0aW5nKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3ZpZGVyOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGRlZmF1bHRNb2RlbHMgPSB7XHJcbiAgICAgIG9wZW5haTogJ2dwdC00by1taW5pJyxcclxuICAgICAgYW50aHJvcGljOiAnY2xhdWRlLTMtaGFpa3UtMjAyNDAzMDcnLFxyXG4gICAgICBvbGxhbWE6ICdsbGFtYTMuMicsXHJcbiAgICAgIGxtc3R1ZGlvOiAnbG9jYWwtbW9kZWwnXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IFsnb2xsYW1hJywgJ2xtc3R1ZGlvJ10uaW5jbHVkZXMocHJvdmlkZXIpIFxyXG4gICAgICA/IGBFbnRlciBtb2RlbCBuYW1lLiBTZXJ2aWNlIG5vdCBkZXRlY3RlZCBvciBubyBtb2RlbHMgYXZhaWxhYmxlLmBcclxuICAgICAgOiBgRW50ZXIgbW9kZWwgbmFtZSBtYW51YWxseS5gO1xyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXIpXHJcbiAgICAgIC5zZXROYW1lKCdNb2RlbCcpXHJcbiAgICAgIC5zZXREZXNjKGRlc2NyaXB0aW9uKVxyXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoZGVmYXVsdE1vZGVsc1twcm92aWRlciBhcyBrZXlvZiB0eXBlb2YgZGVmYXVsdE1vZGVsc10gfHwgJycpXHJcbiAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MubW9kZWwpXHJcbiAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IHRoaXMuc2V0dGluZ3MubW9kZWwgPSB2LnRyaW0oKTsgdGhpcy5kZWJvdW5jZWRTYXZlKCk7IH0pKTtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSBhZGRMb2NhbExMTVNlY3Rpb24oY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5wcm92aWRlciAhPT0gJ29sbGFtYScgJiYgdGhpcy5zZXR0aW5ncy5wcm92aWRlciAhPT0gJ2xtc3R1ZGlvJykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnTG9jYWwgTExNIENvbmZpZ3VyYXRpb24nIH0pO1xyXG4gICAgXHJcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5wcm92aWRlciA9PT0gJ29sbGFtYScpIHtcclxuICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgLnNldE5hbWUoJ09sbGFtYSBVUkwnKVxyXG4gICAgICAgIC5zZXREZXNjKCdVUkwgZm9yIHlvdXIgT2xsYW1hIGluc3RhbmNlLicpXHJcbiAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwpXHJcbiAgICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsID0gdi50cmltKCk7IFxyXG4gICAgICAgICAgICB0aGlzLmRlYm91bmNlZFNhdmUoKTtcclxuICAgICAgICAgICAgLy8gU2VydmljZSB3aWxsIGJlIHJlLWRldGVjdGVkIG9uIG5leHQgdXNlIGR1ZSB0byBVUkwgY2hhbmdlXHJcbiAgICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLnByb3ZpZGVyID09PSAnbG1zdHVkaW8nKSB7XHJcbiAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgIC5zZXROYW1lKCdMTSBTdHVkaW8gVVJMJylcclxuICAgICAgICAuc2V0RGVzYygnVVJMIGZvciB5b3VyIExNIFN0dWRpbyBpbnN0YW5jZS4nKVxyXG4gICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwpXHJcbiAgICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MubG1zdHVkaW9VcmwgPSB2LnRyaW0oKTsgXHJcbiAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkU2F2ZSgpO1xyXG4gICAgICAgICAgICAvLyBTZXJ2aWNlIHdpbGwgYmUgcmUtZGV0ZWN0ZWQgb24gbmV4dCB1c2UgZHVlIHRvIFVSTCBjaGFuZ2VcclxuICAgICAgICAgIH0pKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5hZGRTbGlkZXJXaXRoSW5wdXQoXHJcbiAgICAgIGNvbnRhaW5lckVsLFxyXG4gICAgICAnTW9kZWwgUmVmcmVzaCBJbnRlcnZhbCcsXHJcbiAgICAgICdIb3cgb2Z0ZW4gdG8gY2hlY2sgZm9yIGF2YWlsYWJsZSBtb2RlbHMgKG1pbnV0ZXMpLicsXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MubG9jYWxNb2RlbFJlZnJlc2hJbnRlcnZhbCxcclxuICAgICAgMSxcclxuICAgICAgNjAsXHJcbiAgICAgIDEsXHJcbiAgICAgICh2KSA9PiB7IFxyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MubG9jYWxNb2RlbFJlZnJlc2hJbnRlcnZhbCA9IHY7IFxyXG4gICAgICAgIHRoaXMuZGVib3VuY2VkU2F2ZSgpO1xyXG4gICAgICAgIC8vIE5vdGU6IFNlcnZpY2UgbW9uaXRvcmluZyBub3cgdXNlcyBvbi1kZW1hbmQgZGV0ZWN0aW9uXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYWRkUHJvY2Vzc2luZ1NlY3Rpb24oY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XHJcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdQcm9jZXNzaW5nIFNldHRpbmdzJyB9KTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdPd25lciBuYW1lJylcclxuICAgICAgLnNldERlc2MoJ0V4YWN0IG5hbWUgdGhlIExMTSBzaG91bGQgbG9vayBmb3Igd2hlbiBkZWNpZGluZyB0YXNrcy4nKVxyXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0JyeWFuIEtvbGInKVxyXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzLm93bmVyTmFtZSlcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgdGhpcy5zZXR0aW5ncy5vd25lck5hbWUgPSB2LnRyaW0oKTsgdGhpcy5kZWJvdW5jZWRTYXZlKCk7IH0pKTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdUYXNrcyBmb2xkZXInKVxyXG4gICAgICAuc2V0RGVzYygnRm9sZGVyIHdoZXJlIGdlbmVyYXRlZCB0YXNrIG5vdGVzIHdpbGwgYmUgY3JlYXRlZC4nKVxyXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy50YXNrc0ZvbGRlcilcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgdGhpcy5zZXR0aW5ncy50YXNrc0ZvbGRlciA9IHYudHJpbSgpOyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfSkpO1xyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ1RyaWdnZXIgbm90ZSB0eXBlcycpXHJcbiAgICAgIC5zZXREZXNjKCdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBub3RlIHR5cGVzIHRvIHByb2Nlc3MgKGZyb20gZnJvbnRtYXR0ZXIgVHlwZSBmaWVsZCkuJylcclxuICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MudHJpZ2dlclR5cGVzLmpvaW4oJywgJykpXHJcbiAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IFxyXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncy50cmlnZ2VyVHlwZXMgPSB2LnNwbGl0KCcsJykubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMCk7XHJcbiAgICAgICAgICB0aGlzLmRlYm91bmNlZFNhdmUoKTsgXHJcbiAgICAgICAgfSkpO1xyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ0Zyb250bWF0dGVyIGZpZWxkIGZvciBmaWx0ZXJpbmcnKVxyXG4gICAgICAuc2V0RGVzYygnVGhlIGZyb250bWF0dGVyIGZpZWxkIG5hbWUgdG8gdXNlIGZvciBmaWx0ZXJpbmcgbm90ZXMgKGUuZy4sIFwiVHlwZVwiLCBcIkNhdGVnb3J5XCIsIFwiTm90ZVR5cGVcIikuJylcclxuICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdUeXBlJylcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy50cmlnZ2VyRnJvbnRtYXR0ZXJGaWVsZClcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICBjb25zdCB2YWxpZGF0ZWRGaWVsZCA9IHRoaXMudmFsaWRhdGVGcm9udG1hdHRlckZpZWxkKHYudHJpbSgpKTtcclxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MudHJpZ2dlckZyb250bWF0dGVyRmllbGQgPSB2YWxpZGF0ZWRGaWVsZDsgXHJcbiAgICAgICAgICB0aGlzLmRlYm91bmNlZFNhdmUoKTsgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5wdXQgZmllbGQgaWYgdmFsaWRhdGlvbiBjaGFuZ2VkIHRoZSB2YWx1ZVxyXG4gICAgICAgICAgaWYgKHZhbGlkYXRlZEZpZWxkICE9PSB2LnRyaW0oKSkge1xyXG4gICAgICAgICAgICB0ZXh0LnNldFZhbHVlKHZhbGlkYXRlZEZpZWxkKTtcclxuICAgICAgICAgICAgdGhpcy5zaG93VmFsaWRhdGlvbkZlZWRiYWNrKHRleHQuaW5wdXRFbCwgJ0ludmFsaWQgZmllbGQgbmFtZS4gVXNpbmcgZGVmYXVsdCBcIlR5cGVcIi4nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICBcclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZSgnUHJvY2VzcyBlZGl0cyBhcyB3ZWxsIGFzIG5ldyBmaWxlcycpXHJcbiAgICAgIC5zZXREZXNjKCdJZiBlbmFibGVkLCBtb2RpZmljYXRpb25zIHRvIG1hdGNoaW5nIG5vdGVzIHdpbGwgYmUgcHJvY2Vzc2VkIHRvby4nKVxyXG4gICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5wcm9jZXNzT25VcGRhdGUpXHJcbiAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IHRoaXMuc2V0dGluZ3MucHJvY2Vzc09uVXBkYXRlID0gdjsgdGhpcy5kZWJvdW5jZWRTYXZlKCk7IH0pKTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdMaW5rIGJhY2sgdG8gc291cmNlJylcclxuICAgICAgLnNldERlc2MoJ0luc2VydCBhIGxpbmsgYmFjayB0byB0aGUgc291cmNlIG5vdGUgaW4gZ2VuZXJhdGVkIHRhc2sgbm90ZXMuJylcclxuICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXHJcbiAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MubGlua0JhY2spXHJcbiAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IHRoaXMuc2V0dGluZ3MubGlua0JhY2sgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfSkpO1xyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ1Byb2Nlc3NlZCBtYXJrZXIga2V5JylcclxuICAgICAgLnNldERlc2MoJ0Zyb250bWF0dGVyIGtleSB0byBtYXJrIHByb2Nlc3NlZCBub3Rlcy4nKVxyXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5wcm9jZXNzZWRGcm9udG1hdHRlcktleSlcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgdGhpcy5zZXR0aW5ncy5wcm9jZXNzZWRGcm9udG1hdHRlcktleSA9IHYudHJpbSgpOyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfSkpO1xyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGFkZEV4Y2x1c2lvblNlY3Rpb24oY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XHJcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdGaWxlL0ZvbGRlciBFeGNsdXNpb24gU2V0dGluZ3MnIH0pO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgZGVzY3JpcHRpb25cclxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdwJywge1xyXG4gICAgICB0ZXh0OiAnRXhjbHVkZSBzcGVjaWZpYyBmaWxlcyBvciBmb2xkZXJzIGZyb20gYmVpbmcgcHJvY2Vzc2VkIGJ5IHRoZSB0YXNrIGV4dHJhY3Rvci4nLFxyXG4gICAgICBjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdFeGNsdWRlZCBQYXRocycpXHJcbiAgICAgIC5zZXREZXNjKCdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBleGFjdCBmaWxlIG9yIGZvbGRlciBwYXRocyB0byBleGNsdWRlLiBFeGFtcGxlczogXCJUZW1wbGF0ZXMvXCIsIFwiQXJjaGl2ZS9PbGQgTm90ZXMvXCIsIFwiUHJpdmF0ZS9zZWNyZXRzLm1kXCInKVxyXG4gICAgICAuYWRkVGV4dEFyZWEodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdUZW1wbGF0ZXMvLCBBcmNoaXZlLywgUHJpdmF0ZS9zZWNyZXRzLm1kJylcclxuICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLmpvaW4oJywgJykpXHJcbiAgICAgICAgLm9uQ2hhbmdlKCh2KSA9PiB7IFxyXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncy5leGNsdWRlZFBhdGhzID0gdi5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgIC5tYXAocyA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMCk7XHJcbiAgICAgICAgICB0aGlzLmRlYm91bmNlZFNhdmUoKTsgXHJcbiAgICAgICAgfSkpO1xyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoJ0V4Y2x1c2lvbiBQYXR0ZXJucycpXHJcbiAgICAgIC5zZXREZXNjKCdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBnbG9iIHBhdHRlcm5zIHRvIGV4Y2x1ZGUgZmlsZXMuIFN1cHBvcnRzIHdpbGRjYXJkczogKiAoYW55IGNoYXJhY3RlcnMgZXhjZXB0IC8pLCAqKiAoYW55IGNoYXJhY3RlcnMgaW5jbHVkaW5nIC8pLCA/IChzaW5nbGUgY2hhcmFjdGVyKS4gRXhhbXBsZXM6IFwiKi50ZW1wbGF0ZS5tZFwiLCBcIioqL2RyYWZ0cy8qKlwiLCBcIkFyY2hpdmUvKipcIicpXHJcbiAgICAgIC5hZGRUZXh0QXJlYSh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJyoudGVtcGxhdGUubWQsICoqL2RyYWZ0cy8qKiwgQXJjaGl2ZS8qKicpXHJcbiAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3MuZXhjbHVkZWRQYXR0ZXJucy5qb2luKCcsICcpKVxyXG4gICAgICAgIC5vbkNoYW5nZSgodikgPT4geyBcclxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MuZXhjbHVkZWRQYXR0ZXJucyA9IHYuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAubWFwKHMgPT4gcy50cmltKCkpXHJcbiAgICAgICAgICAgIC5maWx0ZXIocyA9PiBzLmxlbmd0aCA+IDApO1xyXG4gICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7IFxyXG4gICAgICAgIH0pKTtcclxuICAgIFxyXG4gICAgLy8gQWRkIGV4YW1wbGVzIHNlY3Rpb25cclxuICAgIGNvbnN0IGV4YW1wbGVzRWwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6ICd0YXNrLWV4dHJhY3Rvci1leGFtcGxlcycgfSk7XHJcbiAgICBleGFtcGxlc0VsLmNyZWF0ZUVsKCdoNCcsIHsgdGV4dDogJ0V4YW1wbGVzOicgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IGV4YW1wbGVzTGlzdCA9IGV4YW1wbGVzRWwuY3JlYXRlRWwoJ3VsJyk7XHJcbiAgICBleGFtcGxlc0xpc3QuY3JlYXRlRWwoJ2xpJykuY3JlYXRlRWwoJ3N0cm9uZycpLnNldFRleHQoJ0V4YWN0IFBhdGhzOiAnKTtcclxuICAgIGV4YW1wbGVzTGlzdC5sYXN0Q2hpbGQ/LmNyZWF0ZUVsKCdjb2RlJykuc2V0VGV4dCgnXCJUZW1wbGF0ZXMvXCInKTtcclxuICAgIGV4YW1wbGVzTGlzdC5sYXN0Q2hpbGQ/LmFwcGVuZFRleHQoJyAtIGV4Y2x1ZGVzIGVudGlyZSBUZW1wbGF0ZXMgZm9sZGVyJyk7XHJcbiAgICBcclxuICAgIGV4YW1wbGVzTGlzdC5jcmVhdGVFbCgnbGknKS5jcmVhdGVFbCgnc3Ryb25nJykuc2V0VGV4dCgnRmlsZSBFeHRlbnNpb25zOiAnKTtcclxuICAgIGV4YW1wbGVzTGlzdC5sYXN0Q2hpbGQ/LmNyZWF0ZUVsKCdjb2RlJykuc2V0VGV4dCgnXCIqLnRtcFwiJyk7XHJcbiAgICBleGFtcGxlc0xpc3QubGFzdENoaWxkPy5hcHBlbmRUZXh0KCcgLSBleGNsdWRlcyBhbGwgLnRtcCBmaWxlcycpO1xyXG4gICAgXHJcbiAgICBleGFtcGxlc0xpc3QuY3JlYXRlRWwoJ2xpJykuY3JlYXRlRWwoJ3N0cm9uZycpLnNldFRleHQoJ05lc3RlZCBGb2xkZXJzOiAnKTtcclxuICAgIGV4YW1wbGVzTGlzdC5sYXN0Q2hpbGQ/LmNyZWF0ZUVsKCdjb2RlJykuc2V0VGV4dCgnXCIqKi9kcmFmdHMvKipcIicpO1xyXG4gICAgZXhhbXBsZXNMaXN0Lmxhc3RDaGlsZD8uYXBwZW5kVGV4dCgnIC0gZXhjbHVkZXMgYW55IGRyYWZ0cyBmb2xkZXIgYW5kIGl0cyBjb250ZW50cycpO1xyXG4gICAgXHJcbiAgICBleGFtcGxlc0xpc3QuY3JlYXRlRWwoJ2xpJykuY3JlYXRlRWwoJ3N0cm9uZycpLnNldFRleHQoJ01peGVkOiAnKTtcclxuICAgIGV4YW1wbGVzTGlzdC5sYXN0Q2hpbGQ/LmNyZWF0ZUVsKCdjb2RlJykuc2V0VGV4dCgnXCJBcmNoaXZlLyoqLCAqLnRlbXBsYXRlLm1kLCBQcml2YXRlL1wiJyk7XHJcbiAgICBleGFtcGxlc0xpc3QubGFzdENoaWxkPy5hcHBlbmRUZXh0KCcgLSBleGNsdWRlcyBBcmNoaXZlIGZvbGRlciwgdGVtcGxhdGUgZmlsZXMsIGFuZCBQcml2YXRlIGZvbGRlcicpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgc3R5bGluZyBmb3IgYmV0dGVyIHZpc3VhbCBzZXBhcmF0aW9uXHJcbiAgICBleGFtcGxlc0VsLnN0eWxlLm1hcmdpblRvcCA9ICcxNnB4JztcclxuICAgIGV4YW1wbGVzRWwuc3R5bGUucGFkZGluZyA9ICcxMnB4JztcclxuICAgIGV4YW1wbGVzRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3ZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KSc7XHJcbiAgICBleGFtcGxlc0VsLnN0eWxlLmJvcmRlclJhZGl1cyA9ICc4cHgnO1xyXG4gICAgZXhhbXBsZXNFbC5zdHlsZS5mb250U2l6ZSA9ICcwLjllbSc7XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYWRkRnJvbnRtYXR0ZXJTZWN0aW9uKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xyXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnVGFzayBOb3RlIEZyb250bWF0dGVyJyB9KTtcclxuICAgIFxyXG4gICAgLy8gQWRkIGZpZWxkIGJ1dHRvblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdBZGQgRmllbGQnKVxyXG4gICAgICAuc2V0RGVzYygnQWRkIGEgbmV3IGZyb250bWF0dGVyIGZpZWxkJylcclxuICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXHJcbiAgICAgICAgLnNldEJ1dHRvblRleHQoJ0FkZCBGaWVsZCcpXHJcbiAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncy5mcm9udG1hdHRlckZpZWxkcy5wdXNoKHtcclxuICAgICAgICAgICAga2V5OiAnbmV3X2ZpZWxkJyxcclxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogZmFsc2VcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7XHJcbiAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcclxuICAgICAgICB9KSk7XHJcbiAgICBcclxuICAgIC8vIERpc3BsYXkgZXhpc3RpbmcgZmllbGRzXHJcbiAgICB0aGlzLnNldHRpbmdzLmZyb250bWF0dGVyRmllbGRzLmZvckVhY2goKGZpZWxkLCBpbmRleCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogJ3Rhc2stZXh0cmFjdG9yLWZpZWxkJyB9KTtcclxuICAgICAgXHJcbiAgICAgIG5ldyBTZXR0aW5nKGZpZWxkQ29udGFpbmVyKVxyXG4gICAgICAgIC5zZXROYW1lKGBGaWVsZCAke2luZGV4ICsgMX06ICR7ZmllbGQua2V5fWApXHJcbiAgICAgICAgLnNldERlc2MoYFR5cGU6ICR7ZmllbGQudHlwZX0sIFJlcXVpcmVkOiAke2ZpZWxkLnJlcXVpcmVkID8gJ1llcycgOiAnTm8nfWApXHJcbiAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXHJcbiAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnUmVtb3ZlJylcclxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5mcm9udG1hdHRlckZpZWxkcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmRlYm91bmNlZFNhdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XHJcbiAgICAgICAgICB9KSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gQ3VzdG9tIHByb21wdFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdDdXN0b20gUHJvbXB0JylcclxuICAgICAgLnNldERlc2MoJ092ZXJyaWRlIHRoZSBkZWZhdWx0IHRhc2sgZXh0cmFjdGlvbiBwcm9tcHQuIExlYXZlIGVtcHR5IHRvIHVzZSBkZWZhdWx0LicpXHJcbiAgICAgIC5hZGRUZXh0QXJlYSh0ZXh0ID0+IHRleHRcclxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0VudGVyIGN1c3RvbSBwcm9tcHQuLi4nKVxyXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzLmN1c3RvbVByb21wdClcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgdGhpcy5zZXR0aW5ncy5jdXN0b21Qcm9tcHQgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfSkpO1xyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGFkZERlYnVnU2VjdGlvbihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0RlYnVnIFNldHRpbmdzJyB9KTtcclxuICAgIFxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKCdEZWJ1ZyBNb2RlJylcclxuICAgICAgLnNldERlc2MoJ0VuYWJsZSBkZWJ1ZyBsb2dnaW5nIHRvIG1vbml0b3IgcGx1Z2luIGFjdGl2aXRpZXMuIExvZ3MgYXJlIHN0b3JlZCBpbiBtZW1vcnkgb25seSBhbmQgY2xlYXJlZCB3aGVuIE9ic2lkaWFuIHJlc3RhcnRzLicpXHJcbiAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxyXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSlcclxuICAgICAgICAub25DaGFuZ2UoKHYpID0+IHsgXHJcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSA9IHY7IFxyXG4gICAgICAgICAgdGhpcy5kZWJvdW5jZWRTYXZlKCk7XHJcbiAgICAgICAgICAvLyBSZWZyZXNoIGRpc3BsYXkgdG8gc2hvdy9oaWRlIGRlYnVnIG1heCBlbnRyaWVzIHNldHRpbmdcclxuICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIFxyXG4gICAgLy8gT25seSBzaG93IG1heCBlbnRyaWVzIHNldHRpbmcgd2hlbiBkZWJ1ZyBtb2RlIGlzIGVuYWJsZWRcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSkge1xyXG4gICAgICB0aGlzLmFkZFNsaWRlcldpdGhJbnB1dChcclxuICAgICAgICBjb250YWluZXJFbCxcclxuICAgICAgICAnTWF4IERlYnVnIEVudHJpZXMnLFxyXG4gICAgICAgICdNYXhpbXVtIG51bWJlciBvZiBkZWJ1ZyBsb2cgZW50cmllcyB0byBrZWVwIGluIG1lbW9yeS4gT2xkZXIgZW50cmllcyBhcmUgYXV0b21hdGljYWxseSByZW1vdmVkLicsXHJcbiAgICAgICAgdGhpcy5zZXR0aW5ncy5kZWJ1Z01heEVudHJpZXMsXHJcbiAgICAgICAgMTAwLFxyXG4gICAgICAgIDEwMDAwLFxyXG4gICAgICAgIDEwMCxcclxuICAgICAgICAodikgPT4geyB0aGlzLnNldHRpbmdzLmRlYnVnTWF4RW50cmllcyA9IHY7IHRoaXMuZGVib3VuY2VkU2F2ZSgpOyB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYWRkQWR2YW5jZWRTZWN0aW9uKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xyXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnQWR2YW5jZWQgU2V0dGluZ3MnIH0pO1xyXG4gICAgXHJcbiAgICB0aGlzLmFkZFNsaWRlcldpdGhJbnB1dChcclxuICAgICAgY29udGFpbmVyRWwsXHJcbiAgICAgICdNYXggVG9rZW5zJyxcclxuICAgICAgJ01heGltdW0gdG9rZW5zIHRvIGdlbmVyYXRlLicsXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MubWF4VG9rZW5zLFxyXG4gICAgICAxMDAsXHJcbiAgICAgIDIwMDAsXHJcbiAgICAgIDUwLFxyXG4gICAgICAodikgPT4geyB0aGlzLnNldHRpbmdzLm1heFRva2VucyA9IHY7IHRoaXMuZGVib3VuY2VkU2F2ZSgpOyB9XHJcbiAgICApO1xyXG4gICAgXHJcbiAgICB0aGlzLmFkZFNsaWRlcldpdGhJbnB1dChcclxuICAgICAgY29udGFpbmVyRWwsXHJcbiAgICAgICdUZW1wZXJhdHVyZScsXHJcbiAgICAgICdDcmVhdGl2aXR5IGxldmVsICgwID0gZGV0ZXJtaW5pc3RpYywgMSA9IGNyZWF0aXZlKS4nLFxyXG4gICAgICB0aGlzLnNldHRpbmdzLnRlbXBlcmF0dXJlLFxyXG4gICAgICAwLFxyXG4gICAgICAxLFxyXG4gICAgICAwLjEsXHJcbiAgICAgICh2KSA9PiB7IHRoaXMuc2V0dGluZ3MudGVtcGVyYXR1cmUgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfVxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgdGhpcy5hZGRTbGlkZXJXaXRoSW5wdXQoXHJcbiAgICAgIGNvbnRhaW5lckVsLFxyXG4gICAgICAnVGltZW91dCAoc2Vjb25kcyknLFxyXG4gICAgICAnUmVxdWVzdCB0aW1lb3V0IGZvciBMTE0gY2FsbHMuJyxcclxuICAgICAgdGhpcy5zZXR0aW5ncy50aW1lb3V0LFxyXG4gICAgICAxMCxcclxuICAgICAgMTIwLFxyXG4gICAgICA1LFxyXG4gICAgICAodikgPT4geyB0aGlzLnNldHRpbmdzLnRpbWVvdXQgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfVxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgdGhpcy5hZGRTbGlkZXJXaXRoSW5wdXQoXHJcbiAgICAgIGNvbnRhaW5lckVsLFxyXG4gICAgICAnUmV0cnkgQXR0ZW1wdHMnLFxyXG4gICAgICAnTnVtYmVyIG9mIHJldHJ5IGF0dGVtcHRzIGZvciBmYWlsZWQgcmVxdWVzdHMuJyxcclxuICAgICAgdGhpcy5zZXR0aW5ncy5yZXRyaWVzLFxyXG4gICAgICAxLFxyXG4gICAgICA1LFxyXG4gICAgICAxLFxyXG4gICAgICAodikgPT4geyB0aGlzLnNldHRpbmdzLnJldHJpZXMgPSB2OyB0aGlzLmRlYm91bmNlZFNhdmUoKTsgfVxyXG4gICAgKTtcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogSGVscGVyIG1ldGhvZCB0byBjcmVhdGUgYW4gZW5oYW5jZWQgc2xpZGVyIHdpdGggaW5wdXQgZmllbGRcclxuICAgKiBQcm92aWRlcyBiaWRpcmVjdGlvbmFsIHN5bmNocm9uaXphdGlvbiBiZXR3ZWVuIHNsaWRlciBhbmQgbnVtYmVyIGlucHV0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRTbGlkZXJXaXRoSW5wdXQoXHJcbiAgICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBkZXNjOiBzdHJpbmcsXHJcbiAgICB2YWx1ZTogbnVtYmVyLFxyXG4gICAgbWluOiBudW1iZXIsXHJcbiAgICBtYXg6IG51bWJlcixcclxuICAgIHN0ZXA6IG51bWJlcixcclxuICAgIG9uQ2hhbmdlOiAodmFsdWU6IG51bWJlcikgPT4gdm9pZFxyXG4gICk6IHZvaWQge1xyXG4gICAgY29uc3Qgc2V0dGluZyA9IG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShuYW1lKVxyXG4gICAgICAuc2V0RGVzYyhkZXNjKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgY29udGFpbmVyIGZvciBzbGlkZXIgYW5kIGlucHV0XHJcbiAgICBjb25zdCBjb250cm9sQ29udGFpbmVyID0gc2V0dGluZy5jb250cm9sRWwuY3JlYXRlRGl2KHsgY2xzOiAndGFzay1leHRyYWN0b3Itc2xpZGVyLWlucHV0LWNvbnRhaW5lcicgfSk7XHJcbiAgICBcclxuICAgIC8vIENyZWF0ZSBzbGlkZXIgZWxlbWVudFxyXG4gICAgY29uc3Qgc2xpZGVyRWwgPSBjb250cm9sQ29udGFpbmVyLmNyZWF0ZUVsKCdpbnB1dCcsIHtcclxuICAgICAgdHlwZTogJ3JhbmdlJyxcclxuICAgICAgY2xzOiAndGFzay1leHRyYWN0b3Itc2xpZGVyJ1xyXG4gICAgfSkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIFxyXG4gICAgc2xpZGVyRWwubWluID0gbWluLnRvU3RyaW5nKCk7XHJcbiAgICBzbGlkZXJFbC5tYXggPSBtYXgudG9TdHJpbmcoKTtcclxuICAgIHNsaWRlckVsLnN0ZXAgPSBzdGVwLnRvU3RyaW5nKCk7XHJcbiAgICBzbGlkZXJFbC52YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICBcclxuICAgIC8vIENyZWF0ZSBudW1iZXIgaW5wdXQgZWxlbWVudFxyXG4gICAgY29uc3QgaW5wdXRFbCA9IGNvbnRyb2xDb250YWluZXIuY3JlYXRlRWwoJ2lucHV0Jywge1xyXG4gICAgICB0eXBlOiAnbnVtYmVyJyxcclxuICAgICAgY2xzOiAndGFzay1leHRyYWN0b3ItbnVtYmVyLWlucHV0J1xyXG4gICAgfSkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIFxyXG4gICAgaW5wdXRFbC5taW4gPSBtaW4udG9TdHJpbmcoKTtcclxuICAgIGlucHV0RWwubWF4ID0gbWF4LnRvU3RyaW5nKCk7XHJcbiAgICBpbnB1dEVsLnN0ZXAgPSBzdGVwLnRvU3RyaW5nKCk7XHJcbiAgICBpbnB1dEVsLnZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIFxyXG4gICAgLy8gU2xpZGVyIGNoYW5nZSBoYW5kbGVyXHJcbiAgICBzbGlkZXJFbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXJzZUZsb2F0KHNsaWRlckVsLnZhbHVlKTtcclxuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVOdW1lcmljSW5wdXQobmV3VmFsdWUsIG1pbiwgbWF4LCB2YWx1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgaW5wdXQgZmllbGQgdG8gbWF0Y2ggc2xpZGVyXHJcbiAgICAgIGlucHV0RWwudmFsdWUgPSB2YWxpZGF0aW9uLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYWxsIG9uQ2hhbmdlIGNhbGxiYWNrXHJcbiAgICAgIG9uQ2hhbmdlKHZhbGlkYXRpb24udmFsdWUpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIElucHV0IGZpZWxkIGNoYW5nZSBoYW5kbGVyXHJcbiAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmxvYXQoaW5wdXRFbC52YWx1ZSk7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlTnVtZXJpY0lucHV0KG5ld1ZhbHVlLCBtaW4sIG1heCwgdmFsdWUpO1xyXG4gICAgICBcclxuICAgICAgLy8gVXBkYXRlIGlucHV0IGZpZWxkIGlmIHZhbHVlIHdhcyBjbGFtcGVkIG9yIGludmFsaWRcclxuICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcclxuICAgICAgICBpbnB1dEVsLnZhbHVlID0gdmFsaWRhdGlvbi52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNob3cgdmFsaWRhdGlvbiBmZWVkYmFjayB3aXRoIG1lc3NhZ2VcclxuICAgICAgICB0aGlzLnNob3dWYWxpZGF0aW9uRmVlZGJhY2soaW5wdXRFbCwgdmFsaWRhdGlvbi5tZXNzYWdlIHx8ICdJbnZhbGlkIHZhbHVlJyk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBzbGlkZXIgdG8gbWF0Y2ggaW5wdXRcclxuICAgICAgc2xpZGVyRWwudmFsdWUgPSB2YWxpZGF0aW9uLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDYWxsIG9uQ2hhbmdlIGNhbGxiYWNrXHJcbiAgICAgIG9uQ2hhbmdlKHZhbGlkYXRpb24udmFsdWUpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIElucHV0IGZpZWxkIGJsdXIgaGFuZGxlciBmb3IgZmluYWwgdmFsaWRhdGlvblxyXG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHBhcnNlRmxvYXQoaW5wdXRFbC52YWx1ZSk7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlTnVtZXJpY0lucHV0KG5ld1ZhbHVlLCBtaW4sIG1heCwgdmFsdWUpO1xyXG4gICAgICBcclxuICAgICAgLy8gRW5zdXJlIGZpbmFsIHZhbHVlIGlzIHZhbGlkXHJcbiAgICAgIGlucHV0RWwudmFsdWUgPSB2YWxpZGF0aW9uLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgIHNsaWRlckVsLnZhbHVlID0gdmFsaWRhdGlvbi52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICBcclxuICAgICAgLy8gU2hvdyBmZWVkYmFjayBpZiB2YWx1ZSB3YXMgY29ycmVjdGVkXHJcbiAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5zaG93VmFsaWRhdGlvbkZlZWRiYWNrKGlucHV0RWwsIHZhbGlkYXRpb24ubWVzc2FnZSB8fCAnVmFsdWUgY29ycmVjdGVkJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgc3R5bGluZyBmb3IgYmV0dGVyIHZpc3VhbCBsYXlvdXRcclxuICAgIGNvbnRyb2xDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcclxuICAgIGNvbnRyb2xDb250YWluZXIuc3R5bGUuYWxpZ25JdGVtcyA9ICdjZW50ZXInO1xyXG4gICAgY29udHJvbENvbnRhaW5lci5zdHlsZS5nYXAgPSAnMTJweCc7XHJcbiAgICBjb250cm9sQ29udGFpbmVyLnN0eWxlLndpZHRoID0gJzEwMCUnO1xyXG4gICAgXHJcbiAgICBzbGlkZXJFbC5zdHlsZS5mbGV4ID0gJzEnO1xyXG4gICAgc2xpZGVyRWwuc3R5bGUubWluV2lkdGggPSAnMTIwcHgnO1xyXG4gICAgc2xpZGVyRWwuc3R5bGUuaGVpZ2h0ID0gJzIwcHgnO1xyXG4gICAgXHJcbiAgICBpbnB1dEVsLnN0eWxlLndpZHRoID0gJzgwcHgnO1xyXG4gICAgaW5wdXRFbC5zdHlsZS50ZXh0QWxpZ24gPSAnY2VudGVyJztcclxuICAgIGlucHV0RWwuc3R5bGUucGFkZGluZyA9ICc0cHggOHB4JztcclxuICAgIGlucHV0RWwuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlciknO1xyXG4gICAgaW5wdXRFbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnNHB4JztcclxuICAgIGlucHV0RWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3ZhcigtLWJhY2tncm91bmQtcHJpbWFyeSknO1xyXG4gICAgaW5wdXRFbC5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0LW5vcm1hbCknO1xyXG4gICAgaW5wdXRFbC5zdHlsZS5mb250U2l6ZSA9ICcxM3B4JztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlU2VydmljZVN0YXR1cyhzdGF0dXNFbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuICAgIHN0YXR1c0VsLmVtcHR5KCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5zZXR0aW5ncy5wcm92aWRlcjtcclxuICAgIGNvbnN0IHNlcnZpY2UgPSB0aGlzLmxsbVByb3ZpZGVyLmdldFNlcnZpY2VDYWNoZSgpLmdldChwcm92aWRlcik7XHJcbiAgICBcclxuICAgIGlmIChbJ29sbGFtYScsICdsbXN0dWRpbyddLmluY2x1ZGVzKHByb3ZpZGVyKSkge1xyXG4gICAgICBpZiAoc2VydmljZT8uYXZhaWxhYmxlKSB7XHJcbiAgICAgICAgc3RhdHVzRWwuY3JlYXRlRWwoJ2RpdicsIHsgXHJcbiAgICAgICAgICB0ZXh0OiBgXHUyNzA1ICR7cHJvdmlkZXJ9IGNvbm5lY3RlZCAoJHtzZXJ2aWNlLm1vZGVscy5sZW5ndGh9IG1vZGVscylgLFxyXG4gICAgICAgICAgY2xzOiAndGFzay1leHRyYWN0b3Itc3RhdHVzLXN1Y2Nlc3MnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3RhdHVzRWwuY3JlYXRlRWwoJ2RpdicsIHsgXHJcbiAgICAgICAgICB0ZXh0OiBgXHUyNzRDICR7cHJvdmlkZXJ9IG5vdCBhdmFpbGFibGVgLFxyXG4gICAgICAgICAgY2xzOiAndGFzay1leHRyYWN0b3Itc3RhdHVzLWVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodGhpcy5zZXR0aW5ncy5hcGlLZXkpIHtcclxuICAgICAgICBzdGF0dXNFbC5jcmVhdGVFbCgnZGl2JywgeyBcclxuICAgICAgICAgIHRleHQ6IGBcdTI3MDUgJHtwcm92aWRlcn0gQVBJIGtleSBjb25maWd1cmVkYCxcclxuICAgICAgICAgIGNsczogJ3Rhc2stZXh0cmFjdG9yLXN0YXR1cy1zdWNjZXNzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHN0YXR1c0VsLmNyZWF0ZUVsKCdkaXYnLCB7IFxyXG4gICAgICAgICAgdGV4dDogYFx1Mjc0QyAke3Byb3ZpZGVyfSBBUEkga2V5IHJlcXVpcmVkYCxcclxuICAgICAgICAgIGNsczogJ3Rhc2stZXh0cmFjdG9yLXN0YXR1cy1lcnJvcidcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufSIsICIvKipcclxuICogRGVidWcgbG9nZ2luZyBpbmZyYXN0cnVjdHVyZSBmb3IgdGhlIE9ic2lkaWFuIFRhc2sgRXh0cmFjdG9yIHBsdWdpblxyXG4gKiBQcm92aWRlcyBjb21wcmVoZW5zaXZlIGxvZ2dpbmcgY2FwYWJpbGl0aWVzIHdpdGggY29ycmVsYXRpb24gdHJhY2tpbmcgYW5kIG1lbW9yeSBtYW5hZ2VtZW50XHJcbiAqL1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBEZWJ1Z0xvZ0VudHJ5IHtcclxuICB0aW1lc3RhbXA6IG51bWJlcjtcclxuICBsZXZlbDogJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJztcclxuICBjYXRlZ29yeTogJ2ZpbGUtcHJvY2Vzc2luZycgfCAnbGxtLWNhbGwnIHwgJ3Rhc2stY3JlYXRpb24nIHwgJ3NlcnZpY2UtZGV0ZWN0aW9uJyB8ICd2YWxpZGF0aW9uJyB8ICdlcnJvcic7XHJcbiAgbWVzc2FnZTogc3RyaW5nO1xyXG4gIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmc7XHJcbiAgZGF0YT86IHtcclxuICAgIGZpbGVQYXRoPzogc3RyaW5nO1xyXG4gICAgcHJvdmlkZXI/OiBzdHJpbmc7XHJcbiAgICBtb2RlbD86IHN0cmluZztcclxuICAgIHRva2VuVXNhZ2U/OiBudW1iZXI7XHJcbiAgICByZXF1ZXN0UGF5bG9hZD86IGFueTtcclxuICAgIHJlc3BvbnNlRGF0YT86IGFueTtcclxuICAgIGVycm9yPzogc3RyaW5nO1xyXG4gICAgcHJvY2Vzc2luZ1RpbWU/OiBudW1iZXI7XHJcbiAgICByZXRyeUF0dGVtcHQ/OiBudW1iZXI7XHJcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XHJcbiAgfTtcclxuICBlcnJvckNvbnRleHQ/OiBFcnJvckNvbnRleHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRXJyb3JDb250ZXh0IHtcclxuICBlcnJvck5hbWU/OiBzdHJpbmc7XHJcbiAgZXJyb3JNZXNzYWdlPzogc3RyaW5nO1xyXG4gIGVycm9yU3RhY2s/OiBzdHJpbmc7XHJcbiAgb3JpZ2luYWxFcnJvcj86IGFueTtcclxuICBhZGRpdGlvbmFsRGF0YT86IGFueTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uQ29udGV4dCB7XHJcbiAgdmFsaWRhdGlvblR5cGU6ICdzZXR0aW5ncycgfCAnZnJvbnRtYXR0ZXInIHwgJ2ZpZWxkJyB8ICdhcGknO1xyXG4gIGZpZWxkTmFtZTogc3RyaW5nO1xyXG4gIHByb3ZpZGVkVmFsdWU6IGFueTtcclxuICBleHBlY3RlZEZvcm1hdDogc3RyaW5nO1xyXG4gIGVycm9yUmVhc29uOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGVidWdMb2dnZXJDb25maWcge1xyXG4gIGVuYWJsZWQ6IGJvb2xlYW47XHJcbiAgbWF4RW50cmllczogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRGVidWdMb2dnZXIge1xyXG4gIHByaXZhdGUgbG9nczogRGVidWdMb2dFbnRyeVtdID0gW107XHJcbiAgcHJpdmF0ZSBjb25maWc6IERlYnVnTG9nZ2VyQ29uZmlnO1xyXG4gIHByaXZhdGUgY29ycmVsYXRpb25Db3VudGVyOiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgbG9nRmFpbHVyZUNvdW50OiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4TG9nRmFpbHVyZXM6IG51bWJlciA9IDU7XHJcbiAgXHJcbiAgLy8gUGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIGZpZWxkc1xyXG4gIHByaXZhdGUgZW50cnlQb29sOiBEZWJ1Z0xvZ0VudHJ5W10gPSBbXTtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1heFBvb2xTaXplOiBudW1iZXIgPSAxMDA7XHJcbiAgcHJpdmF0ZSBsYXN0Q2xlYW51cFRpbWU6IG51bWJlciA9IDA7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjbGVhbnVwSW50ZXJ2YWw6IG51bWJlciA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzXHJcbiAgcHJpdmF0ZSBsb2dDb3VudDogbnVtYmVyID0gMDtcclxuICBwcml2YXRlIHRvdGFsTG9nVGltZTogbnVtYmVyID0gMDtcclxuXHJcbiAgY29uc3RydWN0b3IoY29uZmlnOiBEZWJ1Z0xvZ2dlckNvbmZpZykge1xyXG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgYSBkZWJ1ZyBlbnRyeSB3aXRoIHNwZWNpZmllZCBsZXZlbCwgY2F0ZWdvcnksIGFuZCBvcHRpb25hbCBkYXRhXHJcbiAgICogT3B0aW1pemVkIHdpdGggb2JqZWN0IHBvb2xpbmcgYW5kIG1lbW9yeSBtYW5hZ2VtZW50XHJcbiAgICovXHJcbiAgbG9nKFxyXG4gICAgbGV2ZWw6ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicsXHJcbiAgICBjYXRlZ29yeTogRGVidWdMb2dFbnRyeVsnY2F0ZWdvcnknXSxcclxuICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgIGRhdGE/OiBEZWJ1Z0xvZ0VudHJ5WydkYXRhJ10sXHJcbiAgICBjb3JyZWxhdGlvbklkPzogc3RyaW5nXHJcbiAgKTogdm9pZCB7XHJcbiAgICAvLyBTa2lwIGxvZ2dpbmcgaWYgZGVidWcgbW9kZSBpcyBkaXNhYmxlZCBmb3IgemVybyBwZXJmb3JtYW5jZSBpbXBhY3RcclxuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zYWZlTG9nKCgpID0+IHtcclxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVc2Ugb2JqZWN0IHBvb2xpbmcgdG8gcmVkdWNlIEdDIHByZXNzdXJlXHJcbiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5nZXRQb29sZWRFbnRyeSgpO1xyXG4gICAgICBlbnRyeS50aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgICBlbnRyeS5sZXZlbCA9IGxldmVsO1xyXG4gICAgICBlbnRyeS5jYXRlZ29yeSA9IGNhdGVnb3J5O1xyXG4gICAgICBlbnRyeS5tZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgZW50cnkuY29ycmVsYXRpb25JZCA9IGNvcnJlbGF0aW9uSWQ7XHJcbiAgICAgIGVudHJ5LmRhdGEgPSBkYXRhID8gdGhpcy5jbG9uZURhdGEoZGF0YSkgOiB1bmRlZmluZWQ7XHJcbiAgICAgIGVudHJ5LmVycm9yQ29udGV4dCA9IHVuZGVmaW5lZDsgLy8gQ2xlYXIgYW55IHByZXZpb3VzIGVycm9yIGNvbnRleHRcclxuXHJcbiAgICAgIHRoaXMubG9ncy5wdXNoKGVudHJ5KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBlcmZvcm1hbmNlIHRyYWNraW5nXHJcbiAgICAgIHRoaXMubG9nQ291bnQrKztcclxuICAgICAgdGhpcy50b3RhbExvZ1RpbWUgKz0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgICAvLyBQZXJmb3JtIG1lbW9yeSBtYW5hZ2VtZW50IHdpdGggYXV0b21hdGljIHJvdGF0aW9uXHJcbiAgICAgIHRoaXMucGVyZm9ybU1lbW9yeU1hbmFnZW1lbnQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSBuZXcgb3BlcmF0aW9uIGFuZCByZXR1cm4gYSBjb3JyZWxhdGlvbiBJRCBmb3IgdHJhY2tpbmcgcmVsYXRlZCBsb2cgZW50cmllc1xyXG4gICAqL1xyXG4gIHN0YXJ0T3BlcmF0aW9uKFxyXG4gICAgY2F0ZWdvcnk6IERlYnVnTG9nRW50cnlbJ2NhdGVnb3J5J10sXHJcbiAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICBkYXRhPzogRGVidWdMb2dFbnRyeVsnZGF0YSddXHJcbiAgKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGNvcnJlbGF0aW9uSWQgPSBgb3AtJHsrK3RoaXMuY29ycmVsYXRpb25Db3VudGVyfS0ke0RhdGUubm93KCl9YDtcclxuICAgIHRoaXMubG9nKCdpbmZvJywgY2F0ZWdvcnksIG1lc3NhZ2UsIGRhdGEsIGNvcnJlbGF0aW9uSWQpO1xyXG4gICAgcmV0dXJuIGNvcnJlbGF0aW9uSWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIGN1cnJlbnQgbG9nIGVudHJpZXNcclxuICAgKi9cclxuICBnZXRMb2dzKCk6IERlYnVnTG9nRW50cnlbXSB7XHJcbiAgICByZXR1cm4gWy4uLnRoaXMubG9nc107IC8vIFJldHVybiBhIGNvcHkgdG8gcHJldmVudCBleHRlcm5hbCBtb2RpZmljYXRpb25cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIGFsbCBsb2cgZW50cmllcyBhbmQgcmV0dXJuIHRoZW0gdG8gcG9vbFxyXG4gICAqL1xyXG4gIGNsZWFyTG9ncygpOiB2b2lkIHtcclxuICAgIC8vIFJldHVybiBlbnRyaWVzIHRvIHBvb2wgYmVmb3JlIGNsZWFyaW5nXHJcbiAgICB0aGlzLnJldHVybkVudHJpZXNUb1Bvb2wodGhpcy5sb2dzKTtcclxuICAgIHRoaXMubG9ncyA9IFtdO1xyXG4gICAgdGhpcy5jb3JyZWxhdGlvbkNvdW50ZXIgPSAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXhwb3J0IGxvZ3MgYXMgZm9ybWF0dGVkIHRleHQgc3RyaW5nIHdpdGggb3B0aW1pemVkIHNlcmlhbGl6YXRpb25cclxuICAgKi9cclxuICBleHBvcnRMb2dzKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5sb2dzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gJ05vIGRlYnVnIGxvZ3MgYXZhaWxhYmxlLic7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIGEgbW9yZSBlZmZpY2llbnQgc3RyaW5nIGJ1aWxkaW5nIGFwcHJvYWNoXHJcbiAgICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSBbXTtcclxuICAgIHBhcnRzLnB1c2goJz09PSBPYnNpZGlhbiBUYXNrIEV4dHJhY3RvciBEZWJ1ZyBMb2dzID09PVxcbicpO1xyXG4gICAgcGFydHMucHVzaChgR2VuZXJhdGVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cXG5gKTtcclxuICAgIHBhcnRzLnB1c2goYFRvdGFsIEVudHJpZXM6ICR7dGhpcy5sb2dzLmxlbmd0aH1cXG5gKTtcclxuICAgIHBhcnRzLnB1c2goJycpO1xyXG5cclxuICAgIC8vIFByZS1hbGxvY2F0ZSB3aXRoIGVzdGltYXRlZCBjYXBhY2l0eSB0byByZWR1Y2UgYXJyYXkgcmVzaXppbmdcclxuICAgIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IG5ldyBBcnJheSh0aGlzLmxvZ3MubGVuZ3RoICogMyk7XHJcbiAgICBsZXQgbGluZUluZGV4ID0gMDtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHRoaXMubG9ncykge1xyXG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZShlbnRyeS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCk7XHJcbiAgICAgIGNvbnN0IGNvcnJlbGF0aW9uUGFydCA9IGVudHJ5LmNvcnJlbGF0aW9uSWQgPyBgIFske2VudHJ5LmNvcnJlbGF0aW9uSWR9XWAgOiAnJztcclxuICAgICAgXHJcbiAgICAgIGxpbmVzW2xpbmVJbmRleCsrXSA9IGBbJHt0aW1lc3RhbXB9XSAke2VudHJ5LmxldmVsLnRvVXBwZXJDYXNlKCl9ICR7ZW50cnkuY2F0ZWdvcnl9JHtjb3JyZWxhdGlvblBhcnR9OiAke2VudHJ5Lm1lc3NhZ2V9YDtcclxuICAgICAgXHJcbiAgICAgIGlmIChlbnRyeS5kYXRhICYmIE9iamVjdC5rZXlzKGVudHJ5LmRhdGEpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgLy8gVXNlIG9wdGltaXplZCBzZXJpYWxpemF0aW9uIGZvciBwZXJmb3JtYW5jZVxyXG4gICAgICAgICAgY29uc3Qgc2VyaWFsaXplZERhdGEgPSB0aGlzLm9wdGltaXplZFN0cmluZ2lmeShlbnRyeS5kYXRhKTtcclxuICAgICAgICAgIGxpbmVzW2xpbmVJbmRleCsrXSA9IGAgIERhdGE6ICR7c2VyaWFsaXplZERhdGEuc3BsaXQoJ1xcbicpLmpvaW4oJ1xcbiAgJyl9YDtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgbGluZXNbbGluZUluZGV4KytdID0gJyAgRGF0YTogW1NlcmlhbGl6YXRpb24gRXJyb3JdJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGxpbmVzW2xpbmVJbmRleCsrXSA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRyaW0gdGhlIGFycmF5IHRvIGFjdHVhbCBzaXplXHJcbiAgICBsaW5lcy5sZW5ndGggPSBsaW5lSW5kZXg7XHJcbiAgICBwYXJ0cy5wdXNoKGxpbmVzLmpvaW4oJ1xcbicpKTtcclxuXHJcbiAgICByZXR1cm4gcGFydHMuam9pbignXFxuJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgb2xkIGVudHJpZXMgdG8gbWFpbnRhaW4gbWVtb3J5IGxpbWl0cyB3aXRoIGF1dG9tYXRpYyByb3RhdGlvblxyXG4gICAqIEtlZXBzIHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzIHVwIHRvIG1heEVudHJpZXMgbGltaXRcclxuICAgKi9cclxuICBjbGVhbnVwKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMubG9ncy5sZW5ndGggPiB0aGlzLmNvbmZpZy5tYXhFbnRyaWVzKSB7XHJcbiAgICAgIC8vIEtlZXAgb25seSB0aGUgbW9zdCByZWNlbnQgbWF4RW50cmllc1xyXG4gICAgICBjb25zdCBlbnRyaWVzVG9SZW1vdmUgPSB0aGlzLmxvZ3MubGVuZ3RoIC0gdGhpcy5jb25maWcubWF4RW50cmllcztcclxuICAgICAgY29uc3QgcmVtb3ZlZEVudHJpZXMgPSB0aGlzLmxvZ3Muc3BsaWNlKDAsIGVudHJpZXNUb1JlbW92ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXR1cm4gcmVtb3ZlZCBlbnRyaWVzIHRvIHBvb2xcclxuICAgICAgdGhpcy5yZXR1cm5FbnRyaWVzVG9Qb29sKHJlbW92ZWRFbnRyaWVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSB0aGUgbG9nZ2VyIGNvbmZpZ3VyYXRpb24gd2l0aCBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25zXHJcbiAgICovXHJcbiAgdXBkYXRlQ29uZmlnKGNvbmZpZzogUGFydGlhbDxEZWJ1Z0xvZ2dlckNvbmZpZz4pOiB2b2lkIHtcclxuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4uY29uZmlnIH07XHJcbiAgICBcclxuICAgIC8vIElmIGRlYnVnIG1vZGUgd2FzIGRpc2FibGVkLCBjbGVhciBsb2dzIHRvIGZyZWUgbWVtb3J5XHJcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZWQpIHtcclxuICAgICAgdGhpcy5jbGVhckxvZ3MoKTtcclxuICAgICAgLy8gQWxzbyBjbGVhciB0aGUgcG9vbCB0byBmcmVlIG1lbW9yeVxyXG4gICAgICB0aGlzLmVudHJ5UG9vbCA9IFtdO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBJZiBtYXhFbnRyaWVzIHdhcyByZWR1Y2VkLCBjbGVhbnVwIGltbWVkaWF0ZWx5XHJcbiAgICBpZiAodGhpcy5sb2dzLmxlbmd0aCA+IHRoaXMuY29uZmlnLm1heEVudHJpZXMpIHtcclxuICAgICAgdGhpcy5jbGVhbnVwKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgZ2V0Q29uZmlnKCk6IERlYnVnTG9nZ2VyQ29uZmlnIHtcclxuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiBkZWJ1ZyBsb2dnaW5nIGlzIGN1cnJlbnRseSBlbmFibGVkXHJcbiAgICovXHJcbiAgaXNFbmFibGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmVuYWJsZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgYW4gZXJyb3Igd2l0aCBkZXRhaWxlZCBjb250ZXh0IGluY2x1ZGluZyBzdGFjayB0cmFjZVxyXG4gICAqIE9wdGltaXplZCB3aXRoIG9iamVjdCBwb29saW5nXHJcbiAgICovXHJcbiAgbG9nRXJyb3IoXHJcbiAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICBlcnJvcjogRXJyb3IgfCB1bmtub3duLFxyXG4gICAgY2F0ZWdvcnk6IERlYnVnTG9nRW50cnlbJ2NhdGVnb3J5J10gPSAnZXJyb3InLFxyXG4gICAgYWRkaXRpb25hbERhdGE/OiBhbnksXHJcbiAgICBjb3JyZWxhdGlvbklkPzogc3RyaW5nXHJcbiAgKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2FmZUxvZygoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICBjb25zdCBlcnJvckNvbnRleHQgPSB0aGlzLmV4dHJhY3RFcnJvckNvbnRleHQoZXJyb3IsIGFkZGl0aW9uYWxEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5nZXRQb29sZWRFbnRyeSgpO1xyXG4gICAgICBlbnRyeS50aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgICBlbnRyeS5sZXZlbCA9ICdlcnJvcic7XHJcbiAgICAgIGVudHJ5LmNhdGVnb3J5ID0gY2F0ZWdvcnk7XHJcbiAgICAgIGVudHJ5Lm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG4gICAgICBlbnRyeS5kYXRhID0gYWRkaXRpb25hbERhdGEgPyB0aGlzLmNsb25lRGF0YShhZGRpdGlvbmFsRGF0YSkgOiB1bmRlZmluZWQ7XHJcbiAgICAgIGVudHJ5LmNvcnJlbGF0aW9uSWQgPSBjb3JyZWxhdGlvbklkO1xyXG4gICAgICBlbnRyeS5lcnJvckNvbnRleHQgPSBlcnJvckNvbnRleHQ7XHJcblxyXG4gICAgICB0aGlzLmxvZ3MucHVzaChlbnRyeSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBQZXJmb3JtYW5jZSB0cmFja2luZ1xyXG4gICAgICB0aGlzLmxvZ0NvdW50Kys7XHJcbiAgICAgIHRoaXMudG90YWxMb2dUaW1lICs9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG5cclxuICAgICAgLy8gUGVyZm9ybSBtZW1vcnkgbWFuYWdlbWVudFxyXG4gICAgICB0aGlzLnBlcmZvcm1NZW1vcnlNYW5hZ2VtZW50KCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZyB2YWxpZGF0aW9uIGVycm9ycyB3aXRoIGRldGFpbGVkIGZpZWxkIGFuZCB2YWx1ZSBjb250ZXh0XHJcbiAgICogT3B0aW1pemVkIHdpdGggb2JqZWN0IHBvb2xpbmdcclxuICAgKi9cclxuICBsb2dWYWxpZGF0aW9uKFxyXG4gICAgdmFsaWRhdGlvblR5cGU6ICdzZXR0aW5ncycgfCAnZnJvbnRtYXR0ZXInIHwgJ2ZpZWxkJyB8ICdhcGknLFxyXG4gICAgZmllbGROYW1lOiBzdHJpbmcsXHJcbiAgICBwcm92aWRlZFZhbHVlOiBhbnksXHJcbiAgICBleHBlY3RlZEZvcm1hdDogc3RyaW5nLFxyXG4gICAgZXJyb3JSZWFzb246IHN0cmluZyxcclxuICAgIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmdcclxuICApOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zYWZlTG9nKCgpID0+IHtcclxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25Db250ZXh0OiBWYWxpZGF0aW9uQ29udGV4dCA9IHtcclxuICAgICAgICB2YWxpZGF0aW9uVHlwZSxcclxuICAgICAgICBmaWVsZE5hbWUsXHJcbiAgICAgICAgcHJvdmlkZWRWYWx1ZTogdGhpcy5zYW5pdGl6ZVZhbHVlKHByb3ZpZGVkVmFsdWUpLFxyXG4gICAgICAgIGV4cGVjdGVkRm9ybWF0LFxyXG4gICAgICAgIGVycm9yUmVhc29uXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBlbnRyeSA9IHRoaXMuZ2V0UG9vbGVkRW50cnkoKTtcclxuICAgICAgZW50cnkudGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgICAgZW50cnkubGV2ZWwgPSAnd2Fybic7XHJcbiAgICAgIGVudHJ5LmNhdGVnb3J5ID0gJ3ZhbGlkYXRpb24nO1xyXG4gICAgICBlbnRyeS5tZXNzYWdlID0gYFZhbGlkYXRpb24gZmFpbGVkIGZvciAke3ZhbGlkYXRpb25UeXBlfS4ke2ZpZWxkTmFtZX06ICR7ZXJyb3JSZWFzb259YDtcclxuICAgICAgZW50cnkuZGF0YSA9IHZhbGlkYXRpb25Db250ZXh0O1xyXG4gICAgICBlbnRyeS5jb3JyZWxhdGlvbklkID0gY29ycmVsYXRpb25JZDtcclxuICAgICAgZW50cnkuZXJyb3JDb250ZXh0ID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgdGhpcy5sb2dzLnB1c2goZW50cnkpO1xyXG4gICAgICBcclxuICAgICAgLy8gUGVyZm9ybWFuY2UgdHJhY2tpbmdcclxuICAgICAgdGhpcy5sb2dDb3VudCsrO1xyXG4gICAgICB0aGlzLnRvdGFsTG9nVGltZSArPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICAgIC8vIFBlcmZvcm0gbWVtb3J5IG1hbmFnZW1lbnRcclxuICAgICAgdGhpcy5wZXJmb3JtTWVtb3J5TWFuYWdlbWVudCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgc3VjY2Vzc2Z1bCB2YWxpZGF0aW9uIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXNcclxuICAgKi9cclxuICBsb2dWYWxpZGF0aW9uU3VjY2VzcyhcclxuICAgIHZhbGlkYXRpb25UeXBlOiAnc2V0dGluZ3MnIHwgJ2Zyb250bWF0dGVyJyB8ICdmaWVsZCcgfCAnYXBpJyxcclxuICAgIGZpZWxkTmFtZTogc3RyaW5nLFxyXG4gICAgY29ycmVsYXRpb25JZD86IHN0cmluZ1xyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNhZmVMb2coKCkgPT4ge1xyXG4gICAgICB0aGlzLmxvZygnaW5mbycsICd2YWxpZGF0aW9uJywgXHJcbiAgICAgICAgYFZhbGlkYXRpb24gcGFzc2VkIGZvciAke3ZhbGlkYXRpb25UeXBlfS4ke2ZpZWxkTmFtZX1gLCBcclxuICAgICAgICB7IHZhbGlkYXRpb25UeXBlLCBmaWVsZE5hbWUgfSwgXHJcbiAgICAgICAgY29ycmVsYXRpb25JZFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYWZlbHkgZXhlY3V0ZSBsb2dnaW5nIHdpdGggZ3JhY2VmdWwgZGVncmFkYXRpb25cclxuICAgKi9cclxuICBwcml2YXRlIHNhZmVMb2cobG9nT3BlcmF0aW9uOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2dPcGVyYXRpb24oKTtcclxuICAgICAgLy8gUmVzZXQgZmFpbHVyZSBjb3VudCBvbiBzdWNjZXNzZnVsIGxvZ1xyXG4gICAgICB0aGlzLmxvZ0ZhaWx1cmVDb3VudCA9IDA7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmhhbmRsZUxvZ2dpbmdGYWlsdXJlKGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZSBsb2dnaW5nIGZhaWx1cmVzIHdpdGggZ3JhY2VmdWwgZGVncmFkYXRpb25cclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZUxvZ2dpbmdGYWlsdXJlKGVycm9yOiB1bmtub3duKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZ0ZhaWx1cmVDb3VudCsrO1xyXG4gICAgXHJcbiAgICAvLyBJZiB3ZSd2ZSBleGNlZWRlZCBtYXggZmFpbHVyZXMsIGRpc2FibGUgbG9nZ2luZyB0byBwcmV2ZW50IGluZmluaXRlIGxvb3BzXHJcbiAgICBpZiAodGhpcy5sb2dGYWlsdXJlQ291bnQgPj0gdGhpcy5tYXhMb2dGYWlsdXJlcykge1xyXG4gICAgICB0aGlzLmNvbmZpZy5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgIGNvbnNvbGUud2FybignRGVidWdMb2dnZXI6IERpc2FibGVkIGFmdGVyIHJlcGVhdGVkIGZhaWx1cmVzLiBMYXN0IGVycm9yOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZhbGwgYmFjayB0byBjb25zb2xlIHdhcm5pbmcgZm9yIGNyaXRpY2FsIGxvZ2dpbmcgZmFpbHVyZXNcclxuICAgIGNvbnNvbGUud2FybignRGVidWdMb2dnZXI6IExvZ2dpbmcgb3BlcmF0aW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeHRyYWN0IGNvbXByZWhlbnNpdmUgZXJyb3IgY29udGV4dCBmcm9tIGVycm9yIG9iamVjdHNcclxuICAgKi9cclxuICBwcml2YXRlIGV4dHJhY3RFcnJvckNvbnRleHQoZXJyb3I6IEVycm9yIHwgdW5rbm93biwgYWRkaXRpb25hbERhdGE/OiBhbnkpOiBFcnJvckNvbnRleHQge1xyXG4gICAgY29uc3QgY29udGV4dDogRXJyb3JDb250ZXh0ID0ge1xyXG4gICAgICBhZGRpdGlvbmFsRGF0YVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICBjb250ZXh0LmVycm9yTmFtZSA9IGVycm9yLm5hbWU7XHJcbiAgICAgIGNvbnRleHQuZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcclxuICAgICAgY29udGV4dC5lcnJvclN0YWNrID0gZXJyb3Iuc3RhY2s7XHJcbiAgICB9IGVsc2UgaWYgKGVycm9yICYmIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb250ZXh0Lm9yaWdpbmFsRXJyb3IgPSBKU09OLnN0cmluZ2lmeShlcnJvcik7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIGNvbnRleHQub3JpZ2luYWxFcnJvciA9IFN0cmluZyhlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnRleHQub3JpZ2luYWxFcnJvciA9IFN0cmluZyhlcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNvbnRleHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYW5pdGl6ZSB2YWx1ZXMgdG8gcHJldmVudCBsb2dnaW5nIHNlbnNpdGl2ZSBpbmZvcm1hdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2FuaXRpemVWYWx1ZSh2YWx1ZTogYW55KTogYW55IHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIC8vIFNhbml0aXplIHBvdGVudGlhbCBBUEkga2V5cyBvciB0b2tlbnMgKHNob3cgb25seSBmaXJzdC9sYXN0IDQgY2hhcnMpXHJcbiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxMCAmJiAvXlthLXpBLVowLTlfLV0rJC8udGVzdCh2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gYCR7dmFsdWUuc3Vic3RyaW5nKDAsIDQpfS4uLiR7dmFsdWUuc3Vic3RyaW5nKHZhbHVlLmxlbmd0aCAtIDQpfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgY29uc3Qgc2FuaXRpemVkID0geyAuLi52YWx1ZSB9O1xyXG4gICAgICAvLyBTYW5pdGl6ZSBjb21tb24gc2Vuc2l0aXZlIGZpZWxkIG5hbWVzXHJcbiAgICAgIGNvbnN0IHNlbnNpdGl2ZUZpZWxkcyA9IFsnYXBpS2V5JywgJ3Rva2VuJywgJ3Bhc3N3b3JkJywgJ3NlY3JldCcsICdrZXknXTtcclxuICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBzZW5zaXRpdmVGaWVsZHMpIHtcclxuICAgICAgICBpZiAoZmllbGQgaW4gc2FuaXRpemVkKSB7XHJcbiAgICAgICAgICBzYW5pdGl6ZWRbZmllbGRdID0gJ1tSRURBQ1RFRF0nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc2FuaXRpemVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB2YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhIHBvb2xlZCBlbnRyeSBvciBjcmVhdGUgYSBuZXcgb25lIHRvIHJlZHVjZSBHQyBwcmVzc3VyZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UG9vbGVkRW50cnkoKTogRGVidWdMb2dFbnRyeSB7XHJcbiAgICBpZiAodGhpcy5lbnRyeVBvb2wubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5lbnRyeVBvb2wucG9wKCkhO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgbmV3IGVudHJ5IGlmIHBvb2wgaXMgZW1wdHlcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRpbWVzdGFtcDogMCxcclxuICAgICAgbGV2ZWw6ICdpbmZvJyxcclxuICAgICAgY2F0ZWdvcnk6ICdmaWxlLXByb2Nlc3NpbmcnLFxyXG4gICAgICBtZXNzYWdlOiAnJyxcclxuICAgICAgY29ycmVsYXRpb25JZDogdW5kZWZpbmVkLFxyXG4gICAgICBkYXRhOiB1bmRlZmluZWQsXHJcbiAgICAgIGVycm9yQ29udGV4dDogdW5kZWZpbmVkXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIGVudHJpZXMgdG8gdGhlIHBvb2wgZm9yIHJldXNlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZXR1cm5FbnRyaWVzVG9Qb29sKGVudHJpZXM6IERlYnVnTG9nRW50cnlbXSk6IHZvaWQge1xyXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XHJcbiAgICAgIC8vIENsZWFyIHJlZmVyZW5jZXMgdG8gcHJldmVudCBtZW1vcnkgbGVha3NcclxuICAgICAgZW50cnkuZGF0YSA9IHVuZGVmaW5lZDtcclxuICAgICAgZW50cnkuZXJyb3JDb250ZXh0ID0gdW5kZWZpbmVkO1xyXG4gICAgICBlbnRyeS5jb3JyZWxhdGlvbklkID0gdW5kZWZpbmVkO1xyXG4gICAgICBlbnRyeS5tZXNzYWdlID0gJyc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBPbmx5IHBvb2wgaWYgd2UgaGF2ZW4ndCBleGNlZWRlZCBtYXggcG9vbCBzaXplXHJcbiAgICAgIGlmICh0aGlzLmVudHJ5UG9vbC5sZW5ndGggPCB0aGlzLm1heFBvb2xTaXplKSB7XHJcbiAgICAgICAgdGhpcy5lbnRyeVBvb2wucHVzaChlbnRyeSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wdGltaXplZCBtZW1vcnkgbWFuYWdlbWVudCB3aXRoIGF1dG9tYXRpYyByb3RhdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgcGVyZm9ybU1lbW9yeU1hbmFnZW1lbnQoKTogdm9pZCB7XHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgXHJcbiAgICAvLyBQZXJmb3JtIGNsZWFudXAgaWYgd2UgZXhjZWVkIG1heEVudHJpZXNcclxuICAgIGlmICh0aGlzLmxvZ3MubGVuZ3RoID4gdGhpcy5jb25maWcubWF4RW50cmllcykge1xyXG4gICAgICB0aGlzLmNsZWFudXAoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUGVyZm9ybSBwZXJpb2RpYyBjbGVhbnVwIHRvIHByZXZlbnQgbWVtb3J5IGJsb2F0XHJcbiAgICBpZiAobm93IC0gdGhpcy5sYXN0Q2xlYW51cFRpbWUgPiB0aGlzLmNsZWFudXBJbnRlcnZhbCkge1xyXG4gICAgICB0aGlzLnBlcmlvZGljQ2xlYW51cCgpO1xyXG4gICAgICB0aGlzLmxhc3RDbGVhbnVwVGltZSA9IG5vdztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBlcmlvZGljIGNsZWFudXAgdG8gbWFuYWdlIG1lbW9yeSBhbmQgcG9vbCBzaXplXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwZXJpb2RpY0NsZWFudXAoKTogdm9pZCB7XHJcbiAgICAvLyBUcmltIHBvb2wgaWYgaXQncyBncm93biB0b28gbGFyZ2VcclxuICAgIGlmICh0aGlzLmVudHJ5UG9vbC5sZW5ndGggPiB0aGlzLm1heFBvb2xTaXplKSB7XHJcbiAgICAgIHRoaXMuZW50cnlQb29sLmxlbmd0aCA9IHRoaXMubWF4UG9vbFNpemU7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZvcmNlIGNsZWFudXAgaWYgd2UncmUgYXBwcm9hY2hpbmcgbWVtb3J5IGxpbWl0c1xyXG4gICAgY29uc3QgbWVtb3J5VGhyZXNob2xkID0gdGhpcy5jb25maWcubWF4RW50cmllcyAqIDAuODtcclxuICAgIGlmICh0aGlzLmxvZ3MubGVuZ3RoID4gbWVtb3J5VGhyZXNob2xkKSB7XHJcbiAgICAgIGNvbnN0IGVudHJpZXNUb1JlbW92ZSA9IE1hdGguZmxvb3IodGhpcy5jb25maWcubWF4RW50cmllcyAqIDAuMik7XHJcbiAgICAgIGNvbnN0IHJlbW92ZWRFbnRyaWVzID0gdGhpcy5sb2dzLnNwbGljZSgwLCBlbnRyaWVzVG9SZW1vdmUpO1xyXG4gICAgICB0aGlzLnJldHVybkVudHJpZXNUb1Bvb2wocmVtb3ZlZEVudHJpZXMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT3B0aW1pemVkIGRlZXAgY2xvbmUgZm9yIGRhdGEgdG8gcHJldmVudCByZWZlcmVuY2UgbGVha3NcclxuICAgKi9cclxuICBwcml2YXRlIGNsb25lRGF0YShkYXRhOiBhbnkpOiBhbnkge1xyXG4gICAgaWYgKGRhdGEgPT09IG51bGwgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGEuZ2V0VGltZSgpKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gdGhpcy5jbG9uZURhdGEoaXRlbSkpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGb3Igb2JqZWN0cywgY3JlYXRlIGEgc2hhbGxvdyBjbG9uZSBhbmQgcmVjdXJzaXZlbHkgY2xvbmUgbmVzdGVkIG9iamVjdHNcclxuICAgIGNvbnN0IGNsb25lZDogYW55ID0ge307XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XHJcbiAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICBjbG9uZWRba2V5XSA9IHRoaXMuY2xvbmVEYXRhKGRhdGFba2V5XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGNsb25lZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBwZXJmb3JtYW5jZSBtZXRyaWNzIGZvciB0aGUgZGVidWcgbG9nZ2VyXHJcbiAgICovXHJcbiAgZ2V0UGVyZm9ybWFuY2VNZXRyaWNzKCk6IHtcclxuICAgIHRvdGFsTG9nczogbnVtYmVyO1xyXG4gICAgYXZlcmFnZUxvZ1RpbWU6IG51bWJlcjtcclxuICAgIHBvb2xTaXplOiBudW1iZXI7XHJcbiAgICBtYXhQb29sU2l6ZTogbnVtYmVyO1xyXG4gICAgbWVtb3J5VXNhZ2U6IHtcclxuICAgICAgY3VycmVudExvZ3M6IG51bWJlcjtcclxuICAgICAgbWF4TG9nczogbnVtYmVyO1xyXG4gICAgICB1dGlsaXphdGlvblBlcmNlbnQ6IG51bWJlcjtcclxuICAgIH07XHJcbiAgfSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbExvZ3M6IHRoaXMubG9nQ291bnQsXHJcbiAgICAgIGF2ZXJhZ2VMb2dUaW1lOiB0aGlzLmxvZ0NvdW50ID4gMCA/IHRoaXMudG90YWxMb2dUaW1lIC8gdGhpcy5sb2dDb3VudCA6IDAsXHJcbiAgICAgIHBvb2xTaXplOiB0aGlzLmVudHJ5UG9vbC5sZW5ndGgsXHJcbiAgICAgIG1heFBvb2xTaXplOiB0aGlzLm1heFBvb2xTaXplLFxyXG4gICAgICBtZW1vcnlVc2FnZToge1xyXG4gICAgICAgIGN1cnJlbnRMb2dzOiB0aGlzLmxvZ3MubGVuZ3RoLFxyXG4gICAgICAgIG1heExvZ3M6IHRoaXMuY29uZmlnLm1heEVudHJpZXMsXHJcbiAgICAgICAgdXRpbGl6YXRpb25QZXJjZW50OiAodGhpcy5sb2dzLmxlbmd0aCAvIHRoaXMuY29uZmlnLm1heEVudHJpZXMpICogMTAwXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGb3JjZSBhIG1lbW9yeSBjbGVhbnVwIGFuZCBvcHRpbWl6YXRpb25cclxuICAgKi9cclxuICBvcHRpbWl6ZU1lbW9yeSgpOiB2b2lkIHtcclxuICAgIC8vIFBlcmZvcm0gYWdncmVzc2l2ZSBjbGVhbnVwXHJcbiAgICB0aGlzLnBlcmlvZGljQ2xlYW51cCgpO1xyXG4gICAgXHJcbiAgICAvLyBDb21wYWN0IHRoZSBsb2dzIGFycmF5IGlmIG5lZWRlZFxyXG4gICAgaWYgKHRoaXMubG9ncy5sZW5ndGggPCB0aGlzLmNvbmZpZy5tYXhFbnRyaWVzICogMC41KSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIG5ldyBhcnJheSB0byByZWR1Y2UgbWVtb3J5IGZyYWdtZW50YXRpb25cclxuICAgICAgdGhpcy5sb2dzID0gWy4uLnRoaXMubG9nc107XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFRyaW0gcG9vbCB0byBvcHRpbWFsIHNpemVcclxuICAgIGNvbnN0IG9wdGltYWxQb29sU2l6ZSA9IE1hdGgubWluKHRoaXMubWF4UG9vbFNpemUsIE1hdGguY2VpbCh0aGlzLmNvbmZpZy5tYXhFbnRyaWVzICogMC4xKSk7XHJcbiAgICBpZiAodGhpcy5lbnRyeVBvb2wubGVuZ3RoID4gb3B0aW1hbFBvb2xTaXplKSB7XHJcbiAgICAgIHRoaXMuZW50cnlQb29sLmxlbmd0aCA9IG9wdGltYWxQb29sU2l6ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wdGltaXplZCBKU09OIHN0cmluZ2lmaWNhdGlvbiB3aXRoIHNpemUgbGltaXRzIHRvIHByZXZlbnQgbWVtb3J5IGlzc3Vlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgb3B0aW1pemVkU3RyaW5naWZ5KG9iajogYW55LCBtYXhEZXB0aDogbnVtYmVyID0gNSwgY3VycmVudERlcHRoOiBudW1iZXIgPSAwKTogc3RyaW5nIHtcclxuICAgIC8vIFByZXZlbnQgaW5maW5pdGUgcmVjdXJzaW9uIGFuZCBleGNlc3NpdmUgbWVtb3J5IHVzYWdlXHJcbiAgICBpZiAoY3VycmVudERlcHRoID49IG1heERlcHRoKSB7XHJcbiAgICAgIHJldHVybiAnW01heCBEZXB0aCBSZWFjaGVkXSc7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEhhbmRsZSBwcmltaXRpdmUgdHlwZXMgcXVpY2tseVxyXG4gICAgaWYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gU3RyaW5nKG9iaik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ3N0cmluZycgPyBgXCIke29ian1cImAgOiBTdHJpbmcob2JqKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gSGFuZGxlIGNpcmN1bGFyIHJlZmVyZW5jZXMgYW5kIGxhcmdlIG9iamVjdHNcclxuICAgIGNvbnN0IHNlZW4gPSBuZXcgV2Vha1NldCgpO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqLCAoa2V5LCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgIC8vIEhhbmRsZSBjaXJjdWxhciByZWZlcmVuY2VzXHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgICAgIGlmIChzZWVuLmhhcyh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdbQ2lyY3VsYXIgUmVmZXJlbmNlXSc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWVuLmFkZCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIExpbWl0IHN0cmluZyBsZW5ndGggdG8gcHJldmVudCBtZW1vcnkgYmxvYXRcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS5sZW5ndGggPiAxMDAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gdmFsdWUuc3Vic3RyaW5nKDAsIDEwMDApICsgJy4uLiBbVHJ1bmNhdGVkXSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgfSwgMik7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gJ1tTZXJpYWxpemF0aW9uIEZhaWxlZF0nO1xyXG4gICAgfVxyXG4gIH1cclxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7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QUFhO0FBQy9CLFdBQU8sS0FBSyxjQUFjLGNBQWMsSUFBSTtBQUFBLEVBQzlDO0FBQUEsRUFFQSxNQUFNLG9CQUFvQjtBQUN4QixXQUFPLEtBQUssY0FBYyxrQkFBa0I7QUFBQSxFQUM5QztBQUFBO0FBQUEsRUFHQSxNQUFNLHFCQUFxQjtBQUFBLEVBRTNCO0FBQUEsRUFFQSxNQUFNLGlCQUFtRDtBQUN2RCxXQUFPLEtBQUssWUFBWSxlQUFlO0FBQUEsRUFDekM7QUFBQSxFQUVBLHVCQUFxQztBQUNuQyxXQUFPLEtBQUssWUFBWSxxQkFBcUI7QUFBQSxFQUMvQztBQUFBO0FBQUEsRUFHQSxNQUFNLFFBQVEsY0FBc0IsWUFBNEM7QUFDOUUsV0FBTyxLQUFLLFlBQVksUUFBUSxjQUFjLFVBQVU7QUFBQSxFQUMxRDtBQUFBLEVBRUEsTUFBTSxpQkFBaUIsVUFBcUQ7QUFDMUUsV0FBTyxLQUFLLFlBQVksaUJBQWlCLFFBQVE7QUFBQSxFQUNuRDtBQUFBLEVBRUEsaUJBQWlCLFVBQTRCO0FBQzNDLFdBQU8sS0FBSyxZQUFZLGlCQUFpQixRQUFRO0FBQUEsRUFDbkQ7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJlIiwgImltcG9ydF9vYnNpZGlhbiJdCn0K
